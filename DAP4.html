<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="author" content="Copyright 2016 UCAR and OPeNDAP, Inc.">
<title>The Data Access Protocol Version 4 (DAP4) Specification</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<!--
###############################################################################
# Generate a nice TOC
#
# Thanks to StackOverflow user "rec",
#     https://stackoverflow.com/users/2511197/rec
# For this answer:
#     https://stackoverflow.com/questions/34481638/how-to-use-tocify-with-asciidoctor-for-a-dynamic-toc
# Which seems to be working nicely for us.
#
# The OPeNDAP Team
###############################################################################
-->

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script>
    /*! jquery.tocify - v1.9.0 - 2013-10-01
     * http://gregfranko.com/jquery.tocify.js/
     * Copyright (c) 2013 Greg Franko; Licensed MIT
     */
    (function (e) {
        "use strict"; e(window.jQuery, window, document)
    })(function (e, t, s) {
        "use strict"; var i = "tocify", o = "tocify-focus", n = "tocify-hover", a = "tocify-hide", l = "tocify-header", h = "." + l, r = "tocify-subheader", d = "." + r, c = "tocify-item", f = "." + c, u = "tocify-extend-page", p = "." + u; e.widget("toc.tocify", {
            version: "1.9.0", options: {
                context: "body", ignoreSelector: null, selectors: "h1, h2, h3", showAndHide: ! 0, showEffect: "slideDown", showEffectSpeed: "medium", hideEffect: "slideUp", hideEffectSpeed: "medium", smoothScroll: ! 0, smoothScrollSpeed: "medium", scrollTo: 0, showAndHideOnScroll: ! 0, highlightOnScroll: ! 0, highlightOffset: 40, theme: "bootstrap", extendPage: ! 0, extendPageOffset: 100, history: ! 0, scrollHistory: ! 1, hashGenerator: "compact", highlightDefault: ! 0
            },
            _create: function () {
                var s = this; s.extendPageScroll = ! 0, s.items =[], s._generateToc(), s._addCSSClasses(), s.webkit = function () {
                    for (var e in t) if (e && -1 !== e.toLowerCase().indexOf("webkit")) return ! 0; return ! 1
                }
                (), s._setEventHandlers(), e(t).load(function () {
                    s._setActiveElement(! 0), e("html, body").promise().done(function () {
                        setTimeout(function () {
                                s.extendPageScroll = ! 1
                            },
                            0)
                    })
                })
            },
            _generateToc: function () {
                var t, s, o = this, n = o.options.ignoreSelector; return t = -1 !== this.options.selectors.indexOf(",") ? e(this.options.context).find(this.options.selectors.replace(/ /g, "").substr(0, this.options.selectors.indexOf(","))): e(this.options.context).find(this.options.selectors.replace(/ /g, "")), t.length ?(o.element.addClass(i), t.each(function (t) {
                    e(this).is(n) ||(s = e("<ul/>", {
                        id: l + t, "class": l
                    }).append(o._nestElements(e(this), t)), o.element.append(s), e(this).nextUntil(this.nodeName.toLowerCase()).each(function () {
                        0 === e(this).find(o.options.selectors).length ? e(this).filter(o.options.selectors).each(function () {
                            e(this).is(n) || o._appendSubheaders.call(this, o, s)
                        }): e(this).find(o.options.selectors).each(function () {
                            e(this).is(n) || o._appendSubheaders.call(this, o, s)
                        })
                    }))
                }), undefined):(o.element.addClass(a), undefined)
            },
            _setActiveElement: function (e) {
                var s = this, i = t.location.hash.substring(1), o = s.element.find('li[data-unique="' + i + '"]');
                return i.length ?(s.element.find("." + s.focusClass).removeClass(s.focusClass), o.addClass(s.focusClass), s.options.showAndHide && o.click()):(s.element.find("." + s.focusClass).removeClass(s.focusClass), ! i.length && e && s.options.highlightDefault && s.element.find(f).first().addClass(s.focusClass)), s
            },
            _nestElements: function (t, s) {
                var i, o, n; return i = e.grep(this.items, function (e) {
                    return e === t.text()
                }), i.length ? this.items.push(t.text() + s): this.items.push(t.text()), n = this._generateHashValue(i, t, s), o = e("<li/>", {
                    "class": c, "data-unique": n
                }).append(e("<a/>", {
                    text: t.text()
                })), t.before(e("<div/>", {
                    name: n, "data-unique": n
                })), o
            },
            _generateHashValue: function (e, t, s) {
                var i = "", o = this.options.hashGenerator; if ("pretty" === o) {
                    for (i = t.text().toLowerCase().replace(/\s/g, "-");
                         i.indexOf("--") > -1;) i = i.replace(/--/g, "-");
                    for (; i.indexOf(":-") > -1;) i = i.replace(/:-/g, "-")
                } else i = "function" == typeof o ? o(t.text(), t): t.text().replace(/\s/g, "");
                return e.length &&(i += "" + s), i
            },
            _appendSubheaders: function (t, s) {
                var i = e(this).index(t.options.selectors), o = e(t.options.selectors).eq(i -1), n = + e(this).prop("tagName").charAt(1), a = + o.prop("tagName").charAt(1);
                a > n ? t.element.find(d + "[data-tag=" + n + "]").last().append(t._nestElements(e(this), i)): n === a ? s.find(f).last().after(t._nestElements(e(this), i)): s.find(f).last().after(e("<ul/>", {
                    "class": r, "data-tag": n
                })).next(d).append(t._nestElements(e(this), i))
            },
            _setEventHandlers: function () {
                var i = this; this.element.on("click.tocify", "li", function () {
                    if (i.options.history &&(t.location.hash = e(this).attr("data-unique")), i.element.find("." + i.focusClass).removeClass(i.focusClass), e(this).addClass(i.focusClass), i.options.showAndHide) {
                        var s = e('li[data-unique="' + e(this).attr("data-unique") + '"]');
                        i._triggerShow(s)
                    }
                    i._scrollTo(e(this))
                }), this.element.find("li").on({
                    "mouseenter.tocify": function () {
                        e(this).addClass(i.hoverClass), e(this).css("cursor", "pointer")
                    },
                    "mouseleave.tocify": function () {
                        "bootstrap" !== i.options.theme && e(this).removeClass(i.hoverClass)
                    }
                }),(i.options.extendPage || i.options.highlightOnScroll || i.options.scrollHistory || i.options.showAndHideOnScroll) && e(t).on("scroll.tocify", function () {
                    e("html, body").promise().done(function () {
                        var o, n, a, l, h = e(t).scrollTop(), r = e(t).height(), d = e(s).height(), c = e("body")[0].scrollHeight; if (i.options.extendPage &&(i.webkit && h >= c - r - i.options.extendPageOffset || ! i.webkit && r + h > d - i.options.extendPageOffset) && ! e(p).length) {
                            if (n = e('div[data-unique="' + e(f).last().attr("data-unique") + '"]'), ! n.length) return; a = n.offset().top, e(i.options.context).append(e("<div />", {
                                "class": u, height: Math.abs(a - h) + "px", "data-unique": u
                            })), i.extendPageScroll &&(l = i.element.find("li.active"), i._scrollTo(e('div[data-unique="' + l.attr("data-unique") + '"]')))
                        }
                        setTimeout(function () {
                                var s, n = null, a = null, l = e(i.options.context).find("div[data-unique]");
                                l.each(function (t) {
                                    var s = Math.abs((e(this).next().length ? e(this).next(): e(this)).offset().top - h - i.options.highlightOffset);
                                    return null == n || n > s ?(n = s, a = t, undefined): ! 1
                                }), s = e(l[a]).attr("data-unique"), o = e('li[data-unique="' + s + '"]'), i.options.highlightOnScroll && o.length &&(i.element.find("." + i.focusClass).removeClass(i.focusClass), o.addClass(i.focusClass)), i.options.scrollHistory && t.location.hash !== "#" + s && t.location.replace("#" + s), i.options.showAndHideOnScroll && i.options.showAndHide && i._triggerShow(o, ! 0)
                            },
                            0)
                    })
                })
            },
            show: function (t) {
                var s = this; if (! t.is(":visible")) switch (t.find(d).length || t.parent().is(h) || t.parent().is(":visible") ? t.children(d).length || t.parent().is(h) ||(t = t.closest(d)): t = t.parents(d).add(t), s.options.showEffect) {
                    case "none": t.show();
                        break; case "show": t.show(s.options.showEffectSpeed);
                        break; case "slideDown": t.slideDown(s.options.showEffectSpeed);
                        break; case "fadeIn": t.fadeIn(s.options.showEffectSpeed);
                        break; default: t.show()
                }
                return t.parent().is(h) ? s.hide(e(d).not(t)): s.hide(e(d).not(t.closest(h).find(d).not(t.siblings()))), s
            },
            hide: function (e) {
                var t = this; switch (t.options.hideEffect) {
                    case "none": e.hide();
                        break; case "hide": e.hide(t.options.hideEffectSpeed);
                        break; case "slideUp": e.slideUp(t.options.hideEffectSpeed);
                        break; case "fadeOut": e.fadeOut(t.options.hideEffectSpeed);
                        break; default: e.hide()
                }
                return t
            },
            _triggerShow: function (e, t) {
                var s = this; return e.parent().is(h) || e.next().is(d) ? s.show(e.next(d), t): e.parent().is(d) && s.show(e.parent(), t), s
            },
            _addCSSClasses: function () {
                return "jqueryui" === this.options.theme ?(this.focusClass = "ui-state-default", this.hoverClass = "ui-state-hover", this.element.addClass("ui-widget").find(".toc-title").addClass("ui-widget-header").end().find("li").addClass("ui-widget-content")): "bootstrap" === this.options.theme ?(this.element.find(h + "," + d).addClass("nav nav-list"), this.focusClass = "active"):(this.focusClass = o, this.hoverClass = n), this
            },
            setOption: function () {
                e.Widget.prototype._setOption.apply(this, arguments)
            },
            setOptions: function () {
                e.Widget.prototype._setOptions.apply(this, arguments)
            },
            _scrollTo: function (t) {
                var s = this, i = s.options.smoothScroll || 0, o = s.options.scrollTo, n = e('div[data-unique="' + t.attr("data-unique") + '"]');
                return n.length ?(e("html, body").promise().done(function () {
                    e("html, body").animate({
                        scrollTop: n.offset().top -(e.isFunction(o) ? o.call(): o) + "px"
                    }, {
                        duration: i
                    })
                }), s): s
            }
        })
    });
</script>

<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
    .tocify-header {
        font-style: italic;
    }

    .tocify-subheader {
        font-style: normal;
        font-size: 90%;
    }

    .tocify ul {
        margin: 0;
    }

    .tocify-focus {
        color: #7a2518;
        background-color: rgba(0, 0, 0, 0.1);
    }

    .tocify-focus > a {
        color: #7a2518;
    }
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C166YERTXV"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag("js", new Date());
gtag("config", "G-C166YERTXV");
</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Data Access Protocol Version 4 (DAP4) Specification</h1>
<div class="details">
<span id="author" class="author">Copyright 2016 UCAR and OPeNDAP, Inc.</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#Data_Model">1. Data Model, Persistent Representations, and Constraints</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1. Introduction</a></li>
<li><a href="#_requirements">1.2. Requirements</a></li>
<li><a href="#_overall_operation">1.3. Overall Operation</a></li>
<li><a href="#_characterization_of_a_data_source">1.4. Characterization of a Data Source</a></li>
<li><a href="#_dmr_declarations">1.5. DMR Declarations</a>
<ul class="sectlevel3">
<li><a href="#_dmr_xml_format">1.5.1. DMR XML Format</a></li>
<li><a href="#_names">1.5.2. Names</a></li>
<li><a href="#_reserved_names">1.5.3. Reserved Names</a></li>
<li><a href="#_fully_qualified_names">1.5.4. Fully Qualified Names</a></li>
<li><a href="#_fqn_references">1.5.5. FQN References</a></li>
<li><a href="#_definitional_declarations_versus_data_bearing_declarations">1.5.6. Definitional Declarations versus Data-Bearing Declarations</a></li>
<li><a href="#_dataset">1.5.7. Dataset</a></li>
<li><a href="#_groups">1.5.8. Groups</a></li>
<li><a href="#_dimensions">1.5.9. Dimensions</a></li>
<li><a href="#_enumeration_types">1.5.10. Enumeration Types</a></li>
<li><a href="#_atomic_types">1.5.11. Atomic Types</a></li>
<li><a href="#_container_types">1.5.12. Container Types</a></li>
<li><a href="#_variables">1.5.13. Variables</a>
<ul class="sectlevel4">
<li><a href="#_simple_variables">Simple Variables</a></li>
<li><a href="#_dimension_ordering">Dimension Ordering</a></li>
<li><a href="#_structure_variables">Structure Variables</a></li>
<li><a href="#_sequence_variables">Sequence Variables</a></li>
<li><a href="#_coverage_variables_and_maps">Coverage Variables and Maps</a></li>
</ul>
</li>
<li><a href="#_attributes_and_arbitrary_xml">1.5.14. Attributes and Arbitrary XML</a></li>
<li><a href="#_namespaces">1.5.15. Namespaces</a></li>
</ul>
</li>
<li><a href="#_data_representation">1.6. Data Representation</a>
<ul class="sectlevel3">
<li><a href="#_response_format">1.6.1. Response Format</a></li>
<li><a href="#_the_dap4_serialized_representation">1.6.2. The DAP4 Serialized Representation</a>
<ul class="sectlevel4">
<li><a href="#_a_note_on_dimension_ordering">A Note on Dimension Ordering</a></li>
<li><a href="#_order_of_serialization">Order of Serialization</a></li>
<li><a href="#_variable_representation">Variable Representation</a></li>
<li><a href="#_numeric_scalar_atomic_types">Numeric Scalar Atomic Types</a></li>
<li><a href="#_byte_swapping_rules">Byte Swapping Rules</a></li>
<li><a href="#_variable_length_scalar_atomic_types">Variable-Length Scalar Atomic Types</a></li>
<li><a href="#_structure_variable_representation">Structure Variable Representation</a></li>
<li><a href="#_sequence_variable_representation">Sequence Variable Representation</a></li>
<li><a href="#_checksums">Checksums</a></li>
</ul>
</li>
<li><a href="#_example_responses">1.6.3. Example responses</a>
<ul class="sectlevel4">
<li><a href="#_a_single_scalar">A single scalar</a></li>
<li><a href="#_a_single_array">A single array</a></li>
<li><a href="#_a_single_structure">A single structure</a></li>
<li><a href="#_an_array_of_structures">An array of structures</a></li>
<li><a href="#_single_array_with_sequence">Single array with sequence</a></li>
<li><a href="#_nested_sequences">Nested Sequences</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dap4_chunked_data_representation">1.7. DAP4 Chunked Data Representation</a>
<ul class="sectlevel3">
<li><a href="#_chunked_format_grammar">1.7.1. Chunked Format Grammar</a></li>
<li><a href="#_lexical_structure">1.7.2. Lexical Structure</a></li>
</ul>
</li>
<li><a href="#_constraints">1.8. Constraints</a>
<ul class="sectlevel3">
<li><a href="#_terminology_used_by_this_section">1.8.1. Terminology used by this section</a></li>
<li><a href="#_subsetting_constraints">1.8.2. Subsetting Constraints</a>
<ul class="sectlevel4">
<li><a href="#_example_1_subsetting_by_variable_or_field_in_a_structure">Example 1: subsetting by variable or field in a Structure</a></li>
<li><a href="#_example_2_subsetting_by_variable_or_field_in_a_group">Example 2: subsetting by variable or field in a Group</a></li>
</ul>
</li>
<li><a href="#_array_subsetting_in_index_space">1.8.3. Array Subsetting in Index Space</a>
<ul class="sectlevel4">
<li><a href="#_example_dataset_with_a_structure_which_has_an_anonymous_dimension_scalar_variables_in_it">Example: Dataset with a Structure which has an anonymous Dimension scalar variables in it</a></li>
<li><a href="#_example_structure_with_scalar_and_array_variables_inside_and_anonymous_dimensions">Example: Structure with scalar and array variables inside and anonymous dimensions</a></li>
<li><a href="#_example_dataset_with_nested_structures_and_anonymous_dimensions">Example: Dataset with Nested Structures and anonymous dimensions</a></li>
</ul>
</li>
<li><a href="#_array_subsetting_with_disjoint_index_subsets">1.8.4. Array subsetting with Disjoint Index Subsets</a></li>
<li><a href="#_how_sequences_fit_into_this_syntax">1.8.5. How Sequences fit into this syntax</a></li>
<li><a href="#_subsetting_and_shared_dimensions">1.8.6. Subsetting and Shared Dimensions</a>
<ul class="sectlevel4">
<li><a href="#_examples_using_shared_dimensions_and_anonymous_dimension">Examples using Shared Dimensions and Anonymous Dimension</a></li>
</ul>
</li>
<li><a href="#_constrained_dmr_objects">1.8.7. Constrained DMR Objects</a>
<ul class="sectlevel4">
<li><a href="#_enumerations">Enumerations</a></li>
<li><a href="#_shared_dimensions">Shared Dimensions</a></li>
<li><a href="#_variables_2">Variables</a></li>
<li><a href="#_array_variables">Array Variables</a></li>
<li><a href="#_structure_variables_2">Structure Variables</a></li>
<li><a href="#_sequence_variables_2">Sequence Variables</a></li>
<li><a href="#_groups_2">Groups</a></li>
<li><a href="#_attributes">Attributes</a></li>
</ul>
</li>
<li><a href="#_filters">1.8.8. Filters</a></li>
<li><a href="#_filters_and_more_complex_data_types">1.8.9. Filters and more complex data types</a>
<ul class="sectlevel4">
<li><a href="#_example_filters_on_complex_types">Example: Filters on complex types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">1.9. References</a></li>
<li><a href="#_appendices">1.10. Appendices</a>
<ul class="sectlevel3">
<li><a href="#_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">1.10.1. Appendix 1. DAP4 DMR Syntax as a RELAX NG Schema</a></li>
<li><a href="#_appendix_2_dap4_relax_ng_lexical_elements">1.10.2. Appendix 2. DAP4 RELAX NG Lexical Elements</a>
<ul class="sectlevel4">
<li><a href="#_basic_character_set_definitions">Basic character set definitions</a></li>
<li><a href="#_ascii_characters_that_may_appear_unescaped_in_identifiers">Ascii characters that may appear unescaped in Identifiers</a></li>
<li><a href="#_the_numeric_constant_classes_integer_and_float">The Numeric Constant Classes: integer and float</a></li>
<li><a href="#_the_stringurl_constant_class">The String/URL Constant Class</a></li>
<li><a href="#_the_opaque_constant_class">The Opaque Constant Class</a></li>
<li><a href="#_the_identifier_class">The Identifier Class</a></li>
<li><a href="#_the_atomic_type_class">The Atomic Type Class</a></li>
<li><a href="#_the_fully_qualified_name_class">The Fully Qualified Name Class</a></li>
</ul>
</li>
<li><a href="#_appendix_3_dap4_type_definitions">1.10.3. Appendix 3. DAP4 Type Definitions</a></li>
<li><a href="#_appendix_4_utf_8">1.10.4. Appendix 4. UTF-8</a></li>
<li><a href="#_appendix_5_lalr1_grammar_for_dmr_using_bison_notation">1.10.5. Appendix 5. LALR(1) Grammar for DMR using Bison Notation</a>
<ul class="sectlevel4">
<li><a href="#_lexical_tokens_for_bison_grammar">Lexical Tokens for Bison Grammar</a></li>
</ul>
</li>
<li><a href="#_appendix_6_lalr1_grammar_for_constraints_using_bison_notation">1.10.6. Appendix 6. LALR(1) Grammar for Constraints using Bison Notation</a>
<ul class="sectlevel4">
<li><a href="#_lexical_tokens_for_bison_grammar_for_constraints">Lexical Tokens for Bison Grammar for Constraints</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#Web_Services">2. Web Services</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">2.1. Introduction</a></li>
<li><a href="#_terms_and_definitions">2.2. Terms and Definitions</a>
<ul class="sectlevel3">
<li><a href="#_dap4_resource_roles_and_media_types">2.2.1. DAP4 Resource Roles and Media Types</a></li>
<li><a href="#_dap4_core_specification_documents">2.2.2. DAP4 Core Specification Documents</a></li>
<li><a href="#_extensions_to_dap4_core_specifications">2.2.3. Extensions to DAP4 Core Specifications</a></li>
</ul>
</li>
<li><a href="#_dap4_web_service_responses">2.3. DAP4 Web Service Responses</a>
<ul class="sectlevel3">
<li><a href="#_dap4_dataset_services_response">2.3.1. DAP4 Dataset Services Response</a>
<ul class="sectlevel4">
<li><a href="#_dsr_resource_role">DSR Resource Role</a></li>
<li><a href="#_normative_encoding_of_the_dsr">Normative Encoding of the DSR</a></li>
<li><a href="#_service_behavior">Service Behavior</a>
<ul class="sectlevel5">
<li><a href="#_downgrading_the_normative_xml_encoding_required">Downgrading the Normative XML Encoding (Required)</a></li>
</ul>
</li>
<li><a href="#_other_encodings_of_the_dsr">Other Encodings of the DSR</a>
<ul class="sectlevel5">
<li><a href="#_html_encoding_optional">HTML Encoding (Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dataset_metadata_response_dmr">2.3.2. Dataset Metadata Response (DMR)</a>
<ul class="sectlevel4">
<li><a href="#_dmr_resource_role">DMR Resource Role</a></li>
<li><a href="#_normative_encoding_of_the_dmr">Normative Encoding of the DMR</a></li>
<li><a href="#_service_behavior_2">Service Behavior</a>
<ul class="sectlevel5">
<li><a href="#_downgrading_the_normative_xml_encoding_required_2">Downgrading the Normative XML Encoding (Required)</a></li>
</ul>
</li>
<li><a href="#_other_encodings_of_the_dmr">Other Encodings of the DMR</a>
<ul class="sectlevel5">
<li><a href="#_html_encoding_optional_2">HTML Encoding (Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dap4_data_response">2.3.3. DAP4: Data Response</a>
<ul class="sectlevel4">
<li><a href="#_data_response_resource_role">Data Response Resource Role</a></li>
<li><a href="#_normative_encoding_of_the_data_response">Normative Encoding of the Data Response</a></li>
<li><a href="#_service_behavior_3">Service Behavior</a></li>
<li><a href="#_other_encodings_of_the_data_response">Other Encodings of the Data Response</a>
<ul class="sectlevel5">
<li><a href="#_text_encoding_optional">Text Encoding (Optional)</a></li>
<li><a href="#_xml_encoding_optional">XML Encoding (Optional)</a></li>
<li><a href="#_netcdf_3_encoding_optional">NetCDF-3 Encoding (Optional)</a></li>
<li><a href="#_netcdf_4_encoding_optional">NetCDF-4 Encoding (Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dap4_error_response">2.3.4. DAP4 Error Response</a>
<ul class="sectlevel4">
<li><a href="#_error_response_resource_role">Error Response Resource Role</a></li>
<li><a href="#_normative_encoding_of_the_error_response">Normative Encoding of the Error Response</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_http">2.4. HTTP</a>
<ul class="sectlevel3">
<li><a href="#_content_negotiation_and_media_types">2.4.1. Content Negotiation and Media Types</a></li>
<li><a href="#_redirects">2.4.2. Redirects</a></li>
<li><a href="#_caching_of_responses_and_conditional_requests">2.4.3. Caching of Responses and Conditional Requests</a></li>
<li><a href="#_authenticationauthorization">2.4.4. Authentication/Authorization</a></li>
<li><a href="#_headers">2.4.5. Headers</a>
<ul class="sectlevel4">
<li><a href="#_request_headers">Request Headers</a>
<ul class="sectlevel5">
<li><a href="#_general">General</a></li>
<li><a href="#_dap_specific">DAP Specific</a></li>
</ul>
</li>
<li><a href="#_response_headers">Response Headers</a>
<ul class="sectlevel5">
<li><a href="#_general_2">General</a></li>
<li><a href="#_dap_specific_2">DAP Specific</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_status_codes">2.4.6. Status Codes</a>
<ul class="sectlevel4">
<li><a href="#_200_ok">200 OK</a></li>
<li><a href="#_400_bad_request">400 Bad Request</a>
<ul class="sectlevel5">
<li><a href="#_400_bad_dap4_request_syntax">400 Bad DAP4 Request Syntax</a></li>
</ul>
</li>
<li><a href="#_401_unauthorized">401 Unauthorized</a></li>
<li><a href="#_403_forbidden">403 Forbidden</a></li>
<li><a href="#_404_not_found">404 Not Found</a></li>
<li><a href="#_415_unsupported_media_type">415 Unsupported Media Type</a></li>
<li><a href="#_500_internal_server_error">500 Internal Server Error</a></li>
</ul>
</li>
<li><a href="#_verbs_aka_methods">2.4.7. Verbs (aka Methods)</a>
<ul class="sectlevel4">
<li><a href="#_get">GET</a>
<ul class="sectlevel5">
<li><a href="#_examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dap4_urls">2.5. DAP4 URLs</a>
<ul class="sectlevel3">
<li><a href="#_query_string_parameters">2.5.1. Query String Parameters</a></li>
</ul>
</li>
<li><a href="#_normative_references">2.6. Normative References</a></li>
<li><a href="#_non_normative_references">2.7. Non-Normative References</a></li>
<li><a href="#_appendix_ancillary_web_services_beyond_dap4">2.8. Appendix - Ancillary Web Services (Beyond DAP4)</a>
<ul class="sectlevel3">
<li><a href="#_dap4_html_data_request_form_service">2.8.1. DAP4: HTML DATA Request Form Service</a></li>
<li><a href="#_dap4_rdf_service">2.8.2. DAP4: RDF Service</a></li>
<li><a href="#_dap4_iso_19115_service">2.8.3. DAP4: ISO 19115 Service</a></li>
<li><a href="#_dap4_iso_conformance_score_service">2.8.4. DAP4: ISO Conformance Score Service</a></li>
<li><a href="#_dap4_netcdf_file_out_service">2.8.5. DAP4: NetCDF File-out Service</a></li>
<li><a href="#_dap4_ascii_data_service">2.8.6. DAP4: ASCII Data Service</a></li>
<li><a href="#_dap4_xml_data_service">2.8.7. DAP4: XML Data Service</a></li>
<li><a href="#_dap4_native_file_access_service">2.8.8. DAP4: Native File Access Service</a></li>
<li><a href="#_dap4_server_version_service">2.8.9. DAP4: Server Version Service</a></li>
<li><a href="#_dap2_services">2.8.10. DAP2 Services</a>
<ul class="sectlevel4">
<li><a href="#_dap2_data_service">DAP2: Data Service</a></li>
<li><a href="#_dap2_ddx_service">DAP2: DDX Service</a></li>
<li><a href="#_dap2_dds_service">DAP2: DDS Service</a></li>
<li><a href="#_dap2_das_service">DAP2: DAS Service</a></li>
<li><a href="#_dap2_ascii_data_service">DAP2: ASCII Data Service</a></li>
<li><a href="#_dap2_json_data_service">DAP2: JSON Data Service</a></li>
<li><a href="#_dap2_info_service">DAP2: Info Service</a></li>
<li><a href="#_dap2_netcdf_service">DAP2: NetCDF Service</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#CSV-encoding-response">3. Extensions: CSV Data Encoding and Response</a>
<ul class="sectlevel2">
<li><a href="#_dap4_extension_details">3.1. DAP4 Extension Details</a></li>
<li><a href="#_requesting_dap4_csv_encoded_data_response">3.2. Requesting DAP4 CSV Encoded Data Response</a></li>
<li><a href="#_dap4_csv_encoding">3.3. DAP4 CSV Encoding</a></li>
<li><a href="#_normative_references_2">3.4. Normative References</a></li>
</ul>
</li>
<li><a href="#netcdf-encoding-response">4. Extensions: NetCDF Data Response</a>
<ul class="sectlevel2">
<li><a href="#_dap4_extension_details_2">4.1. DAP4 Extension Details</a></li>
</ul>
</li>
<li><a href="#netcdf-async">5. Extensions: Asynchronous Response</a>
<ul class="sectlevel2">
<li><a href="#_dap4_extension_details_3">5.1. DAP4 Extension Details</a></li>
<li><a href="#_summary_of_http_mechanisms_used_to_support_asynchronous_http_response">5.2. Summary of HTTP Mechanisms Used to Support Asynchronous HTTP Response</a></li>
<li><a href="#_overview_asynchronous_service_behavior_and_responses">5.3. Overview: Asynchronous Service Behavior and Responses</a></li>
<li><a href="#_client_willingness_to_accept_asynchronous_responses">5.4. Client willingness to accept asynchronous responses</a></li>
<li><a href="#_initial_processing_by_the_server">5.5. Initial processing by the server</a></li>
<li><a href="#_response_retrieval_by_the_client">5.6. Response retrieval by the client</a></li>
<li><a href="#_detail_client_requests">5.7. Detail: Client requests</a>
<ul class="sectlevel3">
<li><a href="#_dap4_constraint_expression_extension_for_async">5.7.1. DAP4 Constraint Expression extension for Async</a></li>
<li><a href="#_x_dap_async_accept">5.7.2. X-DAP-Async-Accept</a></li>
</ul>
</li>
<li><a href="#_detail_server_responses">5.8. Detail: Server responses</a>
<ul class="sectlevel3">
<li><a href="#_http_response_headers">5.8.1. HTTP Response Headers</a>
<ul class="sectlevel4">
<li><a href="#_x_dap_async_required">X-DAP-Async-Required</a></li>
<li><a href="#_x_dap_async_accepted">X-DAP-Async-Accepted</a></li>
</ul>
</li>
<li><a href="#_http_response_codes">5.8.2. HTTP Response Codes</a>
<ul class="sectlevel4">
<li><a href="#_202_accepted">202 Accepted</a></li>
<li><a href="#_400_dap4_asynchronous_response_required">400 DAP4 Asynchronous Response Required</a></li>
<li><a href="#_409_conflict_dap4_response_not_ready">409 Conflict - DAP4 Response Not Ready</a></li>
<li><a href="#_410_gone_dap4_response_no_longer_available">410 Gone - DAP4 Response No Longer Available</a></li>
<li><a href="#_412_precondition_failed">412 Precondition Failed</a></li>
<li><a href="#_500_internal_error">500 Internal Error</a></li>
</ul>
</li>
<li><a href="#_asynchronous_response_documents">5.8.3. Asynchronous Response Documents</a>
<ul class="sectlevel4">
<li><a href="#_dap4_asynchronous_response_required">DAP4 Asynchronous Response Required</a></li>
<li><a href="#_dap4_asynchronous_request_accepted">DAP4 Asynchronous Request Accepted</a></li>
<li><a href="#_dap4_asynchronous_response_not_yet_available">DAP4 Asynchronous Response Not (Yet) Available</a></li>
<li><a href="#_dap4_asynchronous_response_gone">DAP4 Asynchronous Response Gone</a></li>
<li><a href="#_dap4_asynchronous_request_rejected">DAP4 Asynchronous Request Rejected</a></li>
<li><a href="#_dap4_error">DAP4 Error</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_examples_2">5.9. Examples</a>
<ul class="sectlevel3">
<li><a href="#_constrained_data_request_response_using_get">5.9.1. Constrained Data Request-Response using GET</a></li>
<li><a href="#_constrained_data_request_response_with_dap_async_accept_request_header">5.9.2. Constrained Data Request-Response with DAP-Async-Accept Request Header</a></li>
<li><a href="#_constrained_data_request_response_with_conditional_dap_async_accept_request_headers">5.9.3. Constrained Data Request-Response with conditional DAP-Async-Accept Request Headers</a></li>
<li><a href="#_premature_request_for_asynchronous_result">5.9.4. Premature Request For Asynchronous Result</a></li>
</ul>
</li>
<li><a href="#_resource_role">5.10. Resource Role</a></li>
<li><a href="#_normative_encoding_of_the_asynchronous_response">5.11. Normative Encoding of the Asynchronous Response</a></li>
</ul>
</li>
<li><a href="#json-extension">6. Extensions: JSON Data and Metadata Encoding</a></li>
<li><a href="#deltas">7. Deltas</a>
<ul class="sectlevel2">
<li><a href="#_constraints_subsetting_unified_syntax">7.1. Constraints, subsetting: unified syntax</a></li>
<li><a href="#_constraints_subsetting_and_maps">7.2. constraints, subsetting and maps</a></li>
<li><a href="#_response_information">7.3. response information</a></li>
<li><a href="#_using_the_url_query_string_keyvalue_notation">7.4. using the url query string key=value notation</a></li>
<li><a href="#_sequences_with_structures_and_the_resulting_ces">7.5. sequences with structures and the resulting CEs</a></li>
<li><a href="#_basic_testing_support">7.6. basic testing support</a></li>
<li><a href="#_fqns_in_a_dmrdata_response">7.7. FQNs in a DMR/Data response</a></li>
<li><a href="#_augment_the_vol1_spec_with_details_about_ce_effects_on_a_dmr">7.8. augment the vol1 spec with details about CE effects on a DMR</a></li>
<li><a href="#_sequence_serialization_how_to_serialize_a_zero_length_sequence">7.9. sequence serialization: how to serialize a zero-length sequence</a></li>
<li><a href="#_ieee_754_for_real_numbers">7.10. IEEE 754 for real numbers</a></li>
<li><a href="#_how_big_are_arrays_64_bits_63_bits_61_bits_signed_unsigned">7.11. how big are arrays? 64 bits? 63 bits? 61 bits? signed? unsigned?</a></li>
<li><a href="#_about_the_end_chunk_in_a_chunked_response">7.12. About the end chunk in a chunked response</a></li>
<li><a href="#_where_we_encode_the_byte_order_for_a_dap4_data_response">7.13. where we encode the byte order for a DAP4 Data response</a></li>
<li><a href="#_order_of_stuff_in_the_dmr">7.14. Order of stuff in the DMR</a></li>
<li><a href="#_limitations_on_the_dmr_dim_element">7.15. limitations on the DMR Dim element</a></li>
<li><a href="#_names_2">7.16. names</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following two decades of stability and increasing use, DAP2 is being
superseded by DAP4, the first substantive revision in the history of the
Data Access Protocol (DAP), an open-source endeavor led by OPeNDAP, Inc.
The primary and continuing purpose of DAP is to realize <em>remote,
selective, data-retrieval as a widely-accepted and well-crafted Web
service</em>. This document outlines the fundamental concepts of DAP4, and
(targeting those who have already programmed DAP-compatible clients and
servers) it highlights how DAP4 differs from DAP2.</p>
</div>
<div class="paragraph">
<p>Though the protocol, per se, is maintained primarily by OPeNDAP, many
others have engaged in DAP2 realization. One implementation—by Unidata,
in the University Corp. for Atmospheric Research—includes the popular
THREDDS Data Server (TDS). A key motivation for DAP4, developed jointly
by OPeNDAP and Unidata, was to reduce differences that have arisen, and
impede interoperability, among DAP2 realizations. Our hope is that a
modernized, clearer and more comprehensive specification will facilitate
building clients and servers with greater interoperability, making such
ventures more rewarding and less risky.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><span class="blue">Data Retrieval as a Web Service</span></dt>
<dd>
<p>The premise underlying DAP4 remains, as in DAP2, that values from data
sources—or, notably, from proper subsets—along with pertinent metadata
may be acquired remotely and effectively through an appropriately
defined Web service, operated near the source data. To a surprising
degree, DAP services shield users from idiosyncrasies in source-data
formats and storage, so DAP functions as middleware with a further
advantage: source-data and users may reside anyplace that has Internet
connectivity. OPeNDAP’s commitment to open source has fostered several
DAP-compatible servers and an even larger number of DAP-compatible
client environments, several of which (i.e., servers, clients and
client-server libraries) are available at no cost.</p>
<div class="paragraph">
<p>DAP is designed for selectively retrieving (but not for storing) data
organized as variables or groups of variables. It is well suited to
cases where client computers retrieve data stored on remote computers
(i.e., servers) networked to the client, especially where data sources
are huge (comprising large arrays, e.g.) but clients typically need only
small subsets of them. The protocol is fundamentally stateless (some
might say &#8220;RESTful&#8221;), and it governs how clients pose requests and how
servers issue corresponding responses.</p>
</div>
<div class="paragraph">
<p>DAP’s effectiveness is keyed on the underlying data model, which
embraces a rich variety of data types (including tabular and array
structures). Based on this model, DAP spells out the (type-specific)
retrieval operations that clients may request. The flexibility and
domain-neutrality of the DAP data model (which has changed modestly
between DAP2 and DAP4) make it effective—as middleware, per the
above—across a broad range of data types and disciplinary domains.
Stated another way, many kinds of data sources and schemas can be mapped
onto the DAP model for retrieval and use by client computers and
software.</p>
</div>
</dd>
<dt class="hdlist1"><span class="blue">Understanding the DAP Data Model</span></dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>A Brief Data-Model Summary</strong></p>
<div class="paragraph">
<p>Unlike FTP and other protocols enabling clients to access whole files or
granules, DAP offers sub-granular retrievals, and this requires exposing
the detailed structure of each granule (called a &#8220;dataset&#8221; in DAP). To
this end, the structure of every DAP-accessible dataset is manifest in a
machine-readable document called the DMR. DMRs are declaration
statements that adhere formally to the DAP Data Model, which is
sufficiently general to make retrievable a variety of data granules and
data types whose semantics vary widely among the (potential) sources.</p>
</div>
<div class="paragraph">
<p>The DAP data model is built around a notion of &#8220;variables&#8221; that fall
into three classes—atoms, structures and sequences—and may be organized
as multidimensional arrays. As reflected in its DMR, all of a dataset’s
variables are named, and they may optionally be grouped (in a hierarchy)
to add meaning and allow complex name-driven retrievals by clients. DAP
variables are (strongly) typed and optionally may have &#8220;attributes&#8221;
and &#8220;dimensions&#8221;, the former to clarify meaning and the latter to
indicate a variable’s array shape (where relevant). Attributes resemble
variables except that the former may be assigned to the latter, but not
vice versa.</p>
</div>
<div class="paragraph">
<p>Much of DAP’s power arises from its typing structure. The value(s) of an
atomic variable (whether or not dimensioned as an array) are all of the
same atomic type, indicated in the DMR to be integer, floating point,
character, string, etc. Structure variables are combinations of atom
variables joined for semantic reasons, such as to represent complex
numbers, vector-valued parameters, or other relationships among the
values of a dataset.</p>
</div>
<div class="paragraph">
<p>To address a difficult abstraction challenge—retrievals from both
array-oriented and database-oriented sources—DAP allows DMRs to declare
variables of type &#8220;Sequence&#8221;. A sequence is like a relation, i.e., a
table whose rows are &#8220;instances&#8221; or &#8220;records&#8221; and whose columns
contain the values of &#8220;fields&#8221;. In DAP, the content of a sequence may
comprise an arbitrary number of instances (i.e., records) whose
&#8220;fields&#8221; are values from other DAP variables.</p>
</div>
<div class="paragraph">
<p>For example, a sequence named &#8220;BirdTracking&#8221; might contain variables
named &#8220;BirdID&#8221;, &#8220;BandingEvent&#8221;, and &#8220;ObservedPosition&#8221;, and the
contents of BirdTracking would be instances that contain values of the
specified variables (fields). DAP allows arbitrary nesting of sequences
and structures, so in this example BandingEvent could be a structure
(containing date and location info for the bird’s banding) and
ObservedPosition could be a sequence (containing equivalent date and
location info) whose instances represent subsequent bird observations.</p>
</div>
<div class="paragraph">
<p>Hypothetically, this is akin to making BirdTracking a structure with a
single dimension (though DAP does not allow arrays of indefinite
length). However, selective retrieval from an array would require
knowing the indices of desired instances, whereas a BirdTracking
sequence allows filtering-style retrievals that select instances on the
basis of their values.</p>
</div>
</li>
<li>
<p><strong>A Rough Glossary of Data-Model Entities</strong></p>
<div class="paragraph">
<p>Much about DAP may be discerned from a dictionary or glossary-like list
of the key entities in its data model. Such a list follows, sequenced
for ease of understanding (rather than alphabetically). These
descriptions are not definitive, as the formal specification documents
take precedence over anything stated here.</p>
</div>
<div class="ulist disc">
<ul class="disc">
<li>
<p><strong>Data Source</strong> - Though formally outside the DAP Data Model, the term
Data Source generally refers to all the datasets (see below) that may be
retrieved via DAP from a single server, identified by its domain name.
Servers sometimes offer (catalogs and/or inventories of) collections and
sub-collections, but the DAP Data Model focuses on granular and
sub-granular retrievals.</p>
</li>
<li>
<p><strong>Dataset</strong> - Sometimes called a &#8220;granule&#8221; in catalog/inventory
parlance, a DAP Dataset is represented by a unique (unadorned) URL, and
is the highest-level entity (metadata as well as content) described by
the DAP Data Model. Clients invoke retrieval operations by adorning the
Dataset URL with suffixes and query strings interpreted by the server.</p>
</li>
<li>
<p><strong>Declarations and the DMR</strong> - For a specific Dataset, all aspects of the
DAP Data Model (name assignments, structural definitions, etc) are
governed by a formal declarations document. Created as part of making a
Dataset DAP-retrievable, this document is dubbed the DMR (roughly:
Dataset Metadata Response), and clients may retrieve DMRs alongside or
independently of Dataset contents.</p>
</li>
<li>
<p><strong>Name</strong> - Most entities in the DAP Data Model may or must be named. With
some constraints on the use of special characters (such as &#8220;.&#8221;), a
Name can be any character string. To avoid conflicts, DAP has scoping
rules. For example, a Variable and a Dimension may have the same Name
without ambiguity, but two Variables can have the same Name only if they
are declared in different Groups or structures.</p>
</li>
<li>
<p><strong>Variable</strong> - The building blocks for the DAP Data Model are Variables,
which are strictly typed. Three classes of them (atoms, structures and
sequences) are described separately below, but in actuality these are
best distinguished by inspecting their Type declarations. Each Variable
must be assigned a Type and a Name, and it may optionally have a number
of Dimensions and Attributes, elaborated below.</p>
</li>
<li>
<p><strong>Type</strong> - Underpinning DAP’s &#8220;container&#8221; Types (Structure and Sequence,
implied above) are &#8220;atomic&#8221; Types akin to those of computer languages:
bytes, integers, floating-point values, strings, and URLs, plus an enum
type (permitting specified character strings, such as days of the week,
to be treated as variable values) and an opaque type (permitting
arbitrary blobs of bits). More detailed Type descriptions are provided
in Volume I of the DAP specification.</p>
</li>
<li>
<p><strong>(Atom) Variable</strong> - A Variable whose Type is atomic (see above)
comprises a single value or an array of values, and all its values are
of the designated Type. A Variable is an array only if its declaration
includes Dimensions, which determine the array’s shape and its
element-ordering (see below).</p>
</li>
<li>
<p><strong>(Structure) Variable</strong> - A Variable of Type &#8220;Structure&#8221; is a container
for other variables, often implying relationships among them. For
example, a structure Variable named &#8220;Velocity&#8221; might contain a pair of
atom Variables (or fields) named &#8220;x&#8221; and &#8220;y,&#8221; representing
components of a velocity vector. These components would be retrieved via
their &#8220;qualified&#8221; Names, &#8220;Velocity.x&#8221; and &#8220;Velocity.y&#8221;.</p>
<div class="paragraph">
<p><em>Notes on Structures:</em></p>
</div>
<div class="ulist circle">
<ul class="circle">
<li>
<p>Structures may contain variables of any type, including other
structures.</p>
</li>
<li>
<p>A contained variable can be used in the context of several containers,
but these contexts create separate, independent instances.</p>
</li>
<li>
<p>If the semantics of a variable are altered by its context, it should
be separately declared in each relevant context. For example,
declarations for the atoms &#8220;Velocity.x&#8221; and &#8220;Displacement.x&#8221; should
be distinct and separate (falling within &#8220;Velocity&#8221; and
&#8220;Displacement&#8221; declarations respectively) despite reuse of the name
&#8220;x&#8221;.</p>
</li>
<li>
<p>Though a dimensioned structure resembles a structure containing
dimensioned variables (with the same shapes), these are not equivalent,
and the means for referencing them differ. For example, array element
i,j would be referenced as:</p>
<div class="ulist square">
<ul class="square">
<li>
<p>Velocity[i,j].x if two dimensions are assigned to the Velocity
structure.</p>
</li>
<li>
<p>Velocity.x[i,j] if two dimensions are assigned to its x-component
variable.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>(Sequence) Variable</strong> - A Variable of Type &#8220;Sequence&#8221; is a container
holding multiple (unordered) instances of other DAP Variables. For
example, a sequence Variable named &#8220;TracerParticle&#8221; might contain a
pair of structures named &#8220;Velocity&#8221; and &#8220;Displacement&#8221;, each
declared—as in an earlier example—to have x and y components. The
instances of TracerParticle would be like a set of tabular records whose
four fields, Displacement.x, Displacement.y, Velocity.x, and Velocity.y
are retrieved via filter-style (rather than indexed) retrievals, as
discussed in a later section on Constraints.</p>
<div class="paragraph">
<p><em>Notes on Sequences:</em></p>
</div>
<div class="ulist circle">
<ul class="circle">
<li>
<p>Sequences may contain variables of any type, including other
sequences.</p>
</li>
<li>
<p>Though a sequence is similar in some respects to a structure with a
single (indexing) dimension, the differences are significant. For
example, if a DAP server offers retrieval of records from a relational
data base:</p>
</li>
<li>
<p>The most useful client retrievals may entail filtering based on the
values in the fields, and this yields indexing gaps. In other words,
indexing may have little or no utility.</p>
</li>
<li>
<p>The number of records may be hidden or dynamic, so a dimension length
cannot be calculated, and the order in which records are returned may be
volatile.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Group</strong> - The DAP Data Model has a hierarchical mechanism for grouping
Variables and carving out independent namespaces. Groups may be nested,
and all but one must have Names, the exception being the root of the
hierarchy, where the Dataset itself is a Group (needing no name).
Retrieving a Variable whose declaration falls within a Named Group
requires use of its fully qualified name (FQN), such as
GroupA.Group2.Velocity. Any Group (including the Dataset) may be
assigned Attributes but not Dimensions.</p>
</li>
<li>
<p><strong>Attribute</strong> - Otherwise nearly indistinguishable from a Variable, an
Attribute must always be assigned to a specific Variable or Group. The
purpose of Attributes is to provide context or add meaning to the
assigned entities, whereas the purpose of Variables is to convey primary
content. Retrieving an Attribute always requires prepending the name of
the Variable or Group to which it is assigned, which implies that
Attribute Names (such as &#8220;Units&#8221;) enjoy unlimited reusability.</p>
</li>
<li>
<p><strong>Dimension</strong> - A Dimension must have a size and may have a Name. A
Variable of any type may optionally be assigned a number of Dimensions,
in which case its (compound) values are organized and retrieved as an
indexible array of rank n, where n is the number of assigned Dimensions.</p>
<div class="paragraph">
<p><em>Notes on Dimensions:</em></p>
</div>
<div class="ulist circle">
<ul class="circle">
<li>
<p>Named Dimensions resemble named constants. Indeed, assigning a named
dimension to multiple variables (within the scope of a single group) has
the same effect on each, giving definition to that variable’s array
shape and array-element ordering.</p>
</li>
<li>
<p>Unlike attributes, dimensions often are declared outside the variables
to which they are assigned. Groups may not accept dimension assignments,
but groups limit the scope of the dimension names and sizes declared
within them.</p>
</li>
<li>
<p>Dimensions names may be reused, with differing sizes across multiple
groups.</p>
</li>
<li>
<p>The order of the dimension assignments in a variable declaration is
significant, as this determines the variable’s array-element ordering as
well as its shape.</p>
</li>
<li>
<p>Retrieving a dimension may require prepending the name of the group in
which it was declared but never the name of a variable to which it has
been assigned.</p>
</li>
<li>
<p>A Dimension’s size must be a positive integer less than 2^61.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Higher-Level DAP Objects and Extensions</strong></p>
<div class="paragraph">
<p>Shared Dimensions that serve to indicate relations between different
arrays which can be used to build/represent Coverages…</p>
</div>
<div class="paragraph">
<p>Note: Though adoption to-date has been most pronounced in Earth
sciences, DAP’s data types and structures (with the possible exception
of coverages, discussed in this section) are not at all specific to
these disciplines, so we think DAP is positioned for effective use in
many domains, scientific and otherwise.</p>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1"><span class="blue">Client Use of a DAP Data Source</span></dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>High-Level Info about DAP Datasets: the DMR</strong></p>
<div class="paragraph">
<p>A client’s first step in selectively retrieving a data source often is
to discern the character (i.e., its schema) by requesting what DAP calls
the DMR (the data-source metadata response). A DMR provides a complete
characterization of the associated data source sans content, spelling
out its groups, variables, types, dimensions, and attributes as
discussed in the preceding two subsections. For ease of use in client
software, the DMR adheres to a formal syntax and most often is delivered
as an XML document, though other forms are anticipated as DAP4
<em>extensions</em>.</p>
</div>
<div class="paragraph">
<p>Though it is common to retrieve its DMR prior to requesting content from
a data source, this is not the only option. Indeed, a &#8220;Data Request&#8221;
under DAP returns both the DMR and the content (i.e., the <em>values</em> of
variables) for the designated data source, because the former is
critical for interpreting the latter.</p>
</div>
</li>
<li>
<p><strong>Retrieving Content from DAP Datasets: Posing DAP Requests</strong></p>
<div class="paragraph">
<p>Under DAP, the requests clients make of servers, and the resulting
server responses, are all governed by the protocol specification. As
stated previously, the formal specification takes precedent over
anything stated here.</p>
</div>
<div class="paragraph">
<p>For each data source, a number of responses may elicited by a client,
determined by adding a suffix and/or a query string to the basic URL for
the desired data source. Passing the server a completely <em>unadorned</em> URL
yields a Dataset Services Response (DSR). This XML document describes
the various DAP services available for that source, and these always
include provision of a DMR and provision of <em>content</em> from the source.
Unlike the DMR, which is always textual, content (delivered in response
to a Data Request, as discussed above) may be conveyed in textual <em>or</em>
binary form, the latter minimizing data-transfer volumes, of course.</p>
</div>
<div class="paragraph">
<p>If the URL for a Data Request includes a query string, the server parses
this string to determine what data processing the server should perform
before constructing its Data Response. Though other classes of
pre-retrieval processing are anticipated to be defined via DAP
extensions, two forms are mandated by DAP4 for all servers, Index
Subsetting and Field Subsetting, and a third form, Filtering, is defined
in the core DAP specification, though its implementation by servers is
optional.</p>
</div>
<div class="paragraph">
<p><strong>Index Subsetting</strong> - Choosing parts of an array based on the indexes of
that array’s dimensions. This operation always returns an array of the
same rank as the original, although the size of the return array will
(likely) be smaller. Index subsetting uses the bracket syntax described
later.</p>
</div>
<div class="paragraph">
<p><strong>Field Subsetting</strong> - Choosing specific variables or fields from the
dataset. A dataset in DAP4 is made up of a number of variables and those
may be Structures or Sequences that contain fields (and, in effect, the
Dataset is itself a Structure and all of its variables are fields - the
distinction is more convenience than formal). Field subsetting using the
brace syntax described later. One or more fields can be specified using
a semicolon (;) as the separator.</p>
</div>
<div class="paragraph">
<p><strong>Filtering</strong> - A filter is a predicate that can be used to choose data
elements based on their values. the vertical bar (|) is used as a prefix
operator for the filter predicate. Filters can be applied to elements of
an Array or fields of a Sequence. A filter predicate consists of one or
more filter subexpressions. One or more subexpressions can be specified,
using a comma (,) as the separator.</p>
</div>
<div class="paragraph">
<p>Other services listed in the DSR might (at the server’s option) include
the DAP Asynchronous Response. Where implemented (such as for near-line
data sources), this response is sent to the client when the requested
resource (DMR, Data Response, etc.) is not immediately available. If, in
turn, the client makes a &#8220;retrieve it&#8221; request, the server will
respond with a second Asynchronous Response informing the client about
when and where the requested resource may be retrieved.</p>
</div>
<div class="paragraph">
<p>In addition to the most common data objects, a DAP server <em>may</em> provide
additional &#8220;services,&#8221; such as HTML-formatted representations of a
data source’s structure and content. Such additional services are
discussed in Volume 2 of the specification.</p>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1"><span class="blue">The Formal DAP Specification</span></dt>
<dd>
<div class="paragraph">
<p>The DAP4 specification spans two volumes: one describes the Data Model
and DAP’s Request/Response objects; the other volume describes how DAP
clients and servers communicate via HTTP and the modern Web. New volumes
about DAP Extensions will be added as they emerge.</p>
</div>
<div class="paragraph">
<p>Partitioning the specification into two primary documents reflects the
independence of DAP’s data-retrieval functionality from the underlying
network transfer protocol. Indeed, DAP could be used with other
transports. However, utilizing HTTP eases the building of DAP servers
because they can take full advantage of widely used Web-server
frameworks such as Apache. Use of Extensions documents will enable
evolution of the protocol without the expense and complexity of another
major protocol-development project. Anticipated extensions include a
JSON encoding for DAP data/metadata and the provision of server
functions (beyond DAP’s core subsetting and filtering operations).</p>
</div>
<div class="paragraph">
<p><strong>The specification is available at these links:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Data_Model">Volume1: Data Model&#44; Persistent Representation&#44; and Constraints</a></p>
</li>
<li>
<p><a href="#Web_Services">Volume
2: Web Services Specification</a></p>
</li>
<li>
<p>Extensions:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#netcdf-encoding-response">NetCDF Data Response</a></p>
</li>
<li>
<p><a href="#CSV-encoding-response">DAP4
Extension: CSV Data Encoding and Response</a></p>
</li>
<li>
<p><a href="#netcdf-async">DAP4
Extension: netCDF Asynchronous Response</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="_how_dap4_differs_from_dap2" class="dlist">
<dl>
<dt class="hdlist1"><span class="blue">How DAP4 Differs from DAP2</span></dt>
<dd>
<div id="dap2dap4" class="imageblock text-center">
<div class="content">
<img src="./images/DAP4vsDAP2.png" alt="DAP4vsDAP2" width="750">
</div>
<div class="title">Figure 1. Differences in the data model and response types between DAP2 and DAP4. For a complete overview of differences, see text.</div>
</div>
<div class="paragraph">
<p>This section covers changes to the data model, response formats, and
serialization, giving developers a roadmap to migration from DAP2 to
DAP4. E.g., the &#8220;Grid&#8221; type now supports a notion of discrete
functions similar to an OGC/ISO Discrete Coverage and to the Scientific
Data Type found in Unidata’s Common Data Model (CDM). Also from this
section, users may learn of functionalities to seek in clients. E.g.,
DAP4 servers return checksums with each data response, but clients may
utilize these in varying degrees.</p>
</div>
<div class="paragraph">
<p>DAP4 is largely an extension of DAP2 concepts, is close to a superset of DAP2 (see <a href="#dap2dap4">Figure 1</a>),
and includes ideas that emerged as DAP gained prominence across the Earth sciences. Therefore
DAP2-compatible software, in clients or servers, should be easy to adapt
to DAP4, and this has been affirmed in the OPeNDAP-Unidata realization
and testing work. Furthermore, DAP4 exhibits backward compatibility
sufficient to enable gradual transitioning. Substantive changes include
support for Groups, yielding greater compatibility with HDF and NetCDF4.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Data-Model Changes</strong></p>
<div class="paragraph">
<p><strong>Summary</strong>: DAP4 now supports <code>Groups</code>, a generalized form of a grid
datatype, adds a few new atomic types, but <code>Grids</code> are removed from the DAP4 Data model.</p>
</div>
<div class="paragraph">
<p>The DAP4 data model is fundamentally similar to that for DAP2. New
atomic types include: enumeration, 64-bit integer, and opaque, the
container types removes <code>Grids</code> but now include Groups (see <a href="#dap2dap4">Figure 1</a>).
In DAP4, a DAP2 <code>Grid</code> is represented by an <code>Array</code> together with information about
its <code>Dimensions</code> which may be shared, and <code>Maps</code> (see <a href="#_coverage_variables_and_maps">Coverage Variables and Maps</a>). Groups provide a way to organize collections
of variables and dimensions and to encode these organizational relationships when they
are present in the underlying source data.</p>
</div>
<div class="paragraph">
<p>Dimensions may now be named, and the presence of shared dimensions
(i.e., several variables employ a dimension with a given name) along
with explicitly name &#8216;maps&#8217; serves to indicate relationships among
arrays that can, in turn, be used to build/represent a more general form
of the DAP2 Grid datatype that resembles the OGC/ISO &#8220;discrete
coverage&#8221; datatype. These &#8216;discrete coverages&#8217; subsume the role of
DAP2 Grids, so the latter have been removed from DAP4.</p>
</div>
<div class="paragraph">
<p><strong>Migrating from DAP2 to DAP4</strong></p>
</div>
<div class="paragraph">
<p>For servers: A DAP2 DDS/DAS (or DDX) is very close to a DAP4 DMR
(indeed, our C++ library contains a way to build a DMR from a DDS). The
set of datatypes supported by DAP4 is almost a proper superset of those
in DAP2 (see <a href="#dap2dap4">Figure 1</a>]), the
exception being that DAP2’s Grid type has been removed. To
represent a DAP2 Grid in DAP4, the components of the DAP2 Grid are
retained and the appropriate Shared Dimension and Map elements are added
to the dataset/group and array. Since the DAP4 &#8216;discrete coverage&#8217;
type subsumes the DAP2 Grid, it will always be possible to translate a
DAP2 Grid into DAP4.</p>
</div>
<div class="paragraph">
<p>For clients: Some of the new data types are more challenging to
implement than the types included with DAP2. Of particular note are
Enumerations and the expanded grid (aka &#8216;discrete coverage&#8217;) types.</p>
</div>
</li>
<li>
<p><strong>Changed Responses</strong></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>Summary of the main changes between DAP2 and DAP4 Responses</strong>:</p>
</div>
<div class="ulist disc">
<ul class="disc">
<li>
<p>DAP4 includes only one dataset <em>metadata</em> response, the <em>DMR</em> not two;</p>
</li>
<li>
<p>Several Sequences may be individually constrained in one access;</p>
</li>
<li>
<p>Predictable behavior for &#8216;bare&#8217; URLs; and</p>
</li>
<li>
<p>Asynchronous responses</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In DAP4 there is a single XML document, the <em>DMR</em> (see <a href="#dap2dap4">Figure 1</a>),
that encodes the metadata for a
data source. This response is conceptually similar to, and in some ways
identical too, the <em>DDX</em> response that is supported by many DAP2
servers, so it’s organization will be familiar to many people already.
As with DAP2, there is one data response that can be modified
(<em>constrained</em>) using a expression to limit the information it includes.
The basic concepts of slicing an array are unchanged in DAP4. We’ve
taken care to allow servers to extend the information passed into the
data retrieval web service, a topic that is covered in a bit more detail
below under <em>web services.</em> We have replaced the <em>selection</em> part of the
DAP2 constraint expression with a <em>filter</em> sub-expression that is
applied to specific variables. This enables two or more Sequences to
have their own filtering operations (before that was not possible). Our
expanded constraint language also provides a way to subset coverages,
and a proposed extension to the filtering sub-expression provides a way
to subset arrays/coverages by value.</p>
</div>
<div class="paragraph">
<p>We wanted DAP4 to fully embrace REST. DAP2, even though it predates the
term, including many, but not all, of the REST architecture’s features.
One change from DAP2 was to explicitly define what happens when a client
dereferences a &#8216;bare URL&#8217; (one without an extension used to ask for a
specific DAP4 response). When a DAP4 sever is asked to return
information at a bare URL, the result is a Dataset Services Response
(DSR) which contains links to all of the other responses for that
dataset. In addition, the DSR may contain other information such as
server operations that can be used with the dataset. The DSR is an XML
document but can contain a stylesheet that transforms it to HTML for a
web browser.</p>
</div>
<div class="paragraph">
<p>DAP4 servers can also support asynchronous access to data, which enables
access to data from near-line devices and can be used for some server
processing operations (e.g., operations that take a long time to
perform). Asynchronous responses are responses that contain a URL that
can be used to retrieve the actual data at some time in the future. The
protocol has been designed to reduce the chance that a client will
mistakenly make a large number of asynchronous requests since this could
present an undue burden on some kinds of near-line devices.</p>
</div>
<div class="paragraph">
<p><strong>Migrating from DAP2 to DAP4</strong></p>
</div>
<div class="ulist disc">
<ul class="disc">
<li>
<p>If your server or client already reads DAP2 DDX responses (which were
never part of the official protocol but are widely used) then adapting
to the <em>DMR</em> will be very easy since they are very close in structure.</p>
</li>
<li>
<p>Support for the new constraints may take a bit more work since now the
Constraint Expression and Server Functions have been separated.</p>
</li>
<li>
<p>Clients will benefit from asynchronous response support, but this is a
new behavior and may take some serious thought, particularly for clients
that relied on the simpler semantics borrowed from file system accesses.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><strong>Response-Encoding Changes</strong></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>Summary</strong>:</p>
</div>
<div class="ulist disc">
<ul class="disc">
<li>
<p>Checksums for data values;</p>
</li>
<li>
<p>Reliable delivery of error messages to clients;</p>
</li>
<li>
<p>Encode data using the server’s native word order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have added three changes to the encoding of returned data values. All
top-level variables in a data response now include a CRC32 checksum of
their values. This enables people to see if a request is returning the
same data values as it did previously. The checksum values are encoded
in Attributes bound to the returned variables. We have added an encoding
scheme for data values that preserves compactness yet allows clients to
easily detect when a server has encountered an error while sending a
response. Similarly, we have adopted a <em>Reader Make Right</em> encoding
scheme instead of the <em>network byte order</em> scheme used by DAP2. The
latter has become more and more important as the predominance of
little-endian processors has increased.</p>
</div>
<div class="paragraph">
<p><strong>Migrating from DAP2 to DAP4</strong></p>
</div>
<div class="paragraph">
<p>In many ways the encoding scheme is simpler for servers because the data
response uses the server’s native byte order. Clients must detect the
byte order and twiddle bytes as needed. However, the server must
correctly implement the chunking protocol used by the data response and
must correctly computer CRC32 checksums for each of the top level
variables.</p>
</div>
</div>
</div>
</li>
<li>
<p><strong>Changes in the Use of HTTP</strong></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>Summary</strong></p>
</div>
<div class="paragraph">
<p>DAP4 is closer than DAP2 to the REST (Representational State
Transfer) architecture, and it uses HATEOS (Hypermedia As The Engine Of
Application State), making all of the server’s responses explicit via
links in a document.</p>
</div>
<div class="paragraph">
<p>While DAP2 interwove the DAP and HTTP, using, for example, some of the
HTTP headers as the only source of information that was critical to the
DAP itself, DAP4 does not. Instead, DAP4 is completely isolated from
HTTP, enabling it to work with other protocols without change. However,
in as much as HTTP is a ubiquitous network transport protocol, the DAP4
specification includes a volume devoted solely to how a server should
implement DAP4 web services using HTTP.</p>
</div>
<div class="paragraph">
<p>The REST interface for the protocol is described in Volume 2, <em>Web
Services,</em> of the specification. DAP4 requires that a server implement
at least three responses for each dataset: The DSR; DMR; and Data
response. The DSR is a XML document that provides a <em>capabilities</em>
response for the dataset. This document provides links to all of the
other responses available for the dataset, along with other information.
The DSR provides information about alternative encodings for the
different responses in addition to enumerating the basic responses
themselves. The DSR may also list server functions that may be used
with/on the dataset.</p>
</div>
<div class="paragraph">
<p>DAP4 servers are encouraged to support HTTP content negotiation,
providing the standard DSR, DMR and Data responses in a variety of
forms.</p>
</div>
<div class="paragraph">
<p><strong>Migrating from DAP2 to DAP4</strong></p>
</div>
<div class="paragraph">
<p>The web service for DAP4 will likely need to be written from scratch,
but the good news is that those are easy to write. For clients, the
behavioral differences between DAP2 and DAP4 servers are small, with two
exceptions. Since DAP4 optionally supports asynchronous responses,
clients should be modified to access data available only using this new
feature. DAP4 also supports content negotiation and that means a larger
number of ways to get the different responses (even though each protocol
has three basic responses).</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1"><span class="blue">Acknowledgments</span></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>DAP4 is the result of a joint, multiyear development effort by OPeNDAP
and Unidata, funded by a generous grant from NOAA and guided by an
advisory committee comprising Mike Folk (THG), Jim Frew (UCSB), Steve
Hankin (NOAA), Eric Kihn (NOAA), Chris Lynnes (NASA) and Rich Signell
(USGS).</p>
</div>
<div class="paragraph">
<p>Retrieved from
<a href="https://docs.opendap.org/index.php?title=DAP4:_Overview&amp;oldid=10530" class="bare">https://docs.opendap.org/index.php?title=DAP4:_Overview&amp;oldid=10530</a></p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Data_Model">1. Data Model, Persistent Representations, and Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>Abstract</em></strong>
<em>This document defines the Data Access Protocol (DAP) version 4.0
(referred to also as DAP4). This data transmission protocol is intended
to supersede all previous versions of the DAP protocol. DAP4 is designed
specifically for science data, but it is intended to be discipline
neutral. The protocol relies on widely used and stable standards, and is
capable of representing a wide variety of scientific data types.</em></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 1. <strong>Contributors</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>First Draft</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May 24, 2012.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Last Revised:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 February 2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Authors</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John Caron (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethan Davis (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David Fulker (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">James Gallagher (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dennis Heimbigner (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nathan Potter (OPeNDAP)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 2. <strong>Timeline of changes.</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Draft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added specification of chunk order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added specification and interpretation of simple queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion about nested sequences.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formatting changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed serialized representation sections and constraint sections until James provides direction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merge all changes from Gallagher, Potter, and Caron, except as noted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed all references to Sequences.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserted James’ version of serialized representation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added DMR RELAX-NG Grammar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added (semi-)formal description of the DAP4 serialization scheme.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added: (1) Revised Char type (2) Revised unlimited dimension rules (3)
revised MAP rules. (4) Removed HTTP references</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion of identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion of XML escaping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix discrepancies between the formal definition of the on-th-wire format and the examples.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed UByte and made Byte == UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.8.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added draft constraints section</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.8.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improved the discussion of named slices in constraints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.9.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minor change to the grammar for simple constraints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.9.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated the Data Response section so that it no longer mentions
Multipart MIME; edited the sections on FQNs and Attributes. I’ve added &#8216;nested attributes&#8217; back into the text. I also added &#8216;Sequence&#8217; in several places where we will need it once we’ve worked out how those are to be handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integrate James&#8217;s changes with recent changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rebuild the .docx because of repeated Word crashes; minor formatting
info changed/lost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a Dataset construct to make the root group concept clear syntactically.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.3.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Made unlimited into a boolean attribute because it does have a size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserted the new checksum description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed all mention of unlimited wrt Dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove the base and ns attributes from &lt;Dataset&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introduce &lt;Sequence&gt; as a replacement for variable length dimensions;
The term Sequence is subject to future change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.10.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clarify the maximum number of elements as a function of the maximum
number of bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.10.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforce a specific order on declarations in a Group body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.11.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added sections for DSR, Async, and Error responses and their schemas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.11.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified the case sensitivity of XML element names and XML attribute
names</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014.07.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make a pass to clean up and clarify (dmh)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.02.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rollback to version of 2015.12.16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.02.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add back the multiple disjoint slice subset. Provide a general mechanism for arbitrary reserved names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.10.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add _DAP4_Little_Endian attribute to the DMR to reflect the bytorder
used to encode the serialized data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.12.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forgot to mention adding the special names section (5.3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.12.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clarified the reserved names section (5.3) to say that all names
beginning with “_” are reserved, but that the reverse DNS case is preferred.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_introduction">1.1. Introduction</h3>
<div class="paragraph">
<p>This specification defines the protocol referred to as the Data Access
Protocol, version 4.0 (&#8220;DAP4&#8221;). In this document &#8216;DAP&#8217; refers to
DAP4 unless otherwise noted.</p>
</div>
<div class="paragraph">
<p>DAP is intended to be the successor to all previous versions of the DAP
(specifically DAP version 2.0). The goal is to provide a very general
data model capable of representing a wide variety of existing data sets.</p>
</div>
<div class="paragraph">
<p>The DAP builds upon a number of existing data representation schemes.
Specifically, it is influenced by CDM [<a href="#ref1">1</a>], HDF5 [<a href="#ref2">2</a>], DAP version 2.0 [<a href="#ref3">3</a>], and netCDF-4 [<a href="#ref4">4</a>].</p>
</div>
<div class="paragraph">
<p>The DAP is a protocol for access to data organized as variables. It is
particularly suited to accesses by a client computer to data stored on
remote (server) computers that are networked to the client computer. DAP
was designed to hide the implementation of different collections of
data. The assumption is that a wide variety of data sets using a wide
variety of data schemas can be translated into the DAP protocol for
transmission from the server holding that dataset to a client computer
for processing.</p>
</div>
<div class="paragraph">
<p>It is important to stress the discipline neutrality of the DAP and the
relationship between this and adoption of the DAP in disciplines other
than the Earth sciences. Because the DAP is agnostic as relates to
discipline, it can be used across the very broad range of data types
encountered in oceanography - biological, chemical, physical and
geological. There is nothing that constrains the use of the DAP to the
Earth sciences.</p>
</div>
</div>
<div class="sect2">
<h3 id="_requirements">1.2. Requirements</h3>
<div class="paragraph">
<p>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL
NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221; and
&#8220;OPTIONAL&#8221; in this document are to be interpreted as described in RFC
2119 [<a href="#ref5">5</a>].</p>
</div>
</div>
<div class="sect2">
<h3 id="_overall_operation">1.3. Overall Operation</h3>
<div class="paragraph">
<p>The DAP is a stateless protocol that governs clients making requests
from servers, and servers issuing responses to those requests. This
section provides an overview of the requests and responses (i.e. the
messages) that DAP-compliant software MUST support. These messages are
used to request information about a server and data made accessible by
that server, as well as requesting data values themselves.</p>
</div>
<div class="paragraph">
<p>For every data resource the DAP defines a number of responses that may
elicited by a client. These responses provide services information (i.e.
capabilities), structural/semantic descriptions, data access timing and
error information.</p>
</div>
<div class="paragraph">
<p>The Dataset Services Response (DSR) provides a &#8216;Services&#8217; or
&#8216;Capabilities&#8217; response for the DAP. Dereferencing an unadorned DAP
dataset resource URL will return a document describing the DAP services
available for the dataset.</p>
</div>
<div class="paragraph">
<p>The DAP utilizes two responses to represent semantic structural
description and data content of a data source. One response, called the
DMR, returns metadata information describing the structure of a request
for data. That is, it characterizes the variables, their datatypes,
names and attributes. The second response, the Data Response, returns
both the metadata about the request, but also the data that was
requested. The DMR and the metadata part of the Data Response are
represented using a specific XML representation[<a href="#ref16">16</a>]. The syntax of that
representation is defined elsewhere in this document (Section
<a href="#_fully_qualified_names">[1.5.4</a>]).</p>
</div>
<div class="paragraph">
<p>The DAP returns error information using an Error response. If a request
for any of the three basic responses cannot be completed then an Error
response is returned in its place.</p>
</div>
<div class="paragraph">
<p>The two responses (DMR and Data Response) are complete in and of
themselves so that, for example, a client can use the data response
without ever requesting either of the two other responses. In many
cases, client programs will request the DMR response first before
requesting the Data Response but there is no requirement they do so and
no server SHALL require that behavior on the part of clients.</p>
</div>
<div class="paragraph">
<p>Operationally, communication between a DAP client and a DAP server uses
some underlying already existing protocol, most typically HTTP. In addition, a DAP server MAY provide additional
&#8220;services&#8221; which clients may find useful. For example, many
DAP-compliant servers provide HTML-formatted representations or ASCII
representations of a data source’s structure and data. Such additional
services are discussed in <a href="#Web_Services">Volume 2</a> of this specification.</p>
</div>
<div class="paragraph">
<p>The DAP specification also defines extensions to the protocol and
representing important, but optional, capabilities. At least the
following extensions have been defined. 1. Asynchronous Response. The
DAP Asynchronous Response is returned to a client when the requested
resource (DMR, Data Response, etc.) is not immediately available and by
making a specific request that it be made available the server is able
to retrieve it. If the client makes the &#8220;retrieve it&#8221; request the
server will inform the client through a subsequent Asynchronous Response
when and where the client may access the requested resource. 2. CSV Data
Encoding. The DAP4 CSV data encoding represents DAP4 data as structured
Comma-Separated Values (CSV) in UTF-8 text. Though based on the text/csv
media type described in RFC 4180[<a href="#ref18">18</a>], the DAP4 CSV is more complex
so that it can fully represent the more complex data structures of the
DAP4 data model. Some structure beyond simple CSV is necessary to
capture the DAP4 data structures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_characterization_of_a_data_source">1.4. Characterization of a Data Source</h3>
<div class="paragraph">
<p>The DAP characterizes a data source as a collection of variables,
dimensions, and enumeration types. Each variable consists of a name, a
type, a value, and a collection of Attributes. Dimensions have a name
and a size. Enumerations list names and values of the enumeration
constants. These elements may be grouped into collections using the
concept of a &#8220;group&#8221; that has an identifier and defines a naming scope
for the elements within it. Groups may contain other groups.</p>
</div>
<div class="paragraph">
<p>The distinction between information in a variable and in an Attribute is
somewhat arbitrary. However, the intention is that Attributes hold
information that aids in the interpretation of data held in a variable.
Variables, on the other hand, hold the primary content of a data source.</p>
</div>
<div class="paragraph">
<p>Section <a href="#_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">[1.10.1</a>] provides a formal
syntax for DAP DMR characterizations. It is defined using the RelaxNG
standard [<a href="#ref13">13</a>] for describing the context-free syntax of a class of XML
documents, the DMR in this case. It should be noted that any syntax
specification requires a specification of the lexical elements of the
syntax. The XML specification [<a href="#ref16">16</a>] provides most of the lexical context
for the syntax, but there are certain places where additional lexical
elements must be used. Section <a href="#_appendix_2_dap4_relax_ng_lexical_elements">[1.10.2</a>] describes
those additional lexical elements, and those elements are discussed at
appropriate points in this specification.</p>
</div>
<div class="paragraph">
<p>Since the syntax is context-free, there are semantic limitations on what
is legal in a DMR. These semantic limitations are noted at appropriate
places in the following documentation. It should also be noted that if
there are conflicts between what is described here and the RelaxNG
syntax, then the syntax takes precedence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dmr_declarations">1.5. DMR Declarations</h3>
<div class="sect3">
<h4 id="_dmr_xml_format">1.5.1. DMR XML Format</h4>
<div class="paragraph">
<p>Element and Attribute Names<br>
Within the DMR XML document, it is assumed that XML element and XML
attribute names are case sensitive.</p>
</div>
<div class="paragraph">
<p>Character Escapes
Any string of characters appearing within an XML attribute in the DMR
must apply the standard XML escapes. Specifically, any attribute value
containing any of the following characters must replace them with the
corresponding XML escape form.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Character</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Escaped Form</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;amp</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;lt</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;gt</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">“</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;quot</code>;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So for example, given the occurrence of the attribute &#8216;name=&#8220;&amp;&lt;&gt;&#8221;&#8217;
it must be re-written to this form &#8216;name=&#8220;&amp;&lt;&gt;&#8221;&#8217;.</p>
</div>
</div>
<div class="sect3">
<h4 id="_names">1.5.2. Names</h4>
<div class="paragraph">
<p>A name (aka identifier) in DAP4 consists of a sequence of any legal
non-control UTF-8 characters. A control character is any UTF-8 character
in the inclusive range 0x00 — 0x1F. Names are case sensitive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reserved_names">1.5.3. Reserved Names</h4>
<div class="paragraph">
<p>Any name that begins with the character sequence &#8220;_&#8221; is considered
reserved. Note that if the receiver encounters such a name and has no
information on how to process the name, it may at its discretion either
ignore the object with that name, or it may treat the name as an
ordinary name.</p>
</div>
<div class="paragraph">
<p>A special case is when the &#8220;_&#8221; is followed by a reverse DNS name
defining both the definer of that reserved name and possible additional
naming information. This form of reserved name is preferred because it
provides information about the organization that defined it.</p>
</div>
<div class="paragraph">
<p>A (reverse) DNS name is of this syntactic form.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">DNS = &lt;name&gt; | DNS '.' &lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>An example might be <code>edu.ucar.unidata.NAME1.NAME2…</code>. This indicates
the owner/definer of that name is <code>edu.ucar.unidata</code> and that the
additional naming information (“NAME1.NAME2…) has meaning to the owner
for defining the semantics of the so-named object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fully_qualified_names">1.5.4. Fully Qualified Names</h4>
<div class="paragraph">
<p>Every object in a DAP4 Dataset has a Fully Qualified Name (FQN), which
provides a way to unambiguously reference declarations in a dataset and
which can be used in several contexts such as in the DMR in a constraint
expression (see Section <a href="#_constraints">1.8</a>).</p>
</div>
<div class="paragraph">
<p>These FQNs follow the common conventions of names for lexically scoped
identifiers. In DAP4 several kinds of lexical items provide lexical
scoping: Dataset, Groups, Structures, Sequences, Enumerations, and
AttributeSets. Just as with hierarchical file systems or variables in
many programming languages, a simple grammar formally defines how the
names are built using the names of the FQN’s components (see Section
<a href="#_the_fully_qualified_name_class">1.10.2</a>).</p>
</div>
<div class="paragraph">
<p>The FQN for a &#8220;top-level&#8221; variable — as opposed to e.g. a field in a
structure or sequence — is defined purely by the sequence of enclosing
groups plus the variable’s simple name. This also holds for Enumeration
declarations.</p>
</div>
<div class="paragraph">
<p>Consider the following simple dataset, which contains a Structure named
&#8220;inner&#8221; within a Structure named &#8220;outer&#8221; all contained in the
Dataset &#8220;D&#8221;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">places</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;String</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">weather</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temperature</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dew_point</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/Structure&gt;</span>
    <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The FQN for the field &#8216;temperature&#8217; is</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">'/places.weather.temperature'</pre>
</div>
</div>
<div class="paragraph">
<p>Substituting the keyword <em>Sequence</em> for one or more occurrences of
<em>Structure</em> in the above example will leave the FQNs unchanged. Note
that the name of the dataset (&#8220;D&#8221;) is not included; it is implied by
the leading &#8220;/&#8221;.</p>
</div>
<div class="paragraph">
<p>As is the case with Structure or Sequence variables, Groups can be
nested to form hierarchies, too, and this example shows that case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">environmental_data</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">places</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;String</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">weather</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temperature</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dew_point</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/Sequence&gt;</span>
        <span class="tag">&lt;/Structure&gt;</span>
     <span class="tag">&lt;/Group&gt;</span>
     <span class="tag">&lt;Group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">demographic_data</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         ...
     <span class="tag">&lt;/Group&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The FQN to the field <code>temperature</code> in the dataset shown is</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">'/environmental_data/places.weather.temperature'</pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of a different separator character <code>.</code> instead of <code>/</code> once we enter the scope of a structure (or sequence).</p>
</div>
<div class="paragraph">
<p>Enumeration constants are treated similarly to fields. Consider this
example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Enumeration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;EnumConst</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Enumeration&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The FQN for the <code>v1</code> constant in <code>e</code> is as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">/e.v1</pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every dataset has a single outermost <code>&lt;Dataset&gt;</code> declaration, which
semantically, acts like the root group. Whatever name that dataset has
is ignored for the purposes of forming the FQN and instead is treated as
if it has the empty name (““).</p>
</li>
<li>
<p>There is no limit to the nesting of groups or the nesting of
Structures or the nesting of Sequences. Enumerations cannot be nested.</p>
</li>
<li>
<p>Reserved names (see above) inherently contain characters (<code>.</code>) that
will require escaping.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The characters <code>/</code> and <code>.</code> have special meaning in the context of a
fully qualified name. This means that if a name is added to the FQN and
that name contains either of those two characters, then those characters
must be specially escaped so that they will not be misinterpreted. The
defined escapes are as follows.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Character</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Escaped Form</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\blank</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the escape character itself must be escaped. Also note that
this form of escape using &#8216;\&#8217; is independent of any required XML
escape (Section <a href="#_dmr_xml_format">1.5.1</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_fqn_references">1.5.5. FQN References</h4>
<div class="paragraph">
<p>DAP4 imposes the rule that the definition of any object (e.g. dimension,
group, or enumeration) must occur before any reference to that object.
This rule also applies within a group, which in turn implies that, for
example, all dimensions must be declared before all variables that
reference them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_definitional_declarations_versus_data_bearing_declarations">1.5.6. Definitional Declarations versus Data-Bearing Declarations</h4>
<div class="paragraph">
<p>The declarations in a DMR can be grouped into two classes. One class is
<em>definitional</em>. That is, it defines metadata that is used in the rest of
the DMR. These definitional declarations are Groups (including the outer
Dataset), Dimensions, and Enumerations. Such declarations do not contain
data values themselves, although they may define constants such as the
dimension size. The data-bearing declarations are Variables and
Attributes. These elements of the data model are used to house data
values or semantic metadata read from the dataset (or, in the latter
case) synthesized from the values and standards/conventions that the
dataset is known to follow.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dataset">1.5.7. Dataset</h4>
<div class="paragraph">
<p>Every DMR contains exactly one Dataset declaration. It is the outermost
XML element of the DMR.</p>
</div>
<div class="paragraph">
<p>A dataset is specified using this XML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dapVersion</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dmrVersion</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code>, <code>dapVersion</code>, and <code>dmrVersion</code> attributes are required. The
attributes have the following semantics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> – an identifier specifying the name of the dataset. Its content
is determined solely by the Server and is completely uninterpreted with
respect to DAP4.</p>
</li>
<li>
<p><code>dapVersion</code> – the string <code>4.0</code> currently.</p>
</li>
<li>
<p><code>dmrVersion</code> – the string <code>1.0</code> currently.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The body of the Dataset is the same as the body of a <a href="#_groups">[1.5.8</a>],
and semantically the Dataset acts like the outermost, root, group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groups">1.5.8. Groups</h4>
<div class="paragraph">
<p>A group is specified using this XML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;Group&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A group defines a name space and contains other DAP elements.
Specifically, it can contain in this order: dimension, enumerations,
variables, and (sub-)groups. The fact that groups can be nested means
that the set of groups in a DMR form a tree data structure. For any
given DMR, there exists a root group that is the root of this tree.</p>
</div>
<div class="paragraph">
<p>A nested set of groups defines a variety of name spaces and access to
the contents of a group is specified using a notation of the form
<code>/g1/g2/…/gn</code>. This is called a <code>path</code>. By convention <code>/</code> refers
to the <code>root</code> group (the Dataset declaration). Thus the path <code>/g1/g2/g3</code>
indicates that one should start in the root group, move to group <code>g1</code>
within that root group, then to group <code>g2</code> within group <code>g1</code>, and finally to
group <code>g3</code>. This is more fully described in the section on Fully Qualified
names (Section <a href="#_fully_qualified_names">[1.5.4</a>]).</p>
</div>
<div class="paragraph">
<p>The order of declarations within a Group is fixed and must conform to
this order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dimension declarations,</p>
</li>
<li>
<p>Enumeration declarations,</p>
</li>
<li>
<p>Variable declarations,</p>
</li>
<li>
<p>and, finally, nested Group declarations,</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For comparison purposes, DAP groups correspond to netCDF-4 groups and
not to the more complex HDF5 Group type: i.e. the set of groups must
form a tree.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If declared, Groups must be named.</p>
</li>
<li>
<p>A Group can contain any number of objects, including other Groups.</p>
</li>
<li>
<p>Each Group declares a new lexical scope for the objects it contains.</p>
</li>
<li>
<p>An array of Group is not allowed, and a Group cannot be defined within
a Structure or Sequence.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_dimensions">1.5.9. Dimensions</h4>
<div class="paragraph">
<p>A dimension declaration is specified using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">size</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>size</code> is a positive integer (which means that a zero length dimension
is illegal). As described in the Arrays Section, the maximum size of any
dimension is \$2^(61) - 1\$. A dimension declaration will be referenced
elsewhere in the DMR by specifying its name. It should also be noted
that anonymous dimensions also exist. They have a size but no name.
Anonymous dimensions SHOULD NOT be declared.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dimension declarations are not associated with a data type.</p>
</li>
<li>
<p>Dimension sizes MUST be a capable of being represented as a signed
64-bit integer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_enumeration_types">1.5.10. Enumeration Types</h4>
<div class="paragraph">
<p>An enumeration type defines a set of names with specific values called
enumeration constants. As will be seen in Section <a href="#_variables">[1.5.13</a>],
enumeration types may be used as the type for variables or attributes.
The values that can be assigned to such typed objects must come from the
set of enumeration constants.</p>
</div>
<div class="paragraph">
<p>An enumeration type specifies a set of named, integer constants. When a
data source has a variable of type &#8216;Enumeration&#8217; a DAP 4 server MUST
represent that variable using a specified integer type, up to and
including a 64-bit unsigned integer.</p>
</div>
<div class="paragraph">
<p>An Enumeration type is declared using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Enumeration</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                basetype=&quot;Byte|Int8|UInt8|Int16|UInt16
                         |Int32|UInt32|Int64|UInt64&quot;/<span class="error">&gt;</span>
    <span class="tag">&lt;EnumConst</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/Enumeration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The optional &#8220;basetype&#8221; XML attribute defines the type for the value
XML attribute of each enumeration constant. This basetype must be one of
the integer types (see <a href="#Integer_Types">Integer Types</a>). If
unspecified, then it defaults to the Atomic type &#8220;Int32&#8221;.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_atomic_types">1.5.11. Atomic Types</h4>
<div class="paragraph">
<p>The DAP4 specification assumes the existence of certain pre-defined,
declared types called atomic types. As their name suggests, atomic data
types are conceptually indivisible. Atomic variables are used to store
integers, real numbers, strings and URLs. There are five classes of
atomic types, with each family containing one or more variations:
integer, floating-point, string, enumerations, and opaque.</p>
</div>
<div class="paragraph">
<p><em><span id="Integer_Types">Integer Types</span></em></p>
</div>
<div class="paragraph">
<p>The integer types are summarized in the following table. The syntax for
integer constants is defined in
<a href="#_the_numeric_constant_classes_integer_and_float">Appendix 1.10.2</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$ [-2^(7), 2^(7) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synonym for UInt8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Char</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synonym for UInt8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(15), 2^(15) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(16) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(31), 2^(31) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(32) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(63), 2^(63) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(64) - 1\$]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that for historical reasons, the <code>Char</code> type is defined to be a
synonym of <code>UInt8</code>, this mean that technically, the <code>Char</code> type has no
associated character set encoding. However, servers and clients are free
to infer typical character semantics to this type. The inferred
character set encoding is chosen purely at the discretion of the server
or client using whatever conventions they agree to use, possibly
specified using attributes. Note specifically that multi-byte character
encodings such as UTF-8 are problematic precisely because they can be
multi-byte.</p>
</div>
<div class="paragraph">
<p><em><span id="Floating_Point_Types">Floating Point Types</span></em></p>
</div>
<div class="paragraph">
<p>The floating-point data types are summarized in Table 2. The two
floating-point data types use IEEE 754 [<a href="#ref7">7</a>] to represent values. The two
types correspond to ANSI C’s float and double data types. The syntax for
floating point constants is defined in
<a href="#_the_numeric_constant_classes_integer_and_float">Appendix 1.10.2</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit Floating-point number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refer to the IEEE Floating Point Standard [<a href="#ref7">7</a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit Floating-point number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refer to the IEEE Floating Point Standard [<a href="#ref7">7</a>]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><span id="String_Types">String Types</span></em></p>
</div>
<div class="paragraph">
<p>The string data types are summarized in Table 3. Again, the syntax for
these is defined in <a href="##_the_stringurl_constant_class">Appendix 1.10.2</a></p>
</div>
<div class="paragraph">
<p>Strings are individually sized. This means that in an array of strings,
for example, each instance of that string MAY be of a different size.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable length string of UTF-8 characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As defined in [<a href="#ref14">14</a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Uniform Resource Identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As defined in IETF RFC 2396 [<a href="#ref8">8</a>]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><span id="The_Opaque_Type">The Opaque Type</span></em></p>
</div>
<div class="paragraph">
<p>The XML scheme for declaring an Opaque type is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Opaque&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Opaque</code> type is use to hold objects like JPEG images and other Binary
Large Object (<code>BLOB</code>) data that have significant internal structure which
might be understood by clients (e.g., an image display program) but that
would be very cumbersome to describe using the DAP4 built-in types.
Defining a variable of type <code>Opaque</code> does not communicate any
information about its content, although an attribute could be used to do
that.</p>
</div>
<div class="paragraph">
<p>Opaque instances are individually sized. This means that in an array of
opaques, for example, each instance of that opaque MAY be of a different
size.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The content of an opaque object is completely un-interpreted by the
DAP4 implementation. The <code>Opaque</code> type is an <code>Atomic</code> Type, which might seem
odd because instances of <code>Opaque</code> can be of different sizes. However, by
thinking of Opaque as equivalent to a byte-string type, the analogy with
strings makes it clear that it should be an Atomic type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="The_Enum_Type">The Enum Type</span></em></p>
</div>
<div class="paragraph">
<p>The XML scheme for declaring an Enum type is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Enum</span> <span class="attribute-name">enum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FQN</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Enum</code> type is intended to be used in the definition of a variable. It
should not be confused with the definition of an Enumeration, but rather
references such a definition.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Enum typed requires the an attribute that references a previously
defined &lt;Enumeration&gt; declaration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="A_Note_Regarding_Implementation_of_the_Atomic_Types">A Note Regarding
Implementation of the Atomic Types</span></em></p>
</div>
<div class="paragraph">
<p>When implementing the DAP, it is important to match information in a
data source or read from a DAP response to the local data type which
best fits those data. In some cases an exact match may not be possible.
For example Java lacks unsigned integer types [<a href="#ref6">6</a>]. Implementations faced
with such limitations MUST ensure that clients will be able to retrieve
the full range of values from the data source. If this is impractical,
then the server or client may implement this rule by hiding the variable
in question or returning an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_container_types">1.5.12. Container Types</h4>
<div class="paragraph">
<p>There are currently two container types: <code>&lt;Structure&gt;</code> and <code>&lt;Sequence&gt;</code>.</p>
</div>
<div class="paragraph">
<p><em><span id="The_Structure_Type">The Structure Type</span></em></p>
</div>
<div class="paragraph">
<p>A Structure groups a list of variables so that the collection can be
manipulated as a single item. The variables in a Structure may also be
referred to as &#8220;fields&#8221; to conform to conventional use of that term,
but there is otherwise no distinction between fields and variables. The
Structure’s fields MAY be of any type, including <em>Structure</em> or
<em>Sequence</em>. The order of items in the Structure is significant only in
relation to the serialized representation of that Structure.</p>
</div>
<div class="paragraph">
<p><em><span id="The_Sequence_Type">The Sequence Type</span></em></p>
</div>
<div class="paragraph">
<p>A <code>Sequence</code> is intended to represent a <em>sequence</em> of instances of
objects. Suppose that we have a sequence of this form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">field2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>corresponding</em> <code>Structure</code> object is obtained by substituting the
<code>Sequence</code> keyword with <code>Structure</code>. Our above example then has this
associated Structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">field1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">field2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Structure&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics of a sequence are that it represents a sequence of
instances of the corresponding <code>Structure</code>. The length of the <code>Sequence</code> MAY
be different for every instance of a <code>Sequence</code>. Consider this array of
<code>Sequence</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This represents an array of six (3 times 2) <code>sequence</code> instances. However,
the length MAY be different for each of those six instances.</p>
</div>
<div class="paragraph">
<p>Note that the <code>&lt;Sequence&gt;</code> construct was introduced to replace the concept
of variable length dimensions. It turns out that trying to treat
variable length dimensions as dimensions causes significant conceptual
and implementation difficulties. It is hoped that isolating such
variable length objects syntactically is a better representation.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Structures</code> and <code>Sequences</code> MAY freely nested.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_variables">1.5.13. Variables</h4>
<div class="paragraph">
<p>Each variable in a data source MUST have a name, a type and one or more
values. Using just this information and armed with an understanding of
the definition of the DAP data types, a program can read any or all of
the information from a data source.</p>
</div>
<div class="paragraph">
<p>The DAP variables come in several different types. There are several
atomic types, the basic indivisible types representing integers,
floating point numbers and the like, and a container type – the
Structure or Sequence type – that supports aggregation of other
variables into a single unit. A container type may contain both atomic
typed variable as well as other container typed variables, thus allowing
nested type definitions.</p>
</div>
<div class="paragraph">
<p>The DAP variables describe the data when it is being transferred from
the server to the client. It does not necessarily describe the format of
the data inside the server or client. The DAP defines, for each data
type described in this document, a serialized representation, which is
the information actually communicated between DAP servers and DAP
clients. The serialized representation consists of two parts: the
declaration of the type and the serialized encoding of its value(s). The
data representation is presented in Section <a href="#_response_format">[1.6.1</a>].</p>
</div>
<div class="paragraph">
<p><em><span id="Arrays">Arrays</span></em></p>
</div>
<div class="paragraph">
<p>An Array is a multi-dimensional indexed data structure. An Array’s
member variable MUST be of some DAP data type. Array indexes MUST start
at zero. Arrays MUST be stored in row-major order (as is the case with
ANSI C), which means that the order of declaration of dimensions is
significant. The size of each Array’s dimensions MUST be given. The
total number of elements in an Array is fixed as that given by the
product of the size(s) of its dimension(s). Note that a dimension size
of zero is illegal.</p>
</div>
<div class="paragraph">
<p>For practical reasons having to do with current hardware limitations,
the total number of bytes allocated to an array must fit in an unsigned
64-bit integer. The largest atomic types currently defined in this
document are the floating point double and the (U)Int64 integer types.
This means that the practical limit on the total number of elements is
\$2^(64) / 8 = 2^(61)\$. Thus the dimension indices will run from 0 to a maximum
of \$2^(61) - 1\$. Of course this limit on the maximum number of elements also
applies to the maximum dimension size since the total number of elements
is the product of all the dimensions sizes of the array.</p>
</div>
<div class="paragraph">
<p>There is a prescribed limit of 64 on the number of of dimensions for a
variable (i.e. its arity). This is actually larger than will occur in
practice. Assuming a dimension must be at least 1 bit in size, this
effectively limits the number of dimensions to 61.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Simple variables (see below) MAY be arrays.</p>
</li>
<li>
<p>Structures and Sequences MAY be arrays.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_simple_variables">Simple Variables</h5>
<div class="paragraph">
<p>A simple, dimensioned variable is declared using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{fqn}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  ...
  <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{integer}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of two types of dimensions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>name="{fqn}"</code> – specify the fully qualified name of a Dimension that
has been declared previously in the XML document order. See [<a href="#ref19">19</a>].</p>
</li>
<li>
<p><code>size="{integer}"</code> – specify an <strong>anonymous dimension</strong> of a given size.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A simple variable is one whose type is one of the Atomic Types (see
Section <a href="#_atomic_types">[1.5.11</a>]). The name of the Atomic Type (Int32 in
this example) is used as the XML element name. Within the body of that
element, it is possible to specify zero or more dimension references. A
dimension reference (<code>&lt;Dim…/&gt;</code>) MAY refer to a previously defined
dimension declaration. It MAY also define an <strong>anonymous dimension</strong> with no
name, but with a size specified as an integer constant.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>N.A.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_dimension_ordering">Dimension Ordering</h5>
<div class="paragraph">
<p>Consider this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Int32</span>  <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/d1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/d2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/dn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dimensions are considered ordered from top to bottom. From this, a
corresponding left-to-right order [d1][d2]…[dn] can be inferred where
the top dimension is the left-most and the bottom dimension is the
right-most. The assumption of row-major order means that in enumerating
all possible combinations of these dimensions, the right-most is
considered to vary the fastest. The terms &#8220;right(most)&#8221; or
&#8220;left(most&#8221;) refer to this left-to-right ordering of dimensions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_variables">Structure Variables</h5>
<div class="paragraph">
<p>As with simple variables, a structure variable specifies a type as well
as any dimension for that variable. The type, however, is a <code>Structure</code>.</p>
</div>
<div class="paragraph">
<p><strong>Structures</strong><br></p>
</div>
<div class="paragraph">
<p>The XML scheme for a <code>Structure</code> typed variable is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  {variable definition}
  {variable definition}
  ...
  {variable definition}
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">/d1</span><span class="delimiter">'</span></span> <span class="tag">/&gt;</span>
  ...
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">/dn</span><span class="delimiter">'</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/Structure&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Structure</code> contains within it a list of variable definitions (Section
<a href="#_variables">[1.5.13</a>]). For discussion convenience, each such variable
may be referred to as a <code>field</code> of the <code>Structure</code>. The list of fields
may optionally be followed with a list of dimension references
indicating the dimensions of the <code>Structure</code> typed variable.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Structure</code> variables MAY be dimensioned.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_sequence_variables">Sequence Variables</h5>
<div class="paragraph">
<p>As with simple variables, a sequence variable specifies a type as well
as any dimension for that variable. The type, however, is a Sequence.</p>
</div>
<div class="paragraph">
<p><strong>Sequences</strong><br></p>
</div>
<div class="paragraph">
<p>The XML scheme for a Sequence typed variable is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  {variable definition}
  {variable definition}
  ...
  {variable definition}
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">/d1</span><span class="delimiter">'</span></span> <span class="tag">/&gt;</span>
  ...
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">/d2</span><span class="delimiter">'</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sequence</code> contains within it a list of variable definitions (Section
<a href="#_variables">[1.5.13</a>]). For discussion convenience, each such variable
may be referred to as a <code>field</code> of the <code>Sequence</code>. The list of fields
may optionally be followed with a list of dimension references
indicating the dimensions of the <code>Sequence</code> typed variable.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Sequence</code> variables MAY be dimensioned.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_coverage_variables_and_maps">Coverage Variables and Maps</h5>
<div class="paragraph">
<p>A &#8220;Discrete Coverage&#8221; is a concept commonly found in many disciplines,
where the term refers to a sampled function with both its domain and
range explicitly enumerated by variables. DAP2 uses the name <code>Grid</code> to
denote what the <code>OGC</code> calls a <code>rectangular grid</code> [<a href="#ref12">12</a>]. DAP4 expands on
this so that other types of discrete coverages (hereafter
&#8216;coverage(s)&#8217;) can be explicitly represented. Note that the DAP2
<code>Grid</code> construct is gone, and is replaced by these coverages, which are
more general than DAP2 Grids.</p>
</div>
<div class="paragraph">
<p>Consider the example coverage function:</p>
</div>
<div class="paragraph">
<p>\$Temp(lat, lon): [0,180) \times [0,360) -&gt; Float32\$ where \$lat\$ and \$lon\$ are of Float32 type.</p>
</div>
<div class="paragraph">
<p>The range is <code>Float32</code> and the domain is determined by lat and lon. The
<code>Temp</code> function as a coverage is a sampled subset of the continuous
function and is defined at some finite set of pairs from lat X lon.</p>
</div>
<div class="paragraph">
<p>In DAP4, the range for a coverage is represented by a variable, <code>Temp</code> in
this example, whose values are the range of the sampled function.
Because the domain of <em>Temp</em> is a two-tuple (lat,lon), the DAP4 variable
must have rank two. In order to complete the sampling of <code>Temp</code>, it is
necessary to also define two <code>Map</code> (also called <code>coordinate</code>) variables
representing the sampling of <code>lat</code> and <code>lon</code>. These two variables,
<code>lat</code> and <code>lon</code>, have rank one each. Taken as whole, the collection of a
variable plus maps is called a <code>grid</code> for convenience sake.</p>
</div>
<div class="paragraph">
<p>Suppose we want to access the value of the <code>Temp</code> function at position
<code>(x,y)</code>, where <code>x</code> is a value in the <code>lat</code> variable and <code>y</code> is a value in the
<code>lon</code> variable. The <code>lat</code> variable is consulted to find <code>ilat</code> such that
<code>lat[ilat] = x</code>. Similarly, we want the <code>ilon</code> index such that <code>lon[ilon] =
y</code>. We can then obtain \$Temp(x,y)\$ as the (discretized) value of <code>Temp[ilat][ilon]</code>. This
is probably the simplest example for using coverages and more complex
examples exist for, for example, satellite swathes.</p>
</div>
<div class="paragraph">
<p>Using <code>OGC</code> coverage terminology, we have this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>maps</code> (e.g. <code>lat</code>, <code>lon</code>) specify the <code>Domain</code>.</p>
</li>
<li>
<p>The array (e.g. <code>Temp</code>) specifies the <code>Range</code>.</p>
</li>
<li>
<p>The <code>Grid</code> itself is a <code>Coverage</code> per <code>OGC</code>.</p>
</li>
<li>
<p>The <code>Domain</code> and <code>Range</code> are sampled functions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>map</code> is defined using the following XML scheme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{FQN for some variable previously defined in the DMR}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example might look like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Temp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Float32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the <code>map</code> variables are defined elsewhere like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Float32&gt;</span>

<span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lon</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Float32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The containing variable, <code>Temp</code> in the example, will be referred to as the
<code>array variable</code>.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each map variable MUST have a rank no more than that of the array.</p>
</li>
<li>
<p>An array variable can have as many maps as desired.</p>
</li>
<li>
<p>Any map duplicates are ignored</p>
</li>
<li>
<p>The order of declaration (top to bottom) MAY be significant.</p>
</li>
<li>
<p>The fully qualified name of a map must either be in the same lexical
scope as the array variable, or the map must be in some enclosing scope.</p>
</li>
<li>
<p>The set of named "`associated dimensions for a map must be a subset of
the set of named`"associated dimensions” for the array variable.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The term &#8220;associated dimensions&#8221; is computed as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The set of associated dimensions is initialized to empty.</p>
</li>
<li>
<p>For each element mentioned in the fully qualified name (FQN) of the
map or the array variable, add any named dimensions associated with FQN
element to the set of associated dimensions (removing duplicates, of
course).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In practice, the means that an array variable or map variable must take
into account any dimensions associated with any enclosing dimensioned
Structure or Sequence.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_attributes_and_arbitrary_xml">1.5.14. Attributes and Arbitrary XML</h4>
<div class="paragraph">
<p><em><span id="Attributes">Attributes</span></em></p>
</div>
<div class="paragraph">
<p>Simple attributes are defined using the following XML scheme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{atomicTypeName|EnumType fqn}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Namespace</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://netcdf.ucar.edu/cf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!--optional--&gt;</span>
  <span class="tag">&lt;Value</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  ...
  <span class="tag">&lt;Value</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{atomicTypeName|EnumType fqn}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes may also serve as containers for other attributes (and other
containers). In this case, no type is specified, only a name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Namespace</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://netcdf.ucar.edu/cf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
  <span class="tag">&lt;/Attribute&gt;</span>

  ...

  <span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
  <span class="tag">&lt;/Attribute&gt;</span>

<span class="tag">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In DAP4, Attributes (not to be confused with XML attributes) are tuples
with four components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name,</p>
</li>
<li>
<p>Type (one of the defined atomic types such as <code>Int16</code>, <code>String</code>, <code>Enum</code>, <code>fqn</code>,
etc.).</p>
</li>
<li>
<p>value as an alternate form for attributes with a single value,</p>
</li>
<li>
<p>Vector of one or more value declarations,</p>
</li>
<li>
<p>OR a set of contained attributes,</p>
</li>
<li>
<p>Zero or more Namespaces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This differs slightly from DAP2 Attributes because the namespace feature
has been added, although clients can choose to ignore it. For more about
namespaces, refer to Section <a href="#_namespaces">[1.5.15</a>]. The intent of
including the namespace information is to simplify interactions with
semantic web applications where certain schemas or standards have formal
definitions of attributes.</p>
</div>
<div class="paragraph">
<p>Attributes are typically used to associate semantic metadata with the
variables in a data source. Attributes are similar to variables in their
range of types and values, except that they are somewhat limited when
compared to those for variables: they cannot use <code>Structure</code> or <code>Sequence</code>
types.</p>
</div>
<div class="paragraph">
<p>Attributes defined at the top-level within a group are also referred to
as &#8220;group attributes&#8221;. Attributes defined at the root group (i.e.
Dataset) are &#8220;global attributes,&#8221; which many file formats such as HDF4
or netCDF formally recognize.</p>
</div>
<div class="paragraph">
<p>While the DAP does not require any particular Attributes, some may be
required by various metadata conventions. The semantic metadata for a
data source comprises the Attributes associated with that data source
and its variables. Thus, Attributes provide a mechanism by which
semantic metadata may be represented without prescribing that a data
source use a particular semantic metadata convention or standard.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>DAP4 explicitly treats an attribute with one value as an attribute
whose value is a one-element vector.</p>
</li>
<li>
<p>All of the atomic types are allowed as the type for an attribute</p>
</li>
<li>
<p>If the attribute has type <code>Enum</code>, it must also have an XML attribute,
<em>enum</em>, that references a previously defined <code>&lt;Enumeration&gt;</code> declaration.</p>
</li>
<li>
<p>Attribute value constants MUST conform to the appropriate constant
format for the given attribute type and as defined in Section
<a href="#_appendix_2_dap4_relax_ng_lexical_elements">[1.10.2</a>].</p>
</li>
<li>
<p>Attribute containers may may only contain attributes. Container
attributes may not have values; only lowest level (leaf) attributes may
have values.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Arbitrary XML content</em></p>
</div>
<div class="paragraph">
<p>DAP4 supports an explicit type to hold &#8220;arbitrary XML&#8221; markup that
provides a way for the protocol to transport information encoded in XML.
This is useful for &#8220;annotating&#8221; meta-data with information more
complex than simple attributes. This can be used, for example, for
passing semantic web information, or for passing out-of-band
information: e.g about the conversion from some other meta-data system
into DAP4.</p>
</div>
<div class="paragraph">
<p>The form on an other XML declaration is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;otherXML</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
{arbitrary xml}
<span class="tag">&lt;/otherXML&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are no <code>&lt;value/&gt;</code> elements because the value of otherXML is the xml
inside the <code>&lt;otherXML&gt;…&lt;/otherXML&gt;</code>. The text content of the otherXML
element must be valid XML and must be distinct from the XML markup used
to encode elements of the DAP4 data model (i.e., in a practical sense,
the content of an <code>&lt;OtherXML&gt;</code> attribute will be in a namespace other than
DAP4). XML content may appear anywhere that an attribute may appear.</p>
</div>
<div class="paragraph">
<p><em><span id="Attribute_and_OtherXML_Specification_and_Placement">Attribute and
OtherXML Specification and Placement</span></em></p>
</div>
<div class="paragraph">
<p>Attribute and OtherXML declarations MAY occur within the body of the
following XML elements: Group, Dataset, Dimension, Variable, Structure,
Sequence, and Attribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="_namespaces">1.5.15. Namespaces</h4>
<div class="paragraph">
<p>All elements of the DMR – <code>Dataset</code>, <code>Groups</code>, <code>Dimensions</code>, <code>Variables</code>, and
<code>Attributes</code> – can contain an associated <code>Namespace</code> element. The
namespace’s value is defined in the form of an XML style URI string
defining the context for interpreting the element containing the
namespace. Suppose, hypothetically, that we wanted to specify that an
Attribute is to be interpreted as a CF convention [<a href="#ref15">15</a>]. One might
specify this as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">latitude</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Namespace</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://cf.netcdf.unidata.ucar.edu</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  ...
<span class="tag">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is not to claim that this is how to specify a CF
convention [<a href="#ref15">15</a>].; this is purely illustrative.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_representation">1.6. Data Representation</h3>
<div class="paragraph">
<p>Data can be an elusive concept. Data may exist in some storage format on
some disk somewhere, on paper somewhere else, in active memory on some
server, or transmitted along some wire between two computers. All these
can still represent the same data. That is, there is an important
distinction to be made between the data and its representation. The data
can consist of numbers: abstract entities that usually represent
measurements of something, somewhere. Data also consist of the
relationships between those numbers, as when one number defines a time
at which some quantity was measured.</p>
</div>
<div class="paragraph">
<p>The abstract existence of data is in contrast to its concrete
representation, which is how we manipulate and store it. Data can be
stored as ASCII strings in a file on a disk, or as twos-complement
integers in the memory of some computer, or as numbers printed on a
page. It can be stored in HDF5 [<a href="#ref2">2</a>], netCDF [<a href="#ref4">4</a>], GRIB[<a href="#ref17">17</a>], a relational
database, or any number of other digital storage forms.</p>
</div>
<div class="paragraph">
<p>The DAP specifies a particular representation of data, to be used in
transmitting that data from one computer to another. This representation
of some data is sometimes referred to as the serialized representation
of that data, as distinguished from the representations used in some
computer’s memory. The DAP standard outlined in this document has
nothing at all to say about how data is stored or represented on either
the sending or the receiving computer. The DAP transmission format is
completely independent of these details.</p>
</div>
<div class="sect3">
<h4 id="_response_format">1.6.1. Response Format</h4>
<div class="paragraph">
<p>There are two response formats that a server MUST provide to the client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>DMR-only response</p>
</li>
<li>
<p>(DMR +) Data response</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="underline">DMR-Only Response</span> If the client requests only
the DMR, then it is returned as a standard XML encoded document. If
constraints were specified, then the returned DMR may differ from the
full DMR in that, for example, meta-data about only variables specified
in the constraint will be returned. The DMR-Only response MUST be
<em>self-contained</em>. This means that all declarations directly or
transitively mentioned in the selected variables must be included in the
returned DMR. Additionally, all attributes associated with the included
declarations MUST be included as well.</p>
</div>
<div class="paragraph">
<p><span class="underline">Data Response</span> The DAP4 data response uses a format
very similar to that used for DAP2; the data payload is broken into two
pieces. The first part holds metadata describing the names and types of
the variables in the response while the second part holds the values of
those variables.</p>
</div>
<div class="paragraph">
<p>The metadata information, sent as part 1 of the Data Response, is the
DMR limited to just those variables included in the response. The
response, however, MUST be self-contained (in the DMR-Only sense). DAP
attributes for all included declarations MUST be included, but MAY be
ignored by the receiving client.</p>
</div>
<div class="paragraph">
<p>Part 2 of the response consists of the binary data for each variable in
the order they are listed in the DMR given as the response preface. DAP4
uses a receiver makes it right encoding, so the servers MAY simply write
out binary data as they store it with the exceptions that floating-point
data must be encoded according to IEEE 754[<a href="#ref7">7</a>] and Integer data must use
twos-complement notation for signed types. Clients are responsible for
performing byte-swapping operations needed to compute using the values
retrieved.</p>
</div>
<div class="paragraph">
<p>The Data Response is encoded using chunking scheme (see Section
<a href="#How_the_Chunked_Encoding_Affects_the_Data_Response_Format">[1.6.2</a>]).
that breaks it into N parts where each part is prefixed with a chunk
type and chunk byte count header. Chunk types include data and error
types, making it simple for servers to indicate to clients that an error
occurred during the transmission of the Data Response and (relatively)
simple for clients to detect that error.</p>
</div>
<div class="paragraph">
<p>As with DAP2, the response described here is a document that can be
stored on disk or sent as the payload using a number of network
transport protocols, HTTP being the primary transport in practice.
However, any protocol that can transmit a document can be used to
transmit these responses. As such, all critical information needed to
decode the response is completely self-contained.</p>
</div>
<div class="paragraph">
<p>In the rest of this section we will describe the Data Response in the
context of DAP4 using HTTP as its transport protocol.</p>
</div>
<div class="paragraph">
<p><span class="underline">Format of the DMR Part</span></p>
</div>
<div class="paragraph">
<p>The first part (<em>part</em> is not to be confused with <em>chunk</em>) of the Data
Response always contains the DMR. The Data Response, when DAP is using
HTTP as a transport protocol, is the payload for an HTTP response. It is
separated from the last of the HTTP response’s MIME headers by a single
blank line, which MIME defines as a carriage return (ASCII character
with byte value of 13) followed by a line feed (ASCII character with
byte value of 10). This combination can be abbreviated as CRLF.</p>
</div>
<div class="paragraph">
<p><em>Format Related DMR Attributes</em><br>
The DMR MAY contain attributes that reflect information from the
serialized data. Specifically, the following attributes are defined.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>&lt;Attribute name=&#8220;_DAP4_Checksum_CRC32&#8221; type=&#8220;Int32&#8221;/&gt;</code> — this
attribute may be attached to each top-level variable to show the CRC-32
checksum of the content of that data. See Section
<a href="#_the_dap4_serialized_representation">[1.6.2</a>] for more information.</p>
</li>
<li>
<p><code>&lt;Attribute name=&#8220;_DAP4_Little_Endian&#8221; type=&#8220;UInt8&#8221;/&gt;</code> — this
attribute exists in the root group (the dataset) to indicate if the
serialized data byte order is little-endian. The value &#8220;1&#8221; indicates
that little-endian order was used and &#8220;0&#8221; indicates that big-endian
order was used. If missing, little-endian is assumed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="underline">Format of the Data Part</span> The second part of
the Data response consists of the serialized variables as specified by
the data DMR. The variable serializations are concatenated to form a
single binary dataset. If requested, each variable’s serialization is
followed by a CRC32 checksum.</p>
</div>
<div class="paragraph">
<p><span class="underline">Relationship to the Chunking format</span> The data response format is technically independent of the
chunking format (see <a href="#How_the_Chunked_Encoding_Affects_the_Data_Response_Format">1.6.1.3</a>).</p>
</div>
<div class="paragraph">
<p>The assumption is that the DMR will be in a chunk of its own, the first
chunk, and the serialized binary data will be in one or more additional
chunks. This produces a format like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CRLF
{DMR Length in binary form}
{DMR}
CRLF
{Chunk 1 containing some portion of the serialized data}
...
{Chunk n containing the last portion of the serialized data}</pre>
</div>
</div>
<div class="paragraph">
<p>In the above and in the following, the form &#8216;{xxx}&#8217; is intended to
represent any instance of the xxx.</p>
</div>
<div class="paragraph">
<p><em><span id="How_the_Chunked_Encoding_Affects_the_Data_Response_Format">How the
Chunked Encoding Affects the Data Response Format</span></em></p>
</div>
<div class="paragraph">
<p>In a sense, the chunked encoding does not affect the format of the Data
Response at all. Conceptually, the entire binary Data Response is built
and then passed through a &#8216;chunking encoder&#8217; transforming it into one
that is broken up into a series of chunks. That &#8216;chunked document&#8217; is
then sent as the payload of some transport protocol, e.g., HTTP. In
practice, that would be a wasteful implementation because a server would
need to hold the entire response in memory. A better implementation
would, for HTTP, write the initial parts of the HTTP response (its
response code and headers) and then use a pipeline of filters to perform
the encoding operations. The intent of the chunking scheme is to make it
possible for servers to build responses in small chunks, and once they
know those parts have been built without error, send them to the client.
Thus a server should choose the chunk size to be small enough to fit
comfortably in memory but large enough to limit the amount of overhead
spent by the software that encodes and decodes those chunks. When an
error is detected, the normal flow of building chunks and sending the
data along is broken and an error chunk should be sent (See Section
<a href="#_dap4_error_response">[2.3.4</a>]).</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_dap4_serialized_representation">1.6.2. The DAP4 Serialized Representation</h4>
<div class="paragraph">
<p>Given a DMR and the corresponding data, the serialized representation is
formally described in this section.</p>
</div>
<div class="sect4">
<h5 id="_a_note_on_dimension_ordering">A Note on Dimension Ordering</h5>
<div class="paragraph">
<p>Consider this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">d1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">d2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  ...
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dimensions are considered ordered top-to-bottom textually. This
order is linearized into a corresponding left-to-right order
<code>[d1][d2]…[dn]</code>. The assumption of row-major order means that in
enumerating all possible combinations of these dimensions, the rightmost
is considered to vary the fastest. The terms &#8220;right(most)&#8221; or
&#8220;left(most&#8221;) refer to this ordering of dimensions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_order_of_serialization">Order of Serialization</h5>
<div class="paragraph">
<p>The data appearing in a serialized representation is the concatenation
of the variables specified in the tree of Groups within a DMR, where the
variables in a group are taken in depth-first, top-to-bottom order. The
term &#8220;top-to-bottom&#8221; refers to the textual ordering of the variables
in an XML document specifying a given DMR.</p>
</div>
<div class="paragraph">
<p>If a variable is a Structure variable, then its data representation will
be the concatenation of the variables it contains, which will appear in
top-to-bottom order.</p>
</div>
<div class="paragraph">
<p>If a variable is a Sequence variable, then its data representation will
have two parts.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A 64-bit signed <em>count</em> of the number of elements in the sequence</p>
</li>
<li>
<p><em>Count</em> instances of the <a href="#The_Sequence_Type">1.5.12</a> for the
<code>Sequence</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a variable has dimensions, then the contents of each dimensioned data
item will appear concatenated and taken in row-major order.</p>
</div>
</div>
<div class="sect4">
<h5 id="_variable_representation">Variable Representation</h5>
<div class="paragraph">
<p>Given a dimensioned variable, it is represented as the N scalar values
concatenated in row-major order.</p>
</div>
<div class="paragraph">
<p>If the variable is scalar, then it is represented as a single scalar
value.</p>
</div>
</div>
<div class="sect4">
<h5 id="_numeric_scalar_atomic_types">Numeric Scalar Atomic Types</h5>
<div class="paragraph">
<p>For the numeric atomic types, scalar instances are represented as
follows. In all cases a consistent byte ordering is assumed, but the
choice of byte order is at the discretion of the program that generates
the serial representation, typically a server program.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Representation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Char</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit IEEE floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit IEEE floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In narrative form: all numeric quantities are used as a raw, unsigned
vector of N bytes, where N is 1 for Char, Int8, and UInt8; it is 2 for
Int16 and UInt16; it is 4 for Int32, UInt32, and Float32; and it is 8
for Int64, UInt64, and Float64.</p>
</div>
</div>
<div class="sect4">
<h5 id="_byte_swapping_rules">Byte Swapping Rules</h5>
<div class="paragraph">
<p>If the server chooses to byte swap transmitted values, then the
following swapping rules are used.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Size (bytes)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte Swapping Rules</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>2</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>4</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 3</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 2</p>
</div>
<div class="paragraph">
<p>Byte 2 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 3 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>8</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 7</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 6</p>
</div>
<div class="paragraph">
<p>Byte 2 <code>&#8594;</code> Byte 5</p>
</div>
<div class="paragraph">
<p>Byte 3 <code>&#8594;</code> Byte 4</p>
</div>
<div class="paragraph">
<p>Byte 4 <code>&#8594;</code> Byte 3</p>
</div>
<div class="paragraph">
<p>Byte 5 <code>&#8594;</code> Byte 2</p>
</div>
<div class="paragraph">
<p>Byte 6 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 7 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_variable_length_scalar_atomic_types">Variable-Length Scalar Atomic Types</h5>
<div class="paragraph">
<p>The variable length atomic values are all represented as a signed 64-bit
count followed by the data of the value.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Representation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of 8-bit bytes representing a UTF-8 String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes in the string (in Int64 format) followed by the bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of 8-bit bytes representing a URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Opaque</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of un-interpreted 8-bit bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes in the vector (in Int64 format) followed by the bytes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In narrative form, instances of String, Opaque, and URL types are
represented as a 64 bit length (treated as Int64) of the instance
followed by the vector of bytes comprising the value.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_variable_representation">Structure Variable Representation</h5>
<div class="paragraph">
<p>A Structure typed variable is represented as the concatenation of the
representations of the variables contained in the Structure taken in
textual top-to-bottom order. This representation may be nested if one of
the variables itself is a Structure variable. Dimensioned structures are
represented in a form analogous to dimensioned variables of atomic type.
The Structure array is represented by the concatenation of the instances
of the dimensioned Structure, where the instances are listed in
row-major order.</p>
</div>
<div class="paragraph">
<p>It should be noted that no padding is present in the structure
representation. One field’s content is immediately followed by the next
field’s content.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sequence_variable_representation">Sequence Variable Representation</h5>
<div class="paragraph">
<p>A Sequence typed variable is represented as a count specifying the
number of objects (not bytes) of the sequence followed by count
instances of the corresponding Structure using the Structure
representation rules. This representation may be nested if one of the
variables itself is a Sequence variable. Dimensioned sequences are
represented in a form analogous to dimensioned variables of atomic type.
The Sequence array is represented by the concatenation of the instances
of the dimensioned Sequence, where the instances are listed in row-major
order.</p>
</div>
<div class="paragraph">
<p>Each Sequence variable, then, consists of a length, L say, in Int64 form
and giving the number of elements for a specific occurrence of the
variable-length dimension. The count, L, is then followed by L instances
of the serialized form of the sequence’s corresponding structure.</p>
</div>
</div>
<div class="sect4">
<h5 id="_checksums">Checksums</h5>
<div class="paragraph">
<p>As an option, checksums will be computed for the values of all the
&#8220;top-level&#8221; variables present in the DMR of a returned response from a
server. The term &#8220;top-level&#8221; means that the variable is not a field of
a Structure (or Sequence) typed variable.</p>
</div>
<div class="paragraph">
<p>The purpose of the checksum is to detect changes in data over time. That
is, if a client requests the same variable and the returned checksums
are the same, then the client may infer that the data has not changed.
The checksum is not intended for transmission error detection, although
the client MAY use it for that purpose if it chooses. Note that the
value of the checksum will change depending on the byte order used to
serialize the data.</p>
</div>
<div class="paragraph">
<p>The checksum is made visible to the client by adding an attribute to
each top-level variable in the DMR. This attribute is named
&#8220;_DAP4_Checksum_CRC32&#8221;.</p>
</div>
<div class="paragraph">
<p>In all cases, the checksum is computed over the serialized
representation of each top-level variable. The checksum is computed
before any chunking Section <a href="#_dap4_chunked_data_representation">[1.7</a>])
is applied.</p>
</div>
<div class="paragraph">
<p>If the request to the server is a dmr-only request, then the server will
compute the checksum for each variable mentioned in the DMR and will
insert the &#8220;_DAP4_Checksum_CRC32&#8221; attribute in the DMR. Note that this
can have significant performance consequences since the server may need
to read and serialize all of the data for all of the variables mentioned
in the DMR even though that data is not transmitted to the client.</p>
</div>
<div class="paragraph">
<p>If the request to the server is a data request, then the checksum value
will follow the value of the variable in the data part of the response.
The computed checksum is appended to the serialized representation for
transmission to the client. Note that in this case, the client is
expected to add the &#8220;_DAP4_Checksum_CRC32&#8221; attribute to the DMR.</p>
</div>
<div class="paragraph">
<p>The default checksum algorithm is CRC32. So the size of each checksum
inserted in the serialization will be a 32 bit integer. The checksum
integer will use the same endian representation as for the all other
data. Note that CRC32 is not a cryptographically strong checksum, so it
is not suitable for detecting man-in-the-middle attacks.</p>
</div>
<div class="paragraph">
<p><em><span id="Historical_Note">Historical Note</span></em></p>
</div>
<div class="paragraph">
<p>The encoding described in Section <a href="#_response_format">1.6.1</a> is similar
to the serialization form of the DAP2 protocol [<a href="#ref3">3</a>], but has been
extended to support arrays with a varying dimension and stripped of
redundant information added by various XDR implementations.</p>
</div>
<div class="paragraph">
<p>The DAP4 Serialization rules are derived from, but not the same as, XDR
[<a href="#ref10">10</a>]. The differences are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Values are encoded using the byte order of the server. This is the
so-called &#8220;receiver makes it right&#8221; rule.</p>
</li>
<li>
<p>No padding is used.</p>
</li>
<li>
<p>Floating point values always use the IEEE [<a href="#ref7">7</a>] standard.</p>
</li>
<li>
<p>One and two-byte values are not converted to four byte values.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_responses">1.6.3. Example responses</h4>
<div class="paragraph">
<p>In these examples, spaces and newlines have been added to make them
easier to read. The real responses are more compact. Since this proposal
is just about the form of the response - and it really focuses on the
BLOB part - there is no mention of &#8216;chunking.&#8217; For information on how
this BLOB will/could be chunked. see Section
<a href="#_dap4_chunked_data_representation">[1.7</a>]. NB: Some poetic license used
in the following and the checksums for single integer values seems
silly, but these are really simple examples.</p>
</div>
<div class="sect4">
<h5 id="_a_single_scalar">A single scalar</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x
{checksum}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_a_single_array">A single array</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/Int32&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13
{checksum}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_a_single_structure">A single structure</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13
y
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, there is a single variable at the top-level
of the root Group, and that is S; so it is S for which we compute the
checksum.</p>
</div>
</div>
<div class="sect4">
<h5 id="_an_array_of_structures">An array of structures</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Float64</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13 y x00 x01 x02 x03 x10 x11 x12 x13 y x00 x01 x02 x03 x10 x11 x12 x13 y
{checksum}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_single_array_with_sequence">Single array with sequence</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;String</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a-star</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-star</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
16 This is a string
{checksum}
5 a0 a1 a2 a3 a4
{checksum}
3 x00 x01 x02 6 x00 x01 x02 x03 x04 x05
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The checksum calculation includes only the values of the variable, not
the containing chunk’s length bytes.</p>
</li>
<li>
<p>The Sequence objects are treated &#8216;like strings&#8217; and prefixed with a
length count. In the last of the three variables, the dimensioned
sequence <em>x-star</em> has two sequence instances where the first sequence
has 3 elements and the second has 6.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_nested_sequences">Nested Sequences</h5>
<div class="paragraph">
<p>The sequence &#8216;x-star&#8217; has a field that is itself a sequence. In the
example, at the time of serialization &#8216;x-star&#8217; has three elements the
inner sequence (of which there are three instances) have three, six and
one element, respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-star</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y-star</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">z</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
3 3 x00 x01 x02 6 x10 x11 x12 x3 x14 x15 1 x20
{checksum}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dap4_chunked_data_representation">1.7. DAP4 Chunked Data Representation</h3>
<div class="paragraph">
<p>An important capability for DAP4 is supporting clients in determining
when a data transmission fails. This is especially difficult when
sending binary data (Section <a href="#_response_format">1.6.1</a>). In order to
support such a capability, the DAP4 protocol uses a simplified variation
on the HTTP/1.1 chunked transmission format [<a href="#ref9">9</a>] to serialize the data
part of the response document so that errors are simple to detect.
Furthermore, this format is independent of the form or content of that
part of the response, so the same format can be used with different
response forms or dropped when/if DAP is used with protocols that
support out-of-band error signaling, simplifying our ongoing refinement
of the protocol.</p>
</div>
<div class="paragraph">
<p>The data part of a response document is &#8220;chunked&#8221; in a fashion similar
to that outlined in HTTP/1.1. However, in addition to a prefix
indicating the size of the chunk, DAP4 includes a chunk-type code. This
provides a way for the receiver to know if the next chunk is part of the
data response or if it contains an error response (Section
<a href="#_dap4_error_response">[2.3.4</a>]). In the latter case, the client
should assume that the data response has ended, even though the correct
closing information was not provided.</p>
</div>
<div class="paragraph">
<p>Each chunk is prefixed by a chunk header consisting of a chunk type and
byte count, all contained in a single four-byte word. The encoding of
this word is always network byte order (i.e. Big-Endian) The chunk type
will be encoded in the high-order byte of the four-byte word and chunk
size will be given by the three remaining bytes of that word. The
maximum chunk size possible is \$2^{24}\$ bytes. Immediately following the
four-byte chunk header will be chunk-count bytes followed by another
chunk header. More precisely the initial four bytes of the chunk are
decoded using the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Treat the 32 bit header a single, big-endian, unsigned integer.</p>
</li>
<li>
<p>Convert the integer to the local machine byte order by swapping bytes
as necessary (Section <a href="#_byte_swapping_rules">1.6.2</a>). Let the
resulting integer be called H.</p>
</li>
<li>
<p>Compute the chunk type by the following expression: <code>type = (H &gt;&gt; 24) &amp;
0xff</code> (Using C-language operators).</p>
</li>
<li>
<p>Compute the chunk length by the following expression: <code>length = (H &amp;
0x00ffffff)</code> (Using C-language operators).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The chunk type is determined as a set of one or more flags. Currently,
the possible flags are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 3. Chunk Type Encoding</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value of 0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value of 1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A data containing chunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The last data chunk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current chunk is not an error chunk.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current chunk is an &#8220;error chunk&#8221; and contains an error message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data in this response is encoded using Big-Endian (i.e. network byte order)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data in this response is encoded using Little-Endian</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is possible for a chunk type to have more than one of the flags. So,
for example, if the data fits into a single chunk, and we assume
little-endian encoding, then its chunk type would be End + LittleEndian.</p>
</div>
<div class="paragraph">
<p>Error implies End, but if the Error flag is set, then bit 0 should be
treated as set even if it is not. Note that in order for this to work,
the chunk flags values must be powers of two: e.g. 1, 2, 4.</p>
</div>
<div class="paragraph">
<p>The Endian flag must be set only in the first Data chunk. It applies to
the whole response. If set in any subsequent chunk type, it will be
ignored.</p>
</div>
<div class="sect3">
<h4 id="_chunked_format_grammar">1.7.1. Chunked Format Grammar</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">chunked_response: chunklist ;
chunklist: chunk | chunklist chunk ;
chunk: CHUNKTYPE SIZE CHUNKDATA ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is semantic limitation in the definition of &#8216;chunk&#8217;:
the number of bytes in the CHUNKDATA must be equal to SIZE.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lexical_structure">1.7.2. Lexical Structure</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">/* A single 8-bit byte,
   with the encoding 0 = data, 1 = end, 2 = error, 4 = Little-Endian */
CHUNKTYPE = '\x00'|'\x01'|'\x02'|'\x4'|'\x06'
/* A sequence of three 8-bit bytes,
  interpreted as an integer on network byte order */
SIZE = [\0x00-\0xFF][\0x00-\0xFF][\0x00-\0xFF]
CHUNKDATA = [\0x00-\0xFF]*</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constraints">1.8. Constraints</h3>
<div class="paragraph">
<p>A request to a DAP4 server for either metadata (the DMR) or data may
include a constraint expression. This constraint expression specifies
which variables are to be returned and what subset of the data for each
variable is to be returned.</p>
</div>
<div class="paragraph">
<p>This section defines the a constraint language that MUST be supported by
any implementation claiming to support the DAP4 protocol. The method by
which a server is provided with a constraint is specified in Volume 2.
But as a typical example, if such a constraint were to be embedded in a
URL, then it is presumed that it is prefixed with a
&#8220;?dap4.ce=constraint-expression&#8221; that is appended to the end of the
URL.</p>
</div>
<div class="paragraph">
<p>The DAP4 Constraint Expression (CE) syntax is an extension of the syntax
used by DAP2 that adds some important new features for Arrays as well as
addressing some ambiguities and structural problems in the DAP2 syntax.
In this design we also introduce some new terminology to make the
explanation of the CE syntax clearer. Additionally, we use a &#8216;curly
brace&#8217; notation for datasets to streamline the description of datasets
because the XML documents that DAP4 servers produce is verbose and hard
for humans to read.</p>
</div>
<div class="paragraph">
<p>When a client makes a request to a DAP4 server, it MAY send a CE where a
missing (or empty) CE is interpreted to mean that the client wants the
entire dataset sent. A CE is made up of a list of clauses, e ach of
which names a variable in the dataset that the client would like the
server to send to it. Each clause can further be broken down into two
parts: The subset expression and the filter expression. There are
limitations on the CE clauses depending on variable type. For scalar
variables, getting the variable is the only option available, so filter
expression is supported, and if present, the only subset expression
allowed is <code>[0]</code> or <code>[]</code>. Structure variables can be subset by field but
do not support filter expressions (although fields within a Structure
may support filtering). Sequences can be subset by field and do support
filters. Arrays support index subsets.</p>
</div>
<div class="paragraph">
<p>Specifically, the new features added for DAP4 constraints include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a grouping operator for Structures and Sequences.</p>
</li>
<li>
<p>Sequence filtering expressions explicitly bound to a specific Sequence
variable.</p>
</li>
<li>
<p>Multiple, disjoint index subsets.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_terminology_used_by_this_section">1.8.1. Terminology used by this section</h4>
<div class="paragraph">
<p><strong>selection expression</strong><br>
The entire expression passed to the server that is used to choose
specific parts of a dataset.</p>
</div>
<div class="paragraph">
<p><strong>subset</strong><br>
The act of choosing parts of a dataset based on the <em>type</em> of one or
more of its variables. We define several types of subsetting operations
as follows:</p>
</div>
<div class="paragraph">
<p><strong>index subsetting</strong><br>
Choosing parts of an array based on the indexes of that array’s
dimensions. This operation always returns an array of the same rank as
the original, although the size of the return array will likely be
smaller. Index subsetting uses the bracket syntax described
subsequently, and is zero-based (<code>u[1]</code> refers to 2th element of <code>u</code>).</p>
</div>
<div class="paragraph">
<p><strong>field subsetting</strong><br>
Choosing specific variables (fields) from the dataset. A dataset in DAP4
is made up of a number of variables and those may be Structures or
Sequences that contain fields. Field subsetting uses the brace syntax
described later. One or more fields can be specified using a semicolon
(<code>;</code>) as the separator.</p>
</div>
<div class="paragraph">
<p><strong>filter</strong><br>
A filter is a predicate that can be used to choose sequence rows based
on the values of fields of the sequence. the vertical bar (<code>|</code>) is used
as a prefix operator for the filter predicate. Filters can be applied to
fields of a Sequence. A filter predicate consists of one or more filter
subexpressions. One or more subexpressions can be specified, using a
comma (<code>,</code>) as the separator. Implicitly, multiple filter subexpressions
are logically and’ded together.</p>
</div>
<div class="paragraph">
<p><strong>filter subexpression</strong><br>
A simple expression that consists of a single variable/field; the
expression is composed from traditional set of binary and unary
operators: comparison operators (<code>=</code>, <code>!=</code>, <code>&lt;</code>, <code>&#8656;</code>, <code>&gt;</code>, <code>&gt;=</code>) for numbers and
strings, and a string specific regular expression comparison operator
(<code>~=</code>). The operands of the operators must be either numeric or string
constants or a field of the Sequence. Specifically, only atomic-valued,
scalar fields can be used in the filter expression.</p>
</div>
<div class="paragraph">
<p><strong>id</strong><br>
The name of a variable. These must be absolute, with some specific
exceptions. Absolute names are fully qualified names (See Section
<a href="#_fully_qualified_names">[1.5.4</a>]).</p>
</div>
</div>
<div class="sect3">
<h4 id="_subsetting_constraints">1.8.2. Subsetting Constraints</h4>
<div class="paragraph">
<p>The simplest constraint is the null string and it means &#8216;return
everything&#8217; from the dataset. Choosing variables in a dataset is
referred to as the <em>subset</em>. To choose a subset of the variables in a
dataset, enumerate them in a semicolon-separated list. To choose parts
of a <code>Structure</code>, name those parts explicitly using the syntax</p>
</div>
<div class="paragraph">
<p><code>structure_name\{field name}</code><br></p>
</div>
<div class="paragraph">
<p>or<br></p>
</div>
<div class="paragraph">
<p><code>structure_name.field name</code><br></p>
</div>
<div class="paragraph">
<p>Each DAP4 dataset contains one or more <code>Groups</code>. The top-level <code>Group</code> is always
present and is named <code>/</code> (pronounced <code>root</code>).</p>
</div>
<div class="sect4">
<h5 id="_example_1_subsetting_by_variable_or_field_in_a_structure">Example 1: subsetting by variable or field in a Structure</h5>
<div class="paragraph">
<p>Consider a <code>Dataset</code> that has two scalar variables <code>u</code> and <code>v</code> at the <code>root</code> level, and
a <code>Structure</code> named <code>Point</code>. <code>Point</code> has two scalar variables in it, named <code>x</code> and <code>y</code>. Below
we presence the XML code that define the (metadata of the) Dataset, and for those unfamiliar with
DAP4, we also present the DDS (DAP2) metadata of the same Dataset. It should be assume that the
server is implementing the DAP4 protocol, and so DAP2 subsetting does not apply.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 xml example: dataset definition --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_1</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">dapVersion</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4.0</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">dmrVersion</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xml:base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:dap4/test_ce_1.xml</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/ns/DAP/4.0#</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:dap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/ns/DAP/4.0#</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: The syntax used for the examples is (hopefully) easier to read
than the DAP4 DMR which uses XML; Curly braces indicate hierarchy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS reference --&gt;</span>
Dataset {
    Int32 u;
    Int32 v;
    Structure {
        Int32 x;
        Int32 y;
    } Point;
} vol_1_ce_1;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 4. DAP4 Subsetting scenarios</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access just <code><em>u</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/u</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access just <code>u</code> and <code>v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/u;/v</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access just <code>x</code> within <code>Point</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Point{x}</code><br>
or<br>
<code>/Point.x</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_example_2_subsetting_by_variable_or_field_in_a_group">Example 2: subsetting by variable or field in a Group</h5>
<div class="paragraph">
<p>Consider a <code>Dataset</code> that has two scalar variables <code>u</code> and <code>v</code> at the <code>root</code> level. The Dataset
has a <code>Group</code> named <code>inst2</code>, and inside of it are two other scalar variables also named <code>u</code> and <code>v</code>.
Inside the groups there is also a <code>Structure</code> named <code>Point</code>, and <code>Point</code> has two scalar variables in it,
named <code>x</code> and <code>y</code>. One can imagine that the Dataset in the
<a href="#_example_1_subsetting_by_variable_or_field_in_a_structure">above Example</a> is fully contained within the
<code>Group</code> named <code>inst2</code>.</p>
</div>
<div class="paragraph">
<p>Below we presence the XML code that define the (metadata of the) Dataset, and for those unfamiliar with
DAP4, we also present the DDS (DAP2) metadata of the same Dataset, even though <span class="underline">`Group`s are NOT part of
the DAP2 spec</span>. It should be assume that the server is implementing the DAP4 protocol, and so DAP2 subsetting does not apply.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 DMR --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Group</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inst2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Structure&gt;</span>
  <span class="tag">&lt;/Group&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Int32 u;
    Int32 v;
    Group {
        Int32 u;
        Int32 v;
    Structure {
        Int32 x;
        Int32 y;
    } Point;
   } inst2;
} vol_1_ce_2;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 5. DAP4 Subsetting scenarios when Dataset has a <code>Group</code></caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access 'root' <code>u</code> and <code>v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/u;/v</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access 'root' <code>u</code>, <code>v</code>, and <code>u</code> <code>v</code> within <code>inst2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/u;/v;/inst2/u;/inst2/v</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access <code>u</code> and <code>v</code> within <code>inst2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/inst2/u;/inst2/v</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access <code>x</code> in <code>Point</code>, which is inside the <code>inst2</code> Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/inst2/Point{x}</code> or <code>/inst2/Point.x</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a semicolon is a change from DAP2 where clauses in the <em>project
part</em> of the constraint were separated using a comma (<code>,</code>). We used
semicolon because the comma is used elsewhere and using comma here made
for a convoluted grammar. We wanted the grammar to be LALR(1) so that
both table-driven and recursive-descent parsers would be easy to
write.because it’s easy to make both table and recursive descent parsers
for these.</p>
</li>
<li>
<p>Every name in a constraint should be a <strong>fully qualified name</strong>, except
that if a simple name is referenced inside curly braces (e.g.<code>{x}</code>) for
a variable whose type is a structure or sequence type, S say, and &#8220;x&#8221;
is a top-level field in S, then that is allowed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array_subsetting_in_index_space">1.8.3. Array Subsetting in Index Space</h4>
<div class="paragraph">
<p>Subsetting fixed-size arrays in their <em>index space</em> is accomplished
using square brackets. The syntax closely follows that of DAP2, with
some extensions. For an array with <code>N</code> dimensions, <code>N</code> sets of brackets
are used, even if the array is only subset on some of the dimensions.
The names of array variables are fully qualified names (FQNs) so it’s
possible to name arrays in structures and/or <code>Groups</code>. Array index values
are <em>zero-based</em> as with a number of programming languages such as C and
Java. Every array has a known starting index value of zero. Within the
square brackets, several subexpressions are allowed:</p>
</div>
<div class="paragraph">
<p><strong>[ ]</strong><br>
return all of elements elements for a particular dimension <em>or</em> apply a
shared dimension slice (more on this later).</p>
</div>
<div class="paragraph">
<p><strong>[ <em>n</em> ]</strong><br>
return only the value at a single index, where \$0 &lt;= n &lt; N\$ for a
dimension of size <code>N</code>. This slicing operator does not reduce the
dimensionality of an array, but does return a dimension size of one for
the dimension to which this is applied.</p>
</div>
<div class="paragraph">
<p><strong>[ <em>start</em> : <em>step</em> : <em>last</em> ]</strong><br>
return every value whose index is in the range <strong>start</strong> \$&lt;=\$ <em>index</em> \$&lt;=\$ <strong>last</strong>
and where <code>(index - start)% step == 0</code>. <strong>NOTE</strong>: <span class="underline">range defined by square brackets is inclusive to right
(subset will include the last index)</span>.</p>
</div>
<div class="paragraph">
<p><strong>[ <em>start</em> : <em>last</em> ]</strong><br>
return the values whose index is in the range  <strong>start</strong> \$&lt;=\$ <em>index</em> \$&lt;=\$ <strong>last</strong> where <code>step=1</code> by default.</p>
</div>
<div class="paragraph">
<p><strong>[ <em>start</em> : ]</strong><br>
return every value whose index is in the range <strong>start</strong> \$&lt;=\$ <em>index</em> \$&lt;= N-1\$, where <code>N</code>
is the dimension size. <code>step=1</code> by default.</p>
</div>
<div class="paragraph">
<p><strong>[ <em>start</em> : <em>step</em> : ]</strong><br>
return every value whose index is in the range <strong>start</strong> \$&lt;=\$ <em>index</em> \$&lt;= N-1\$, where <code>N</code>
is the dimension size and where <code>(index - start)% step == 0</code>.</p>
</div>
<div class="paragraph">
<p>Subsetting can be applied to any array. It can also be applied to a
scalar, but in this case, the only legal forms are <em>[0]</em> or <em>[]</em>.</p>
</div>
<div class="sect4">
<h5 id="_example_dataset_with_a_structure_which_has_an_anonymous_dimension_scalar_variables_in_it">Example: Dataset with a Structure which has an anonymous Dimension scalar variables in it</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 DMR --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Int32&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Int32&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Int32 u[256][256];
    Int32 v[256][256];
    Structure {
        Int32 x;
        Int32 y;
    } Point[256];
} vol_1_ce_3;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 6. DAP4 Subsetting scenarios by index when Dataset has a Structure</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Extra Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access all of <code>u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns all the array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access all of <code>x</code> inside <code>Point</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Point{x}</code><br>
or<br>
<code>/Point.x</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This returns an array of Structures with a single <br>
(Int32) element, not an array of Int32.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access elements 11th through 20th of array <code>Point</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Point[10:19]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns 10 Structures.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access every 4th element in the <code>Point</code> array</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Point[0:4:255]</code><br>
or<br>
<code>/Point[0:4:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns 64 Structures corresponding to elements<br>
at indexes 0, 3, 7, …, 255 of the array.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Index-space and field subsetting may be combined in the <br>
logical way</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Point[0:4:]{x}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns an array of structures (with 64 elements) named<br>
 <code>Point</code> that contains a single <code>Int32</code> field named <code>x</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access every forth element of <code>u</code><br>
in both dimensions</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[0:4:][0:4:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns 1/16th of the original array’s data<br>
starting with its 1st element.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get all rows, and the 11th<br>
through 19th columns of <code>u</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[][10:19]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns a 2D array with 10 columns.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access 10 columns of 2D array<br>
along a single row.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[7][10:19]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns a 1D array of 10 elements that span<br>
columns 11th through 20th along the 8th row of<br>
original array data.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>All of <code>u</code> array</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[][]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>identical to <code>/u</code>, <code>/u[0:][0:]</code><br>
and <code>/u[0:1:][0:1:]</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_example_structure_with_scalar_and_array_variables_inside_and_anonymous_dimensions">Example: Structure with scalar and array variables inside and anonymous dimensions</h5>
<div class="paragraph">
<p>The data model for DAP4 is very similar to that of a modern structured
programming language where <em>constructor types</em> like <code>Structure</code> may
contain any allowed type (including other <code>Structures</code>, etc.) as well as
being arrays themselves. The basic syntax for subsetting outlined so far
can be applied to the fields of a Structure using braces to enclose the
subsetting expression that apply to the fields of the <code>Structure</code>. This
can be applied recursively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 DMR --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Int32&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Int32 u[256][1024];
    Structure {
        Int32 x;
        Int32 y[1024];
        Int32 z[256];
    } Points[256];
} vol_1_ce_4;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 7. DAP4 Subsetting scenarios by index when Dataset has a Structure</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Extra Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get all of the elements (<code>Structure</code>) <code>Points</code>, and for each
of those elements get the elements 8th through 257th array <code>y</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points{y[7:256]}</code> or<br>
<code>/Points.y[7:256]</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Returns a <code>Structure</code> with 256 elements of <code>Points</code>, but without
fields <code>x</code> and <code>z</code> inside of it.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get the first ten elements of <code>Points</code> and, for each of those, only the
first ten elements of the array <code>y</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points[0:9]{y[0:9]}</code> or<br>
<code>/Points[0:9].y[0:9]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get the first ten elements of <code>Points</code> and, for each of those, return
only all of <code>x’ and the first ten elements of the array `y</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points[0:9]{x;y[0:9]}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>length of <code>Points</code> is 10.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get the first ten elements of <code>Points</code> (all fields included)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points[0:9]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>length of <code>Points</code> is 10, and for each of them, inside there are scalar <code>x</code>,
all of <code>y</code> and <code>z</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get all of <code>Points</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points</code> or <code>/Points[]</code> or <code>/Points[0:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When <code>Points</code> uses a <span class="underline">shared dimension</span>, the last of the three CEs will replace that with an
anonymous dimension (see the section on shared dimensions)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_example_dataset_with_nested_structures_and_anonymous_dimensions">Example: Dataset with Nested Structures and anonymous dimensions</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 DMR --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Int32&gt;</span>
  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Points</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sounding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/Int32&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pressure</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;/Structure&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">256</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Int32 u[256][1024];
    Structure {
        Int32 x;
        Int32 y;
        Structure {
            Int32 height[1024];
            Int32 pressure[1024];
        } sounding;
    } Points[256];
} vol_1_ce_5;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 8. DAP4 Subsetting scenarios by index when Dataset has a Structure</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 55%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Extra Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get the first element of <code>Points</code> and, for that, get the fields
<code>x</code>, <code>y</code> and a slice of <code>height</code> within <code>sounding</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points[0]{x,y,sounding{height[0:8:]}}</code><br>
or<br>
<code>/Points[0]</code>{x,y,sounding.height[0:8:]}`<br>
or<br>
<code>/Points[0].x;/Points[0].y;Points[0].soundings.height[0:8:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field <code>pressure</code> is missing. <span class="underline">The last option is legal, but <code>/Points[0]</code> will only appear once in the result</span>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the example above, we note that the <code>{}</code> syntax provides an
easy way to request <code>x</code>, <code>y</code> and <code>sounding.height[0:8:]</code> without having
to repeat <code>/Points[0]</code> three times. Furthermore, in any given Constraint Expression, each variable can be
constrained only one way.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array_subsetting_with_disjoint_index_subsets">1.8.4. Array subsetting with Disjoint Index Subsets</h4>
<div class="paragraph">
<p>As a new feature in DAP4 constraints, index subset within square
brackets can contain multiple, disjoint slices, where each slice is of
any of the previously defined slice formats (most generally
<code>start:stride:last</code> where <code>last</code> is included).
The disjoint slices are separated by commas.</p>
</div>
<div class="paragraph">
<p>Using the preceding example dataset <a href="#_example_structure_with_scalar_and_array_variables_inside_and_anonymous_dimensions">vol_1_ce_4</a>,
some disjoint index examples might be as follows.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 9. DAP4 Subsetting scenarios by index when Dataset has a Structure</caption>
<colgroup>
<col style="width: 41.1764%;">
<col style="width: 58.8236%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[10:12,19:23]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access elements 10 through 12, and 19 through 23 of array <code>u</code>, resulting in an
array of size 8. The values returned are<br>
<code>u[10] u[11] u[12] u[19] u[20] u[21] u[22] u[23]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/u[19:23, 10:12]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access elements 19 through 23 and 10 through 12 of array <code>u</code>. The result
will be an array of size <code>8</code>, as follows:<br></p>
</div>
<div class="paragraph">
<p><code>u[19] u[20] u[21] u[22] u[23] u[10] u[11] u[12]</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_how_sequences_fit_into_this_syntax">1.8.5. How Sequences fit into this syntax</h4>
<div class="paragraph">
<p>The <code>Sequence</code> type is more general data type in DAP4 than in DAP2 where
it was significantly limited. In DAP4 Arrays of <code>Sequences</code> will be
supported as will <code>Sequence fields</code> that are themselves <code>Arrays</code> or
<code>Sequences</code>. A <code>Sequence variable</code> is conceptually like a table of rows
where each field in the <code>Sequence</code> is a column in the table (or like an
array of Structures, where the size of the single array dimension is a
secret). <span class="underline">Note that while there is a big difference between the value
held by a <code>Structure</code> and a <code>Sequence</code>, each has the same subsetting syntax
in the CE</span>. The differences is that <code>Sequences</code> may have filters applied during CEs while <code>Structures</code>
may not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_6</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">z</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">z</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1024</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>
<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Sequence {
        Int32 x;
        Int32 y;
    } s1;

   Sequence {
        Int32 x;
        Int32 y;
    } s2[100];

    Sequence {
        Int32 z;
        Int32 x[10];
    } s3;

     Sequence {
        Int32 z;
        Int32 x[1024];
    } s4[100];
} example;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 10. DAP4 Subsetting scenarios by index when Dataset has many <code>Sequences</code></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 35%;">
<col style="width: 35%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objective</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Extra Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get all of Sequence <code>s1</code> and its elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/s1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No other elements outside of <code>s1</code> are included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get all elements <code>x</code> and <code>y</code> of Sequence <code>s1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/s1{x;y}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>/s1</code> in this case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get all rows of Sequence <code>s1</code>, but only field <code>x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/s1{x}</code> or <code>/s1.x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each field/child of <code>s1</code> behaves like a column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get 100 rows of all elements (columns) of <code>s2</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/s2{x;y}</code> or <code>/s2[0:99]{x,y}</code><br>
or <code>/s2[]{x;y}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Each <code>x</code> and <code>y</code> have 100 elements. So these expressions are equivalent.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Slice first 10 rows of Sequence <code>s2</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/s2[0:9]{x;y}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If there were more columns in <code>s2</code>, only would get <code>x</code> and <code>y</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get every instance of the Sequence <code>s3</code> where <code>z</code> is less than 10.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/s3{} | z &lt; 10</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note the use of <code>filter</code> <code>|</code> (read "such as"), a topic that is discussed in
much more detail later on.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_subsetting_and_shared_dimensions">1.8.6. Subsetting and Shared Dimensions</h4>
<div class="paragraph">
<p><span class="underline"><strong>Shared Dimensions</strong></span> provide additional information to indicate that a
group of arrays share certain relationships; that specific groups of the
arrays form <code>coverages</code> by indicating how dimensions of <code>Maps</code> and
<code>Arrays</code> are linked. The <span class="underline">DAP4 CE syntax provides a way to slice a Shared
Dimension so that slice can be used by all of the arrays that use it
without repeating the slicing operation for each Array</span>. The syntax can
be read &#8216;Assign the shared dimension <code>X</code> this slice,&#8217; where the slice
looks like, for example, <code>row=[10:19]</code>. All of the variations of the
slice operator possible for an array are accepted for shared dimension
slicing. In any CE, all of the shared dimension slicing clauses must
precede the variable subsetting clauses.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> DAP4 uses XML for it’s actual grammar, and because that’s wordy
this document includes a mock notation. I will extend that notation used
so far so it includes concepts needed to mimic DAP4’s notation for a
coverage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The keyword <strong>Dimensions</strong> introduces a list of symbols and their sizes.
(That is the definition of a Dimension in DAP4; a size bound to an
identifier.)</p>
</li>
<li>
<p>Arrays where every dimension uses a <strong>Dimension</strong> to supply its extent
are DAP4 <strong>Maps</strong>. <span class="underline"><strong>Maps</strong> are the arrays that hold the <strong>domain</strong> values for a
<strong>coverage</strong></span>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong><br></p>
</div>
<div class="paragraph">
<p>Using <strong>Shared Dimensions</strong> for array slicing adds some complexity to the
processing of constraints. Two cases are important to consider and are
shown in the examples.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a request is made for an <code>Array</code> with <code>Maps</code> but the request names
only the Array and not the Maps, the assumption is made that the
requester intended to receive <em>only</em> the Array and not the <code>Maps</code>. For
example, the client might have already requested/received the <code>Maps</code>. Note
that in this case the <a href="#<em>constrained_dmr_objects">Constrained DMR</a> included with the data response will still
include the _Map</em> element(s) for the Array, and the receiving client
must know that the associated (Map) variable is not present in the
response.</p>
</li>
<li>
<p>A second case involves requests for two or more <em>Arrays</em> that share <em>Maps</em>
and that constrain (i.e. &#8216;slice&#8217;) those Maps differently. Because this
can introduce a logical inconsistency, when a local dimension slice is
applied to an <em>Array</em>’s dimension that has a Map, using that local
dimension slice will cause the Map to be removed from the data
response’s Constrained DMR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The examples make these two cases clearer.</p>
</div>
<div class="sect4">
<h5 id="_examples_using_shared_dimensions_and_anonymous_dimension">Examples using Shared Dimensions and Anonymous Dimension</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_7</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlon</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>
  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lon</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sal</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">O2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CO2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Dimensions: nlat=100, nlon=50;
    Float32 lat[nlat];
    Float32 lon[nlon];

    // The maps ''lat'' and ''lon'' are used here and define a coverage
    Float32 temp[lon][lat];
    Float32 sal[lon][lat];
    Float32 O2[lat][lon];
    Float32 CO2[lon][lat][10];
} shared_dimensions;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 11. DAP4 Subsetting scenarios with Shared Dimensions</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 45%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Extra Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/lon[0:99];/lat[10];/temp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong><span style="color: #CC0000;">Baseline without use of shared dimensions.</span></strong>. Returns all of <code>temp</code> Array, a subset of <code>lon</code> of size 100, and the 11th element of array <code>lat</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat[nlat];/lon[nlon];/temp[nlat][nlon]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Will return <code>nlat</code>, <code>nlon</code>, <code>lat</code>, <code>lon</code> as 1D arrays of size 10,
and <code>temp</code> a <code>10x10</code> array.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat[];/lon[];/temp[][]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>3</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat;/lon;/temp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as 1 and 2.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat;/lon;/temp;/sal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as 1-3, but <code>10x10</code> <code>sal</code> array is included.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>5</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat;/lon</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This CE requests just the arrays that hold the domain values.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>6</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/temp;/sal</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This CE requests just the arrays that hold the range values. The <code>Maps</code> <code>lat</code> and <code>lon</code> are not included.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>7</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/temp[][];/sal[][]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Requests exactly the same data as 6.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:4:];/nlon=[0:4:];/CO2</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mixes <code>shared dimension</code> and local slicing to return every fourth value in the first two
dimensions of <code>CO2</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>9</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:4:];/nlon=[0:4:];/CO2[][][0:4:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The variable <code>CO2</code> contains an <span class="underline">anonymous dimension</span>. The CE mixes the
shared dimension slicing, and applies slicing along the third (anonymous) dimension.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:4:];/nlon=[0:4:];/CO2[][1][0:4:]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Similar example as 9, but the <code>[1]</code> overrides the slicing provided by a shared dimension <code>nlon</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>11</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/temp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Return only Array <code>temp</code> (all of it). Maps are not included but will be mentioned in the Constrained DMR.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>12</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/lat;/lon;/temp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Will return three Arrays: The <code>Map Arrays</code> <code>lat</code> and <code>lon</code> and the &#8216;value
Array&#8217; <code>temp</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>13</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/nlat=[0:9];/nlon=[10:19];/lat;/lon;/temp;/sal[][8:9]</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Similar to 3, except that <code>sal</code> uses a local dimension slice for its second dimension. This means
that it will not use the <code>nlon=[10:19]</code> slice that <code>temp</code> uses.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The examples 1-4 show how two or more arrays variables can be accessed along
with their <code>Maps</code> without sending multiple copies of the <code>Maps</code>.</p>
</div>
<div class="paragraph">
<p>The examples 5-6 support clients that read the
domain values first and then display a map (for example) providing a way
for someone to view the data’s geographical extent before accessing the
values them selves. Also note that there is no restriction that the same
shared dimension slices must be used for both requests; like DAP2, each
request in DAP4 is <em>stateless</em>.</p>
</div>
<div class="paragraph">
<p>For the examples 11 and 12, below are the Constrained DMR responses for each. In summary, it is the
requester’s (the client) responsibility to understand that the <code>Maps</code> are separate
variables and must be explicitly requested.</p>
</div>
<div class="paragraph">
<p>The Constrained DMR for constraint expression (CE) in example 11 is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">....
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_7</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlon</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only <code>temp</code> is returned, but the response contains information about its dimensions (which will appeared as
named only).</p>
</div>
<div class="paragraph">
<p>The Constrained DMR for the CE <code>/lat;/lon;/temp</code> in example 12 is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_7</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlon</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>
  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lon</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The only difference between example 11 and 12, is that in the response from example 12,
the maps <code>lat</code> and <code>lon</code> are included in the response.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Constrained DMR for the CE in example 13 is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_7</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- The effect of ''nlat=[0:9]'' --&gt;</span>
  <span class="tag">&lt;Dimension</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nlon</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- ... /nlon=[10:19] --&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>               <span class="comment">&lt;!-- We asked for lat and lon --&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>
  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lon</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>              <span class="comment">&lt;!-- ... and temp --&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

  <span class="tag">&lt;Float32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sal</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>              <span class="comment">&lt;!-- ... and sal, but... --&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/nlon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="attribute-value">2</span><span class="tag">/&gt;</span>                   <span class="comment">&lt;!-- for this dimension, we use a local dim slice --&gt;</span>
    <span class="tag">&lt;Map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/lat</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>               <span class="comment">&lt;!-- and thus only one of the two Maps is shown. --&gt;</span>
  <span class="tag">&lt;/Float32&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this last example, to avoid a conflict with the <code>nlon</code> slice and the fact that that is being applied
to <code>temp</code> and <code>lon</code>, applying a local dimension slice to an Array with Maps will cause the
associated Maps to be elided from the response’s Constrained DMR. For Arrays with no Maps, this has no effect.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_constrained_dmr_objects">1.8.7. Constrained DMR Objects</h4>
<div class="paragraph">
<p>When a DAP4 server receives a request for a Data response, it must build
and return a Data Response Document that contains a text/xml part
containing a DMR, a separator and a binary part that contains the data
values. The organization of the Data Response Document is described in
detail elsewhere in this document. In this section the focus is on the
DMR returned in the first part of the response and how it relates to the
DMR for the original unconstrained dataset. We refer to the original
dataset’s DMR as the <em>DMR</em> and the DMR associated with the data response
as the Constrained DMR, although a data response
can be generated using a null CE, we consider that a constraint, too.</p>
</div>
<div class="paragraph">
<p>The DMR contains a number of declarations for the dataset: Enumerations,
Dimensions, Attributes, Groups and Variables. Each DMR and Constrained DMR must
follow the rules for the DMR described in this specification and,
because DAP4 is a stateless protocol, each response from a server must
stand on its own. Since a Constraint Expression alters the data returned
(limiting variables, changing the size of dimensions and so on), it
stands to reason that the contents of the Constrained DMR will vary for any given
dataset based on the CE. Furthermore, a goal of DAP4 is to specify that
the Constrained DMR be &#8216;minimal&#8217; containing no unused definitions.</p>
</div>
<div class="paragraph">
<p>Because filters alter the values of variables, but not whether a
variable is returned, they have no affect on the Constrained DMR. Only the
subsetting operators will be discussed here.</p>
</div>
<div class="sect4">
<h5 id="_enumerations">Enumerations</h5>
<div class="paragraph">
<p>An enumeration is included in the Constrained DMR if and only if some variable or
attribute in the CE references it. A null CE returns the entire dataset,
so it effectively references every variable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_shared_dimensions">Shared Dimensions</h5>
<div class="paragraph">
<p>Shared Dimension declarations from the DMR are not included in the Constrained DMR
unless the Shared Dimension is used by a variable that has been
projected and that variable does not override that shared dimension
using a local slicing operation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_variables_2">Variables</h5>
<div class="paragraph">
<p>Each clause in the constraint must specify a variable and that variable
will be declared in the Constrained DMR. The variable must be referenced by a FQN.</p>
</div>
</div>
<div class="sect4">
<h5 id="_array_variables">Array Variables</h5>
<div class="paragraph">
<p>Array variables follow all the rules for <em>Variables</em> with the additional
conditions that their dimensions may appear altered depending on the CE.
If the local slicing operations are used, then the sliced dimensions
will have the size given be the slice operator, not the size as shown in
the full dataset’s DMR. If a shared dimension is sliced and the Array
uses that slice, then its size will reflect that. Arrays may mix shared
dimension slices and local slices and the result must be correctly
reflected in the specific variable’s declaration.</p>
</div>
<div class="paragraph">
<p>Note that slicing never affects the <em>rank</em> of an array.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_variables_2">Structure Variables</h5>
<div class="paragraph">
<p>If the variable is a Structure, then either the entire Structure is
included or a subset of its fields will be included in the variable
declaration where the fields are those specifically mentioned in a
constraint projection. As with all other variables, each variable in the
structure will have the same rank and type as the original declaration
in the DMR.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sequence_variables_2">Sequence Variables</h5>
<div class="paragraph">
<p>If the variable is a Sequence, then for declaration purposes, it is
treated like a Structure (as above). Note that applying a filter to a
Sequence will not change its declaration form because the number of
records in the sequence is not specified in the DMR. Note also that
mentioning a Sequence field in the filter does not necessarily mean it
will be included in the DMR. It will only be included if it is mentioned
in the projection part of the constraint clause.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups_2">Groups</h5>
<div class="paragraph">
<p>Each declaration in the Constrained DMR that corresponds to a declaration in the
DMR will cause its containing group (and that group’s parents) to be
included in the Constrained DMR. This ensures that the FQN for a declaration in the
Constrained DMR is the same as in the DMR.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes">Attributes</h5>
<div class="paragraph">
<p>Attributes are unaffected by the CE and are simply included in the Constrained DMR,
with the stipulation that attributes for variables that are not included
in the Constrained DMR won’t be part of the Constrained DMR. Essentially DAP4 views those
attributes as part of the variables and explicitly excluding the
variable from the Constrained DMR (by providing a CE that does not include it)
excludes its attributes too. Group level attributes will be included if
and only that group appears in the Constrained DMR.</p>
</div>
<div class="paragraph">
<p>There is one situation that bears mention, however. Many datasets
contain variables which include attributes that describe domain-specific
values for for the variables value(s). For example, imagine a
atmospheric profile that includes information about the minimum and
maximum temperatures of that profile. If the values are stored in an
array and the array is sliced so that only a subset of values are
returned, the attributes will provide correct values for the original
data <em>but possibly not the data returned in the response</em> because the
slicing operation has removed some of the values of the array. Because
DAP4 is a <em>domain neutral</em> protocol, it has no knowledge about how the
values of a specific attribute relate to the values of the variable and
cannot adjust the values of the attribute to match the CE.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filters">1.8.8. Filters</h4>
<div class="paragraph">
<p>While <em>subsetting</em> provides ways to choose data based on the dataset
structure and the types of the variables, <em>filters</em> provide a way to
choose data based on their values. The values to be returned are denoted
using one or more simple predicates. The general syntax for a filter
expression is to follow a subset (projection) expression with a pipe
(<strong>|</strong>) and one or more filter predicates. Multiple predicates are
separated by commas and the value of complete predicate is the logical
AND of the comma-separated subexpressions.</p>
</div>
<div class="paragraph">
<p>Filter expressions can only be applied to Sequence variables (or arrays
of them). In each case the result of the filter operation returns <em>the
same type</em> variable. A Sequence variable is essentially a table of
values and thus can be thought of as containing a number of rows and the
filter expression is applied to <em>each row</em> in the order those rows are
provided to the expression evaluator. Every row that satisfies the
predicate will be included in the value returned; those that don’t will
not be included in the result. Note that no new values are computed by
these operations; no interpolations, means, etc., are performed.</p>
</div>
<div class="paragraph">
<p>The behavior of filtering expressions on Sequences will be covered in
the following sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filters_and_more_complex_data_types">1.8.9. Filters and more complex data types</h4>
<div class="paragraph">
<p>The basic syntax for filters is that there is a subsetting expression, a
pipe (<strong>|</strong>) and then one or more filter predicates. This syntax can
appear any place a <em>selection expression</em> can appear, so it can be used
inside braces when an Array or Sequence is a field of a Structure or
Sequence. Note that the filter expression prefix operator binds to the
index subset immediately to its left at the same level (i.e. eliding
braces). Some examples follow.</p>
</div>
<div class="sect4">
<h5 id="_example_filters_on_complex_types">Example: Filters on complex types</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP4 DMR --&gt;</span>
<span class="tag">&lt;Dataset</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vol_1_ce_9</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Points1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Int32&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>

  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Points2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sounding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">depth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>

  <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Points3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sounding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">depth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Sequence&gt;</span>
    <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/Sequence&gt;</span>

  <span class="tag">&lt;Structure</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Points4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;Sequence</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">raw</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">depth</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;Int32</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">temps</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/Int32&gt;</span>
      <span class="tag">&lt;Dim</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/Sequence&gt;</span>
  <span class="tag">&lt;/Structure&gt;</span>

<span class="tag">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- DAP2 DDS (for reference only!) --&gt;</span>
Dataset {
    Sequence {
        Int32 x[100];
        Int32 y;
    } Points1;

    Sequence {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temp;
        } sounding;
    } Points2;

    Sequence {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temp;
        } sounding;
    } Points3[20];

    Structure {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temps[4];
        } raw;
    } Points4[100]

} complex_types_example;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 12. DAP4 Subsetting scenarios with Shared Dimensions</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 45%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression to add after</strong> <code>?dap4.ce=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interpretation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points1{x[0:9]}|y&lt;3</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>For the Sequence <code>Points1</code>, return the rows of data where <code>y</code> is less
than 3. In those rows, subset <code>x</code> so that only the first ten elements
are included. Note that <code>y</code> is mentioned in the filter, but not in the
selection so it will not appear in the resulting DMR.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points2{x; y; sounding | depth &gt; 20} | x &gt; 17</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>For the Sequence <code>sounding</code> the <code>filter</code> expression can use only <code>depth</code> and <code>temp</code> (and constants). When
filtering the values of a child sequence, the sequence name must be used
and thus the names of all of the fields of the parent sequence needed in
the result must be listed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>3</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points3[10:19]</code>{ x; y; sounding | depth &gt; 10 } | 20 &lt; x &lt; 40, y &lt;35`</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This selection expression first finds the index subset of <code>Points3</code> and
arranges to return the fields <code>x</code>, <code>y</code> and <code>sounding</code> where <code>x</code> and <code>y</code>
satisfy the predicates <code>20 &lt; x &lt; 40</code> and <code>y &lt;35</code>. And for the field
<code>sounding</code>, which is a <code>Sequence</code> itself, it will return both fields where
<code>depth &gt; 10</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/Points4[3:2:8]{x; y; raw\{temps[2] | temps &gt; 7,ND=-1}}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>temps</code> field of the Sequence <code>raw</code> is still an
<code>Array</code>, it’s just an Array with a single element. w</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Example 3 points out an important aspect to the syntax
and to expression evaluation: the order of evaluation of the filter
predicates happens after the index and variable and/or field subsetting.
The order of evaluation of the complete filter predicates can happen in
any order (i.e., the <code>20 &lt; x &lt; 40</code>, <code>y &lt;35</code> and <code>depth &gt; 10</code> predicates
can happen in any order. The order of evaluation of the filter predicate
subexpressions (i.e., <code>20 &lt; x &lt; 40</code> and <code>y &lt;35</code>) is also unspecified.</p>
</li>
<li>
<p>Example 4 illustrates that neither the subsetting nor filtering operations alter the types of the
variables.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_references">1.9. References</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="ref1"></a> Caron, J. "<em>Unidata’s Common Data Model Version 4</em>, 2012".
(<a href="https://docs.unidata.ucar.edu/netcdf-java/4.6/userguide/CDM/index.html" class="bare">https://docs.unidata.ucar.edu/netcdf-java/4.6/userguide/CDM/index.html</a>)</p>
</li>
<li>
<p><a id="ref2"></a> Folk, M., Pourmal, E. 2007. HDF5 Data Model, File Format and Library&#8201;&#8212;&#8201;HDF5 1.6. ESDS-RFC-007v1 Recommended Standard. January 2007. <a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-007v1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-007v1.pdf</a>.</p>
</li>
<li>
<p><a id="ref3"></a> Gallagher J., N. Potter, T. Sgouros, S. Hankin, and G. Flierl, <em>The
Data Access Protocol—DAP 2.0</em>, NASA Earth Science Data Systems
Recommended Standard ESE-RFC-004.1.2 (<a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESE-RFC-004v1.1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESE-RFC-004v1.1.pdf</a>).</p>
</li>
<li>
<p><a id="ref4"></a> Hartnett, E., <em>netCDF-4/HDF5 File Format</em>, NASA Earth Science Data
Systems Recommended Standard ESDS-RFC-022, 2011
(<a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-022v1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-022v1.pdf</a>).</p>
</li>
<li>
<p><a id="ref5"></a> The Internet Society, <em>IETF RFC 2119: Key words for use in RFCs to
Indicate Requirement Levels</em> , 1997
(<a href="http://tools.ietf.org/html/rfc2119" class="bare">http://tools.ietf.org/html/rfc2119</a>).</p>
</li>
<li>
<p><a id="ref6"></a> Gosling, J., B. Joy, G. Steele, G. Bracha, A Buckley, <em>The Java™
Language Specification — 7th Edition</em> Oracle Corporation, 2012,
(<a href="http://docs.oracle.com/javase/specs/jls/se7/html/" class="bare">http://docs.oracle.com/javase/specs/jls/se7/html/</a>).</p>
</li>
<li>
<p><a id="ref7"></a> IEEE, <em>IEEE Standard for Binary Floating-Point Arithmetic, ANSI/IEEE
Std 754-1985</em>, Digital Object Identifier: 10.1109/IEEESTD.1985.82928,
1985.]</p>
</li>
<li>
<p><a id="ref8"></a> The Internet Society, <em>IETF RFC 2396: Uniform Resource Identifiers
(URI): Generic Syntax</em> , 1998 (<a href="http://tools.ietf.org/html/rfc2396" class="bare">http://tools.ietf.org/html/rfc2396</a>).</p>
</li>
<li>
<p><a id="ref9"></a> The Internet Society, <em>IETF RFC 2616: Hypertext Transfer Protocol —
HTTP/1.1</em> , 1999 (<a href="http://tools.ietf.org/html/rfc2616" class="bare">http://tools.ietf.org/html/rfc2616</a>).</p>
</li>
<li>
<p><a id="ref10"></a> The Internet Society, <em>IETF RFC 4506: XDR: External Data
Representation Standard</em>, 2006 (<a href="http://tools.ietf.org/html/rfc4506" class="bare">http://tools.ietf.org/html/rfc4506</a>).</p>
</li>
<li>
<p><a id="ref11"></a> ISO/IEC, <em>Information technology — Portable Operating System Interface
(POSIX) — Part 2: Shell and Utilities</em>, ISO/IEC 9945-2,1993
(<a href="http://www.iso.org/iso/catalogue_detail.htm?csnumber=17841" class="bare">http://www.iso.org/iso/catalogue_detail.htm?csnumber=17841</a>).</p>
</li>
<li>
<p><a id="ref12"></a> The Open Geospatial Consortium Inc., <em>Abstract Specifications</em>,
(<a href="https://www.ogc.org/publications/standard/abstract-specification/" class="bare">https://www.ogc.org/publications/standard/abstract-specification/</a>).</p>
</li>
<li>
<p><a id="ref13"></a> The Organization for the Advancement of Structured Information
Standards, <em>RELAX NG Specification</em>, Committee Specification: 2001, J.
Clark, M. Makoto (eds.) (<a href="http://relaxng.org/spec-20011203.html" class="bare">http://relaxng.org/spec-20011203.html</a>).</p>
</li>
<li>
<p><a id="ref14"></a> The Unicode Consortium. <em>The Unicode Standard, Version 6.2.0</em>, ISBN
978-1-936213-07-8, 2012.</p>
</li>
<li>
<p><a id="ref15"></a> Unidata, <em>CF Metadata</em>, (<a href="https://cfconventions.org/" class="bare">https://cfconventions.org/</a>).</p>
</li>
<li>
<p><a id="ref16"></a> W3C, <em>Extensible Markup Language (XML) 1.0</em>, T. Bray, J. Paoli, C. M.
Sperberg-McQueen, E. Maler, F. Yergeau (eds.), Fifth Edition. 2008
(<a href="http://www.w3.org/TR/2008/REC-xml-20081126/" class="bare">http://www.w3.org/TR/2008/REC-xml-20081126/</a>).</p>
</li>
<li>
<p><a id="ref17"></a> World Meteorological Organization, <em>FM 92 GRIB</em>, edition 2, version 2,
2003 (<a href="https://old.wmo.int/extranet/pages/prog/www/DPS/FM92-GRIB2-11-2003.pdf" class="bare">https://old.wmo.int/extranet/pages/prog/www/DPS/FM92-GRIB2-11-2003.pdf</a>)</p>
</li>
<li>
<p><a id="ref18"></a> The Internet Society, <em>IETF RFC 4180: Uniform Resource Identifiers
(URI): Generic Syntax</em> , 2005  (<a href="https://datatracker.ietf.org/doc/html/rfc4180" class="bare">https://datatracker.ietf.org/doc/html/rfc4180</a>)</p>
</li>
<li>
<p><a id="ref19"></a> W3C DOM-3 glossary for the definition of XML document order (<a href="https://www.w3.org/TR/DOM-Level-3-Core/glossary.html" class="bare">https://www.w3.org/TR/DOM-Level-3-Core/glossary.html</a>).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_appendices">1.10. Appendices</h3>
<div class="sect3">
<h4 id="_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">1.10.1. Appendix 1. DAP4 DMR Syntax as a RELAX NG Schema</h4>
<div class="paragraph">
<p>This RELAX NG grammar is the definitive formal grammar for the DMR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="comment">&lt;!-- RELAX NG Grammar --&gt;</span>
<span class="comment">&lt;!-- Date: June 15, 2012 --&gt;</span>
<span class="comment">&lt;!-- Last Revised: November 23, 2012 --&gt;</span>

<span class="tag">&lt;grammar</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://relaxng.org/ns/structure/1.0</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns:a</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://relaxng.org/ns/compatibility/annotations/1.0</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">datatypeLibrary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/datatypes/dap4</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">ns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/ns/DAP/4.0#</span><span class="delimiter">&quot;</span></span>
         <span class="tag">&gt;</span>
<span class="tag">&lt;start&gt;</span>
  <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataset</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/start&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataset</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Dataset</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;a:documentation&gt;</span>
        Semantic restriction: dapVersion, dmrVersion are required.
    <span class="tag">&lt;/a:documentation&gt;</span>

    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dmrVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>

    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupbody</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupdef</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupbody</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupbody</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>

  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimdef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enumdef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupdef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>

<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enumdef</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enumeration</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basetype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;choice&gt;</span> <span class="comment">&lt;!-- Must be consistent with atomictype and variable --&gt;</span>
            <span class="tag">&lt;value&gt;</span>Byte<span class="tag">&lt;/value&gt;</span> <span class="comment">&lt;!-- equivalent to UInt8 --&gt;</span>
            <span class="tag">&lt;value&gt;</span>Int8<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>UInt8<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>Int16<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>UInt16<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>Int32<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>UInt32<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>Int64<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>UInt64<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/choice&gt;</span>
    <span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;oneOrMore&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enumconst</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/oneOrMore&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enumconst</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EnumConst</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namespace</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Namespace</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_uri</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;/element&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimdef</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Dimension</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;a:documentation&gt;</span>
      A Dimension is a binding of a name to a size; when two or more variables
      use the same 'name' it can be inferred that they 'share' that dimension.
      The 'size' attribute must be a positive integer.
    <span class="tag">&lt;/a:documentation&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">size</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_dim</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadatalist</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimref</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Dim</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;optional&gt;</span>
        <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_fqn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;/optional&gt;</span>
    <span class="tag">&lt;optional&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">size</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_dim</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;/optional&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="comment">&lt;!-- Atomictype define is only a way
     to list the set of atomictypes;
     it is never used in the grammar
--&gt;</span>
<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomictype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="comment">&lt;!-- This must be consistent with &quot;variable&quot; below --&gt;</span>
  <span class="tag">&lt;choice&gt;</span>
    <span class="tag">&lt;value&gt;</span>Char<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Byte<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Int8<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>UInt8<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Int16<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>UInt16<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Int32<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>UInt32<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Int64<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>UInt64<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Float32<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Float64<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>String<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>URL<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Opaque<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>Enum<span class="tag">&lt;/value&gt;</span>
  <span class="tag">&lt;/choice&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variable</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;choice&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplevariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">structurevariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sequencevariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/choice&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplevariable</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;choice&gt;</span>
    <span class="comment">&lt;!-- Following  must be consistent with &quot;atomictype&quot; --&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Char</span><span class="delimiter">&quot;</span></span>   <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Byte</span><span class="delimiter">&quot;</span></span>   <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Int8</span><span class="delimiter">&quot;</span></span>   <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UInt8</span><span class="delimiter">&quot;</span></span>  <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Int16</span><span class="delimiter">&quot;</span></span>  <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UInt16</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Int32</span><span class="delimiter">&quot;</span></span>  <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UInt32</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Int64</span><span class="delimiter">&quot;</span></span>  <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UInt64</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Float32</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Float64</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="comment">&lt;!-- Made 'string' capitalized. jhrg --&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="comment">&lt;!-- Added URL type. jhrg --&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">URL</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Opaque</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enum</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">enum</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_fqn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
      <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/element&gt;</span>
  <span class="tag">&lt;/choice&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variabledef</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;choice&gt;</span>
      <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/choice&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapref</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Map</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_fqn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">structurevariable</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Structure</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;zeroOrMore&gt;</span>
      <span class="tag">&lt;choice&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/choice&gt;</span>
    <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sequencevariable</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sequence</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;zeroOrMore&gt;</span>
      <span class="tag">&lt;choice&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dimref</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/choice&gt;</span>
    <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadatalist</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/zeroOrMore&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;choice&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">otherxml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/choice&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;choice&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicattribute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerattribute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/choice&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicattribute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Attribute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
      <span class="tag">&lt;a:documentation&gt;</span>
        Semantic constraint: type must be compatible
        with the set of attribute value types
      <span class="tag">&lt;/a:documentation&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;choice&gt;</span>
          <span class="tag">&lt;value&gt;</span>Char<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Byte<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Int8<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>UInt8<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Int16<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>UInt16<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Int32<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>UInt32<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Int64<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>UInt64<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Float32<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Float64<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>String<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>URL<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Enum<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Opaque<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/choice&gt;</span>
      <span class="tag">&lt;/attribute&gt;</span>
      <span class="tag">&lt;optional&gt;</span>
          <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/optional&gt;</span>
      <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;choice&gt;</span>
          <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Value</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;choice&gt;</span> <span class="comment">&lt;!-- technical ambiguity --&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_float</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_opaque</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_char</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_fqn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- for enum types --&gt;</span>
                <span class="tag">&lt;/choice&gt;</span>
              <span class="tag">&lt;/attribute&gt;</span>
         <span class="tag">&lt;/element&gt;</span>
     <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Value</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_text</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/element&gt;</span>
    <span class="tag">&lt;/choice&gt;</span>
      <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerattribute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Attribute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;zeroOrMore&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/zeroOrMore&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">otherxml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OtherXML</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">arbitraryxml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>

<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">arbitraryxml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;element&gt;</span>
      <span class="tag">&lt;anyName</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;zeroOrMore&gt;</span>
        <span class="tag">&lt;choice&gt;</span>
          <span class="tag">&lt;attribute&gt;</span>
            <span class="tag">&lt;anyName</span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/attribute&gt;</span>
          <span class="tag">&lt;text</span><span class="tag">/&gt;</span>
          <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">arbitraryxml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/choice&gt;</span>
      <span class="tag">&lt;/zeroOrMore&gt;</span>
    <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span>
<span class="tag">&lt;/grammar&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_appendix_2_dap4_relax_ng_lexical_elements">1.10.2. Appendix 2. DAP4 RELAX NG Lexical Elements</h4>
<div class="paragraph">
<p>Within the RELAXNG DAP4 grammar there are markers for occurrences of
primitive type such as integers, floats, or strings (ignoring case). The
markers typically look like this when defining an attribute that can
occur in the DAP4 DMR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Principal_Investigator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The &#8220;&lt;data type=`"dap4_string”/&gt;” specifies the lexical class for the
values that this attribute can have. In this case, the
"`Principal_Investigator&#8221; attribute is defined to have a DAP4 string
value. Similar notation is used for values occurring as text within an
xml element.</p>
</div>
<div class="paragraph">
<p>The lexical specification later in this section defines the legal
lexical structure for such items. Specifically, it defines the format of
the following lexical items.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Constants, namely: string, float, integer, character, and opaque.</p>
</li>
<li>
<p>Identifiers</p>
</li>
<li>
<p>Fully qualified names (also referred to as FQNs) (Section
<a href="#_fully_qualified_names">1.5.4</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The specification is written using the extended POSIX regular expression
notation [<a href="#ref11">11</a>] with some additions.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Names are assigned to regular expressions using the notation &#8220;name =
regular-expression&#8221;</p>
</li>
<li>
<p>Named expressions can be used in subsequent regular expressions by
using the notation &#8220;{name}&#8221;. Such occurrences are equivalent to
textually substituting the expression associated with name for the
&#8220;{name}&#8221; occurrence.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The definition of {UTF8} is deferred to the next section.</p>
</li>
<li>
<p>Comments are indicated using the &#8220;//&#8221; notation. Standard xml escape
formats (&amp;x#DDD; or &amp;{name};) are assumed to be used as needed.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_basic_character_set_definitions">Basic character set definitions</h5>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CONTROLS   = [\x00-\x1F] // ASCII control characters

WHITESPACE = [ \r\n\t\f]+

HEXCHAR    = [0-9a-zA-Z]

// ASCII printable characters

ASCII = [0-9a-zA-Z !"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\\]\\^_`|{}~]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ascii_characters_that_may_appear_unescaped_in_identifiers">Ascii characters that may appear unescaped in Identifiers</h5>
<div class="paragraph">
<p>This is assumed to be basically all ASCII printable characters except
these characters: &#8216;.&#8217;, &#8216;/&#8217;, &#8216;“&#8217;, ’’&#8216;, and&#8217;&amp;’. Occurrences of
these characters are assumed to be representable using the standard XML
&amp;{name}; notation (e.g. &amp;). In this expression, backslash is
interpreted as an escape character.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">IDASCII=[0-9a-zA-Z!#$%()*+:;&lt;=&gt;?@\[\]\\^_`|{}~]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_numeric_constant_classes_integer_and_float">The Numeric Constant Classes: integer and float</h5>
<div class="listingblock">
<div class="content">
<pre class="nowrap">INTEGER    = {INT}|{UINT}|{HEXINT}

INT        = [+-][0-9]+{INTTYPE}?

UINT       = [0-9]+{INTTYPE}?

HEXINT     = {HEXSTRING}{INTTYPE}?

INTTYPE    = ([BbSsLl]|"ll"|"LL")

HEXSTRING  = (0[xX]{HEXCHAR}+)

FLOAT      = ({MANTISSA}{EXPONENT}?)|{NANINF}

EXPONENT   = ([eE][+-]?[0-9]+)

MANTISSA   = [+-]?[0-9]*\.[0-9]*

NANINF     = (-?inf|nan|NaN)B.1.4 The String Constant Class

STRING     = ([^"&amp;&lt;&gt;]|{XMLESCAPE})*

CHAR       = ([^'&amp;&lt;&gt;]|{XMLESCAPE})

URL        = (http|https|[:][/][/][a-zA-Z0-9\-]+
             ([.][a-zA-Z\-]+)+([:][0-9]+)?
             ([/]([a-zA-Z0-9\-._,'\\+%)*
             ([?].+)?([#].+)?</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_stringurl_constant_class">The String/URL Constant Class</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">STRING = &quot;\({SIMPLESTRING}{ESCAPEDQUOTE}?\)*&quot;
SIMPLESTRING = [^&quot;\\]
ESCAPEDQOTE=\\&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_opaque_constant_class">The Opaque Constant Class</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">OPAQUE = 0x([0-9A-Fa-f] [0-9A-Fa-f])+</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a semantic constraint that if there is an odd number of hex
digits in the opaque constant, a zero hex digit will be added to the end
to ensure that the constant represents a set of 8-bit bytes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_identifier_class">The Identifier Class</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">ID         = {IDCHAR}+

IDCHAR     = ({IDASCII}|{XMLESCAPE}|{UTF8})

XMLESCAPE  = [<span class="error">&amp;</span>][#][0-9]+;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_atomic_type_class">The Atomic Type Class</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">ATOMICTYPE =   Char | Byte
             | Int8 | UInt8 | Int16 | UInt16
             | Int32 | UInt32 | Int64 | UInt64
             | Float32 | Float64
             | String | URL
             | Enum
             | Opaque ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This list should be consistent with the atomic types in the grammar.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_fully_qualified_name_class">The Fully Qualified Name Class</h5>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FQN      = ([/]{EID})+([.]{EID})*
EID      = {EIDCHAR}+
EIDCHAR  =  ({EIDASCII}|{XMLESCAPE}|{UTF8})
EIDASCII = [0-9a-zA-Z!#$%()*+:;&lt;=&gt;?@\[\]\\^_`|{}~]</pre>
</div>
</div>
<div class="paragraph">
<p>This should be consistent with the definition in Section
<a href="#_fully_qualified_names">[1.5.4</a>].</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_appendix_3_dap4_type_definitions">1.10.3. Appendix 3. DAP4 Type Definitions</h4>
<div class="paragraph">
<p>The RELAXNG [<a href="#ref13">13</a>] grammar references the following specific types. For
each type, the following table give the lexical format as defined by the
patterns previously given or by specific patterns as listed.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RELAXNG Data Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Lexical Pattern</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{INTEGER}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{FLOAT}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{CHAR}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{STRING}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_opaque</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{OPAQUE}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_fqn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{FQN}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{URL}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_dim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1-9][0-9]*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the above lexical element classes are not disjoint. The type
element &#8220;&lt;datatype=…/&gt;&#8221; should be sufficient to interpret the type
within the DMR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_appendix_4_utf_8">1.10.4. Appendix 4. UTF-8</h4>
<div class="paragraph">
<p>The UTF-8 specification [<a href="#ref14">14</a>] defines several ways to validate a UTF-8
string of characters.</p>
</div>
<div class="paragraph">
<p>The full (most correct) validating version of UTF8 character set is as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">UTF8 =   ([\xC2-\xDF][\x80-\xBF])
       | (\xE0[\xA0-\xBF][\x80-\xBF])
       | ([\xE1-\xEC][\x80-\xBF][\x80-\xBF])
       | (\xED[\x80-\x9F][\x80-\xBF])
       | ([\xEE-\xEF][\x80-\xBF][\x80-\xBF])
       | (\xF0[\x90-\xBF][\x80-\xBF][\x80-\xBF])
       | ([\xF1-\xF3][\x80-\xBF][\x80-\xBF][\x80-\xBF])
       | (\xF4[\x80-\x8F][\x80-\xBF][\x80-\xBF])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lines of the above expression cover the UTF-8 characters as follows:
1. non-overlong 2-byte 2. excluding overlongs 3. straight 3-byte 4.
excluding surrogates 5. straight 3-byte 6. planes 1-3 7. planes 4-15 8.
plane 16</p>
</div>
<div class="paragraph">
<p>Note that values from 0 through 127 (ASCII and control characters) are
not included in any of these definitions.</p>
</div>
<div class="paragraph">
<p>The above reference also defines some alternative regular expressions.
First, there is what is termed the partially relaxed version of UTF8
defined by this regular expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">UTF8 =    ([\xC0-\xD6][\x80-\xBF])
        | ([\xE0-\xEF][\x80-\xBF][\x80-\xBF])
        | ([\xF0-\xF7][\x80-\xBF][\x80-\xBF][\x80-\xBF])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second, there is what is termed the most-relaxed version of UTF8 defined
by this regular expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">UTF8 = ([\xC0-\xD6]...)|([\xE0-\xEF)...)|([\xF0 \xF7]...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any conforming DAP4 implementation MUST use at least the most-relaxed
expression for validating UTF-8 character strings, but MAY use either
the partially-relaxed or the full validation expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="_appendix_5_lalr1_grammar_for_dmr_using_bison_notation">1.10.5. Appendix 5. LALR(1) Grammar for DMR using Bison Notation</h4>
<div class="paragraph">
<p>It is conventient to have a Bison grammar that corresponds to the above
RELAX NG grammar. If there is a conflict, then the RELAX NG grammar is
considered correct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">%start dataset
%%
dataset:
    DATASET_
    xml_attribute_list
    groupbody
    _DATASET
    ;

group:
    GROUP_
    ATTR_NAME
    groupbody
    _GROUP
    ;

groupbody:
      %empty
    | groupbody dimdef
    | groupbody enumdef
    | groupbody variable
    | groupbody metadata
    | groupbody group
    ;

enumdef:
    ENUMERATION_
    xml_attribute_list
    enumconst_list
    _ENUMERATION
    ;

enumconst_list:
      enumconst
    | enumconst_list enumconst
    ;

enumconst:
      ENUMCONST_ ATTR_NAME ATTR_VALUE _ENUMCONST
    | ENUMCONST_ ATTR_VALUE ATTR_NAME _ENUMCONST
    ;

dimdef:
    DIMENSION_
    xml_attribute_list
    metadatalist
    _DIMENSION
    ;

dimref:
      DIM_ ATTR_NAME _DIM
    | DIM_ ATTR_SIZE _DIM
    ;

variable:
      atomicvariable
    | enumvariable
    | structurevariable
    | sequencevariable
    ;

atomicvariable:
    atomictype_
    ATTR_NAME
    varbody
    _atomictype
    ;

enumvariable:
    ENUM_
    xml_attribute_list
    varbody
    _ENUM
    ;

atomictype_:
      CHAR
    | BYTE
    | INT8
    | UINT8
    | INT16
    | UINT16
    | INT32
    | UINT32
    | INT64
    | UINT64
    | FLOAT32
    | FLOAT64
    | STRING
    | URL
    | OPAQUE
    ;

_atomictype:
      _CHA
    | _BYT
    | _INT
    | _UINT
    | _INT1
    | _UINT1
    | _INT3
    | _UINT3
    | _INT6
    | _UINT6
    | _FLOAT3
    | _FLOAT6
    | _STRIN
    | _UR
    | _OPAQU
    | _ENUM
    ;

varbody:
      %empty
    | varbody dimref
    | varbody mapref
    | varbody metadata
    ;

mapref:
    MAP_
    ATTR_NAME
    metadatalist
    _MAP
    ;

structurevariable:
    STRUCTURE_
    ATTR_NAME
    structbody
    _STRUCTURE
    ;

structbody:
      %empty
    | structbody variable
    | structbody dimref
    | structbody mapref
    | structbody metadata
    ;

sequencevariable:
    SEQUENCE_
    ATTR_NAME
    sequencebody
    _SEQUENCE
    ;

sequencebody:
      %empty
    | sequencebody dimref
    | sequencebody variable
    | sequencebody mapref
    | sequencebody metadata
    ;

metadatalist:
      %empty
    | metadatalist metadata
    ;

metadata:
      attribute
    ;

attribute:
      atomicattribute
    | containerattribute
    | otherxml
    ;


atomicattribute:
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      valuelist
      _ATTRIBUTE
    |
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      _ATTRIBUTE
    ;

namespace_list:
      %empty
    | namespace_list namespace
    ;

namespace:
    NAMESPACE_
    ATTR_HREF
    _NAMESPACE
    ;

containerattribute:
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      attributelist
      _ATTRIBUTE
    ;

attributelist:
      attribute
    | attributelist attribute
    ;

valuelist:
      value
    | valuelist value
    ;

value:
      VALUE_ TEXT _VALUE
    | VALUE_ ATTR_VALUE _VALUE
    ;

otherxml:
    OTHERXML_
    xml_attribute_list
    xml_body
    _OTHERXML
    ;

xml_body:
      element_or_text
    | xml_body element_or_text
    ;

element_or_text:
      xml_open
      xml_attribute_list
      xml_body
      xml_close
    | TEXT
    ;

xml_attribute_list:
      %empty
    | xml_attribute_list xml_attribute
    ;

xml_attribute:
      ATTR_BASE
    | ATTR_BASETYPE
    | ATTR_DAPVERSION
    | ATTR_DMRVERSION
    | ATTR_ENUM
    | ATTR_HREF
    | ATTR_NAME
    | ATTR_NAMESPACE
    | ATTR_NS
    | ATTR_SIZE
    | ATTR_TYPE
    | ATTR_VALUE
    ;

xml_open:
      DATASET_
    | GROUP_
    | ENUMERATION_
    | ENUMCONST_
    | NAMESPACE_
    | DIMENSION_
    | DIM_
    | ENUM_
    | MAP_
    | STRUCTURE_
    | SEQUENCE_
    | VALUE_
    | ATTRIBUTE_
    | OTHERXML_
    | CHAR_
    | BYTE_
    | INT8_
    | UINT8_
    | INT16_
    | UINT16_
    | INT32_
    | UINT32_
    | INT64_
    | UINT64_
    | FLOAT32_
    | FLOAT64_
    | STRING_
    | URL_
    | OPAQUE_
    ;

xml_close:
      _DATASET
    | _GROUP
    | _ENUMERATION
    | _ENUMCONST
    | _NAMESPACE
    | _DIMENSION
    | _DIM
    | _ENUM
    | _MAP
    | _STRUCTURE
    | _SEQUENCE
    | _VALUE
    | _ATTRIBUTE
    | _OTHERXML
    | _CHAR
    | _BYTE
    | _INT8
    | _UINT8
    | _INT16
    | _UINT16
    | _INT32
    | _UINT32
    | _INT64
    | _UINT64
    | _FLOAT32
    | _FLOAT64
    | _STRING
    | _URL
    | _OPAQUE
    ;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_lexical_tokens_for_bison_grammar">Lexical Tokens for Bison Grammar</h5>
<div class="paragraph">
<p>The above Bison grammar assumes a corresponding lexer that will return a
set of token types (listed below). The token with a trailing underscore
represents an opening XML element and a token with a leading underscore
represents a closing XML element. So, for example, token <em>DATASET<em> is
_&lt;Dataset&gt;</em> and token </em>DATASET_ is <em>&lt;/Dataset&gt;</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">/* XML Element Names */
%token DATASET_ _DATASET
%token GROUP_ _GROUP
%token ENUMERATION_ _ENUMERATION
%token ENUMCONST_ _ENUMCONST
%token NAMESPACE_ _NAMESPACE
%token DIMENSION_ _DIMENSION
%token DIM_ _DIM
%token MAP_ _MAP
%token STRUCTURE_ _STRUCTURE
%token SEQUENCE_ _SEQUENCE
%token VALUE_ _VALUE
%token ATTRIBUTE_ _ATTRIBUTE
%token OTHERXML_ _OTHERXML
%token ERROR_ _ERROR
%token MESSAGE_ _MESSAGE
%token CONTEXT_ _CONTEXT
%token OTHERINFO_ _OTHERINFO

/* XML Element Names for Atomic Types*/
%token CHAR_ _CHAR
%token BYTE_ _BYTE
%token INT8_ _INT8
%token UINT8_ _UINT8
%token INT16_ _INT16
%token UINT16_ _UINT16
%token INT32_ _INT32
%token UINT32_ _UINT32
%token INT64_ _INT64
%token UINT64_ _UINT64
%token FLOAT32_ _FLOAT32
%token FLOAT64_ _FLOAT64
%token STRING_ _STRING
%token URL_ _URL
%token OPAQUE_ _OPAQUE
%token ENUM_ _ENUM

/* XML Attribute Names */
%token ATTR_BASE ATTR_BASETYPE ATTR_DAPVERSION ATTR_DMRVERSION
%token ATTR_ENUM ATTR_HREF ATTR_NAME ATTR_NAMESPACE
%token ATTR_NS ATTR_SIZE ATTR_TYPE ATTR_VALUE
%token ATTR_HTTPCODE

/* Arbitrary XML Text */
%token TEXT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_appendix_6_lalr1_grammar_for_constraints_using_bison_notation">1.10.6. Appendix 6. LALR(1) Grammar for Constraints using Bison Notation</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml">%start constraint
%%
constraint:
    dimredeflist
    clauselist
    ;

dimredeflist:
          %empty
        | dimredeflist ';' dimredef
        ;

clauselist:
          clause
        | clauselist ';' clause
        ;

clause:
          projection
    | selection
        ;

projection:
    segmenttree
        ;

segmenttree:
          segment
        | segmenttree '.' segment
        | segmenttree '.' '{' segmentforest '}'
        | segmenttree '{' segmentforest '}'
        ;

segmentforest:
      segmenttree
    | segmentforest ',' segmenttree
    ;

segment:
          NAME
        | NAME slicelist
        ;

slicelist:
          slice
        | slicelist slice
        ;

slice:
          '[' ']'
        | '[' subsetlist ']'
    ;

subsetlist:
      subset
    | subsetlist ',' subset
    ;

subset:
           index
        |  index ':' index
        |  index ':' index ':' index
        |  index ':'
        |  index ':' index ':'
        ;

index:  INTEGER ;

selection:
        segmenttree '|' filter
        ;

filter:
          predicate
        | predicate ',' predicate  /* ',' == AND */
        | '!' predicate %prec NOT
        ;

predicate:
          primary relop primary
        | primary relop primary relop primary
        | primary eqop primary
        ;

relop:
      '<span class="entity">&amp;lt;</span>' '='
    | '<span class="entity">&amp;gt;</span>' '='
    | '<span class="entity">&amp;lt;</span>'
    | '^gt;'
    ;

eqop:
      '=' '='
    | '!' '='
    | '~' '='
    ;

primary:
          fieldname
        | constant
        | '(' predicate ')'
    ;

dimredef: NAME '=' slice ;

fieldname: NAME

constant: STRING | INTEGER | DOUBLE | BOOLEAN ;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_lexical_tokens_for_bison_grammar_for_constraints">Lexical Tokens for Bison Grammar for Constraints</h5>
<div class="paragraph">
<p>The primary lexical tokens for constraints are: NAME, STRING, INTEGER,
DOUBLE, BOOLEAN.</p>
</div>
<div class="paragraph">
<p>These lexemes are intended to match the patterns defined for the RELAX
NG grammar.</p>
</div>
<div class="paragraph">
<p>Retrieved from
<a href="https://docs.opendap.org/index.php?title=DAP4:_Specification_Volume_1&amp;oldid=13089" class="bare">https://docs.opendap.org/index.php?title=DAP4:_Specification_Volume_1&amp;oldid=13089</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.opendap.org/index.php?title=Special:Categories">Categories</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.opendap.org/index.php?title=Category:Development">Development</a></p>
</li>
<li>
<p><a href="https://docs.opendap.org/index.php?title=Category:DAP4">DAP4</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Web_Services">2. Web Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>Abstract</em></strong></p>
</div>
<div class="paragraph">
<p><em>While Volume 1 of the DAP4 specification addresses the detailed
semantics and structure of the DAP4 data and metadata content, this
volume (Volume 2) details the manner in which clients can request things
from a DAP4 server and what things the clients can expect to receive
from a DAP4 server in response to their requests. The description of
this interaction focuses on DAP4 clients and servers that are
communicating via HTTP, and while this is perceived by the authors as
the most common transport for DAP4 client/server interaction the
specification is written in a broad enough manner to allow for other
transport mechanisms.</em></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 13. <strong>Contributors</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>First Draft</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">November 6, 2013</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Last Revised:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">04 July 2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Authors</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John Caron (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethan Davis (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David Fulker (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">James Gallagher (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dennis Heimbigner (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nathan Potter (OPeNDAP)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 14. <strong>Timeline of changes.</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.09.06</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Draft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014.07.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASCII/.ascii changed to text/.txt; Removed most of the async text since it is duplicate of the material in the extension; Created a volume 3 containing the extensions</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_introduction_2">2.1. Introduction</h3>
<div class="paragraph">
<p>This document defines the DAP4 Web Service protocol which DAP4-compliant
software MUST support when utilizing the HTTP protocol to transmit DAP4
requests and responses, along with additional optional services that
DAP4-compliant software SHOULD support.</p>
</div>
<div class="paragraph">
<p>The DAP4 protocol uses three basic responses to represent a data
resource. One response, the Dataset Metadata Response (DMR) contains
metadata information describing the structure of the data resource. That
is, it characterizes the variables, their datatypes, names and
attributes. The second response, the Data Response (DataDMR), contains
both the metadata about the requested data and the actual data that was
requested. The third basic response is the Dataset Services Response
(DSR) that provides a listing of services, any alternate media
representations if available, and all of the associated access URI’s for
a particular data resource.</p>
</div>
<div class="paragraph">
<p>The DAP4 protocol uses a fourth basic resource, the Constraint/Query
Expression (CE), to represent subsetting of and, possibly,
transformations of the dataset requested.</p>
</div>
<div class="paragraph">
<p>The DAP4 protocol uses a fifth basic resource, the Error Response (ER),
to allow servers to communicate error information with clients. When a
request for any of the three basic responses cannot be completed, an
Error response is returned. If an error occurs before the standard
response is initiated, an error response is returned in place of the
standard response. If an error occurs after a data response has been
initiated, an Error Response is returned as the final chunked record as
described in Section 7 &#8220;DAP4 Chunked Data Representation&#8221; of the DAP4
Data Model document (see [<a href="#_dap4_chunked_data_representation">1.7</a>]).</p>
</div>
<div class="paragraph">
<p>The DAP4 Data Model, constraint/query language, dataset metadata XML
encoding, and binary data encoding are all defined in the Volume 1:
[<a href="#Data_Model">Data Model, Persistent Representations, and Constraints
</a>] document.</p>
</div>
<div class="paragraph">
<p>Each of the three responses (Dataset Metadata, Data, and Dataset
Services) are complete in and of themselves so that, for example, the
Data response can be used by a client without ever requesting either of
the two other responses. In many cases, client programs will request the
Dataset Metadata response before requesting the Data response but there
is no requirement they do so and servers SHALL NOT require that behavior
on the part of clients.</p>
</div>
<div class="paragraph">
<p>These three standard dataset responses can each be accessed in two
different ways. First, similar to DAP2 URL construction and to support
client-driven content negotiation (see the section titled
<a href="#_content_negotiation_and_media_types">HTTP
- Content Negotiation and Media Types</a> below), each dataset resource
has a standard URL suffix that can be added to the DAP4 dataset URL to
retrieve the resource in its standard (normative) encoding. This allows
clients, given a base DAP4 dataset URL, to construct DAP4 URLs in a
simple and standard way for each of the three standard dataset
resources.</p>
</div>
<div class="paragraph">
<p>Second, to support server-driven content negotiation (see the section titled
<a href="#_content_negotiation_and_media_types">HTTP
- Content Negotiation and Media Types</a> below) and
hypermedia-driven style, a DAP4 resource role is defined for each
standard dataset resource and a DAP4 media type is defined for each
dataset resource encoding scheme.</p>
</div>
<div class="paragraph">
<p>Any particular instance of a DAP4 server MAY have one or more additional
services, alternate media representations of service responses, or
unique (to the server instance) server side functions. All of these
things, including the core services and their default representations
MUST be included in the <em>Dataset Services
Response</em> [<a href="#_dap4_dataset_services_response">2.3.1</a>].</p>
</div>
<div class="paragraph">
<p>The DAP4 web service is currently limited to HTTP GET requests though it
is expected that extensions (e.g., asynchronous access) will use other
HTTP methods (e.g., POST). This makes, for now, the DAP4 Constraint
Expression something of a pseudo-resource type given that they are
encoded as part of the URL query string rather than as an independent
document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_terms_and_definitions">2.2. Terms and Definitions</h3>
<div class="paragraph">
<p><strong>Dataset Service Response (DSR)</strong><br>
The DAP4 response type that contains a list of DAP (and other) services
available for the dataset including any alternate media representations
and all the associated access URIs.</p>
</div>
<div class="paragraph">
<p><strong>Dataset Metadata Response (DMR)</strong><br>
The DAP4 response type that contains metadata information describing the
structure of the requested data. The metadata information characterizes
the requested data variables including their names, data types, shapes,
and attributes.</p>
</div>
<div class="paragraph">
<p><strong>Dataset Data Response (Data)</strong><br>
The DAP4 response type that contains both the dataset metadata and the
binary data for the requested data.</p>
</div>
<div class="paragraph">
<p><strong>Resource role ID</strong><br>
A URI that identifies the role of a resource, generally provided with a
link to allow clients to identify the type of resource the link
references. (For instance, an &#8220;atom:link&#8221; element has an optional
&#8220;atom:rel&#8221; attribute.)</p>
</div>
<div class="paragraph">
<p><strong>Media Type</strong><br>
A internet media type is a two-part identifier for resource encoding
schemes, e.g. <code>text/html</code>, <code>text/plain</code>,
&#8220;application/octet-stream&#8221;. (See <a href="#_dap4_resource_roles_and_media_types">section
2.2.1 DAP4 Resource Roles and Media Types</a> of this document)</p>
</div>
<div class="paragraph">
<p><strong>DAP4 Constraint Expression (CE)</strong><br>
The constraint expression that encapsulates various sub-setting of, and
possibly the application of server side functions to variables in a DAP4
dataset.</p>
</div>
<div class="paragraph">
<p><strong>Query String (QS)</strong><br>
Everything after the <code>?</code> character in a URL.</p>
</div>
<div class="sect3">
<h4 id="_dap4_resource_roles_and_media_types">2.2.1. DAP4 Resource Roles and Media Types</h4>
<div class="paragraph">
<p>The standard DAP4 dataset resource roles and encodings (plus a few
alternate encodings) that are defined in the core DAP4 documents are:</p>
</div>
<div class="paragraph">
<p><strong>Dataset Services Response (DSR)</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Role</strong>:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://services.opendap.org/dap4/dataset-service" class="bare">http://services.opendap.org/dap4/dataset-service</a></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Media Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none or <code>.dsr</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>application/vnd.opendap.dap4.dataset-services+xml</p>
</div>
<div class="paragraph">
<p>Normative DSR encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc" class="bare">http://server/path/dataset.nc</a></code><br>
<code><a href="http://server/path/dataset.nc.dsr" class="bare">http://server/path/dataset.nc.dsr</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.xml</code> or <code>.dsr.xml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/xml</p>
</div>
<div class="paragraph">
<p>Normative DSR encoding with generic media type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.xml" class="bare">http://server/path/dataset.nc.xml</a></code>
<code><a href="http://server/path/dataset.nc.dsr.xml" class="bare">http://server/path/dataset.nc.dsr.xml</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.html</code> or <code>.dsr.html</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/html</p>
</div>
<div class="paragraph">
<p>HTML DSR encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.html" class="bare">http://server/path/dataset.nc.html</a></code>
<code><a href="http://server/path/dataset.nc.dsr.html" class="bare">http://server/path/dataset.nc.dsr.html</a></code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Dataset Metadata Response (DMR)</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Role</strong>:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://services.opendap.org/dap4/dataset-metadata" class="bare">http://services.opendap.org/dap4/dataset-metadata</a></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Media Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dmr</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>application/vnd.opendap.dap4.dataset-metadata+xml</p>
</div>
<div class="paragraph">
<p>Normative DMR encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dmr" class="bare">http://server/path/dataset.nc.dmr</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dmr.xml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/xml</p>
</div>
<div class="paragraph">
<p>Normative DMR encoding with generic media type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dmr.xml" class="bare">http://server/path/dataset.nc.dmr.xml</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dmr.html</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/html</p>
</div>
<div class="paragraph">
<p>HTML DMR encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dmr.html" class="bare">http://server/path/dataset.nc.dmr.html</a></code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Dataset Data Response (Data)</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Role</strong>:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://services.opendap.org/dap4/data" class="bare">http://services.opendap.org/dap4/data</a></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Media Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dap</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>application/vnd.opendap.dap4.data</p>
</div>
<div class="paragraph">
<p>Normative Data encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dap" class="bare">http://server/path/dataset.nc.dap</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dap.txt</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/plain</p>
</div>
<div class="paragraph">
<p>Text (UTF-8) Data encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dap.txt" class="bare">http://server/path/dataset.nc.dap.txt</a></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dap.xml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/xml</p>
</div>
<div class="paragraph">
<p>XML Data encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dap.xml" class="bare">http://server/path/dataset.nc.dap.xml</a></code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Error Response (ER)</strong></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Role</strong>:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://services.opendap.org/dap4/error" class="bare">http://services.opendap.org/dap4/error</a></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Media Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>application/vnd.opendap.dap4.error+xml</p>
</div>
<div class="paragraph">
<p>Normative Error encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/xml</p>
</div>
<div class="paragraph">
<p>Normative Error encoding with generic media type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/html</p>
</div>
<div class="paragraph">
<p>HTML Error encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>N/A</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_dap4_core_specification_documents">2.2.2. DAP4 Core Specification Documents</h4>
<div class="ulist">
<ul>
<li>
<p>DAP4 Volume 1: &#8220;Data Model, Persistence Representations, and
Constraints&#8221;</p>
</li>
<li>
<p>DAP4 Volume 2: Web Services</p>
</li>
<li>
<p>DAP4 Dataset Services</p>
</li>
<li>
<p>DAP4 Requirements for Server-side Functions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_extensions_to_dap4_core_specifications">2.2.3. Extensions to DAP4 Core Specifications</h4>
<div class="paragraph">
<p>Several types of extensions can be made to the DAP4 core including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New encodings for the core DAP4 response types</p>
</li>
<li>
<p>New response types</p>
</li>
<li>
<p>New server-side functions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dap4_web_service_responses">2.3. DAP4 Web Service Responses</h3>
<div class="paragraph">
<p>The core of the DAP4 Web Service protocol consists of the four standard
response types: Dataset Services Response (DSR), Dataset Metadata
Response (DMR), Dataset Data Response (Data), DAP4 Error Response
(Error) Each dataset served by a DAP4 compliant server MUST provide the
DSR, DMR, and Data responses and MUST return errors documents as DAP4
Error Responses.</p>
</div>
<div class="paragraph">
<p>All of the example requests described below are based on the DAP4
dataset URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://server.org:8080/dap/path/data.nc</pre>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_dataset_services_response">2.3.1. DAP4 Dataset Services Response</h4>
<div class="paragraph">
<p>The DAP4 Dataset Services Response
(DSR) provides clients with a listing of all available DAP4 services and all
the available encodings for those services as well as all available DAP4
extensions.</p>
</div>
<div class="paragraph">
<p>Each service (or response type) has a unique resource role (defined in
the appropriate specification), each link (alternate representation) for
a given service MUST fulfill that same role. This is not always a clear
distinction to make. For example, the DAP4 Dataset Metadata Response can
be mapped into ISO 19115 metadata. However, IS0 19115 is clearly a
different domain.</p>
</div>
<div class="paragraph">
<p>The DAP4 Dataset Services Response MUST contain the following
information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List of DAP versions supported by server</p>
</li>
<li>
<p>The implementation version (e.g., &#8220;TDS 4.3.57&#8221; or &#8220;Hyrax 1.7.45&#8221;)</p>
</li>
<li>
<p>List of all available DAP4 services for the dataset</p>
</li>
<li>
<p>For each DAP4 services listed, a list of all available links each with
its corresponding media type</p>
</li>
<li>
<p>List of supported extensions</p>
<div class="ulist">
<ul>
<li>
<p>Resource type extensions</p>
</li>
<li>
<p>Media type extensions</p>
</li>
<li>
<p>Server-side function extensions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If SHOULD contain the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A human readable title for the dataset</p>
</li>
<li>
<p>A human readable title for each service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To take advantage of web caching, servers should try to keep DSRs light
weight (i.e., quick creation) and as stable as possible.</p>
</div>
<div class="sect4">
<h5 id="_dsr_resource_role">DSR Resource Role</h5>
<div class="paragraph">
<p>DSRs are identified by the resource role:</p>
</div>
<div class="paragraph">
<p><strong><code><a href="http://services.opendap.org/dap4/dataset-services" class="bare">http://services.opendap.org/dap4/dataset-services</a></code></strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_normative_encoding_of_the_dsr">Normative Encoding of the DSR</h5>
<div class="paragraph">
<p>The normative XML representation for the Dataset Services Response is
defined in the &#8220;Normative XML Encoding of the DSR&#8221; appendix. The media
type for the normative XML representation is</p>
</div>
<div class="paragraph">
<p><code>application/vnd.opendap.dataset-services+xml</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_service_behavior">Service Behavior</h5>
<div class="paragraph">
<p>When an HTTP GET request is made on a base DAP4 dataset URL, all DAP4
servers MUST return the normative XML encoding of the DSR given these
conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the request &#8220;Accept&#8221; header contains only the normative XML encoding
media type,</p>
</li>
<li>
<p>the request &#8220;Accept&#8221; header equals <code>*/*</code>, or</p>
</li>
<li>
<p>the request &#8220;Accept&#8221; header does not indicate a preference for
another media type in which the server knows how to encode the DSR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: application/vnd.opendap.dataset-services+xml
Date: ...</pre>
</div>
</div>
<div class="sect5">
<h6 id="_downgrading_the_normative_xml_encoding_required">Downgrading the Normative XML Encoding (Required)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a base DAP dataset URL with the suffix <code>.xml</code> added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.xml</code></p>
</div>
<div class="paragraph">
<p>the response MUST be the normative representation of the DSR along with
the HTTP <code>Content-Type</code> header set to <code>text/xml</code> . For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.xml HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>The normative XML representation MUST also be returned when an HTTP GET
request is made on a base DAP4 dataset URL (without a suffix) and the
server uses server-driven content negotiation to decide that the best
response for the client would be an HTML encoded DSR. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc HTTP/1.1
Host: server.org:8080
Accept: text/xml</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_encodings_of_the_dsr">Other Encodings of the DSR</h5>
<div class="sect5">
<h6 id="_html_encoding_optional">HTML Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a base DAP dataset URL with the suffix <code>.html</code> added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.html</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with an HTML representation of the DSR, <strong>or</strong>
return an HTTP status of 404 to indicate that an HTML representation of
the DSR is not available. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.html HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the HTML representation MUST also be returned when an HTTP
GET request is made on a base DAP4 dataset URL (without a suffix) and
the server uses server-driven content negotiation to decide that the
best response for the client would be an HTML encoded DSR. For example
this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc HTTP/1.1
Host: server.org:8080
Accept: text/html</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the HTML representation of the DMR, if available. If no such
representation is available then the server MAY return an HTTP status of
404 or even 415.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dataset_metadata_response_dmr">2.3.2. Dataset Metadata Response (DMR)</h4>
<div class="paragraph">
<p>The Dataset Metadata Service returns the Dataset Metadata Response (DMR)
which is a metadata description of the dataset. The normative
representation of the DMR is an XML document that contains both the
&#8216;syntactic&#8217; (structural) and &#8216;semantic&#8217; metadata for the dataset,
persisted as a DAP4 data model representation of the dataset held at the
server (see section <a href="#Data_Model">1</a>).</p>
</div>
<div class="paragraph">
<p>The DMR service accepts a query string (constraint expression) that
allows you to inspect the effects on the data structures when
sub-setting and/or server side functions are applied. If a constraint
expression has been successfully applied, the service will returned the
constrained view of the dap:Dataset object. The constrained view may
contain different data structures than the unconstrained view as the
constraint may alter the reasonable representation of the data set. Note
that all dap:Attribute objects have been removed from constrained
dap:Dataset objects. More information on the syntax of DAP4 constraint
expressions can be found in Volume 1 of the DAP4 specification (see section <a href="#Data_Model">1</a>).</p>
</div>
<div class="sect4">
<h5 id="_dmr_resource_role">DMR Resource Role</h5>
<div class="paragraph">
<p>DMRs are identified by the resource role:</p>
</div>
<div class="paragraph">
<p><strong><code><a href="http://services.opendap.org/dap4/dataset-metadata" class="bare">http://services.opendap.org/dap4/dataset-metadata</a></code></strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_normative_encoding_of_the_dmr">Normative Encoding of the DMR</h5>
<div class="paragraph">
<p>The normative XML representation for the Dataset Metadata Response is
defined in Volume 1 of the DAP4
specification (see section <a href="#Data_Model">1</a>).
The media type for the normative XML representation is:</p>
</div>
<div class="paragraph">
<p><code>application/vnd.opendap.dap4.dataset-metadata+xml</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_service_behavior_2">Service Behavior</h5>
<div class="paragraph">
<p>Every DAP4 compliant server MUST return the normative representation of
the Dataset Metadata Response (an XML document described (see section <a href="#Data_Model">Volume 1</a>) of the
DAP4 specification when a client attempts to access a dataset URL with the suffix
<code>.dmr</code> appended to it. The DAP4 server MAY return alternate
representations if the client indicates that it can accept them and the
server can provide them.</p>
</div>
<div class="paragraph">
<p>When an HTTP GET request is made on a base DAP dataset URL with the
suffix <code>.dmr</code> added to it:</p>
</div>
<div class="paragraph">
<p><strong>request url</strong> = <code>dataset_url + '.dmr' [?dap_constraint]</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with an normative representation of the DMR for
the (possibly constrained) dataset given these conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the request <code>Accept</code> header contains only the normative XML encoding
media type (<code>application/vnd.opendap.dap4.dataset-metadata+xml</code>),</p>
</li>
<li>
<p>the request <code>Accept</code> header equals <code>*/*</code>, or</p>
</li>
<li>
<p>the request <code>Accept</code> header does not indicate a preference for
another media type in which the server knows how to encode the DMR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dmr HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: application/vnd.opendap.dataset-metadata+xml
Date: ...</pre>
</div>
</div>
<div class="sect5">
<h6 id="_downgrading_the_normative_xml_encoding_required_2">Downgrading the Normative XML Encoding (Required)</h6>
<div class="paragraph">
<p>While the normative representation of the the Dataset Metadata response
is already an XML document, the normative media type is
<code>application/vnd.opendap.dataset-metadata+xml</code> which may be unfamiliar
to many generic clients (such as web browsers) and it is quite
conceivable that such a client might ask for the more generic
<code>text/xml</code> media type.</p>
</div>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP DMR URL with the suffix
<code>.xml</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dmr.xml</code></p>
</div>
<div class="paragraph">
<p>the response MUST be the normative representation of the DMR along with
the HTTP <code>Content-Type</code> header set to <code>text/xml</code> . For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dmr.xml HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>The normative XML representation of the DMR MUST also be returned when
an HTTP GET request is made on a base DAP4 DMR URL ( and the server uses
server-driven content negotiation to decide that the best response for
the client would be an HTML encoded DSR. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dmr HTTP/1.1
Host: server.org:8080
Accept: text/xml</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_encodings_of_the_dmr">Other Encodings of the DMR</h5>
<div class="sect5">
<h6 id="_html_encoding_optional_2">HTML Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP DMR URL with the suffix
<code>.html</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dmr.html</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with an HTML representation of the DMR, <strong>or</strong>
return an HTTP status of 404 (or 415) to indicate that an HTML
representation of the DMR is not available. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dmr.html HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the HTML representation MUST also be returned when an HTTP
GET request is made on a base DAP4 DMR URL (without an additional
suffix) and the server uses server-driven content negotiation to decide
that the best response for the client would be an HTML encoded DMR. For
example this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dmr HTTP/1.1
Host: server.org:8080
Accept: text/html</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the HTML representation of the DMR, if available. If no such
representation is available then the server MAY return an HTTP status of
404 or even 415.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_data_response">2.3.3. DAP4: Data Response</h4>
<div class="paragraph">
<p>The Data Service provides DAP4 data access to a dataset, and is the
(primary) way that DAP4 returns data to a client. The Data service
accepts a query string (constraint expression) which allows you to
subset the data and invoke server side functions. When the service is
invoked it returns the DAP4 data object. On the wire this is a binary
document with MIME type <em>application/vnd.opendap.dap4.data</em>. The payload
is broken into two logical parts: A DMR-type xml document that describes
the data and a BLOB that contains the actual data. For more on the
information on the Data response and the internal structure of its
payload along with a complete discussion of the DAP4 constraint
expression syntax see Volume 1 of the DAP4
specification (see <a href="#Data_Model">[1</a>]).</p>
</div>
<div class="sect4">
<h5 id="_data_response_resource_role">Data Response Resource Role</h5>
<div class="paragraph">
<p>DAP4 Data Responses are identified by the resource role:</p>
</div>
<div class="paragraph">
<p><strong><code>http://services.opendap.org/dap4/data</code></strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_normative_encoding_of_the_data_response">Normative Encoding of the Data Response</h5>
<div class="paragraph">
<p>The normative XML representation for the Data Response is defined in
Volume 1 of the DAP4
specification (see <a href="#Data_Model">[1</a>]). The media type for the normative XML representation is:</p>
</div>
<div class="paragraph">
<p><code>application/vnd.opendap.dap4.data</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_service_behavior_3">Service Behavior</h5>
<div class="paragraph">
<p>Every DAP4 compliant server MUST return the normative representation of
the Data Response when a client attempts to access a dataset URL with
the suffix &#8220;`.dap`&#8221; appended to it. The DAP4 server MAY return
alternate representations if the client indicates that it can accept
them and the server can provide them. The normative representation of
the Data Response is described in Volume 1 of the DAP4
specification (see <a href="#Data_Model">[1</a>]).</p>
</div>
<div class="paragraph">
<p>When an HTTP GET request is made on a base DAP dataset URL with the
suffix <code>.dap</code> added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url + '.dap' [?dap_constraint]</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with an normative representation of the (possibly
constrained) data response for the dataset given these conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the request <code>Accept</code> header contains only the normative XML encoding
media type (<code>application/vnd.opendap.dap4.data</code>),</p>
</li>
<li>
<p>the request <code>Accept</code> header equals <code>*/*</code>, or</p>
</li>
<li>
<p>the request <code>Accept</code> header does not indicate a preference for
another media type in which the server knows how to encode the Data
Response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: application/vnd.opendap.data
Date: ...</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_encodings_of_the_data_response">Other Encodings of the Data Response</h5>
<div class="sect5">
<h6 id="_text_encoding_optional">Text Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP Data Response URL with the
suffix <code>.txt</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dap.txt</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with the text representation of the Data Response
using the utf-8 character set, <strong>or</strong> return an HTTP status of 404 (or
415) to indicate that a text representation of the Data Response is not
available. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap.txt HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the text representation MUST also be returned when an HTTP
GET request is made on a base DAP4 Data Response URL (without an
additional suffix) and the server uses server-driven content negotiation
to decide that the best response for the client would be an text encoded
Data Response. For example this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap HTTP/1.1
Host: server.org:8080
Accept: text/plain</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the text representation of the Data Response, if available.
If no such representation is available then the server MAY return an
HTTP status of 404 or even 415.</p>
</div>
</div>
<div class="sect5">
<h6 id="_xml_encoding_optional">XML Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP Data Response URL with the
suffix <code>.xml</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dap.xml</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with the XML representation of the Data Response,
<strong>or</strong> return an HTTP status of 404 (or 415) to indicate that an XML
representation of the Data Response is not available. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap.xml HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the XML representation MUST also be returned when an HTTP
GET request is made on a base DAP4 Data Response URL (without an
additional suffix) and the server uses server-driven content negotiation
to decide that the best response for the client would be an XML encoded
data response. For example this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap HTTP/1.1
Host: server.org:8080
Accept: text/xml</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the XML representation of the Data Response, if available.
If no such representation is available then the server MAY return an
HTTP status of 404 or even 415.</p>
</div>
</div>
<div class="sect5">
<h6 id="_netcdf_3_encoding_optional">NetCDF-3 Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP Data Response URL with the
suffix <code>.nc</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dap.nc</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with a NetCDF-3 representation of the Data
Response, <strong>or</strong> return an HTTP status of 404 (or 415) to indicate that a
NetCDF-3 representation of the Data Response is not available. For
example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap.nc HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: application/x-netcdf
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the NetCDF-3 representation MUST also be returned when an
HTTP GET request is made on a base DAP4 Data Response URL (without an
additional suffix) and the server uses server-driven content negotiation
to decide that the best response for the client would be an NetCDF-3
encoded data response. For example this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap HTTP/1.1
Host: server.org:8080
Accept: application/x-netcdf</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the NetCDF-3 representation of the Data Response, if
available. If no such representation is available then the server MAY
return an HTTP status of 404 or even 415.</p>
</div>
</div>
<div class="sect5">
<h6 id="_netcdf_4_encoding_optional">NetCDF-4 Encoding (Optional)</h6>
<div class="paragraph">
<p>When an HTTP GET request is made on a DAP Data Response URL with the
suffix <code>.nc4</code><br>
added to it:</p>
</div>
<div class="paragraph">
<p>request url = <code>dataset_url.dap.nc4</code></p>
</div>
<div class="paragraph">
<p>the server MUST reply with a NetCDF-4 representation of the Data
Response, <strong>or</strong> return an HTTP status of 404 (or 415) to indicate that a
NetCDF-4 representation of the Data Response is not available. For
example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap.nc HTTP/1.1
Host: server.org:8080
Accept: */*</pre>
</div>
</div>
<div class="paragraph">
<p>Might result in the following response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">HTTP/1.1 200 OK
Content-Type: application/x-netcdf;ver=4
Date: ...</pre>
</div>
</div>
<div class="paragraph">
<p>If available, the NetCDF-4 representation MUST also be returned when an
HTTP GET request is made on a base DAP4 Data Response URL (without an
additional suffix) and the server uses server-driven content negotiation
to decide that the best response for the client would be an NetCDF-4
encoded data response. For example this request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap HTTP/1.1
Host: server.org:8080
Accept: application/x-netcdf;ver=4</pre>
</div>
</div>
<div class="paragraph">
<p>Must return the NetCDF-4 representation of the Data Response, if
available. If no such representation is available then the server MAY
return an HTTP status of 404 or even 415.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_error_response">2.3.4. DAP4 Error Response</h4>
<div class="paragraph">
<p>The DAP4 protocol returns error information using an Error response. If
a request for any of the three basic responses cannot be completed then
an Error response is returned in its place.</p>
</div>
<div class="paragraph">
<p>The normative XML representation for the Error Response is defined by
the following RELAX-NG schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;grammar</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://relaxng.org/ns/structure/1.0</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmlns:doc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.example.com/annotation</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">datatypeLibrary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/datatypes/dap4</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">ns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.opendap.org/ns/DAP/4.0#</span><span class="delimiter">&quot;</span></span>
                <span class="tag">&gt;</span>
<span class="tag">&lt;start&gt;</span>
  <span class="tag">&lt;ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorresponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/start&gt;</span>
<span class="tag">&lt;define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorresponse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Error</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;optional&gt;</span>
      <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpcode</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;data</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dap4_integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;/optional&gt;</span>
    <span class="tag">&lt;optional&gt;</span>
      <span class="tag">&lt;interleave&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;text</span><span class="tag">/&gt;</span><span class="tag">&lt;/Message&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Context</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;text</span><span class="tag">/&gt;</span><span class="tag">&lt;/Message&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">OtherInformation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;text</span><span class="tag">/&gt;</span><span class="tag">&lt;/Message&gt;</span>
      <span class="tag">&lt;/interleave&gt;</span>
    <span class="tag">&lt;/optional&gt;</span>
  <span class="tag">&lt;/element&gt;</span>
<span class="tag">&lt;/define&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Error element has one optional attribute: the <em>httpcode</em> which is a
standard HTTP protocol return code indicating the general class of
error. When possible, this code should match the return code in the HTTP
headers for the response.</p>
</div>
<div class="paragraph">
<p>The body of the &lt;Error&gt; element may contain any or all of the following
inner elements each containing arbitrary text.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>&lt;Message&gt; — A short informative message describing the error.</p>
</li>
<li>
<p>&lt;Context&gt; — Information describing the context in which the error
occurred: position of a parse error in a constraint expression, for
example.</p>
</li>
<li>
<p>&lt;OtherInformation&gt; — Arbitrary additional text information: a Java
stack trace, for example.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_error_response_resource_role">Error Response Resource Role</h5>
<div class="paragraph">
<p>DAP4 Error Responses are identified by the resource role:</p>
</div>
<div class="paragraph">
<p><strong><code><a href="http://services.opendap.org/dap4/error" class="bare">http://services.opendap.org/dap4/error</a></code></strong></p>
</div>
</div>
<div class="sect4">
<h5 id="_normative_encoding_of_the_error_response">Normative Encoding of the Error Response</h5>
<div class="paragraph">
<p>The normative XML representation for the Error Response is defined in
Appendix x &#8220;Normative XML Encoding of the Error Response&#8221;. The media
type for the normative XML representation is:</p>
</div>
<div class="paragraph">
<p><code>application/vnd.opendap.dap4.error.xml</code></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http">2.4. HTTP</h3>
<div class="paragraph">
<p>The DAP4 Web Services specification describes the features of HTTP that
are required to be a compliant DAP4 client or server. It does not
attempt to describe all aspects of HTTP that DAP4 servers might
implement or that DAP4 clients may see in response to DAP4 requests.
Similarly, it does not cover all issues related to the performance and
scalability of HTTP.</p>
</div>
<div class="paragraph">
<p>However, the following sections include both DAP4 requirements as well
as some suggestions of HTTP features that servers and clients are
encouraged to use.</p>
</div>
<div class="sect3">
<h4 id="_content_negotiation_and_media_types">2.4.1. Content Negotiation and Media Types</h4>
<div class="paragraph">
<p>Though the DAP4 core specifications only describe one encoding for each
type of resource, DAP4 web servers MAY have the ability to provide a
given resource in a number of different media types. All media types
available for a resource MUST be listed in the DAP4 Dataset Services
response document.</p>
</div>
<div class="paragraph">
<p>DAP4 responses MUST use the &#8220;Content-Type&#8221; header field to identify
the media type of the DAP4 response body. For example, the normative
value for the XML encoded DMR response is
<em>application/vnd.opendap.dap4.dataset-metadata+xml</em>.</p>
</div>
<div class="paragraph">
<p>The DAP4 Dataset Services response describes the available services and
their media types, and through this description provides DAP4 software
(client and/or server) with two different mechanisms to negotiate for
different kinds of media representations. The first mechanism is
server-driven content negotiation as described in the HTTP 1.1
specification, section 12, <code>Content
Negotiation</code> [<a href="#RFC2616_S12">12</a>]
The second mechanism is similar to the agent-driven negotiation also
described in section 12 of the HTTP 1.1 specification. The difference
being that the &#8220;list of available representations … [each with] its own
URI&#8221; is provided by the DAP4 Dataset Services response rather than in
response to an initial request.</p>
</div>
<div class="paragraph">
<p>Clients need not retrieve the Dataset Services response in order to
access the normative representations of either the Dataset Metadata or
Data responses, as these responses are required for every DAP4 server
and are mapped to well known URL patterns. If clients attempt to access
other representations or other services using agent-driven negotiation
without first checking the Dataset Services response, they should be
prepared to receive a 404 <code>Not Found</code> response [<a href="#RFC2616_S10_4_5">7</a>].</p>
</div>
<div class="paragraph">
<p>When using server-driven negotiation, DAP4 clients are encouraged to, at
a minimum, include <code>Accept</code> [<a href="#RFC2616_S14_1">14</a>] and <code>User-Agent</code> [<a href="#RFC2616_S14_43">17</a>]
headers in their requests and to provide accurate and detailed
information in the values of those headers. However, when server-driven
negotiation is used, DAP4 servers are not limited to those headers for
determining the media type that is returned. DAP4 clients should also be
prepared to handle 415 <code>Unsupported Media type</code> [<a href="#RFC2616_S10_4_16">10</a>] response codes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redirects">2.4.2. Redirects</h4>
<div class="paragraph">
<p>While HTTP redirects are not directly part of the DAP4 web protocol it
is strongly suggested that DAP4 client implementations be capable of
processing HTTP redirects as nominally described in the HTTP-1.1
specification sections on <code>Redirection Status Codes</code> [<a href="#RFC2616_S10_3">3</a>] and <code>Redirection
Response Headers</code>[<a href="#RFC2616_S14_30">16</a>]. (It is suggested that implementers of DAP4 clients
utilize an existing robust HTTP client library that will manage this for them.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_caching_of_responses_and_conditional_requests">2.4.3. Caching of Responses and Conditional Requests</h4>
<div class="paragraph">
<p>While, HTTP caching and conditional requests are not explicitly part of
the DAP4 web protocol, they do provide important tools for improving the
performance of both sides client server interaction. Therefore, it is
strongly suggested that DAP4 servers and client implementers be aware of
how <code>HTTP caching</code> [<a href="#RFC2616_S13">13</a>] works, and utilize it for working with DAP servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authenticationauthorization">2.4.4. Authentication/Authorization</h4>
<div class="paragraph">
<p>Authentication is the process by which a user agent establishes the
identity of the user to a server, and the server establishes it’s
identity with the user agent. While, HTTP authentication is not
explicitly part of the DAP4 web protocol, it does provide important
tools for securing the client server interaction. Therefore, it is
strongly suggested that DAP4 servers and client implementers be aware of
how <code>HTTP authentication</code> works [<a href="#RFC2617">19</a>], and utilize it for working with DAP
servers. Server implementers should pay particular attention to <code>HTTP security
considerations</code>[<a href="#RFC2616_S15">18</a>].</p>
</div>
<div class="paragraph">
<p>Authorization is the process through which a server determines who/what
has access to its various holdings and services. The HTTP protocol does
not directly address the issue of authorization (even though HTTP
defines the 401 response status using the word &#8220;authorization&#8221; it does
not provide separate semantics for authentication and authorization
which we see as an important distinction for data access), but any DAP4
server implementer should be aware that some kind of mechanism for
controlling access to holdings and services will likely be desired by
the people that install and operate their software.</p>
</div>
</div>
<div class="sect3">
<h4 id="_headers">2.4.5. Headers</h4>
<div class="sect4">
<h5 id="_request_headers">Request Headers</h5>
<div class="paragraph">
<p>These are the HTTP request headers that DAP clients using HTTP MAY
utilize. DAP4 servers MUST accept these headers and act on them in a
manner consistent with their descriptions below.</p>
</div>
<div class="sect5">
<h6 id="_general">General</h6>
<div class="paragraph">
<p><strong>Accept</strong><br>
The HTTP Accept header MAY be used by clients that wish to engage in
server-dirven content negotiation by requesting a particular
representation of a resource in the initial request. The server MUST
utilize this header, if present, in a manner consistent with the HTTP
content negotiation specification [<a href="#RFC2616_S12">12</a>]</p>
</div>
<div class="paragraph">
<p><strong>User-Agent</strong><br>
The HTTP User-Agent header MAY be used by clients to indicate their
&#8220;software identity&#8221; to the server [<a href="#RFC2616_S14_43">17</a>]. The server
MAY utilize this header, if present, to alter the
Content-Type of the response to something that is more likely to be
digestible by the requesting client
software [<a href="#RFC2616_S14_17">15</a>].</p>
</div>
</div>
<div class="sect5">
<h6 id="_dap_specific">DAP Specific</h6>
<div class="paragraph">
<p>There are no DAP specific headers required to make a general DAP
request.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_response_headers">Response Headers</h5>
<div class="paragraph">
<p>These are the HTTP response headers that DAP servers using HTTP MUST and
SHOULD (as indicated) return.</p>
</div>
<div class="sect5">
<h6 id="_general_2">General</h6>
<div class="paragraph">
<p><strong>Date</strong><br>
DAP4 servers MUST return an HTTP <strong>Date</strong> header whose value is the time
of the response and which MUST be in RFC 1123 date/time
format [<a href="#RFC1123">20</a>].</p>
</div>
<div class="paragraph">
<p><strong>Last-Modified</strong><br>
DAP4 servers SHOULD return an HTTP <strong>Last-Modified</strong> header whose value is
the last modified time of the request resource and which MUST be in RFC
1123 date/time format[<a href="#RFC1123">20</a>].</p>
</div>
<div class="paragraph">
<p><strong>Content-Type</strong><br>
DAP4 servers MUST return an HTTP <strong>Content-Type</strong> header, the value of
which SHOULD be set in accordance with the Dap4 Resource Roles and Media
Types discussion in section 1.1 of this document.</p>
</div>
<div class="paragraph">
<p><strong>Content-Description</strong><br>
DAP4 servers SHOULD return an HTTP <strong>Content-Description</strong> header.</p>
</div>
<div class="paragraph">
<p><strong>Content-Disposition</strong><br>
DAP4 servers SHOULD return an HTTP <strong>Content-Disposition</strong> header when
transmitting file typed responses.</p>
</div>
<div class="paragraph">
<p><strong>Content-Encoding</strong><br>
DAP4 servers MUST return an HTTP <strong>Content-Encoding</strong> header when the
content-coding of an entity is not &#8220;identity&#8221;.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dap_specific_2">DAP Specific</h6>
<div class="paragraph">
<p><strong>X-DAP-Server</strong><br>
DAP4 servers SHOULD return the <strong>X-DAP-Server</strong> HTTP header. This HTTP
header is used in a response to communicate the software version of the
server. This may be a simple string with the server name and version
number, or multiple software component versions may be represented. The
value of this header is a string determined by the implementations
author(s).</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>X-DAP-Server: bes/3.10.0, libdap/3.11.2, dap-server/ascii/4.1.2,
csv_handler/1.0.2, freeform_handler/3.8.4, fits_handler/1.0.7,
fileout_netcdf/1.1.2, gateway_module/1.1.0, hdf4_handler/3.9.4,
hdf5_handler/1.5.0, netcdf_handler/3.10.0, ncml_module/1.2.1,
dap-server/usage/4.1.2, dap-server/www/4.1.2, xml_data_handler/1.0.1</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>X-DAP-Server: TDS-4.19.3</code></p>
</div>
<div class="paragraph">
<p>X-DAP<br>
DAP4 servers MUST return the <strong>X-DAP</strong> HTTP header. This HTTP header is
used in a response to indicate the DAP protocol version used to encode
the content of the response. This value is constrained to a format of
<em>"`major_version`" dot "`minor version`"</em>, where both major_version and
minor_version are represented by an integer value.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>X-DAP: 4.0</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>X-DAP: 2.17</code></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_status_codes">2.4.6. Status Codes</h4>
<div class="paragraph">
<p>DAP servers that provide an HTTP interface are expected to utilize the
HTTP response codes in a manner consistent with the HTTP 1.1
specification [<a href="#RFC2616">1</a>].</p>
</div>
<div class="paragraph">
<p>The ones that are detailed here are used by the DAP in a manner
consistent with the specifications definition, but in support of
specific DAP server behavior.</p>
</div>
<div class="sect4">
<h5 id="_200_ok">200 OK</h5>
<div class="paragraph">
<p>A server MUST return an HTTP status of 200 when the request has been
successful and that the returned document contains the requested
resource. However since DAP responses can be quite large and since it is
also possible for the server to encounter any number of problems during
the marshaling, serialization, and subsequent transmission of the
response it is possible that the server may have committed/transmitted
the HTTP headers (in which the status value is transmitted) before a
subsequent error is encountered. These types of errors are transmitted
in the DAP4 over-the-wire protocol and all DAP4 clients MUST be able to
read and process these errors.</p>
</div>
</div>
<div class="sect4">
<h5 id="_400_bad_request">400 Bad Request</h5>
<div class="paragraph">
<p>The HTTP specification defines this status code as:</p>
</div>
<div class="paragraph">
<p><code>The request could not be understood by the server due to malformed
syntax. The client SHOULD NOT repeat the request without
modifications [<a href="#RFC2616_S10_4_1">4</a>]</code></p>
</div>
<div class="paragraph">
<p>DAP4 servers utilizes this code to mean the following.</p>
</div>
<div class="sect5">
<h6 id="_400_bad_dap4_request_syntax">400 Bad DAP4 Request Syntax</h6>
<div class="paragraph">
<p>The <strong>400 Bad DAP4 Request Syntax</strong> HTTP response code MUST be returned by
the server when there is a problem with the syntax of the OPeNDAP URL.
The problem could be in the formulation of the constraint expression, or
it may be that the URL extension did not match any that are recognized
by this server.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_401_unauthorized">401 Unauthorized</h5>
<div class="paragraph">
<p>The <strong>401 Unauthorized</strong> HTTP response code MUST be returned by the server
when access to the requested resource requires (not previously acquired)
user authentication. See the HTTP specification-1.1 for usage and
behavior [<a href="#RFC2616_S10_4_2">5</a>].</p>
</div>
</div>
<div class="sect4">
<h5 id="_403_forbidden">403 Forbidden</h5>
<div class="paragraph">
<p>The <strong>403 Forbidden</strong> HTTP response code MUST be returned when the server
has understood the request, but is refusing to fulfill it. Authorization
will not help and the request SHOULD NOT be repeated. This is
appropriate to return if, for example, the server software does not have
read permission for the requested resource [<a href="#RFC2616_S10_4_4">6</a>].</p>
</div>
</div>
<div class="sect4">
<h5 id="_404_not_found">404 Not Found</h5>
<div class="paragraph">
<p>The <strong>404 Not Found</strong> HTTP response code MUST be returned when the server
has not found anything matching the Request-URI [<a href="#RFC2616_S10_4_5">7</a>].</p>
</div>
</div>
<div class="sect4">
<h5 id="_415_unsupported_media_type">415 Unsupported Media Type</h5>
<div class="paragraph">
<p>The <strong>415 Unsupported Media Type</strong> HTTP response code MUST be returned
when the client requests a representation of the requested resource that
the server cannot provide [<a href="#RFC2616_S10_4_16">10</a>].</p>
</div>
</div>
<div class="sect4">
<h5 id="_500_internal_server_error">500 Internal Server Error</h5>
<div class="paragraph">
<p>The <strong>500 Internal Server Error</strong> status code SHOULD be returned when the
DAP server encounters internal problems when attempting to fulfill a
request [<a href="#RFC2616_S10_5_1">11</a>].</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verbs_aka_methods">2.4.7. Verbs (aka Methods)</h4>
<div class="sect4">
<h5 id="_get">GET</h5>
<div class="paragraph">
<p>A DAP4 request may be made using the HTTP GET request method utilizing a
Uniform Resource Identifier (URI) that encodes information specific to
the DAP4.</p>
</div>
<div class="paragraph">
<p>Each GET request MUST conform to the HTTP specification (which basically
says that a GET request MUST contain an HTTP protocol version number
followed by a MIME-like message containing various headers that further
describe the request.). While there are some optional DAP4 HTTP request
headers that may be used, DAP4 requests do not require specific HTTP
headers beyond those necessary for HTTP (see section 4.5.1 Request
Headers of this document for more). DAP4 servers SHOULD support the use
of the HTTP Accept request header to allow clients to engage in HTTP
content negotiation for specific representations of a requested DAP4
response [<a href="#RFC2616_S12">12</a>].</p>
</div>
<div class="paragraph">
<p>The DAP server responds to the GET request with an HTTP compliant
response (one that includes a status line containing the HTTP protocol
version and an error or success code, followed by HTTP response headers
and then response itself). There are two DAP specific HTTP headers that
are always included in a DAP response over HTTP: X-DAP-Server and X-DAP,
as described in section 4.5.2 of this document. The DAP response is the
payload of the HTTP response. Unless otherwise negotiated, the data
response payload is encoded using the chunked format as described in
<a href="#Data_Model">Volume 1</a>, while the other responses are simple HTTP responses.</p>
</div>
<div class="sect5">
<h6 id="_examples">Examples</h6>
<div class="paragraph">
<p>HTTP GET request.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap?/u,/v[0:8:1024] HTTP/1.1
Host: server.org
Accept: application/vnd.opendap.dap4.data</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dap4_urls">2.5. DAP4 URLs</h3>
<div class="paragraph">
<p>In DAP4 we divide a dataset URL into two sections, the <strong>identifier</strong> and
the <strong>query string</strong>. The <strong>identifier</strong> section is everything up to the
<code>?</code> character. The <strong>query string</strong> is the <code>?</code> character and
everything after it.</p>
</div>
<div class="paragraph">
<p>For example in the URL:</p>
</div>
<div class="paragraph">
<p><strong><a href="http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc.dmr?dap4.ce=/u;/lat;/lon" class="bare">http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc.dmr?dap4.ce=/u;/lat;/lon</a></strong></p>
</div>
<div class="paragraph">
<p>We have:</p>
</div>
<div class="paragraph">
<p><strong>identifier</strong> =<br>
<strong><a href="http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc.dmr" class="bare">http://test.opendap.org:8080/opendap/data/nc/fnoc1.nc.dmr</a></strong></p>
</div>
<div class="paragraph">
<p><strong>query string</strong> = <strong>?dap4.ce=/u;/lat;/lon</strong></p>
</div>
<div class="paragraph">
<p>Additionally DAP4 URLs conform to the web convention in which the query
string is decomposed as a set of key-value pairs (KVP) separated from
each other by &#8220;<strong>&amp;</strong>&#8221; characters:</p>
</div>
<div class="paragraph">
<p><code>?key=value&amp;key=value&amp;key=value &#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>Many web services utilize this pattern, including OGC. The DAP2
constraint expression subsumed the entire query string, so it did not
fit into the standard KVP model. Tomcat (and other web server
frameworks) provide specific API methods for collecting the KVP from the
query string, but again DAP2 doesn’t play well with this. The DAP4
constraint is designed to operate in a KVP environment.</p>
</div>
<div class="sect3">
<h4 id="_query_string_parameters">2.5.1. Query String Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>DAP4 query string parameters will always begin with the 5 character
string &#8220;<strong>dap4.</strong>&#8221; In this way query string parameters associated with
the DAP4 protocol can be easily identified by both people and software.</p>
</li>
<li>
<p>DAP4 query string keys are case sensitive.</p>
</li>
<li>
<p>DAP4 servers MUST treat ALL values of query string KVPs as case
sensitive.</p>
</li>
<li>
<p>Each DAP4 key may appear once in each query string (request URL).</p>
</li>
<li>
<p>The order of the keys does not matter, and unrecognized keys are
ignored, along with their values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DAP4 protocol reserves the exclusive use of all future query string
keys that begin with the 4 character token &#8220;<strong>dap4.</strong>&#8221; This way future
DAP4 service features may be added and invoked through the query string
section of the request URL without interfering with other features and
behaviors added to service implementations outside of the DAP4
development process.</p>
</div>
<div class="paragraph">
<p>The following keys are reserved.</p>
</div>
<div class="paragraph">
<p><strong>dap4.ce</strong><br>
The DAP4 constraint expression is contained in a single query string
parameter named &#8220;<strong>dap4.ce</strong>&#8221; This constraint expression contains all
of the subsetting information for the dataset include the projection
(which variables are to be returned), slicing (how the various arrays
are to be decimated), and filtering (conditional retrieval of values).
The fill discussion of the syntax of the constraint expression can be
found in Section 8 of Volume 1 of the DAP4 specification (see <a href="#_constraints">[1.8</a>]).</p>
</div>
<div class="paragraph">
<p><strong>dap4.async</strong><br>
The asynchronous response behavior is described in detail in <a href="#l#netcdf-async">Section 5</a>.
While the a DAP4 server’s asynchronous response behavior can be
controlled by a savvy client using HTTP headers it can also be managed
using the DAP4 query string parameter &#8220;<strong>dap4.async</strong>&#8221;</p>
</div>
<div class="paragraph">
<p><strong>dap4.func</strong><br>
While server-side functions are not addressed in the initial DAP4
specification or constraint expression syntax we do anticipate them
being defined (in short order) in an extension to the DAP4
specification. For now we are working with a proposed server side
function syntax in which a server side function is invoked as a key
value pair, something like:</p>
</div>
<div class="paragraph">
<p><code>dap4.func=ugr5(0,v,z,”10&lt;lat&lt;30”)</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_normative_references">2.6. Normative References</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="RFC2616"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html">Hypertext Transfer Protocol – HTTP/1.1</a>.</p>
</li>
<li>
<p><a id="RFC2616_S10_2_3"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.2.3">HTTP/1.1 Section 10.2.3 - Accepted</a></p>
</li>
<li>
<p><a id="RFC2616_S10_3"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.3">HTTP/1.1 Section 10.3 - Redirection Status Codes</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_1"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.1">HTTP/1.1 Section 10.4.1 - Bad Request</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_2"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.2">HTTP/1.1 Section 10.4.2 - Unauthorized</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_4"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.4">HTTP/1.1 Section 10.4.4 - Forbidden</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_5"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.5">HTTP/1.1 Section 10.4.5 - Not Found</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_10"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.10">HTTP/1.1 Section 10.4.10 - Conflict</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_13"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.13">HTTP/1.1 Section 10.4.13 - Precondition Failed</a></p>
</li>
<li>
<p><a id="RFC2616_S10_4_16"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.4.16">HTTP/1.1 Section 10.4.16 - Unsupported Media Type</a></p>
</li>
<li>
<p><a id="RFC2616_S10_5_1"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-10.5.1">HTTP/1.1 Section 10.5.1 - Internal Server Error</a></p>
</li>
<li>
<p><a id="RFC2616_S12"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-12">HTTP/1.1 Section 12 - Content Negotiation</a></p>
</li>
<li>
<p><a id="RFC2616_S13"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-13">HTTP/1.1 Section 13 - Caching</a></p>
</li>
<li>
<p><a id="RFC2616_S14_1"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-14.1">HTTP/1.1 Section 14.1 - Accept Header</a></p>
</li>
<li>
<p><a id="RFC2616_S14_17"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-14.17">HTTP/1.1 Section 14.17 - Content-Type Header</a></p>
</li>
<li>
<p><a id="RFC2616_S14_30"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-14.30">HTTP/1.1 Section 14.30 - Redirection Response Headers</a></p>
</li>
<li>
<p><a id="RFC2616_S14_43"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-14.43">HTTP/1.1 Section 14.43 - User-Agent Header</a></p>
</li>
<li>
<p><a id="RFC2616_S15"></a> <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-15">HTTP/1.1 Section 15 - Security Considerations</a></p>
</li>
<li>
<p><a id="RFC2617"></a> <a href="https://www.rfc-editor.org/rfc/rfc2617.html">HTTP Authentication</a></p>
</li>
<li>
<p><a id="RFC1123"></a> <a href="https://www.ietf.org/rfc/rfc1123.txt">Requirements for Internet Hosts</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_non_normative_references">2.7. Non-Normative References</h3>
<div class="paragraph">
<p>[REST] R. Fielding, UC Irvine Doctoral Thesis: &#8220;Architectural Styles
and the Design of Network-based Software Architectures&#8221;</p>
</div>
<div class="paragraph">
<p>[MediaType] Wikipedia: Internet Media Type</p>
</div>
<hr>
<hr>
</div>
<div class="sect2">
<h3 id="_appendix_ancillary_web_services_beyond_dap4">2.8. Appendix - Ancillary Web Services (Beyond DAP4)</h3>
<div class="paragraph">
<p>DAP4 servers MAY offer a number of other services that, while not
exactly DAP4 services per say, are commonly available. This section
lists some of the alternate services a DAP4 server might provide. By
enumerating the available services in the Dataset Services Response
servers can easily make software clients and the people that use them
aware of the server’s ancillary capabilities.</p>
</div>
<div class="sect3">
<h4 id="_dap4_html_data_request_form_service">2.8.1. DAP4: HTML DATA Request Form Service</h4>
<div class="paragraph">
<p>The HTML DATA Request Form Service provides browser based access to the
Dataset. When invoked it returns a web-browser renderable document (in
html) that provides a form (or other UI) that can be used to constrain
and request data in accordance with the DAP4 specification as applied to
the dataset .</p>
</div>
<div class="paragraph">
<p>suffix = <code>.html</code><br>
service url = <code>dataset_url + .html</code><br>
role id = <code>http://services.opendap.org/dap4/data-request-form#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/html</code> | <code>text/xhtml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_rdf_service">2.8.2. DAP4: RDF Service</h4>
<div class="paragraph">
<p>The RDF service provides an RDF representation of the Dataset document
(DDX). The RDF response is an XML document containing an RDF version of
the
<a href="https://docs.opendap.org/index.php?title=DAP4:_Responses#Dataset_Response">DAP4:
Dataset Response.</a></p>
</div>
<div class="paragraph">
<p>suffix = <code>.rdf</code><br>
service url = <code>dataset_url + .rdf</code><br>
role id = <code>http://services.opendap.org/dap4/rdf#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>application/rdf+xml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_iso_19115_service">2.8.3. DAP4: ISO 19115 Service</h4>
<div class="paragraph">
<p>This service provides ISO 19115 metadata for the Dataset, if any can be
found. When invoked it returns an XML document containing ISO 19115
metadata located in the
<a href="https://docs.opendap.org/index.php?title=DAP4:_Responses#Dataset_Response">DAP4:
Dataset Response.</a></p>
</div>
<div class="paragraph">
<p>suffix = <code>.iso</code><br>
service url = <code>dataset_url + .iso</code><br>
role id = <code>http://services.opendap.org/dap4/iso-19115-metadata#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/xml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_iso_conformance_score_service">2.8.4. DAP4: ISO Conformance Score Service</h4>
<div class="paragraph">
<p>This service provides a browser renderable document that describes how
well the metadata held in the Dataset conforms to ISO 19115. When
invoked this service returns a browser renderable document that scores
how well the metadata held in the
<a href="https://docs.opendap.org/index.php?title=DAP4:_Responses#Dataset_Response">Dataset
Response</a> conforms to ISO 19115.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.rubric</code><br>
service url = <code>dataset_url + .rubric</code><br>
role id = <code>http://services.opendap.org/dap4/iso-19115-score#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/html</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_netcdf_file_out_service">2.8.5. DAP4: NetCDF File-out Service</h4>
<div class="paragraph">
<p>This service provides data responses in NetCDF-4 file format. When
invoked the regular DAP data response will be repackaged as a NetCDF 4
file.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.nc4</code><br>
service url = <code>dataset_url + '.nc4' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap4/netcdf-3#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>application/x-netcdf-4</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_ascii_data_service">2.8.6. DAP4: ASCII Data Service</h4>
<div class="paragraph">
<p>This service provides data responses in ASCII format. When invoked the
regular DAP data response will be repackaged as an ASCII representation
of the data values.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.ascii</code><br>
service url = <code>dataset_url + '.ascii' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap4/ascii#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/plain</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_xml_data_service">2.8.7. DAP4: XML Data Service</h4>
<div class="paragraph">
<p>This service provides data responses in XML format. When invoked the
constrained Dataset response document (DDX) will be marked up with the
data values of the request and returned. Large requests may be denied.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.xdap</code><br>
service url = <code>dataset_url + '.xdap' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap4/xml-data#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/xml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_native_file_access_service">2.8.8. DAP4: Native File Access Service</h4>
<div class="paragraph">
<p>This service provides direct access to the data source file (or whatever
else) that is creating the DAP dataset resource. When invoked it returns
the &#8220;native&#8221; data from whatever store (filesystem, etc.) it may be in.
Servers MAY elect to not support this response, for example, for
generated data, very large data, et cetera.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.file</code><br>
service url = <code>dataset_url + .file</code><br>
role id = <code>http://services.opendap.org/dap4/file#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: Type varies with file type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dap4_server_version_service">2.8.9. DAP4: Server Version Service</h4>
<div class="paragraph">
<p>This service provides software versioning information. When invoked the
service returns an XML file containing a description of the version of
the server and it’s components.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.ver</code><br>
service url = <code>dataset_url + .ver</code><br>
role id = <code>http://services.opendap.org/dap4/version#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/xml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dap2_services">2.8.10. DAP2 Services</h4>
<div class="paragraph">
<p>In order to support legacy client applications DAP4 server
implementations MAY support the DAP2 services stack. If they do so the
DAP2 services MUST be organized as described in this section.</p>
</div>
<div class="sect4">
<h5 id="_dap2_data_service">DAP2: Data Service</h5>
<div class="paragraph">
<p>The DAP2 data service provides DAP2 data access to the data resource.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.dods</code><br>
service url = <code>dataset_url + '.dods' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap2/dods#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>application/octet-stream</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_ddx_service">DAP2: DDX Service</h5>
<div class="paragraph">
<p>The DAP2 DDX service provides DAP2 access to the data resource metadata.
When invoked the service returns an XML document containing both
syntactic and semantic dataset metadata in DAP2 XML format.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.ddx</code><br>
service url = <code>dataset_url + .ddx</code><br>
role id = <code>http://services.opendap.org/dap2/ddx#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/xml</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_dds_service">DAP2: DDS Service</h5>
<div class="paragraph">
<p>The DAP2 DDS service provides access to the &#8216;syntactic&#8217; metadata (aka
use or structural metadata) for the data resource. When invoked returns
a DAP2 DDS response document conforming to the DDS part of the DAP2
specification.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.dds</code><br>
service url = <code>dataset_url + '.dds' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap2/dds#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/plain</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_das_service">DAP2: DAS Service</h5>
<div class="paragraph">
<p>The DAP2 DAS service provides access to the &#8216;semantic&#8217; metadata (aka
domain metadata) for the data resource. When invoked returns a DAP2 DAS
response document conforming to the DAS part of the DAP2 specification.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.das</code><br>
service url = <code>dataset_url + .das</code><br>
role id = <code>http://services.opendap.org/dap2/das#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/plain</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_ascii_data_service">DAP2: ASCII Data Service</h5>
<div class="paragraph">
<p>This service provides DAP2 data responses in ASCII format. When invoked
the regular DAP2 data response will be repackaged as an ASCII
representation of the data values.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.ascii</code><br>
service url = <code>dataset_url + '.ascii' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap2/ascii#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/plain</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_json_data_service">DAP2: JSON Data Service</h5>
<div class="paragraph">
<p>This service provides DAP2 data responses in w10n JSON format. When
invoked the regular DAP2 data response will be repackaged as an w10n
JSON representation of the data values.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.json</code><br>
service url = <code>dataset_url + '.json' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap2/json#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/plain</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_info_service">DAP2: Info Service</h5>
<div class="paragraph">
<p>The DAP2 INFO service provides a browser renderable page that combines
both the DAP2 &#8216;syntactic&#8217; and &#8216;semantic&#8217; metadata for the data
resource in a human readable way. When invoked this service returns a
web browser renderable document that combines both the DAP2
&#8216;syntactic&#8217; and &#8216;semantic&#8217; metadata for the data resource in a human
readable way.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.info</code><br>
service url = <code>dataset_url + .info</code><br>
role id = <code>http://services.opendap.org/dap2/Info#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>text/html</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_dap2_netcdf_service">DAP2: NetCDF Service</h5>
<div class="paragraph">
<p>This service provides data responses in NetCDF-3 file format. When
invoked the regular DAP data response will be repackaged as a NetCDF 3
file.</p>
</div>
<div class="paragraph">
<p>suffix = <code>.nc</code><br>
service url = <code>dataset_url + '.nc' + [?dap_constraint]</code><br>
role id = <code>http://services.opendap.org/dap4/netcdf-3#</code></p>
</div>
<div class="paragraph">
<p>Default/primary media type: <code>application/x-netcdf</code></p>
</div>
<div class="paragraph">
<p><a href="https://docs.opendap.org/index.php?title=Template:ServiceTemplate">Template:
ServiceTemplate</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CSV-encoding-response">3. Extensions: CSV Data Encoding and Response</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>Abstract</em></strong></p>
</div>
<div class="paragraph">
<p>This document specifies the DAP4 CSV data encoding, how DAP4 servers can
advertise support for the DAP4 CSV encoding, and how DAP4 clients can
request DAP4 CSV encoded data responses.</p>
</div>
<div class="paragraph">
<p>The DAP4 CSV data encoding represents DAP4 data as structured
Comma-Separated Values (CSV) in UTF-8 text. Though based on the
<em>text/csv</em> media type described in [<a href="#RFC_4180">1</a>],
the DAP4 CSV is more complex so that it can fully represent the more
complex data structures of the DAP4 data model. Some structure beyond
simple CSV is necessary to capture the DAP4 data structures.</p>
</div>
<div class="paragraph">
<p>As with requests for data in the DAP4 binary data encoding described in
<a href="#Data_Model">Volume 1</a> of the DAP4 specification,
requests for DAP4 CSV encoded data can be constrained to a subset by
using a standard DAP4 Constraint Expression [DAP4 CE].</p>
</div>
<div class="sect2">
<h3 id="_dap4_extension_details">3.1. DAP4 Extension Details</h3>
<div class="paragraph">
<p>The Role URI for the DAP4 CSV Data Encoding and Response extension is</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">http://services.opendap.org/dap4/extension/text-csv-data</pre>
</div>
</div>
<div class="paragraph">
<p>DAP4 servers MUST include this role URI in a Dataset Service Response
[DSR] <em>extension</em> element to indicate that the DAP4 CSV Data Encoding
and Response extension is supported for the dataset (?represented by
that DSR?). DAP4 clients MAY check for DSR <strong>extension</strong> elements with
this role URI to determine if the DAP4 CSV Data Encoding and Response
extension is supported.</p>
</div>
<div class="paragraph">
<p>Dataset Service Response [DSR] <em>extension</em> elements must also contain a
name and a description. The following are recommended text for the name
and description:</p>
</div>
<div class="paragraph">
<p><strong>Name</strong><br>
DAP4 CSV Data Encoding and Response</p>
</div>
<div class="paragraph">
<p><strong>Description</strong><br>
This extension provides an encoding for representing DAP4 data as
structured Comma-Separated Values (CSV) in UTF-8 text.</p>
</div>
</div>
<div class="sect2">
<h3 id="_requesting_dap4_csv_encoded_data_response">3.2. Requesting DAP4 CSV Encoded Data Response</h3>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Media Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dap</code> or + <code>.dap.csv</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>application/vnd.opendap.dap4.data+csv</p>
</div>
<div class="paragraph">
<p>DAP4 CSV encoding</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dap" class="bare">http://server/path/dataset.nc.dap</a></code></p>
</div>
<div class="paragraph">
<p><a href="http://server/path/dataset.nc.dap.csv" class="bare">http://server/path/dataset.nc.dap.csv</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>.dap.csv</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>text/csv</p>
</div>
<div class="paragraph">
<p>DAP4 CSV (UTF-8) Data encoding with generic media type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><a href="http://server/path/dataset.nc.dap.csv" class="bare">http://server/path/dataset.nc.dap.csv</a></code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_dap4_csv_encoding">3.3. DAP4 CSV Encoding</h3>

</div>
<div class="sect2">
<h3 id="_normative_references_2">3.4. Normative References</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="RFC_4180"></a> <a href="https://www.rfc-editor.org/rfc/rfc4180.html">Common Format and MIME Type for Comma-Separated Values (CSV)
Files</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="netcdf-encoding-response">4. Extensions: NetCDF Data Response</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dap4_extension_details_2">4.1. DAP4 Extension Details</h3>
<div class="paragraph">
<p>There is currently no text in this page.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="netcdf-async">5. Extensions: Asynchronous Response</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Abstract</strong></p>
</div>
<div class="paragraph">
<p>This document specifies the DAP4 Asynchronous HTTP Response extension.
It defines the set of HTTP mechanisms used by DAP4 clients and servers
when requesting or delivering asynchronous responses.</p>
</div>
<div class="paragraph">
<p>This extension provides DAP4 with a mechanism that allows servers to
handle requests where the construction or computation of the response
takes more time than a client may wish to wait.</p>
</div>
<div class="sect2">
<h3 id="_dap4_extension_details_3">5.1. DAP4 Extension Details</h3>
<div class="paragraph">
<p>The Role URI for the DAP4 Asynchronous HTTP Response extension is</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">http://services.opendap.org/dap4/extension/asynchronous-http-response</pre>
</div>
</div>
<div class="paragraph">
<p>DAP4 servers MUST include this role URI in a Dataset Service Response
[DSR] <em>extension</em> element to indicate that the DAP4 Asynchronous HTTP
Response extension is supported for the dataset (?represented by that
DSR?). DAP4 clients MAY check for DSR <strong>extension</strong> elements with this
role URI to determine if the DAP4 Asynchronous HTTP Response extension
is supported.</p>
</div>
<div class="paragraph">
<p>Dataset Service Response [DSR] <em>extension</em> elements must also contain a
name and a description. The following are recommended text for the name
and description:</p>
</div>
<div class="paragraph">
<p><strong>Name</strong><br>
DAP4 Asynchronous HTTP Response</p>
</div>
<div class="paragraph">
<p><strong>Description</strong><br>
This extension provides DAP4 with a mechanism to support asynchronous
HTTP responses, e.g., when a request will take the server time to
fulfill.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_of_http_mechanisms_used_to_support_asynchronous_http_response">5.2. Summary of HTTP Mechanisms Used to Support Asynchronous HTTP Response</h3>
<div class="paragraph">
<p>Role: <a href="http://services.opendap.org/dap4/async" class="bare">http://services.opendap.org/dap4/async</a></p>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DAP4 Asynch Response document:</p>
<div class="ulist">
<ul>
<li>
<p>Media Type: <code>application/vnd.opendap.dap4.async+xml</code></p>
</li>
<li>
<p>XML Namespace: <a href="http://opendap.org/ns/dap/asynchronous" class="bare">http://opendap.org/ns/dap/asynchronous</a></p>
</li>
<li>
<p>Types of documents</p>
<div class="ulist">
<ul>
<li>
<p>Required</p>
</li>
<li>
<p>Accepted</p>
</li>
<li>
<p>Not Yet Available</p>
</li>
<li>
<p>Gone</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP Request Headers</p>
</div>
<div class="paragraph">
<p>HTTP Response Headers</p>
</div>
<div class="paragraph">
<p>URL Query String: dap4.async</p>
</div>
</div>
<div class="sect2">
<h3 id="_overview_asynchronous_service_behavior_and_responses">5.3. Overview: Asynchronous Service Behavior and Responses</h3>
<div class="paragraph">
<p>Asynchronous responses are responses that will take the server some time
to build. When a client is told that a response &#8216;is asynchronous,&#8217; it
must know to come back at a later time to retrieve the response. The
concept is a very simple one, and the existing network infrastructure is
very good at supporting these kinds of interactions. A major factor in
the success of the proposed solution will be the level of uniform
support for the design. Secondly, as is often the case, the details will
be more complex than the underlying concept. In particular, the request
mechanism must be extended so that synchronous (regular) requests are
not affected by the addition of asynchronous requests and, at the same
time, clients do not inadvertently make asynchronous requests. another
detail is that the (asynchronous) responses are <em>ephemeral</em> because they
typically only persist for a period of time and then be purged.</p>
</div>
<div class="paragraph">
<p>A typical &#8216;workflow&#8217; for an asynchronous request is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client makes a data request that indicates that it will accept
either an asynchronous or synchronous response. Optionally, the client
can place a time constraint on the response, indicating that if the
response will not be ready in a given period of time, it does not want
the response.</p>
</li>
<li>
<p>The server returns an initial response (without delay) that indicates
the request has indeed resulted in an asynchronous response and provides
the client with a URL and time estimate.</p>
</li>
<li>
<p>The client reads the time estimate and waits…</p>
</li>
<li>
<p>The client dereferences the URL and gets the response.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Examples<br>
A DAP4 server that is retrieving data content from a near-line tape
storage subsystem might take several minutes to access a particular data
holding.</p>
</div>
<div class="paragraph">
<p>A DAP4 server that is providing access to data held in an Amazon Web
Services Glacier Vault will have to wait ~4 hours before it can retrieve
a particular holding.</p>
</div>
<div class="paragraph">
<p>In these circumstances the server may return the DAP4 Asynchronous
Response.</p>
</div>
<div class="paragraph">
<p>The remainder of this section will expand on this basic workflow using
examples that focus on the HTTP protocol but that also allow for the use
of other transport protocols.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_willingness_to_accept_asynchronous_responses">5.4. Client willingness to accept asynchronous responses</h3>
<div class="paragraph">
<p>A client can indicate willingness to accept asynchronous responses in
one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By including the <a href="#_x_dap_async_accept">X-DAP-Async-Accept</a> HTTP header.</p>
</li>
<li>
<p>By adding the <a href="#_dap4_constraint_expression_extension_for_async">async</a>
keyword to the DAP constraint expression.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the client indicates that it must have access to the asynchronous
response content within a certain time (utilizing either the
<a href="#_x_dap_async_accept">X-DAP-Async-Accept</a>
HTTP header and/or the <a href="#_dap4_constraint_expression_extension_for_async">async</a>
keyword in the constraint expression) and the response will not be
available in that time frame, the server MUST reject the request and
return an HTTP status of <a href="#_412_precondition_failed">412</a>
and the <a href="#_dap4_asynchronous_request_rejected">DAP Asynchronous Request Rejected</a> XML document.</p>
</div>
<div class="paragraph">
<p>If both the <em>X-DAP-Async-Accept</em> HTTP header and the <em>async</em> keyword are
used, the keyword takes precedence.</p>
</div>
<div class="paragraph">
<p>Servers must reject requests that require an asynchronous response if
the client has not indicated willingness to accept such a response.
Rejection of such requests is indicated by all three of the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#_400_dap4_asynchronous_response_required">HTTP status of 400</a></p>
</li>
<li>
<p>Inclusion of the <a href="#_x_dap_async_required">X-DAP-Async-Required</a> HTTP response header</p>
</li>
<li>
<p>The response body must contain the <a href="#_dap4_asynchronous_response_required">DAP
Asynchronous Response Required</a> XML document.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This safety check (requiring clients to explicitly indicate their
willingness to accept asynchronous responses) is required because
otherwise very simple clients might inadvertently make requests that
will result in an asynchronous responses, and these kinds of responses
are likely to use disproportionately (relative to synchronous responses)
more server resources. We want to make DAP4 so that simple clients work
well and don’t encounter unexpected &#8216;hiccups.&#8217;</p>
</div>
</div>
<div class="sect2">
<h3 id="_initial_processing_by_the_server">5.5. Initial processing by the server</h3>
<div class="paragraph">
<p>When a request is accepted by the server and it will result in an
asynchronous response, the server MUST the server MUST return a 202
(Accepted) HTTP status code and the <a href="#_dap4_asynchronous_request_accepted">DAP4
Asynchronous Request Accepted</a> XML document. This document contains a
URL to the pending result of the request.</p>
</div>
<div class="paragraph">
<p>Of course, this discussion is about the mechanism that enables a client
to make a request and the server to provide <em>information about</em> an
asynchronous response to that request. It does not cover any of the
nearly infinite ways a server might actually make the <em>content</em> of that
response. It is likely that servers will write the responses to files
and the URL returned to the client will be used to retrieve that file,
but there’s no requirement that servers do that. The only requirements
on server are that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The URL returned asserts, using the <a href="#_dap4_constraint_expression_extension_for_async">constraint
expression syntax for async</a> that the client accepts async responses.</p>
</li>
<li>
<p>The URL returned can be dereferenced and that operation will return
the response requested by the client.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_response_retrieval_by_the_client">5.6. Response retrieval by the client</h3>
<div class="paragraph">
<p>When a client requests an asynchronous result that is ready, the server
MUST return a 200 (OK) HTTP status code and the resulting data response.
If the client attempts to access the asynchronous result prior to it’s
availability, the server SHOULD return an HTTP response status of
<a href="#_409_conflict_dap4_response_not_ready">409(DAP Response Not Ready)</a> along with the
<a href="#_dap4_asynchronous_response_not_yet_available">DAP4 Asynchronous Response Not Available</a> XML document. If the server does
not return the 409 response status then it MUST return a 404 (Not Found)
response along with whatever document it deems fit as the response body.</p>
</div>
<div class="paragraph">
<p>If the client attempts to access the asynchronous result after it is no
longer available, the server SHOULD return an
<a href="#_410_gone_dap4_response_no_longer_available">HTTP response status of 410 (Gone)</a> along with the
<a href="#_dap4_asynchronous_response_gone">DAP4 Asynchronous Response Gone</a> document. If the server does not return the
410 response status then the server MUST return a 404 (Not Found)
response along with whatever document it deems fit as the response body.</p>
</div>
<div class="paragraph">
<p>In each case above where the server SHOULD return a specific error code,
but may return a 404 code instead, the intent is for servers to provide
the most appropriate use of HTTP/1.1’s error codes while also providing
servers with an &#8216;out&#8217; when that is hard for them to do. For example,
knowing that a response, which is essentially ephemeral, is gone would,
in theory, require to server to keep a record of every URL ever issued
for an asynchronous response and that is not practical. At the same
time, it is easy to see that a client would really like to know that the
response has not yet been finished (i.e., it has not waited long enough)
or that it is gone (i.e., it waited too long).</p>
</div>
</div>
<div class="sect2">
<h3 id="_detail_client_requests">5.7. Detail: Client requests</h3>
<div class="sect3">
<h4 id="_dap4_constraint_expression_extension_for_async">5.7.1. DAP4 Constraint Expression extension for Async</h4>
<div class="paragraph">
<p>By adding a keyword/value pair to the DAP4 query string we can allow a
client to encode it’s willingness to accept an asynchronous response,
along with the a maximum amount of time the client can wait before it
can access the response.</p>
</div>
<div class="paragraph">
<p><strong>dap4.async</strong><br>
A value of zero indicates the client is willing to unconditionally
accept an asynchronous response. A positive integer value will be
interpreted as the number of seconds that the client will wait for
access to the response. If the value is negative the serve MUST return
an error.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong><br>
Client is willing to unconditionally accept an asynchronous response</p>
</div>
<div class="paragraph">
<p><code>?dap4.async=0</code></p>
</div>
<div class="paragraph">
<p>Client is willing to wait for 60 seconds for access to the asynchronous
response</p>
</div>
<div class="paragraph">
<p><code>?dap4.async=60</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_x_dap_async_accept">5.7.2. X-DAP-Async-Accept</h4>
<div class="paragraph">
<p>A client may indicate willingness to accept asynchronous responses by
including the <em>X-DAP-Async-Accept</em> HTTP header. Clients can make
conditional requests for asynchronous responses by indicating the
maximum time they are willing to wait by using the <strong>X-DAP-Async-Accept</strong>
HTTP header with a value given in seconds. A value of zero indicates
that the client is willing to accept whatever delay the server may
encounter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_detail_server_responses">5.8. Detail: Server responses</h3>
<div class="paragraph">
<p>Several &#8216;experimental&#8217; HTTP headers are used by this design. They
convey information either in the request (like the <em>X-DAP-Async-Accept</em>
described above) or they encode information for a response. While only
clients that intend to support asynchronous responses need to understand
all of these, <em>every</em> client SHOULD understand the
<em>X-DAP-Async-Required</em> header. Because we need to support clients like
web browsers, knowledge of that header is not required, but
DAP4-specific clients will provide the most information to users if they
know to look for at least that response header.</p>
</div>
<div class="sect3">
<h4 id="_http_response_headers">5.8.1. HTTP Response Headers</h4>
<div class="sect4">
<h5 id="_x_dap_async_required">X-DAP-Async-Required</h5>
<div class="paragraph">
<p>The <em>X-DAP-Async-Required</em> HTTP response header is included in the
response if the request requires an asynchronous response and the client
has not indicated willingness to accept such a response. Rejection of
the request should also be indicated by the <a href="#_400_dap4_asynchronous_response_required">400
DAP Asynchronous Response Required</a> HTTP response code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_x_dap_async_accepted">X-DAP-Async-Accepted</h5>
<div class="paragraph">
<p>The <em>X-DAP-Async-Accepted</em> HTTP response header is included in the
response if the server has accepted an asynchronous request. Acceptance
of the request should also be indicated by the
<a href="#_202_accepted">202 Asynchronous Request Accepted</a> HTTP response code.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_response_codes">5.8.2. HTTP Response Codes</h4>
<div class="paragraph">
<p>HTTP provides a number of response codes beyond the simple 200 (OK), 404
(Not Found) and 500 (Internal Server Error). In this design we describe
how those standard codes SHOULD be used by DAP4 servers. We don’t
enumerate all of the possible codes, instead opting for a description of
those that most relevant.</p>
</div>
<div class="sect4">
<h5 id="_202_accepted">202 Accepted</h5>
<div class="paragraph">
<p>A server indicates that a request has been accepted and will be handled
asynchronously by returning a &#8216;202 Accepted&#8217; HTTP response code. The
response body must contain a document in one of the asynchronous
information media types listed link##_asynchronous_response_documents[below].
A server MUST return this response, and only do so, when a client has
indicated a willingness to process an asynchronous response and the
response will actually be returned using the asynchronous mechanism.</p>
</div>
</div>
<div class="sect4">
<h5 id="_400_dap4_asynchronous_response_required">400 DAP4 Asynchronous Response Required</h5>
<div class="paragraph">
<p>The &#8216;400 DAP Asynchronous Response Required&#8217; HTTP response code is
used to indicate that the DAP4 request has been rejected because an
asynchronous response is required and the client did not indicate
willingness to accept an asynchronous response.</p>
</div>
<div class="paragraph">
<p>The response code text is used to indicate the reason for the rejection.
However, since the &#8216;400&#8217; HTTP response code is not specific to
asynchronous DAP (the standard text for the &#8216;400&#8217; code is &#8220;Bad
Request&#8221;), the <em>X-DAP-Async-Required</em> HTTP response header is also
included in the response (see <a href="#_x_dap_async_required">above</a>).</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> that a standard 400 HTTP response code is returned. In this way,
a client that does not understand asynchronous DAP can fail gracefully.
The response code text message has been changed to be more informative
of the reason for the failure. For clients that are aware of
asynchronous DAP, the &#8220;DAP-Async-Required&#8221; header is set to &#8220;true&#8221;.
The body of the response also returns some information the client can
use to decide on how it will continue.</p>
</div>
</div>
<div class="sect4">
<h5 id="_409_conflict_dap4_response_not_ready">409 Conflict - DAP4 Response Not Ready</h5>
<div class="paragraph">
<p>The &#8216;409 Conflict&#8217; HTTP response code MAY be returned by a server to
indicate that the DA4P request has been rejected because a previous
asynchronous request has not been completed and the result is not ready
for access. If a server utilizes the &#8216;409 Conflict&#8217; HTTP response code
it must also return a <a href="#_dap4_asynchronous_response_not_yet_available">DAP4
Asynchronous Response Not Yet Available</a> document in the response body.</p>
</div>
</div>
<div class="sect4">
<h5 id="_410_gone_dap4_response_no_longer_available">410 Gone - DAP4 Response No Longer Available</h5>
<div class="paragraph">
<p>The &#8216;410 Gone&#8217; HTTP response code MAY be used by a server to indicate
that the result of an asynchronous request is no longer available. If a
server utilizes the &#8216;410 Gone&#8217; HTTP response code it must also return
a <a href="#_dap4_asynchronous_response_gone">DAP4 Asynchronous Response Gone</a> document in the response body.</p>
</div>
</div>
<div class="sect4">
<h5 id="_412_precondition_failed">412 Precondition Failed</h5>
<div class="paragraph">
<p>The &#8216;412 Precondition Failed&#8217; HTTP response code is used to indicate
that the DAP request has been rejected because it did not meet the
<strong>X-DAP-Async-Accept</strong> condition (see <a href="#_x_dap_async_accepted">above</a>) that was specified in the request.</p>
</div>
</div>
<div class="sect4">
<h5 id="_500_internal_error">500 Internal Error</h5>
<div class="paragraph">
<p>The &#8216;500 Internal Error&#8217; HTTP response code is used to indicate that
the DAP request has caused an error on the server. The request body and
other headers must be compliant with the <a href="#_dap4_error_response">DAP4 Error Response</a>
and <a href="#_status_codes">Status Codes</a> sections of the
<a href="#Web_Services">Web Services Specification</a>. The request should not be repeated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_response_documents">5.8.3. Asynchronous Response Documents</h4>
<div class="paragraph">
<p>The uses of these documents are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to inform clients that a request will result in an asynchronous
response;</p>
</li>
<li>
<p>to provide clients with the status of an an accepted asynchronous
request; and</p>
</li>
<li>
<p>to inform clients that a request for and asynchronous response has
been rejected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These response documents are the payloads to various responses,
including errors. By using the HTTP 400-series error response codes, the
design ensures that generic web clients will understand that their
request was in error (even if they don’t really understand why). The
text provided with the response code will be sufficient that person
could understand the gist of the problem, if not more. The response
documents described here, along with the <em>X-DAP</em> describe above, are a
way of providing additional information to a savvy client so that it can
take full advantage of the synchronous response system.</p>
</div>
<div class="paragraph">
<p>These documents are XML that follows the DAP Asynchronous XML schema and
are declared in the namespace <strong><a href="http://opendap.org/ns/dap/asynchronous" class="bare">http://opendap.org/ns/dap/asynchronous</a></strong>.</p>
</div>
<div class="sect4">
<h5 id="_dap4_asynchronous_response_required">DAP4 Asynchronous Response Required</h5>
<div class="paragraph">
<p>This document informs clients that a request will result in an
asynchronous response, and that the client has not yet indicated it’s
willingness to accept an asynchronous response. It might seem
superfluous to include a document that clearly only a client
knowledgable about the asynchronous response features could parse, but
many such clients may not, as a matter of course, indicate they will
accept these responses. For example, a user-configurable parameter might
be turn off support for the feature. The <em>expectedDelay</em> and
<em>responseLifetime</em> elements convey information about conditions the
clients can expect if it submits an asynchronous request for the
response. As noted below, these are estimates made by the server since a
number of things that the server cannot predict can affect them in the
interleaving time between the client’s requests. Additionally, a server
MAY return values of zero for either of the values, indicating that it
cannot make an accurate estimate.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;AsynchronousResponse status="required"&gt;
  &lt;expectedDelay seconds="600" /&gt;
  &lt;responseLifetime seconds="3600"/&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This response MUST be associated with the 400 HTTP response code and the
<em>X-DAP-Async-Required</em> response header.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dap4_asynchronous_request_accepted">DAP4 Asynchronous Request Accepted</h5>
<div class="paragraph">
<p>This response informs clients that a request resulting in an
asynchronous response has been accepted, along with operational
information about retrieving the asynchronous response result. Note that
the <em>expectedDelay</em> and <em>responseLifetime</em> elements are an estimate by
the server. A server SHOULD ensure that the response will remain
available for the time period given by <em>expectedDelay</em> and
<em>responseLifetime</em>. We say <em>SHOULD</em> and not <em>MUST</em> because we cannot
predict all possible operational situations where these kinds of
responses might be used. For example, a server might be providing access
for several types of users who might have different access priorities,
especially to limited resources like those typically involved with
asynchronous access, and thus some responses might be further delayed,
or removed early, to enable processing of requests from users with
higher priority. It should be kept in mind, however, that the usefulness
of the asynchronous responses will depend, in part, on servers providing
a facility on which clients can depend.</p>
</div>
<div class="paragraph">
<p>While the <em>expectedDelay</em> and <em>responseLifetime</em> elements are required,
a server MAY set their <em>seconds</em> attribute to <em>0</em> to indicate that it
cannot provide a reliable value. In this case, clients SHOULD poll every
300 seconds and servers SHOULD expect this behavior. This is the default
TCP user timeout period (see <a href="http://tools.ietf.org/html/rfc5482" class="bare">http://tools.ietf.org/html/rfc5482</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;AsynchronousResponse status="accepted"&gt;
  &lt;expectedDelay seconds="600" /&gt;
  &lt;responseLifetime seconds="3600"/&gt;
  &lt;link href="http://server.org/async/path/result" /&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This response document MUST be associated with the 202 HTTP status code
and the <em>X-DAP-Async-Accepted</em> response header.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dap4_asynchronous_response_not_yet_available">DAP4 Asynchronous Response Not (Yet) Available</h5>
<div class="paragraph">
<p>This document informs clients that a while a previous request for an
asynchronous response has been accepted, the result is not available.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;AsynchronousResponse status="pending"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This response document MUST be associated with the
<a href="#_409_conflict_dap4_response_not_ready">409 HTTP response code</a>.</p>
</div>
<div class="paragraph">
<p>Servers SHOULD return this response document and it’s associated HTTP
status of 409, but servers MAY return any document in the response body
along with either a a 404 (Not Found) or a 400 (Bad Request) HTTP
status.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dap4_asynchronous_response_gone">DAP4 Asynchronous Response Gone</h5>
<div class="paragraph">
<p>This document informs clients that a while a previous request for an
asynchronous response has been accepted, the result is <em>no longer</em>
available.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;AsynchronousResponse status="gone"/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This response document MUST be associated with the <a href="#_410_gone_dap4_response_no_longer_available">410
HTTP status code</a>.</p>
</div>
<div class="paragraph">
<p>Servers SHOULD return this response document and it’s associated HTTP
status of 410, but servers MAY return any document in the response body
along with either a a 404 (Not Found) or a 400 (Bad Request) HTTP
status.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dap4_asynchronous_request_rejected">DAP4 Asynchronous Request Rejected</h5>
<div class="paragraph">
<p>This document informs clients that a request for an asynchronous
response has been rejected, even though the client said it is willing to
process an asynchronous response. There are at least as many reasons a
server might reject the request for an asynchronous response as there
are systems that might return such responses. However, this design
provides suggested response codes for cases that seem likely so that
clients can make educated decisions about the reason for the rejection.
The reason codes supported are:</p>
</div>
<div class="paragraph">
<p><strong>time</strong><br>
The client indicated that it was only willing to wait <em>X</em> seconds and
the server thought it would take more time to build the result.</p>
</div>
<div class="paragraph">
<p><strong>unavailable</strong><br>
A needed resource is not available. This might indicate that hardware,
like a robot tape system, cannot be currently accessed.</p>
</div>
<div class="paragraph">
<p><strong>privileges</strong><br>
The client is not allowed to make the request.</p>
</div>
<div class="paragraph">
<p><strong>other</strong><br>
Self evident…</p>
</div>
<div class="paragraph">
<p>In addition to the reason codes, this response will contain a text
description of the reason for rejection.</p>
</div>
<div class="paragraph">
<p>Servers SHOULD make every effort to use the correct reason codes and
provide cogent descriptions.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;AsynchronousResponse status="rejected"&gt;
    &lt;reason code="time"/&gt;
    &lt;description&gt;Acceptable access delay was less than estimated delay.&lt;/description&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This response document MUST associated with the 412 HTTP status code.</p>
</div>
<div class="paragraph">
<p>Servers SHOULD return this response document along with an HTTP status
of 412, but servers MAY return any document in the response body along
with an HTTP status of 404 (Not Found) or of 400 (Bad Request) in its
place.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dap4_error">DAP4 Error</h5>
<div class="paragraph">
<p>If the server encounters an error it must MUST (MAY?) return an HTTP
status of 500 (Internal Error) along with a request body and other
headers compliant with the <a href="#_dap4_error_response">DAP4 Error Response</a>
and <a href="#_status_codes">Status Codes</a> sections of the
<a href="#Web_Services">Web Services Specification</a>. The request should not be repeated.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_2">5.9. Examples</h3>
<div class="sect3">
<h4 id="_constrained_data_request_response_using_get">5.9.1. Constrained Data Request-Response using GET</h4>
<div class="paragraph">
<p>Simple Request</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc?dap4.ce=x,y,temp HTTP/1.1
Host: server.org</pre>
</div>
</div>
<div class="paragraph">
<p>If the server decides it needs to handle this request in an asynchronous
manner, it will refuse the request because it did not say it would
accept an asynchronous response.</p>
</div>
<div class="paragraph">
<p>Response</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">400 DAP Asynchronous Response Required
X-DAP-Async-Required: true
Content-Type: text/xml;charset=UTF-8

&lt;AsynchronousResponse status="required"&gt;
  &lt;expectedDelay seconds="600" /&gt;
  &lt;responseLifetime seconds="3600"/&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_constrained_data_request_response_with_dap_async_accept_request_header">5.9.2. Constrained Data Request-Response with DAP-Async-Accept Request Header</h4>
<div class="paragraph">
<p>Request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc?dap4.ce=x,y,temp HTTP/1.1
Host: server.org
X-DAP-Async-Accept: 0</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, this request would produce the same result using only the
URL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap?dap4.async=0&amp;dap4.ce=x,y,temp HTTP/1.1
Host: server.org</pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">202 Accepted
Content-Type: text/xml;charset=UTF-8

&lt;AsynchronousResponse status="accepted"&gt;
  &lt;expectedDelay seconds="600" /&gt;
  &lt;responseLifetime seconds="3600"/&gt;
  &lt;link href="http://server.org/async/path/result" /&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>NB</strong>: This example originally included an <em>Accept</em> header with the value
of <em>multipart/mixed</em>. However, that is not a good example. The HTTP/1.1
specification says that when a specific media type is indicated as the
only one acceptable, a server must return a 406 response code if it
cannot return that media type. The meaning of <em>Accept: */*</em> is the same
as not including the header, so I have removed the header from these
examples. We need to be heads up in the ways that we suggest that header
should be used by clients</p>
</div>
</div>
<div class="sect3">
<h4 id="_constrained_data_request_response_with_conditional_dap_async_accept_request_headers">5.9.3. Constrained Data Request-Response with conditional DAP-Async-Accept Request Headers</h4>
<div class="paragraph">
<p>Request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc?dap4.ce=x,y,temp HTTP/1.1
Host: server.org
X-DAP-Async-Accept: 60</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, this request would produce the same result using only the
URL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /dap/path/data.nc.dap?dap4.async=60&amp;dap4.ce=x,y,temp HTTP/1.1
Host: server.org</pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">412 Precondition Failed
Content-Type: text/xml;charset=UTF-8

&lt;AsynchronousResponse status="rejected"&gt;
    &lt;reason code="time"/&gt;
    &lt;description&gt;Acceptable access delay was less than estimated delay.&lt;/description&gt;
&lt;/AsynchronousResponse&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_premature_request_for_asynchronous_result">5.9.4. Premature Request For Asynchronous Result</h4>
<div class="paragraph">
<p>Request:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /async/path/data.nc?dap4.ce=x,y,temp HTTP/1.1
Host: server.org</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, this request would produce the same result using only the
URL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">GET /async/path/data.nc?dap4.ce=x,y,temp HTTP/1.1
Host: server.org</pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">409 Conflict
Content-Type: text/xml;charset=UTF-8

&lt;AsynchronousResponse status="pending"/&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_role">5.10. Resource Role</h3>
<div class="paragraph">
<p>DAP4 Asynchronous Responses are identified by the resource role:</p>
</div>
<div class="paragraph">
<p><strong><code>http://services.opendap.org/dap4/async</code></strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_normative_encoding_of_the_asynchronous_response">5.11. Normative Encoding of the Asynchronous Response</h3>
<div class="paragraph">
<p>The normative XML representation for the Asynchronous Response is
defined in Appendix x &#8220;Normative XML Encoding of the Asynchronous
Response&#8221;. The media type for the normative XML representation is:</p>
</div>
<div class="paragraph">
<p><code>application/vnd.opendap.dap4.async.xml</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-extension">6. Extensions: JSON Data and Metadata Encoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is currently no text in this page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deltas">7. Deltas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document contains a collection of emails between the collaborators/developers going back to July 2013, regarding DAP4 and it’s implementation. These all concern links:#Data_Model[Volume 1].</p>
</div>
<div class="sect2">
<h3 id="_constraints_subsetting_unified_syntax">7.1. Constraints, subsetting: unified syntax</h3>
<div class="paragraph">
<p>Dennis and I decided on this syntax for CEs that encompasses simple
projections and array slicing, including when the arrays use shared
dims. No grammar, just examples of what’s allowed and explanations of
what the examples mean.</p>
</div>
<div class="paragraph">
<p>CEs for DAP4</p>
</div>
<div class="paragraph">
<p>CE Syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dataset</span> <span class="attribute-name">name</span>=<span class="attribute-value">t1</span><span class="tag">&gt;</span>
     <span class="tag">&lt;dimension</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span> <span class="attribute-name">size</span>=<span class="attribute-value">20</span><span class="tag">/&gt;</span>
     <span class="tag">&lt;byte</span> <span class="attribute-name">name</span>=<span class="attribute-value">b</span><span class="tag">&gt;</span>
         <span class="tag">&lt;dim</span> <span class="attribute-name">size</span>=<span class="attribute-value">10</span><span class="tag">/&gt;</span>
     <span class="tag">&lt;/byte&gt;</span>
     <span class="tag">&lt;byte</span> <span class="attribute-name">name</span>=<span class="attribute-value">c</span><span class="tag">&gt;</span>
          <span class="tag">&lt;dim</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/byte&gt;</span>
    <span class="tag">&lt;structure</span> <span class="attribute-name">name</span>=<span class="attribute-value">s</span><span class="tag">&gt;</span>
         <span class="tag">&lt;byte</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span><span class="tag">&gt;</span>
             <span class="tag">&lt;dim</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/byte&gt;</span>
         <span class="tag">&lt;byte</span> <span class="attribute-name">name</span>=<span class="attribute-value">e</span><span class="tag">&gt;</span>
              <span class="tag">&lt;dim</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span><span class="tag">/&gt;</span>
              <span class="tag">&lt;dim</span> <span class="attribute-name">size</span>=<span class="attribute-value">5</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/byte&gt;</span>
         <span class="tag">&lt;byte</span> <span class="attribute-name">name</span>=<span class="attribute-value">f</span><span class="tag">&gt;</span>
             <span class="tag">&lt;dim</span> <span class="attribute-name">name</span>=<span class="attribute-value">d</span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/byte&gt;</span>
    <span class="tag">&lt;/structure&gt;</span>
<span class="tag">&lt;/dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some CEs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>b</code><br>
Return just b</p>
</li>
<li>
<p><code>b;c</code><br>
Return both b and c</p>
</li>
<li>
<p><code>b[1:4]</code><br>
Slice <code>b</code> so that only elements 1 through 4 are returned. Since <code>b</code> does not
use a shared dim the special properties of shared dims (sdims) don’t
matter. Although in this case it doesn’t matter</p>
</li>
<li>
<p><code>c[]</code><br>
Return all of <code>c</code> but because a local slicing operation was performed, <code>c</code>
is returned with dim 1 as an anonymous dim, not the sdim &#8216;d&#8217;</p>
</li>
<li>
<p><code>/d=[2:5];c[]</code><br>
Slice the sdim &#8216;d&#8217; using <code>[2:5]</code>. For the variable <code>c</code>, apply that slice
and return the result. In this case <code>c</code> will be shown with the <code>sdmi</code> &#8216;d&#8217;
but that <code>sdim</code> will be of size <code>4</code>. Thus the <em>[]</em> means two different
things for an array with shared dims. Either return the whole dim as if
a local slice was made or since that sdim was sliced (previously in the
CE), use that slice. We use an explicit thing to cover the case where an
array has both sdims and anonymous dims.</p>
</li>
<li>
<p><code>/d=[2:5];/s.d[]</code><br>
Apply the sdim slice to the array &#8216;d&#8217;. Since arrays and dims can have
the same name, we use an <em>=</em> to mean <em>this is a sdim and I’m slicing it</em>
in the CE. This is not a great example of that since the var and sdim
have different FQNs, but it’s possible for them to have the same FQN,
hence the <em>=</em></p>
</li>
<li>
<p><code>/d=[2:5];s.e[][]</code><br>
Similarly, apply the slice to the first dim (using the sdim slice) and
get all of the second dime</p>
</li>
<li>
<p><code>/d=[2:5];s.e[][1:3]</code><br>
Use the sdim slice and apply a slice to the second (anonymous) dim.
really this is the same case as above, but with different values for the
second dim’s slice operator</p>
</li>
<li>
<p><code>/d=[2:5];s.e[1:4][1:3]</code><br>
Return e with two anonymous dims; based on the original sizes. That is,
even though the first dim in the DMR uses the sdim &#8216;d&#8217;, since we’re
using the local slicing operator, we take the 1:4 slice from the
20-element dimension. The only time a sdim slice applies is when an
array is declared as using it in the DMR and <em>[]</em> appears for that dim
in the CE.</p>
</li>
<li>
<p><code>/d=[2:5];s\{d[],f[]}</code><br>
Slicing apples recursively</p>
</li>
<li>
<p><code>/d=[2:5];s.d[];s.f[]</code><br>
Same result as the previous CE</p>
</li>
<li>
<p><code>/d=[2:5];s\{d[],e[][1]}</code><br></p>
</li>
<li>
<p><code>/d=[2:5];s[1:3]\{d,f}</code><br>
This slicing op applies to &#8216;s&#8217; (which makes no sense with the example
dataset; image it does make sense ;-)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CDMR: Will be a subset of the DMR. It may reference shared dims but will
not create any dims</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>seq\{i,j,k} | j &lt; 10</code><br>
This filter, shown with a Sequence <em>seq</em> (not int he example DMR) is
applied to everything in the clause. CEs are made up of clauses
separated by <em>;</em> marks.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_constraints_subsetting_and_maps">7.2. constraints, subsetting and maps</h3>
<div class="paragraph">
<p>Bob Simons sent this:<br>
I liked your talk about OPeNDAP yesterday at ESIP. I especially liked
your phrases &#8220;select by index&#8221;, &#8220;select by coordinate&#8221;, &#8220;select by
value&#8221;. They are useful phrases.</p>
</div>
<div class="paragraph">
<p>I understand and like &#8220;select by index&#8221;. But since it is also useful
to select by coordinate value, it would be great if OPeNDAP 4 would
support the optional syntax &#8220;(value)&#8221; in projection constraints, where
the value is converted to the nearest index. For example,
variable[(startValue):stride:(stopValue)] would be converted by the
server to variable[startIndex:stride:stopIndex] This would allow users
to specify requests</p>
</div>
<div class="paragraph">
<p>For time variables (with units of &#8220;someTimeUnit since someTime&#8221;), it
would be great if the startValue or stopValue could be expressed in
whatever the dimensions units are (e.g., in &#8220;minutes since
1980-01-01&#8221;) <strong>or</strong> as an ISO 8601:2004 &#8220;extended&#8221;) time (e.g.,
1985-12-31T23:59:59Z).</p>
</div>
<div class="paragraph">
<p>This also solves problems with datasets that just offer the latest e.g.,
30 days of data. Currently, if a user requests the time values, finds
the index for a current date, and requests the data with that time
index, the dataset may have changed so that the requested index no
longer has the value the user expects.</p>
</div>
<div class="paragraph">
<p>Is there any chance that the OPeNDAP 4 specification could include the
() notation in projection constraints?</p>
</div>
<div class="paragraph">
<p>Thanks for considering this.</p>
</div>
<div class="paragraph">
<p>And we had a long thread about it:<br>
Dan- I think what might work is the use of functions inside of
projections. e.g. velocity[f(start):stride:f(end)] where f converts
something in say, time or lat or lon to an index. - Dennis</p>
</div>
<div class="paragraph">
<p>Daniel Holloway wrote: Dennis, James, There are several proposals within
the wiki that seem applicable to this problem, what about is it about
this particular problem/solution that breaks the ideas put forth in the
&#8216;filter constraints&#8217; proposal that could not be addressed
(potentially) by extending that idea somewhat? Similarly in the
&#8216;constraint expressions&#8217; proposal, and somewhat less though related in
the &#8216;subset arrays and grids by value&#8217;, granted the problem as stated
is more grid projection using selection by value on the map vectors. Dan
On Jul 16, 2013, at 9:47 PM, Dennis Heimbigner wrote: I must confess to
be intrigued/baffled at Bob’s mixing of time endpoints and index
strides. As for using &#8220;nearest&#8221; even that requires a specification of
rounding.</p>
</div>
<div class="paragraph">
<p>In any case, and to be somewhat cliched, this seems like a job for a
server side function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dennis.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>p.s. coordinate variables are associated with other variables using the
&lt;Map&gt;…&lt;/Map&gt; construct.</p>
</div>
<div class="paragraph">
<p>Dave Fulker wrote: On Tue, Jul 16, 2013 at 9:44 AM, John Caron
&lt;<a href="mailto:caron@unidata.ucar.edu">caron@unidata.ucar.edu</a>&gt; wrote: ok, i understand your concern a bit
better. you are considering the general case where coordinate values are
all over the place. but if they are monotonic, then the user makes a
range request in coordinate space and the server translates this quite
easily into a range request in index space.</p>
</div>
<div class="paragraph">
<p>im pretty sure this is what bob is proposing. By my reading, Bob’s
request does <strong>not</strong> include coordinate values in the stride; he asks for
coordinate-to-index translation only at the interval endpoints and
expects only the <strong>nearest</strong> values there, so interpolation is never
required. If we want to support coordinate values in the stride
argument, some notion of &#8220;nearest&#8221; might be plausible (as Dennis
hints), but I suspect Bob omitted this deliberately. It’s not even clear
to me that monotonicity is a requirement; without it, users could
separate apples from oranges without knowing their indices.  ;-) I
personally think Bob’s notation could be accommodated directly in DAP4
without violating our KISS commitment <strong>if we restrict it to 1-D maps</strong>.
Use with N-D maps strikes me as complicated, and I think it leads to
questions of the sort Nathan raises, so I would not try to bite off that
one (within DAP4). Also, I’m less inclined toward including Bob’s
time-translation request because it involves interpreting the &#8220;units&#8221;
attribute. For me that smacks of extension along the lines Ethan
suggests. Stated another way, I can see the ( ) to [ ] translation as
truly domain independent, but notions of time seem less so. Finally,
could someone remind me: are coordinate maps a formal data type in DAP4,
or are they established via naming conventions? Thanks, Dave On
7/16/2013 9:31 AM, Dennis Heimbigner wrote:</p>
</div>
<div class="paragraph">
<p>Thinking about Nathan’s last comment leads me to dissect this issue a
bit more.</p>
</div>
<div class="paragraph">
<p>Suppose we have the following schema using time as in Bob’s original
request. The lat/lon issue is similar except in 2 dimensions.</p>
</div>
<div class="paragraph">
<p>dimensions: time=… variables:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">float velocity(time);
float time(time);</pre>
</div>
</div>
<div class="paragraph">
<p>If we want to get the time of velocity(i), then we can compute time(i).</p>
</div>
<div class="paragraph">
<p>The inverse of this is to ask for the velocity at time 1/1/13, for
example.</p>
</div>
<div class="paragraph">
<p>If I understand Bob’s suggestion, he is saying one should be able to ask
for velocity(1/1/13) and get the velocity at that time. Or similarly,
ask for the range of velocities(1/1/13:1hr:1/2/13).</p>
</div>
<div class="paragraph">
<p>The problem comes in figuring out to choose which integer indices of the
time dimension are be included in the set given that it may be the case
that none of the values 1/1/13,1/1/13+2hr,…1/2/13 are actually in the
time(time) variable. This means we need to define an algorithm to decide
which indices are in the set and which are out. Finding the initial
starting index requires searching time(time) to find, say, the first i
such that time(i) &gt;= 1/1/13. For each additional point, we need to
either search for another &#8220;closest&#8221; point or interpolate between two
adjacent velocity values based on some pair of covering points in the
time(time) variable.</p>
</div>
<div class="paragraph">
<p>As Nathan points out, we can approximate the above by allowing domain
based query. So we might say \{velocity(x,y)|time(x) &gt;= 1/1/13 &amp;&amp;
time(x) &#8656; 1/2/13} This has at least the advantage of being well defined
and domain independent (more or less). When we met in Boulder, some of
our discussions addressed this kind of query, but no resolution. It is
fair to say, however, that it is still on our agenda.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dennis</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Daniel Holloway wrote:</p>
</div>
<div class="paragraph">
<p>On Jul 16, 2013, at 12:42 AM, Nathan Potter wrote:</p>
</div>
<div class="paragraph">
<p>Isn’t it reasonable to factor out the lat/long coordinate issue? Can we
not consider the two cases: a) Subsetting range values of array or Grid
by value - if a particular value that exists in the Array/Grid fulfills
the selection constraint then it is included in the response.</p>
</div>
<div class="paragraph">
<p>b) Subsetting by Domain value - this I think is what Dennis is
referring to - where the constrained specifies which values in the
domain are acceptable. For the map upon which the constraint is applied
has a value at a particular index i, then all of the requested variables
that utilize that map should have their i’th value included in the
result.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">While I can see how 'b' might be viewed as a special constraint case</pre>
</div>
</div>
<div class="paragraph">
<p>for &#8216;grids&#8217; at some point it becomes a similar problem to constraining
any array by value, that is what are the potential changes to the
response type, if any, (.e.g., sparse array, mask, …).</p>
</div>
<div class="paragraph">
<p>What is actually returned in both cases is the thing I think we would
have to work out (a sparse array? a mask?)</p>
</div>
<div class="paragraph">
<p>I don’t see how interpolation/search comes into it. So maybe Dennis you
could elaborate on your concerns - I’m not following you.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">First, assuming his intent is simply to select array indices of</pre>
</div>
</div>
<div class="paragraph">
<p>the dependent variable based on &#8216;selection by value&#8217; on the
independent, or coordinate, variables using only the values in the
coordinate variables themselves, that is, (.e.g., not supporting iso8601
time-values in the constraints and expecting conversion to
seconds-since-1970). Then minimally there’s the issue at the boundaries
for any particular extent, or when discrete values are requested when
the domain variable (in OGC parlance) is a coverage and not a point. So,
regardless of geo or any specific domain there will be some extent of
interpolation and/or search, and how that is communicated in the
response. Also, in DAP-4 we’re extending grid map-vectors to be
n-dimensional, though typically size 1 or 2 is my guess, so the
resulting shape for constrained variables will become quite important to
the end-user client.
- Dan</p>
</div>
<div class="paragraph">
<p>Thanks, Nathan</p>
</div>
<div class="paragraph">
<p>On Jul 15, 2013, at 6:27 PM, Dennis Heimbigner wrote:</p>
</div>
<div class="paragraph">
<p>Remember that what was being proposed is to map from the specification
of a geo lat/long range to a set of integer indices. The inverse is not
a problem (IMO). Going from lat/long to indices requires, I think,
algorithms to deal with interpolation and search. I do not think,
personally, that there is likely to be any agreement about which
algorithms to use.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dennis</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nathan Potter wrote:</p>
</div>
<div class="paragraph">
<p>I think it’s not a coordinates question but a select/subset by value
question. If we limit our view of the problem to just subsetting arrays,
Grids, and Sequences then I think if we solve the resulting data model
issues (sparse arrays? masks? etc.) then we might have something really
useful. And I don’t think it adds a huge burden of thought or work.
Unless of course I am mistaken and the possible result space turns out
to be awful to represent. Nathan On Jul 15, 2013, at 4:38 PM, John Caron
wrote:</p>
</div>
<div class="paragraph">
<p>Im not so sure, it might be very low hanging fruit. Note that it doesnt
require georeferencing or feature types, just coordinates (maps). On the
grid data type, i think all the semantics are already there. OTOH, it
would require some clarifications.</p>
</div>
<div class="paragraph">
<p>On 7/15/2013 4:00 PM, Ethan Davis wrote:</p>
</div>
<div class="paragraph">
<p>I agree with Dennis on this one.</p>
</div>
<div class="paragraph">
<p>While Bob’s proposal is very simple and elegant in its request encoding,
it assumes things outside of the core DAP4 data model. So, to my mind it
doesn’t belong in the core specification.</p>
</div>
<div class="paragraph">
<p>It might make a good extension. But it would need to be fleshed out. It
would need a few extensions to the DMR. For example, a way to indicate
when it can be used (which datasets, which arrays, which dimensions).
And, as Dennis mentions, the same for the interpolation algorithm.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ethan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On 7/15/2013 1:12 PM, Dennis Heimbigner wrote:</p>
</div>
<div class="paragraph">
<p>For what its worth, my philosphy here is that DAP4 is intended to be the
lowest level representation for data. Any additional semantics such as
geographical coordinates and more generally feature types should be
implemented on top of DAP4. The relatively simple semantics of DAP4
should not be made more complicated by embedding feature types. For
example, embedding geographical coordinates requires defining the
interpolation algorithm as part of the standard. If some other algorithm
is desired, then how is that to be supported?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dennis</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dave Fulker wrote:</p>
</div>
<div class="paragraph">
<p>Here’s Bob Simons’ reply to my request for his ESIP slides. I think that
the perspective he presents (note, e.g., the slide that he titled
&#8220;Don’t Treat In-Situ/Tabular Data Like Gridded Data&#8221;) should inform
our thinking as we finalize DAP4. – Dave</p>
</div>
</div>
<div class="sect2">
<h3 id="_response_information">7.3. response information</h3>
<div class="paragraph">
<p>We started down this path, then left it hanging, I think:
<a href="http://docs.opendap.org/index.php/DAP4:_Inclusion_of_response_metadata_in_the_DMR" class="bare">http://docs.opendap.org/index.php/DAP4:_Inclusion_of_response_metadata_in_the_DMR</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_url_query_string_keyvalue_notation">7.4. using the url query string key=value notation</h3>
<div class="paragraph">
<p>Gallagher James wrote: Dennis, I’m thinking about, but have not really
worked thorough, the idea that DAP4 will separate server functions from
the Constraint Expression by passing those two things into the servers
using different key names in the query string. Something like &#8216;URL ?
eval = &lt;functions&gt; &amp; ce = &lt;constraint expr&gt;&#8217;. The semantics of this
would be that the &lt;functions&gt; (whatever that turns out to be) are
evaluated first and then the &lt;constraint expr&gt; is applied to the result.
If the &#8216;eval=&lt;functions&gt;&#8217; part of the query string is not given then
the constraint is applied to the dataset (and if the constraint is not
given the dataset is just returned in toto). Does this seem reasonable
to you?<br>
I am not sure. My immediate reaction is to ask how the client will know
what kind of constraint to write in the presence of an &#8216;eval=&#8217;; that
is, what is the DMR against which the constraint is written? - Dennis</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">We should elaborate on what the different keys might mean. _eval_ would
run a function(s) and produce a virtual dataset. The server would return
the DMR, etc., for that</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sequences_with_structures_and_the_resulting_ces">7.5. sequences with structures and the resulting CEs</h3>
<div class="paragraph">
<p>James Gallagher wrote: On Aug 2, 2013, at 7:04 PM, Dennis Heimbigner
wrote: Yes I did intend to allow nesting of Sequences and Structures. I
suspect that in the implementation I will come to regret it, but until
then…. My guess is that’s not so bad, but, I think we should our filters
to &#8216;id op constant&#8217; (and the positional variants) and not support &#8216;id
op id&#8217;. Or limit the latter case based on the scope of the ids (but I’d
rather not support it at all). James<br>
That sounds right to me; we can always extend it later if there is
sufficient reason Dennis</p>
</div>
</div>
<div class="sect2">
<h3 id="_basic_testing_support">7.6. basic testing support</h3>
<div class="paragraph">
<p>We might make a collection of DMR files available for debugging/testing</p>
</div>
</div>
<div class="sect2">
<h3 id="_fqns_in_a_dmrdata_response">7.7. FQNs in a DMR/Data response</h3>
<div class="paragraph">
<p>Gallagher James wrote: Are the Dim, Map and Enum elements’ name
attributes always FQNs? So &lt;Dim name=&#8220;x&#8221;/&gt; is never valid and should
always be a FQN like: &lt;Dim name=&#8220;/x&#8221;/&gt; ?<br>
Dennis: That is what I put in the spec. The argument is that it is
easier for machines while still making it reasonably readable by a
person.</p>
</div>
</div>
<div class="sect2">
<h3 id="_augment_the_vol1_spec_with_details_about_ce_effects_on_a_dmr">7.8. augment the vol1 spec with details about CE effects on a DMR</h3>
<div class="paragraph">
<p>It occurs to me that we need to augment our proposed constraint
expression grammars with a description of what kinds of DMRs will result
from our proposed constraints.</p>
</div>
<div class="paragraph">
<p>That is, given a constraint and a DMR for the unconstrained dataset,
describe the DMR that corresponds to the result of applying the
constraint.</p>
</div>
<div class="paragraph">
<p>To that end, I have put up a new proposal based on describing rules for
constructing the DMR that results from a constraint.
<a href="http://docs.opendap.org/index.php/DAP4:_Alternate_Proposal_for_a_Constraint_Expression_Syntax" class="bare">http://docs.opendap.org/index.php/DAP4:_Alternate_Proposal_for_a_Constraint_Expression_Syntax</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_sequence_serialization_how_to_serialize_a_zero_length_sequence">7.9. sequence serialization: how to serialize a zero-length sequence</h3>
<div class="paragraph">
<p>Gallagher James wrote: Dennis, Looking at Sequence and thinking about CE
evaluation: When there’s a nested Sequence like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Seq {
 Int32 i;
 Int32 j;
 Seq {
    Int32 k;
    Int32 l;
 } inner;
} outer;</pre>
</div>
</div>
<div class="paragraph">
<p>And a CE requests all of outer (which means inner too) such that k &gt; 10,
what should be sent when k is not &gt; 10? Should i and j still be sent and
an empty inner (so the count would be 0)? This would be my preference
since the alternative is very tricky to code. Is that your
understanding?<br>
Dennis: Yes, a count of zero should be allowed.<br>
also: My recollection is that we decided to only allow filtering based
on the outermost variables (i and j in this case) and filtering based on
k would be illegal. Maybe we should revisit this decision. the best
alternative I can think of in this case is that all records in outer are
kept and all records in inner are filtered (for each record in outer).</p>
</div>
<div class="paragraph">
<p><strong>nb</strong>: This is a big deal for nested sequences because it you were to
require that zero-length child sequences suppress the serialization of
their parent sequence (as was the case with DAP2) the code to handle the
sequence serialization becomes very complex. We made the correct
decision here to allow child sequences to be zero length</p>
</div>
</div>
<div class="sect2">
<h3 id="_ieee_754_for_real_numbers">7.10. IEEE 754 for real numbers</h3>
<div class="paragraph">
<p>Gallagher James wrote: Dennis, When we adopted &#8216;reader make right&#8217; we
mostly talked about byte order; do you handle the case where one of the
two hosts does not use IEEE754 for either 32 or 64 bit reals?<br>
Reader makes it right was intended to apply only to byte order. We
should indeed enforce use of 754 as the only acceptable format. -Dennis</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_big_are_arrays_64_bits_63_bits_61_bits_signed_unsigned">7.11. how big are arrays? 64 bits? 63 bits? 61 bits? signed? unsigned?</h3>
<div class="paragraph">
<p>Gallagher James wrote: I’m wondering what type should be used to hold
the number of elements in an array. I can’t find where in the spec it
says how big an array can be - is it an unsigned 64bit number of
elements? Or unsigned 32 bits?<br>
Dennis: it is a signed 64 bit integer.<br>
Yes signed. The argument is that interpretive languages (Java, python…)
are not good at handling unsigned 64 bit numbers, so I chose to stick to
signed 64 bit integer, which is effectively a 63 bit int We need to fix
the text. Here’s what the dc says: … The total number of elements in an
Array MUST NOT exceed \$2^(64)-1\$.</p>
</div>
<div class="paragraph">
<p>In the telecon we decided that the make number of elements was \$2^(61)-1\$.
We decided that the number of bytes for an array should never be more
than \$2^(64)-1\$ bytes (because the size needs to be signed because Java and
Python don’t grok unsigned ints) and because C code will need to malloc
these and malloc won’t take more than a 64-bit int.</p>
</div>
</div>
<div class="sect2">
<h3 id="_about_the_end_chunk_in_a_chunked_response">7.12. About the end chunk in a chunked response</h3>
<div class="paragraph">
<p>Dennis, I’m tweaking my code to process the chunked responses and
thinking about what the end chunk means. Does the end chunk mean that
once any data it contains has be consumed EOF has been reached? Or is it
possible to have more data chunks (or an error chunk) after an end
chunk? James<br>
I believe the rule is that any sequence of chunks must stop at the first
end chunk or error chunk. The end chunk may or may not contain data. - Dennis</p>
</div>
</div>
<div class="sect2">
<h3 id="_where_we_encode_the_byte_order_for_a_dap4_data_response">7.13. where we encode the byte order for a DAP4 Data response</h3>
<div class="paragraph">
<p>On Sep 10, 2013, at 10:06 AM, Dennis Heimbigner &lt;<a href="mailto:dmh@unidata.ucar.edu">dmh@unidata.ucar.edu</a>&gt;
wrote: I think we agreed to put the serialization byte order in the http
headers. Do you want to revisit that decision? =Dennis<br>
Yes. There’s another part of the spec that says the response
document/body is all you need to read (of course, you need the spec too)
the document. The HTTP headers are generally lost by the time a client
gets the response body, so I think the byte order should go in the
response body somewhere. James<br>
ok with me. One possibility is a new flag in the chunk headers. -Dennis</p>
</div>
</div>
<div class="sect2">
<h3 id="_order_of_stuff_in_the_dmr">7.14. Order of stuff in the DMR</h3>
<div class="paragraph">
<p>Gallagher James wrote: On Sep 5, 2013, at 9:30 AM, Dennis Heimbigner
wrote: I recall that we placed limits on which dimensions and maps and
enums could be referenced to be something in the same group or an
enclosing group. Given that, we could do this order: dimensions, enums,
variables, groups because the above rule would guarantee no forward
reference.<br>
OK, lets adopt this and change the grammar to reflect it. I’ll change
the rng file and check it in. As for group attributes, currently, I
print them at the very end of the group, but this is easily changed. I
would suggest however, that they be either at the very beginning or the
very end of the group. My vote is to put them at the end. =Dennis<br>
More info - we have adopted this as the correct order, although it
should be said that any order so long as everything is &#8216;defined before
use&#8217; is acceptable:<br>
For Atomic Variables I propose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dimension references</p>
</li>
<li>
<p>Attributes</p>
</li>
<li>
<p>maps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Seq/Struct I propose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>fields</p>
</li>
<li>
<p>dim references</p>
</li>
<li>
<p>Attributes</p>
</li>
<li>
<p>maps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DMR Order of stuff… Personally, I think the best order is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dimdefs</p>
</li>
<li>
<p>enumdefs</p>
</li>
<li>
<p>variables</p>
</li>
<li>
<p>attributes</p>
</li>
<li>
<p>groups</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This keeps all of the per-group stuff (enum,dim,var,attr) together and
then the subgroups after that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitations_on_the_dmr_dim_element">7.15. limitations on the DMR Dim element</h3>
<div class="paragraph">
<p>Gallagher James wrote: Dennis, In an array in DAP4, Can a Dim element
have both a name and a size? Is the name limited to only names of shared
Dimension elements (previously defined)? James<br>
Limited to previously defined dimensions. You can only specify a size
within an array. - Dennis</p>
</div>
</div>
<div class="sect2">
<h3 id="_names_2">7.16. names</h3>
<div class="paragraph">
<p>Gallagher James wrote: Dennis, You might have guessed that my previous
question relates to looking up things (groups, variables, dimensions)
based on their FQN. Are we allowing a Group and a variable, for example,
to have the same name at the same lexical level (I hope not)? James<br>
I have assumed that yes, two decls of different kinds can have the same
name. This is obviously true for dimensions and variables, so I assumed
it held generally. Why is this causing a problem? - Dennis</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-10-31 21:34:01 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>