<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="2024-10-23">
<title>DAP4 Volume 1 : Data Model and Serialized Representation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>DAP4 Volume 1 : Data Model and Serialized Representation</h1>
<div class="details">
<span id="author" class="author">2024-10-23</span><br>
<span id="revdate">The Data Access Protocol</span>
<br><span id="revremark">DAP Version 4.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_requirements">2. Requirements</a></li>
<li><a href="#_overall_operation">3. Overall Operation</a></li>
<li><a href="#_characterization_of_a_data_source">4. Characterization of a Data Source</a></li>
<li><a href="#_dmr_declarations">5. DMR Declarations</a>
<ul class="sectlevel2">
<li><a href="#_dmr_xml_format">5.1. DMR XML Format</a></li>
<li><a href="#_names">5.2. Names</a></li>
<li><a href="#_reserved_names">5.3. Reserved Names</a></li>
<li><a href="#_fully_qualified_names">5.4. Fully Qualified Names</a></li>
<li><a href="#_fqn_references">5.5. FQN References</a></li>
<li><a href="#_definitional_declarations_versus_data_bearing_declarations">5.6. Definitional Declarations versus Data-Bearing Declarations</a></li>
<li><a href="#_dataset">5.7. Dataset</a></li>
<li><a href="#_groups">5.8. Groups</a></li>
<li><a href="#_dimensions">5.9. Dimensions</a></li>
<li><a href="#_enumeration_types">5.10. Enumeration Types</a></li>
<li><a href="#_atomic_types">5.11. Atomic Types</a></li>
<li><a href="#_container_types">5.12. Container Types</a></li>
<li><a href="#_variables">5.13. Variables</a></li>
<li><a href="#_attributes_and_arbitrary_xml">5.14. Attributes and Arbitrary XML</a></li>
<li><a href="#_namespaces">5.15. Namespaces</a></li>
</ul>
</li>
<li><a href="#_data_representation">6. Data Representation</a>
<ul class="sectlevel2">
<li><a href="#_response_format">6.1. Response Format</a></li>
<li><a href="#_the_dap4_serialized_representation">6.2. The DAP4 Serialized Representation</a></li>
<li><a href="#_example_responses">6.3. Example responses</a></li>
</ul>
</li>
<li><a href="#_dap4_chunked_data_representation">7. DAP4 Chunked Data Representation</a>
<ul class="sectlevel2">
<li><a href="#_chunked_format_grammar">7.1. Chunked Format Grammar</a></li>
<li><a href="#_lexical_structure">7.2. Lexical Structure</a></li>
</ul>
</li>
<li><a href="#_constraints">8. Constraints</a>
<ul class="sectlevel2">
<li><a href="#_terminology_used_by_this_section">8.1. Terminology used by this section</a></li>
<li><a href="#_subsetting_constraints">8.2. Subsetting Constraints</a></li>
<li><a href="#_array_subsetting_in_index_space">8.3. Array Subsetting in Index Space</a></li>
<li><a href="#_array_subsetting_with_disjoint_index_subsets">8.4. Array subsetting with Disjoint Index Subsets</a></li>
<li><a href="#_how_sequences_fit_into_this_syntax">8.5. How Sequences fit into this syntax</a></li>
<li><a href="#_subsetting_and_shared_dimensions">8.6. Subsetting and Shared Dimensions</a></li>
<li><a href="#_constrained_dmr_objects">8.7. Constrained DMR Objects</a></li>
<li><a href="#_filters">8.8. Filters</a></li>
<li><a href="#_filters_and_more_complex_data_types">8.9. Filters and more complex data types</a></li>
</ul>
</li>
<li><a href="#_references">9. References</a></li>
<li><a href="#_appendices">10. Appendices</a>
<ul class="sectlevel2">
<li><a href="#_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">10.1. Appendix 1. DAP4 DMR Syntax as a RELAX NG Schema</a></li>
<li><a href="#_appendix_2_dap4_relax_ng_lexical_elements">10.2. Appendix 2. DAP4 RELAX NG Lexical Elements</a></li>
<li><a href="#_appendix_3_dap4_type_definitions">10.3. Appendix 3. DAP4 Type Definitions</a></li>
<li><a href="#_appendix_4_utf_8">10.4. Appendix 4. UTF-8</a></li>
<li><a href="#_appendix_5_lalr1_grammar_for_dmr_using_bison_notation">10.5. Appendix 5. LALR(1) Grammar for DMR using Bison Notation</a></li>
<li><a href="#_appendix_6_lalr1_grammar_for_constraints_using_bison_notation">10.6. Appendix 6. LALR(1) Grammar for Constraints using Bison Notation</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Copyright 2016</strong> <a href="https://www.ucar.edu/">UCAR</a> and <a href="https://www.opendap.org/">OPeNDAP,Inc</a>.</p>
</div>
<div class="paragraph">
<p>Distribution of this document is unlimited.</p>
</div>
<div class="paragraph">
<p>This document takes material from the DAP2 specification and the OPULS
Wiki page.</p>
</div>
<div class="paragraph">
<p><strong><em>Abstract</em></strong>
<em>This document defines the Data Access Protocol (DAP) version 4.0
(referred to also as DAP4). This data transmission protocol is intended
to supersede all previous versions of the DAP protocol. DAP4 is designed
specifically for science data, but it is intended to be discipline
neutral. The protocol relies on widely used and stable standards, and is
capable of representing a wide variety of scientific data types.</em></p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 1. <strong>Contributors</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>First Draft</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May 24, 2012.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Last Revised:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 February 2016</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Final</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Authors</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John Caron (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethan Davis (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">David Fulker (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">James Gallagher (OPeNDAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dennis Heimbigner (Unidata)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nathan Potter (OPeNDAP)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 2. <strong>Timeline of changes.</strong></caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Draft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added specification of chunk order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added specification and interpretation of simple queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion about nested sequences.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.05.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formatting changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed serialized representation sections and constraint sections until James provides direction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merge all changes from Gallagher, Potter, and Caron, except as noted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed all references to Sequences.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserted James’ version of serialized representation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added DMR RELAX-NG Grammar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added (semi-)formal description of the DAP4 serialization scheme.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.6.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added: (1) Revised Char type (2) Revised unlimited dimension rules (3)
revised MAP rules. (4) Removed HTTP references</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion of identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added discussion of XML escaping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix discrepancies between the formal definition of the on-th-wire format and the examples.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.7.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed UByte and made Byte == UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.8.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added draft constraints section</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.8.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improved the discussion of named slices in constraints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.9.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minor change to the grammar for simple constraints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.9.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated the Data Response section so that it no longer mentions
Multipart MIME; edited the sections on FQNs and Attributes. I’ve added &#8216;nested attributes&#8217; back into the text. I also added &#8216;Sequence&#8217; in several places where we will need it once we’ve worked out how those are to be handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integrate James&#8217;s changes with recent changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rebuild the .docx because of repeated Word crashes; minor formatting
info changed/lost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012.11.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a Dataset construct to make the root group concept clear syntactically.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.3.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Made unlimited into a boolean attribute because it does have a size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserted the new checksum description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed all mention of unlimited wrt Dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove the base and ns attributes from &lt;Dataset&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.4.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introduce &lt;Sequence&gt; as a replacement for variable length dimensions;
The term Sequence is subject to future change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.10.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clarify the maximum number of elements as a function of the maximum
number of bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.10.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforce a specific order on declarations in a Group body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.11.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added sections for DSR, Async, and Error responses and their schemas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013.11.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specified the case sensitivity of XML element names and XML attribute
names</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014.07.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make a pass to clean up and clarify (dmh)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.02.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rollback to version of 2015.12.16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.02.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add back the multiple disjoint slice subset. Provide a general mechanism for arbitrary reserved names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.10.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add _DAP4_Little_Endian attribute to the DMR to reflect the bytorder
used to encode the serialized data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.12.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forgot to mention adding the special names section (5.3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016.12.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clarified the reserved names section (5.3) to say that all names
beginning with “_” are reserved, but that the reverse DNS case is preferred.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification defines the protocol referred to as the Data Access
Protocol, version 4.0 (&#8220;DAP4&#8221;). In this document &#8216;DAP&#8217; refers to
DAP4 unless otherwise noted.</p>
</div>
<div class="paragraph">
<p>DAP is intended to be the successor to all previous versions of the DAP
(specifically DAP version 2.0). The goal is to provide a very general
data model capable of representing a wide variety of existing data sets.</p>
</div>
<div class="paragraph">
<p>The DAP builds upon a number of existing data representation schemes.
Specifically, it is influenced by CDM [<a href="#ref1">1</a>], HDF5 [<a href="#ref2">2</a>], DAP version 2.0 [<a href="#ref3">3</a>], and netCDF-4 [<a href="#ref4">4</a>].</p>
</div>
<div class="paragraph">
<p>The DAP is a protocol for access to data organized as variables. It is
particularly suited to accesses by a client computer to data stored on
remote (server) computers that are networked to the client computer. DAP
was designed to hide the implementation of different collections of
data. The assumption is that a wide variety of data sets using a wide
variety of data schemas can be translated into the DAP protocol for
transmission from the server holding that dataset to a client computer
for processing.</p>
</div>
<div class="paragraph">
<p>It is important to stress the discipline neutrality of the DAP and the
relationship between this and adoption of the DAP in disciplines other
than the Earth sciences. Because the DAP is agnostic as relates to
discipline, it can be used across the very broad range of data types
encountered in oceanography - biological, chemical, physical and
geological. There is nothing that constrains the use of the DAP to the
Earth sciences.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements">2. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL
NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221; and
&#8220;OPTIONAL&#8221; in this document are to be interpreted as described in RFC
2119 [<a href="#ref5">5</a>].</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_operation">3. Overall Operation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DAP is a stateless protocol that governs clients making requests
from servers, and servers issuing responses to those requests. This
section provides an overview of the requests and responses (i.e. the
messages) that DAP-compliant software MUST support. These messages are
used to request information about a server and data made accessible by
that server, as well as requesting data values themselves.</p>
</div>
<div class="paragraph">
<p>For every data resource the DAP defines a number of responses that may
elicited by a client. These responses provide services information (i.e.
capabilities), structural/semantic descriptions, data access timing and
error information.</p>
</div>
<div class="paragraph">
<p>The Dataset Services Response (DSR) provides a &#8216;Services&#8217; or
&#8216;Capabilities&#8217; response for the DAP. Dereferencing an unadorned DAP
dataset resource URL will return a document describing the DAP services
available for the dataset.</p>
</div>
<div class="paragraph">
<p>The DAP utilizes two responses to represent semantic structural
description and data content of a data source. One response, called the
DMR, returns metadata information describing the structure of a request
for data. That is, it characterizes the variables, their datatypes,
names and attributes. The second response, the Data Response, returns
both the metadata about the request, but also the data that was
requested. The DMR and the metadata part of the Data Response are
represented using a specific XML representation[<a href="#ref16">16</a>]. The syntax of that
representation is defined elsewhere in this document (Section
<a href="#_fully_qualified_names">5.4</a>).</p>
</div>
<div class="paragraph">
<p>The DAP returns error information using an Error response. If a request
for any of the three basic responses cannot be completed then an Error
response is returned in its place.</p>
</div>
<div class="paragraph">
<p>The two responses (DMR and Data Response) are complete in and of
themselves so that, for example, a client can use the data response
without ever requesting either of the two other responses. In many
cases, client programs will request the DMR response first before
requesting the Data Response but there is no requirement they do so and
no server SHALL require that behavior on the part of clients.</p>
</div>
<div class="paragraph">
<p>Operationally, communication between a DAP client and a DAP server uses
some underlying already existing protocol, most typically HTTP. Volume 2
of this specification discusses how the DAP should utilize HTTP.</p>
</div>
<div class="paragraph">
<p>In addition to these data objects, a DAP server MAY provide additional
&#8220;services&#8221; which clients may find useful. For example, many
DAP-compliant servers provide HTML-formatted representations or ASCII
representations of a data source’s structure and data. Such additional
services are discussed in Volume 2 of this specification.</p>
</div>
<div class="paragraph">
<p>The DAP specification also defines extensions to the protocol and
representing important, but optional, capabilities. At least the
following extensions have been defined. 1. Asynchronous Response. The
DAP Asynchronous Response is returned to a client when the requested
resource (DMR, Data Response, etc.) is not immediately available and by
making a specific request that it be made available the server is able
to retrieve it. If the client makes the &#8220;retrieve it&#8221; request the
server will inform the client through a subsequent Asynchronous Response
when and where the client may access the requested resource. 2. CSV Data
Encoding. The DAP4 CSV data encoding represents DAP4 data as structured
Comma-Separated Values (CSV) in UTF-8 text. Though based on the text/csv
media type described in RFC 4180[<a href="#ref18">18</a>], the DAP4 CSV is more complex
so that it can fully represent the more complex data structures of the
DAP4 data model. Some structure beyond simple CSV is necessary to
capture the DAP4 data structures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_characterization_of_a_data_source">4. Characterization of a Data Source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DAP characterizes a data source as a collection of variables,
dimensions, and enumeration types. Each variable consists of a name, a
type, a value, and a collection of Attributes. Dimensions have a name
and a size. Enumerations list names and values of the enumeration
constants. These elements may be grouped into collections using the
concept of a &#8220;group&#8221; that has an identifier and defines a naming scope
for the elements within it. Groups may contain other groups.</p>
</div>
<div class="paragraph">
<p>The distinction between information in a variable and in an Attribute is
somewhat arbitrary. However, the intention is that Attributes hold
information that aids in the interpretation of data held in a variable.
Variables, on the other hand, hold the primary content of a data source.</p>
</div>
<div class="paragraph">
<p>Section <a href="#_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">10.1</a> provides a formal
syntax for DAP DMR characterizations. It is defined using the RelaxNG
standard [<a href="#ref13">13</a>] for describing the context-free syntax of a class of XML
documents, the DMR in this case. It should be noted that any syntax
specification requires a specification of the lexical elements of the
syntax. The XML specification [<a href="#ref16">16</a>] provides most of the lexical context
for the syntax, but there are certain places where additional lexical
elements must be used. Section <a href="#DAP4_Lexical_Elements">11</a> describes
those additional lexical elements, and those elements are discussed at
appropriate points in this specification.</p>
</div>
<div class="paragraph">
<p>Since the syntax is context-free, there are semantic limitations on what
is legal in a DMR. These semantic limitations are noted at appropriate
places in the following documentation. It should also be noted that if
there are conflicts between what is described here and the RelaxNG
syntax, then the syntax takes precedence.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dmr_declarations">5. DMR Declarations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dmr_xml_format">5.1. DMR XML Format</h3>
<div class="paragraph">
<p>Element and Attribute Names<br>
Within the DMR XML document, it is assumed that XML element and XML
attribute names are case sensitive.</p>
</div>
<div class="paragraph">
<p>Character Escapes
Any string of characters appearing within an XML attribute in the DMR
must apply the standard XML escapes. Specifically, any attribute value
containing any of the following characters must replace them with the
corresponding XML escape form.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Character</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Escaped Form</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;amp</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;lt</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;gt</code>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">“</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;quot</code>;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So for example, given the occurrence of the attribute &#8216;name=&#8220;&amp;&lt;&gt;&#8221;&#8217;
it must be re-written to this form &#8216;name=&#8220;&amp;&lt;&gt;&#8221;&#8217;.</p>
</div>
</div>
<div class="sect2">
<h3 id="_names">5.2. Names</h3>
<div class="paragraph">
<p>A name (aka identifier) in DAP4 consists of a sequence of any legal
non-control UTF-8 characters. A control character is any UTF-8 character
in the inclusive range 0x00 — 0x1F. Names are case sensitive.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reserved_names">5.3. Reserved Names</h3>
<div class="paragraph">
<p>Any name that begins with the character sequence &#8220;_&#8221; is considered
reserved. Note that if the receiver encounters such a name and has no
information on how to process the name, it may at its discretion either
ignore the object with that name, or it may treat the name as an
ordinary name.</p>
</div>
<div class="paragraph">
<p>A special case is when the &#8220;_&#8221; is followed by a reverse DNS name
defining both the definer of that reserved name and possible additional
naming information. This form of reserved name is preferred because it
provides information about the organization that defined it.</p>
</div>
<div class="paragraph">
<p>A (reverse) DNS name is of this syntactic form.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DNS = &lt;name&gt; | DNS '.' &lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>An example might be &#8220;edu.ucar.unidata.NAME1.NAME2…&#8221;. This indicates
the owner/definer of that name is &#8220;edu.ucar.unidata&#8221; and that the
additional naming information (“NAME1.NAME2…) has meaning to the owner
for defining the semantics of the so-named object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fully_qualified_names">5.4. Fully Qualified Names</h3>
<div class="paragraph">
<p>Every object in a DAP4 Dataset has a Fully Qualified Name (FQN), which
provides a way to unambiguously reference declarations in a dataset and
which can be used in several contexts such as in the DMR in a constraint
expression (see Section <a href="#Constraints">8</a>).</p>
</div>
<div class="paragraph">
<p>These FQNs follow the common conventions of names for lexically scoped
identifiers. In DAP4 several kinds of lexical items provide lexical
scoping: Dataset, Groups, Structures, Sequences, Enumerations, and
AttributeSets. Just as with hierarchical file systems or variables in
many programming languages, a simple grammar formally defines how the
names are built using the names of the FQN’s components (see Section
<a href="#FQN_Syntax">10</a>).</p>
</div>
<div class="paragraph">
<p>The FQN for a &#8220;top-level&#8221; variable — as opposed to e.g. a field in a
structure or sequence — is defined purely by the sequence of enclosing
groups plus the variable’s simple name. This also holds for Enumeration
declarations.</p>
</div>
<div class="paragraph">
<p>Consider the following simple dataset, which contains a Structure named
&#8220;inner&#8221; within a Structure named &#8220;outer&#8221; all contained in the
Dataset &#8220;D&#8221;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"D"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"places"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;String</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"weather"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"temperature"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"dew_point"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Structure&gt;</span>
    <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The FQN for the field &#8216;temperature&#8217; is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>'/places.weather.temperature'.</pre>
</div>
</div>
<div class="paragraph">
<p>Substituting the keyword <em>Sequence</em> for one or more occurrences of
<em>Structure</em> in the above example will leave the FQNs unchanged. Note
that the name of the dataset (&#8220;D&#8221;) is not included; it is implied by
the leading &#8220;/&#8221;.</p>
</div>
<div class="paragraph">
<p>As is the case with Structure or Sequence variables, Groups can be
nested to form hierarchies, too, and this example shows that case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"D"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Group</span> <span class="na">name=</span><span class="s">"environmental_data"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"places"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;String</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"weather"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"temperature"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"dew_point"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/Sequence&gt;</span>
        <span class="nt">&lt;/Structure&gt;</span>
     <span class="nt">&lt;/Group&gt;</span>
     <span class="nt">&lt;Group</span> <span class="na">name=</span><span class="s">"demographic_data"</span><span class="nt">&gt;</span>
         ...
     <span class="nt">&lt;/Group&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The FQN to the field &#8216;temperature&#8217; in the dataset shown is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>'/environmental_data/places.weather.temperature'.</pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of a different separator character — &#8220;.&#8221; instead of &#8220;/&#8221;
— once we enter the scope of a structure (or sequence).</p>
</div>
<div class="paragraph">
<p>Enumeration constants are treated similarly to fields. Consider this
example.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;Dataset name="DE"&gt;
    &lt;Enumeration name="e"&gt;
        &lt;EnumConst name="v1" value="5"/&gt;
    &lt;/Enumeration&gt;
&lt;/Dataset&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The FQN for the &#8220;v1&#8221; constant in &#8220;e&#8221; is as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/e.v1</pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every dataset has a single outermost &lt;Dataset&gt; declaration, which
semantically, acts like the root group. Whatever name that dataset has
is ignored for the purposes of forming the FQN and instead is treated as
if it has the empty name (““).</p>
</li>
<li>
<p>There is no limit to the nesting of groups or the nesting of
Structures or the nesting of Sequences. Enumerations cannot be nested.</p>
</li>
<li>
<p>Reserved names (see above) inherently contain characters (&#8216;.&#8217;) that
will require escaping.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The characters &#8220;/&#8221; and &#8220;.&#8221; have special meaning in the context of a
fully qualified name. This means that if a name is added to the FQN and
that name contains either of those two characters, then those characters
must be specially escaped so that they will not be misinterpreted. The
defined escapes are as follows.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Character</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Escaped Form</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\blank</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the escape character itself must be escaped. Also note that
this form of escape using &#8216;\&#8217; is independent of any required XML
escape (Section <a href="#XML_Escaping_Within_the_DMR">5.1</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_fqn_references">5.5. FQN References</h3>
<div class="paragraph">
<p>DAP4 imposes the rule that the definition of any object (e.g. dimension,
group, or enumeration) must occur before any reference to that object.
This rule also applies within a group, which in turn implies that, for
example, all dimensions must be declared before all variables that
reference them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_definitional_declarations_versus_data_bearing_declarations">5.6. Definitional Declarations versus Data-Bearing Declarations</h3>
<div class="paragraph">
<p>The declarations in a DMR can be grouped into two classes. One class is
<em>definitional</em>. That is, it defines metadata that is used in the rest of
the DMR. These definitional declarations are Groups (including the outer
Dataset), Dimensions, and Enumerations. Such declarations do not contain
data values themselves, although they may define constants such as the
dimension size. The data-bearing declarations are Variables and
Attributes. These elements of the data model are used to house data
values or semantic metadata read from the dataset (or, in the latter
case) synthesized from the values and standards/conventions that the
dataset is known to follow.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dataset">5.7. Dataset</h3>
<div class="paragraph">
<p>Every DMR contains exactly one Dataset declaration. It is the outermost
XML element of the DMR.</p>
</div>
<div class="paragraph">
<p>A dataset is specified using this XML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"..."</span> <span class="na">dapVersion=</span><span class="s">"..."</span> <span class="na">dmrVersion=</span><span class="s">"..."</span><span class="nt">&gt;</span>
...
<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>name</em>, <em>dapVersion</em>, and <em>dmrVersion</em>, attributes are required. The
attributes have the following semantics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>name</em> – an identifier specifying the name of the dataset. Its content
is determined solely by the Server and is completely uninterpreted with
respect to DAP4.</p>
</li>
<li>
<p><em>dapVersion</em> – the string &#8220;4.0&#8221; currently.</p>
</li>
<li>
<p><em>dmrVersion</em> – the string &#8220;1.0&#8221; currently.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The body of the Dataset is the same as the body of a <a href="#Groups">5.7</a>,
and semantically the Dataset acts like the outermost, root, group.</p>
</div>
</div>
<div class="sect2">
<h3 id="_groups">5.8. Groups</h3>
<div class="paragraph">
<p>A group is specified using this XML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Group</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
...
<span class="nt">&lt;Group&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A group defines a name space and contains other DAP elements.
Specifically, it can contain in this order: dimension, enumerations,
variables, and (sub-)groups. The fact that groups can be nested means
that the set of groups in a DMR form a tree data structure. For any
given DMR, there exists a root group that is the root of this tree.</p>
</div>
<div class="paragraph">
<p>A nested set of groups defines a variety of name spaces and access to
the contents of a group is specified using a notation of the form
&#8220;/g1/g2/…/gn&#8221;. This is called a &#8220;path&#8221;. By convention &#8220;/&#8221; refers
to the root group (the Dataset declaration). Thus the path &#8220;/g1/g2/g3&#8221;
indicates that one should start in the root group, move to group g1
within that root group, then to group g2 within group g1, and finally to
group g3. This is more fully described in the section on Fully Qualified
names (Section <a href="#Fully_Qualified_Names">5.3</a>).</p>
</div>
<div class="paragraph">
<p>The order of declarations within a Group is fixed and must conform to
this order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dimension declarations,</p>
</li>
<li>
<p>Enumeration declarations,</p>
</li>
<li>
<p>Variable declarations,</p>
</li>
<li>
<p>and, finally, nested Group declarations,</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For comparison purposes, DAP groups correspond to netCDF-4 groups and
not to the more complex HDF5 Group type: i.e. the set of groups must
form a tree.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If declared, Groups must be named.</p>
</li>
<li>
<p>A Group can contain any number of objects, including other Groups.</p>
</li>
<li>
<p>Each Group declares a new lexical scope for the objects it contains.</p>
</li>
<li>
<p>An array of Group is not allowed, and a Group cannot be defined within
a Structure or Sequence.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_dimensions">5.9. Dimensions</h3>
<div class="paragraph">
<p>A dimension declaration is specified using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">size=</span><span class="s">"size"</span><span class="nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The size is a positive integer (which means that a zero length dimension
is illegal). As described in the Arrays Section, the maximum size of any
dimension is \$2^(61) - 1\$. A dimension declaration will be referenced
elsewhere in the DMR by specifying its name. It should also be noted
that anonymous dimensions also exist. They have a size but no name.
Anonymous dimensions SHOULD NOT be declared.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dimension declarations are not associated with a data type.</p>
</li>
<li>
<p>Dimension sizes MUST be a capable of being represented as a signed
64-bit integer.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enumeration_types">5.10. Enumeration Types</h3>
<div class="paragraph">
<p>An enumeration type defines a set of names with specific values called
enumeration constants. As will be seen in Section <a href="#Variables">5.12</a>,
enumeration types may be used as the type for variables or attributes.
The values that can be assigned to such typed objects must come from the
set of enumeration constants.</p>
</div>
<div class="paragraph">
<p>An enumeration type specifies a set of named, integer constants. When a
data source has a variable of type &#8216;Enumeration&#8217; a DAP 4 server MUST
represent that variable using a specified integer type, up to and
including a 64-bit unsigned integer.</p>
</div>
<div class="paragraph">
<p>An Enumeration type is declared using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Enumeration</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
                basetype="Byte|Int8|UInt8|Int16|UInt16
                         |Int32|UInt32|Int64|UInt64"/&gt;
    <span class="nt">&lt;EnumConst</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"integer"</span><span class="nt">/&gt;</span>
    ...
<span class="nt">&lt;/Enumeration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The optional &#8220;basetype&#8221; XML attribute defines the type for the value
XML attribute of each enumeration constant. This basetype must be one of
the integer types (see Section <a href="#Integer_Types">5.10.1</a>). If
unspecified, then it defaults to the Atomic type &#8220;Int32&#8221;.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_atomic_types">5.11. Atomic Types</h3>
<div class="paragraph">
<p>The DAP4 specification assumes the existence of certain pre-defined,
declared types called atomic types. As their name suggests, atomic data
types are conceptually indivisible. Atomic variables are used to store
integers, real numbers, strings and URLs. There are five classes of
atomic types, with each family containing one or more variations:
integer, floating-point, string, enumerations, and opaque.</p>
</div>
<div class="paragraph">
<p><em><span id="Integer_Types">Integer Types</span></em></p>
</div>
<div class="paragraph">
<p>The integer types are summarized in the following table. The syntax for
integer constants is defined in Section
#The_Numeric_Constant_Classes:_integer_and_float[11.3].</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$ [-2^(7), 2^(7) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synonym for UInt8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Char</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synonym for UInt8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^8 - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(15), 2^(15) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(16) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(31), 2^(31) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(32) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[-2^(63), 2^(63) - 1\$]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[0, 2^(64) - 1\$]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that for historical reasons, the Char type is defined to be a
synonym of UInt8, this mean that technically, the Char type has no
associated character set encoding. However, servers and clients are free
to infer typical character semantics to this type. The inferred
character set encoding is chosen purely at the discretion of the server
or client using whatever conventions they agree to use, possibly
specified using attributes. Note specifically that multi-byte character
encodings such as UTF-8 are problematic precisely because they can be
multi-byte.</p>
</div>
<div class="paragraph">
<p><em><span id="Floating_Point_Types">Floating Point Types</span></em></p>
</div>
<div class="paragraph">
<p>The floating-point data types are summarized in Table 2. The two
floating-point data types use IEEE 754 [<a href="#ref7">7</a>] to represent values. The two
types correspond to ANSI C’s float and double data types. The syntax for
floating point constants is defined in Section
#The_Numeric_Constant_Classes:_integer_and_float[11.3].</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit Floating-point number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refer to the IEEE Floating Point Standard [<a href="#ref7">7</a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit Floating-point number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refer to the IEEE Floating Point Standard [<a href="#ref7">7</a>]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><span id="String_Types">String Types</span></em></p>
</div>
<div class="paragraph">
<p>The string data types are summarized in Table 3. Again, the syntax for
these is defined in Section <a href="#The_String.2FURL_Constant_Class">11.4</a></p>
</div>
<div class="paragraph">
<p>Strings are individually sized. This means that in an array of strings,
for example, each instance of that string MAY be of a different size.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Range of Legal Values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable length string of UTF-8 characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As defined in [<a href="#ref14">14</a>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Uniform Resource Identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As defined in IETF RFC 2396 [<a href="#ref8">8</a>]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><span id="The_Opaque_Type">The Opaque Type</span></em></p>
</div>
<div class="paragraph">
<p>The XML scheme for declaring an Opaque type is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Opaque&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Opaque type is use to hold objects like JPEG images and other Binary
Large Object (BLOB) data that have significant internal structure which
might be understood by clients (e.g., an image display program) but that
would be very cumbersome to describe using the DAP4 built-in types.
Defining a variable of type &#8220;Opaque&#8221; does not communicate any
information about its content, although an attribute could be used to do
that.</p>
</div>
<div class="paragraph">
<p>Opaque instances are individually sized. This means that in an array of
opaques, for example, each instance of that opaque MAY be of a different
size.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The content of an opaque object is completely un-interpreted by the
DAP4 implementation. The Opaque type is an Atomic Type, which might seem
odd because instances of Opaque can be of different sizes. However, by
thinking of Opaque as equivalent to a byte-string type, the analogy with
strings makes it clear that it should be an Atomic type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="The_Enum_Type">The Enum Type</span></em></p>
</div>
<div class="paragraph">
<p>The XML scheme for declaring an Enum type is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Enum</span> <span class="na">enum=</span><span class="s">"FQN"</span><span class="nt">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Enum type is intended to be used in the definition of a variable. It
should not be confused with the definition of an Enumeration, but rather
references such a definition.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Enum typed requires the an attribute that references a previously
defined &lt;Enumeration&gt; declaration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="A_Note_Regarding_Implementation_of_the_Atomic_Types">A Note Regarding
Implementation of the Atomic Types</span></em></p>
</div>
<div class="paragraph">
<p>When implementing the DAP, it is important to match information in a
data source or read from a DAP response to the local data type which
best fits those data. In some cases an exact match may not be possible.
For example Java lacks unsigned integer types [<a href="#ref6">6</a>]. Implementations faced
with such limitations MUST ensure that clients will be able to retrieve
the full range of values from the data source. If this is impractical,
then the server or client may implement this rule by hiding the variable
in question or returning an error.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_types">5.12. Container Types</h3>
<div class="paragraph">
<p>There are currently two container types: &lt;Structure&gt; and &lt;Sequence&gt;.</p>
</div>
<div class="paragraph">
<p><em><span id="The_Structure_Type">The Structure Type</span></em></p>
</div>
<div class="paragraph">
<p>A Structure groups a list of variables so that the collection can be
manipulated as a single item. The variables in a Structure may also be
referred to as &#8220;fields&#8221; to conform to conventional use of that term,
but there is otherwise no distinction between fields and variables. The
Structure’s fields MAY be of any type, including <em>Structure</em> or
<em>Sequence</em>. The order of items in the Structure is significant only in
relation to the serialized representation of that Structure.</p>
</div>
<div class="paragraph">
<p><em><span id="The_Sequence_Type">The Sequence Type</span></em></p>
</div>
<div class="paragraph">
<p>A Sequence is intended to represent a <em>sequence</em> of instances of
objects. Suppose that we have a sequence of this form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"field1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"field2"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>corresponding</em> Structure object is obtained by substituting the
<em>Sequence</em> keyword with <em>Structure</em>. Our above example then has this
associated Structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"s"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"field1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"field2"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Structure&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics of a sequence are that it represents a sequence of
instances of the corresponding Structure. The length of the Sequence MAY
be different for every instance of a Sequence. Consider this array of
Sequence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This represents an array of six (3 times 2) sequence instances. However,
the length MAY be different for each of those six instances.</p>
</div>
<div class="paragraph">
<p>Note that the &lt;Sequence&gt; construct was introduced to replace the concept
of variable length dimensions. It turns out that trying to treat
variable length dimensions as dimensions causes significant conceptual
and implementation difficulties. It is hoped that isolating such
variable length objects syntactically is a better representation.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Structures and Sequences MAY freely nested.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_variables">5.13. Variables</h3>
<div class="paragraph">
<p>Each variable in a data source MUST have a name, a type and one or more
values. Using just this information and armed with an understanding of
the definition ofv the DAP data types, a program can read any or all of
the information from a data source.</p>
</div>
<div class="paragraph">
<p>The DAP variables come in several different types. There are several
atomic types, the basic indivisible types representing integers,
floating point numbers and the like, and a container type – the
Structure or Sequence type – that supports aggregation of other
variables into a single unit. A container type may contain both atomic
typed variable as well as other container typed variables, thus allowing
nested type definitions.</p>
</div>
<div class="paragraph">
<p>The DAP variables describe the data when it is being transferred from
the server to the client. It does not necessarily describe the format of
the data inside the server or client. The DAP defines, for each data
type described in this document, a serialized representation, which is
the information actually communicated between DAP servers and DAP
clients. The serialized representation consists of two parts: the
declaration of the type and the serialized encoding of its value(s). The
data representation is presented in Section <a href="#Response_Format">6.1</a>.</p>
</div>
<div class="paragraph">
<p><em><span id="Arrays">Arrays</span></em></p>
</div>
<div class="paragraph">
<p>An Array is a multi-dimensional indexed data structure. An Array’s
member variable MUST be of some DAP data type. Array indexes MUST start
at zero. Arrays MUST be stored in row-major order (as is the case with
ANSI C), which means that the order of declaration of dimensions is
significant. The size of each Array’s dimensions MUST be given. The
total number of elements in an Array is fixed as that given by the
product of the size(s) of its dimension(s). Note that a dimension size
of zero is illegal.</p>
</div>
<div class="paragraph">
<p>For practical reasons having to do with current hardware limitations,
the total number of bytes allocated to an array must fit in an unsigned
64-bit integer. The largest atomic types currently defined in this
document are the floating point double and the (U)Int64 integer types.
This means that the practical limit on the total number of elements is
\$2^(64) / 8 = 2^(61)\$. Thus the dimension indices will run from 0 to a maximum
of \$2^(61) - 1\$. Of course this limit on the maximum number of elements also
applies to the maximum dimension size since the total number of elements
is the product of all the dimensions sizes of the array.</p>
</div>
<div class="paragraph">
<p>There is a prescribed limit of 64 on the number of of dimensions for a
variable (i.e. its arity). This is actually larger than will occur in
practice. Assuming a dimension must be at least 1 bit in size, this
effectively limits the number of dimensions to 61.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Simple variables (see below) MAY be arrays.</p>
</li>
<li>
<p>Structures and Sequences MAY be arrays.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Simple_Variables">Simple Variables</span></em></p>
</div>
<div class="paragraph">
<p>A simple, dimensioned variable is declared using this XML form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"{fqn}"</span><span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"{integer}"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of two types of dimensions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>name=&#8220;{fqn}&#8221; – specify the fully qualified name of a Dimension that
has been declared previously in the XML document order. See [<a href="#ref19">19</a>].</p>
</li>
<li>
<p>size=&#8220;{integer}&#8221; – specify an anonymous dimension of a given size,</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A simple variable is one whose type is one of the Atomic Types (see
Section <a href="#Atomic_Types">5.10</a>). The name of the Atomic Type (Int32 in
this example) is used as the XML element name. Within the body of that
element, it is possible to specify zero or more dimension references. A
dimension reference (&lt;Dim…/&gt;) MAY refer to a previously defined
dimension declaration. It MAY also define an anonymous dimension with no
name, but with a size specified as an integer constant.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>N.A.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Dimension_Ordering">Dimension Ordering</span></em> Consider this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Int32</span>  <span class="na">name=</span><span class="s">"i"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/d1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/d2"</span><span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/dn"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dimensions are considered ordered from top to bottom. From this, a
corresponding left-to-right order [d1][d2]…[dn] can be inferred where
the top dimension is the left-most and the bottom dimension is the
right-most. The assumption of row-major order means that in enumerating
all possible combinations of these dimensions, the right-most is
considered to vary the fastest. The terms &#8220;right(most)&#8221; or
&#8220;left(most&#8221;) refer to this left-to-right ordering of dimensions.</p>
</div>
<div class="paragraph">
<p><em><span id="Structure_Variables">Structure Variables</span></em></p>
</div>
<div class="paragraph">
<p>As with simple variables, a structure variable specifies a type as well
as any dimension for that variable. The type, however, is a Structure.</p>
</div>
<div class="paragraph">
<p><em><span id="Structures">Structures</span></em> The XML scheme for a Structure typed
variable is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
  {variable definition}
  {variable definition}
  ...
  {variable definition}
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">'/d1'</span> <span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">'/dn'</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Structure&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Structure contains within it a list of variable definitions (Section
<a href="#Variables">5.12</a>). For discussion convenience, each such variable
may be referred to as a &#8220;field&#8221; of the Structure. The list of fields
may optionally be followed with a list of dimension references
indicating the dimensions of the Structure typed variable.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Structure variables MAY be dimensioned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Sequence_Variables">Sequence Variables</span></em></p>
</div>
<div class="paragraph">
<p>As with simple variables, a sequence variable specifies a type as well
as any dimension for that variable. The type, however, is a Sequence.</p>
</div>
<div class="paragraph">
<p><em><span id="Sequences">Sequences</span></em></p>
</div>
<div class="paragraph">
<p>The XML scheme for a Sequence typed variable is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
  {variable definition}
  {variable definition}
  ...
  {variable definition}
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">'/d1'</span> <span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">'/d2'</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Sequence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Sequence contains within it a list of variable definitions (Section
<a href="#Variables">5.12</a>). For discussion convenience, each such variable
may be referred to as a &#8220;field&#8221; of the Sequence. The list of fields
may optionally be followed with a list of dimension references
indicating the dimensions of the Sequence typed variable.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sequence variables MAY be dimensioned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Coverage_Variables_and_Maps">Coverage Variables and Maps</span></em></p>
</div>
<div class="paragraph">
<p>A &#8220;Discrete Coverage&#8221; is a concept commonly found in many disciplines,
where the term refers to a sampled function with both its domain and
range explicitly enumerated by variables. DAP2 uses the name &#8216;Grid&#8217; to
denote what the OGC calls a &#8216;rectangular grid&#8217; [<a href="#ref12">12</a>]. DAP4 expands on
this so that other types of discrete coverages (hereafter
&#8216;coverage(s)&#8217;) can be explicitly represented. Note that the DAP2
<em>Grid</em> construct is gone, and is replaced by these coverages, which are
more general than DAP2 Grids.</p>
</div>
<div class="paragraph">
<p>Consider the example coverage function</p>
</div>
<div class="paragraph">
<p>Temp: <em>lat</em> X <em>lon</em> &#8594; Float32</p>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="paragraph">
<p><em>lat</em> and <em>lon</em> subsets are of Float32 in the range [0,360).</p>
</div>
<div class="paragraph">
<p>The range is, of course, <em>Float32</em> and the domain is <em>lat X lon</em>. The
Temp function as a coverage is a sampled subset of the continuous
function and is defined at some finite set of pairs from lat X lon.</p>
</div>
<div class="paragraph">
<p>In DAP4, the range for a coverage is represented by a variable, Temp in
this example, whose values are the range of the sampled function.
Because the domain of <em>Temp</em> is a two-tuple (lat,lon), the DAP4 variable
must have rank two. In order to complete the sampling of Temp, it is
necessary to also define two &#8216;Map&#8217; (also called &#8216;coordinate&#8217;)
variables representing the sampling of lat and lon. These two variables,
lat and lon, have rank one each. Taken as whole, this collection of a
variable plus maps is called a &#8220;grid&#8221; for convenience sake.</p>
</div>
<div class="paragraph">
<p>Suppose we want to access the value of the Temp function at position
(x,y), where x is a value in the lat variable and y is a value in the
lon variable. The lat variable is consulted to find ilat such that
lat[ilat] = x. Similarly, we want the ilon index such that lon[ilon] =
y. We can then obtain Temp(x,y) as the value of Temp[ilat][ilon]. This
is probably the simplest example for using coverages and more complex
examples exist for, for example, satellite swathes.</p>
</div>
<div class="paragraph">
<p>Using OGC coverage terminology, we have this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The maps (e.g. lat and lon) specify the &#8220;Domain&#8221;</p>
</li>
<li>
<p>The array (e.g. Temp) specifies the &#8220;Range&#8221;</p>
</li>
<li>
<p>The Grid itself is a &#8220;Coverage&#8221; per OGC.</p>
</li>
<li>
<p>The Domain and Range are sampled functions</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A map is defined using the following XML scheme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"{FQN for some variable previously defined in the DMR}"</span><span class="nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example might look like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"Temp"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/lat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"/lat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"/lon"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Float32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the map variables are defined elsewhere like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/lat"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Float32&gt;</span>

<span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"/lon"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"/lon"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Float32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The containing variable, temp in the example, will be referred to as the
&#8220;array variable&#8221;.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each map variable MUST have a rank no more than that of the array.</p>
</li>
<li>
<p>An array variable can have as many maps as desired.</p>
</li>
<li>
<p>Any map duplicates are ignored</p>
</li>
<li>
<p>The order of declaration (top to bottom) MAY be significant.</p>
</li>
<li>
<p>The fully qualified name of a map must either be in the same lexical
scope as the array variable, or the map must be in some enclosing scope.</p>
</li>
<li>
<p>The set of named "`associated dimensions for a map must be a subset of
the set of named`"associated dimensions” for the array variable.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The term &#8220;associated dimensions&#8221; is computed as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The set of associated dimensions is initialized to empty.</p>
</li>
<li>
<p>For each element mentioned in the fully qualified name (FQN) of the
map or the array variable, add any named dimensions associated with FQN
element to the set of associated dimensions (removing duplicates, of
course).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In practice, the means that an array variable or map variable must take
into account any dimensions associated with any enclosing dimensioned
Structure or Sequence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attributes_and_arbitrary_xml">5.14. Attributes and Arbitrary XML</h3>
<div class="paragraph">
<p><em><span id="Attributes">Attributes</span></em></p>
</div>
<div class="paragraph">
<p>Simple attributes are defined using the following XML scheme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"{atomicTypeName|EnumType fqn}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Namespace</span> <span class="na">href=</span><span class="s">"http://netcdf.ucar.edu/cf"</span><span class="nt">/&gt;</span> <span class="c">&lt;!--optional--&gt;</span>
  <span class="nt">&lt;Value</span> <span class="na">value=</span><span class="s">"value"</span><span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;Value</span> <span class="na">value=</span><span class="s">"value"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"{atomicTypeName|EnumType fqn}"</span> <span class="na">value=</span><span class="s">"value"</span><span class="nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes may also serve as containers for other attributes (and other
containers). In this case, no type is specified, only a name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Namespace</span> <span class="na">href=</span><span class="s">"http://netcdf.ucar.edu/cf"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/Attribute&gt;</span>

  ...

  <span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/Attribute&gt;</span>

<span class="nt">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In DAP4, Attributes (not to be confused with XML attributes) are tuples
with four components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name,</p>
</li>
<li>
<p>Type (one of the defined atomic types such as Int16, String, Enum fqn,
etc.).</p>
</li>
<li>
<p>value as an alternate form for attributes with a single value,</p>
</li>
<li>
<p>Vector of one or more value declarations,</p>
</li>
<li>
<p>OR a set of contained attributes,</p>
</li>
<li>
<p>Zero or more Namespaces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This differs slightly from DAP2 Attributes because the namespace feature
has been added, although clients can choose to ignore it. For more about
namespaces, refer to Section <a href="#Namespaces">5.14</a>. The intent of
including the namespace information is to simplify interactions with
semantic web applications where certain schemas or standards have formal
definitions of attributes.</p>
</div>
<div class="paragraph">
<p>Attributes are typically used to associate semantic metadata with the
variables in a data source. Attributes are similar to variables in their
range of types and values, except that they are somewhat limited when
compared to those for variables: they cannot use Structure or Sequence
types</p>
</div>
<div class="paragraph">
<p>Attributes defined at the top-level within a group are also referred to
as &#8220;group attributes&#8221;. Attributes defined at the root group (i.e.
Dataset) are &#8220;global attributes,&#8221; which many file formats such as HDF4
or netCDF formally recognize.</p>
</div>
<div class="paragraph">
<p>While the DAP does not require any particular Attributes, some may be
required by various metadata conventions. The semantic metadata for a
data source comprises the Attributes associated with that data source
and its variables. Thus, Attributes provide a mechanism by which
semantic metadata may be represented without prescribing that a data
source use a particular semantic metadata convention or standard.</p>
</div>
<div class="paragraph">
<p><em>Semantic Notes</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>DAP4 explicitly treats an attribute with one value as an attribute
whose value is a one-element vector.</p>
</li>
<li>
<p>All of the atomic types are allowed as the type for an attribute</p>
</li>
<li>
<p>If the attribute has type Enum, it must also have an XML attribute,
<em>enum</em>, that references a previously defined &lt;Enumeration&gt; declaration.</p>
</li>
<li>
<p>Attribute value constants MUST conform to the appropriate constant
format for the given attribute type and as defined in Section
<a href="#DAP4_Lexical_Elements">11</a>.</p>
</li>
<li>
<p>Attribute containers may may only contain attributes. Container
attributes may not have values; only lowest level (leaf) attributes may
have values.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>[#Arbitrary_XML_content]#Arbitrary XML content #</em></p>
</div>
<div class="paragraph">
<p>DAP4 supports an explicit type to hold &#8220;arbitrary XML&#8221; markup that
provides a way for the protocol to transport information encoded in XML.
This is useful for &#8220;annotating&#8221; meta-data with information more
complex than simple attributes. This can be used, for example, for
passing semantic web information, or for passing out-of-band
information: e.g about the conversion from some other meta-data system
into DAP4.</p>
</div>
<div class="paragraph">
<p>The form on an otherXML declaration is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;otherXML</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
{arbitrary xml}
<span class="nt">&lt;/otherXML&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are no &lt;value/&gt; elements because the value of otherXML is the xml
inside the &lt;otherXML&gt;…&lt;/otherXML&gt;. The text content of the otherXML
element must be valid XML and must be distinct from the XML markup used
to encode elements of the DAP4 data model (i.e., in a practical sense,
the content of an &lt;OtherXML&gt; attribute will be in a namespace other than
DAP4). XML content may appear anywhere that an attribute may appear.</p>
</div>
<div class="paragraph">
<p><em><span id="Attribute_and_OtherXML_Specification_and_Placement">Attribute and
OtherXML Specification and Placement</span></em></p>
</div>
<div class="paragraph">
<p>Attribute and OtherXML declarations MAY occur within the body of the
following XML elements: Group, Dataset, Dimension, Variable, Structure,
Sequence, and Attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_namespaces">5.15. Namespaces</h3>
<div class="paragraph">
<p>All elements of the DMR – Dataset, Groups, Dimensions, Variables, and
Attributes – can contain an associated Namespace element. The
namespace’s value is defined in the form of an XML style URI string
defining the context for interpreting the element containing the
namespace. Suppose, hypothetically, that we wanted to specify that an
Attribute is to be interpreted as a CF convention [<a href="#ref15">15</a>]. One might
specify this as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">"latitude"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Namespace</span> <span class="na">href=</span><span class="s">"http://cf.netcdf.unidata.ucar.edu"</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/Attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is not to claim that this is how to specify a CF
convention [<a href="#ref15">15</a>].; this is purely illustrative.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_representation">6. Data Representation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data can be an elusive concept. Data may exist in some storage format on
some disk somewhere, on paper somewhere else, in active memory on some
server, or transmitted along some wire between two computers. All these
can still represent the same data. That is, there is an important
distinction to be made between the data and its representation. The data
can consist of numbers: abstract entities that usually represent
measurements of something, somewhere. Data also consist of the
relationships between those numbers, as when one number defines a time
at which some quantity was measured.</p>
</div>
<div class="paragraph">
<p>The abstract existence of data is in contrast to its concrete
representation, which is how we manipulate and store it. Data can be
stored as ASCII strings in a file on a disk, or as twos-complement
integers in the memory of some computer, or as numbers printed on a
page. It can be stored in HDF5 [<a href="#ref2">2</a>], netCDF [<a href="#ref4">4</a>], GRIB[<a href="#ref17">17</a>], a relational
database, or any number of other digital storage forms.</p>
</div>
<div class="paragraph">
<p>The DAP specifies a particular representation of data, to be used in
transmitting that data from one computer to another. This representation
of some data is sometimes referred to as the serialized representation
of that data, as distinguished from the representations used in some
computer’s memory. The DAP standard outlined in this document has
nothing at all to say about how data is stored or represented on either
the sending or the receiving computer. The DAP transmission format is
completely independent of these details.</p>
</div>
<div class="sect2">
<h3 id="_response_format">6.1. Response Format</h3>
<div class="paragraph">
<p>There are two response formats that a server MUST provide to the client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>DMR-only response</p>
</li>
<li>
<p>(DMR +) Data response</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="DMR-Only_Response">DMR-Only Response</span></em> If the client requests only
the DMR, then it is returned as a standard XML encoded document. If
constraints were specified, then the returned DMR may differ from the
full DMR in that, for example, meta-data about only variables specified
in the constraint will be returned. The DMR-Only response MUST be
<em>self-contained</em>. This means that all declarations directly or
transitively mentioned in the selected variables must be included in the
returned DMR. Additionally, all attributes associated with the included
declarations MUST be included as well.</p>
</div>
<div class="paragraph">
<p><em><span id="Data_Response">Data Response</span></em> The DAP4 data response uses a format
very similar to that used for DAP2; the data payload is broken into two
pieces. The first part holds metadata describing the names and types of
the variables in the response while the second part holds the values of
those variables.</p>
</div>
<div class="paragraph">
<p>The metadata information, sent as part 1 of the Data Response, is the
DMR limited to just those variables included in the response. The
response, however, MUST be self-contained (in the DMR-Only sense). DAP
attributes for all included declarations MUST be included, but MAY be
ignored by the receiving client.</p>
</div>
<div class="paragraph">
<p>Part 2 of the response consists of the binary data for each variable in
the order they are listed in the DMR given as the response preface. DAP4
uses a receiver makes it right encoding, so the servers MAY simply write
out binary data as they store it with the exceptions that floating-point
data must be encoded according to IEEE 754[<a href="#ref7">7</a>] and Integer data must use
twos-complement notation for signed types. Clients are responsible for
performing byte-swapping operations needed to compute using the values
retrieved.</p>
</div>
<div class="paragraph">
<p>The Data Response is encoded using chunking scheme (see Section
<a href="#How_the_Chunked_Encoding_Affects_the_Data_Response_Format">6.2</a>).
that breaks it into N parts where each part is prefixed with a chunk
type and chunk byte count header. Chunk types include data and error
types, making it simple for servers to indicate to clients that an error
occurred during the transmission of the Data Response and (relatively)
simple for clients to detect that error.</p>
</div>
<div class="paragraph">
<p>As with DAP2, the response describe here is a document that can be
stored on disk or sent as the payload using a number of network
transport protocols, HTTP being the primary transport in practice.
However, any protocol that can transmit a document can be used to
transmit these responses. As such, all critical information needed to
decode the response is completely self-contained.</p>
</div>
<div class="paragraph">
<p>In the rest of this section we will describe the Data Response in the
context of DAP4 using HTTP as its transport protocol.</p>
</div>
<div class="paragraph">
<p><em><span id="Format_of_the_DMR_Part">Format of the DMR Part</span></em></p>
</div>
<div class="paragraph">
<p>The first part (<em>part</em> is not to be confused with <em>chunk</em>) of the Data
Response always contains the DMR. The Data Response, when DAP is using
HTTP as a transport protocol, is the payload for an HTTP response. It is
separated from the last of the HTTP response’s MIME headers by a single
blank line, which MIME defines as a carriage return (ASCII character
with byte value of 13) followed by a line feed (ASCII character with
byte value of 10). This combination can be abbreviated as CRLF.</p>
</div>
<div class="paragraph">
<p><em>Format Related DMR Attributes</em><br>
The DMR MAY contain attributes that reflect information from the
serialized data. Specifically, the following attributes are defined.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>&lt;Attribute name=&#8220;_DAP4_Checksum_CRC32&#8221; type=&#8220;Int32&#8221;/&gt; — this
attribute may be attached to each top-level variable to show the CRC-32
checksum of the content of that data. See Section
<a href="#The_DAP4_Serialized_Representation">6.2</a> for more information.</p>
</li>
<li>
<p>&lt;Attribute name=&#8220;_DAP4_Little_Endian&#8221; type=&#8220;UInt8&#8221;/&gt; — this
attribute exists in the root group (the dataset) to indicate if the
serialized data byte order is little-endian. The value &#8220;1&#8221; indicates
that little-endian order was used and &#8220;0&#8221; indicates that big-endian
order was used. If missing, little-endian is assumed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Format_of_the_Data_Part">Format of the Data Part</span></em> The second part of
the Data response consists of the serialized variables as specified by
the data DMR. The variable serializations are concatenated to form a
single binary dataset. If requested, each variable’s serialization is
followed by a CRC32 checksum.</p>
</div>
<div class="paragraph">
<p><em><span id="Relationship_to_the_Chunking_format">Relationship to the Chunking
format</span></em> The data response format is technically independent of the
chunking format</p>
</div>
<div class="paragraph">
<p>(see
<a href="#How_the_Chunked_Encoding_Affects_the_Data_Response_Format">6.1.3</a>).</p>
</div>
<div class="paragraph">
<p>The assumption is that the DMR will be in a chunk of its own, the first
chunk, and the serialized binary data will be in one or more additional
chunks. This produces a format like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CRLF
{DMR Length in binary form}
{DMR}
CRLF
{Chunk 1 containing some portion of the serialized data}
...
{Chunk n containing the last portion of the serialized data}</pre>
</div>
</div>
<div class="paragraph">
<p>In the above and in the following, the form &#8216;{xxx}&#8217; is intended to
represent any instance of the xxx.</p>
</div>
<div class="paragraph">
<p><em><span id="How_the_Chunked_Encoding_Affects_the_Data_Response_Format">How the
Chunked Encoding Affects the Data Response Format</span></em></p>
</div>
<div class="paragraph">
<p>In a sense, the chunked encoding does not affect the format of the Data
Response at all. Conceptually, the entire binary Data Response is built
and then passed through a &#8216;chunking encoder&#8217; transforming it into one
that is broken up into a series of chunks. That &#8216;chunked document&#8217; is
then sent as the payload of some transport protocol, e.g., HTTP. In
practice, that would be a wasteful implementation because a server would
need to hold the entire response in memory. A better implementation
would, for HTTP, write the initial parts of the HTTP response (its
response code and headers) and then use a pipeline of filters to perform
the encoding operations. The intent of the chunking scheme is to make it
possible for servers to build responses in small chunks, and once they
know those parts have been built without error, send them to the client.
Thus a server should choose the chunk size to be small enough to fit
comfortably in memory but large enough to limit the amount of overhead
spent by the software that encodes and decodes those chunks. When an
error is detected, the normal flow of building chunks and sending the
data along is broken and an error chunk should be sent (See Section
<a href="#DAP4_Error_Response_Format">12</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_dap4_serialized_representation">6.2. The DAP4 Serialized Representation</h3>
<div class="paragraph">
<p>Given a DMR and the corresponding data, the serialized representation is
formally described in this section.</p>
</div>
<div class="paragraph">
<p><em><span id="A_Note_on_Dimension_Ordering">A Note on Dimension Ordering</span></em></p>
</div>
<div class="paragraph">
<p>Consider this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Int32</span>  <span class="na">name=</span><span class="s">"i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"d1"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"d2"</span><span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"dn"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Int32&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dimensions are considered ordered top-to-bottom textually. This
order is linearized into a corresponding left-to-right order
[d1][d2]…[dn]. The assumption of row-major order means that in
enumerating all possible combinations of these dimensions, the rightmost
is considered to vary the fastest. The terms &#8220;right(most)&#8221; or
&#8220;left(most&#8221;) refer to this ordering of dimensions.</p>
</div>
<div class="paragraph">
<p><em><span id="Order_of_Serialization">Order of Serialization</span></em></p>
</div>
<div class="paragraph">
<p>The data appearing in a serialized representation is the concatenation
of the variables specified in the tree of Groups within a DMR, where the
variables in a group are taken in depth-first, top-to-bottom order. The
term &#8220;top-to-bottom&#8221; refers to the textual ordering of the variables
in an XML document specifying a given DMR.</p>
</div>
<div class="paragraph">
<p>If a variable is a Structure variable, then its data representation will
be the concatenation of the variables it contains, which will appear in
top-to-bottom order.</p>
</div>
<div class="paragraph">
<p>If a variable is a Sequence variable, then its data representation will
have two parts.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A 64-bit signed <em>count</em> of the number of elements in the sequence</p>
</li>
<li>
<p><em>Count</em> instances of the <a href="#The_Sequence_Type">5.11.2</a> for the
Sequence.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a variable has dimensions, then the contents of each dimensioned data
item will appear concatenated and taken in row-major order.</p>
</div>
<div class="paragraph">
<p><em><span id="Variable_Representation">Variable Representation</span></em></p>
</div>
<div class="paragraph">
<p>Given a dimensioned variable, it is represented as the N scalar values
concatenated in row-major order.</p>
</div>
<div class="paragraph">
<p>If the variable is scalar, then it is represented as a single scalar
value.</p>
</div>
<div class="paragraph">
<p><em><span id="Numeric_Scalar_Atomic_Types">Numeric Scalar Atomic Types</span></em></p>
</div>
<div class="paragraph">
<p>For the numeric atomic types, scalar instances are represented as
follows. In all cases a consistent byte ordering is assumed, but the
choice of byte order is at the discretion of the program that generates
the serial representation, typically a server program.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Representation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Char</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UInt8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 16-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UInt64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float32</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit IEEE floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Float64</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit IEEE floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bits</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In narrative form: all numeric quantities are used as a raw, unsigned
vector of N bytes, where N is 1 for Char, Int8, and UInt8; it is 2 for
Int16 and UInt16; it is 4 for Int32, UInt32, and Float32; and it is 8
for Int64, UInt64, and Float64.</p>
</div>
<div class="paragraph">
<p><em><span id="Byte_Swapping_Rules">Byte Swapping Rules</span></em></p>
</div>
<div class="paragraph">
<p>If the server chooses to byte swap transmitted values, then the
following swapping rules are used.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Size (bytes)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Byte Swapping Rules</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>2</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>4</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 3</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 2</p>
</div>
<div class="paragraph">
<p>Byte 2 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 3 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>8</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Byte 0 <code>&#8594;</code> Byte 7</p>
</div>
<div class="paragraph">
<p>Byte 1 <code>&#8594;</code> Byte 6</p>
</div>
<div class="paragraph">
<p>Byte 2 <code>&#8594;</code> Byte 5</p>
</div>
<div class="paragraph">
<p>Byte 3 <code>&#8594;</code> Byte 4</p>
</div>
<div class="paragraph">
<p>Byte 4 <code>&#8594;</code> Byte 3</p>
</div>
<div class="paragraph">
<p>Byte 5 <code>&#8594;</code> Byte 2</p>
</div>
<div class="paragraph">
<p>Byte 6 <code>&#8594;</code> Byte 1</p>
</div>
<div class="paragraph">
<p>Byte 7 <code>&#8594;</code> Byte 0</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><span id="Variable-Length_Scalar_Atomic_Types">Variable-Length Scalar Atomic
Types</span></em></p>
</div>
<div class="paragraph">
<p>The variable length atomic values are all represented as a signed 64-bit
count followed by the data of the value.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Representation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of 8-bit bytes representing a UTF-8 String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes in the string (in Int64 format) followed by the bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>URL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of 8-bit bytes representing a URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Opaque</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector of un-interpreted 8-bit bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes in the vector (in Int64 format) followed by the bytes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In narrative form, instances of String, Opaque, and URL types are
represented as a 64 bit length (treated as Int64) of the instance
followed by the vector of bytes comprising the value.</p>
</div>
<div class="paragraph">
<p><em><span id="Structure_Variable_Representation">Structure Variable
Representation</span></em></p>
</div>
<div class="paragraph">
<p>A Structure typed variable is represented as the concatenation of the
representations of the variables contained in the Structure taken in
textual top-to-bottom order. This representation may be nested if one of
the variables itself is a Structure variable. Dimensioned structures are
represented in a form analogous to dimensioned variables of atomic type.
The Structure array is represented by the concatenation of the instances
of the dimensioned Structure, where the instances are listed in
row-major order.</p>
</div>
<div class="paragraph">
<p>It should be noted that no padding is present in the structure
representation. One field’s content is immediately followed by the next
field’s content.</p>
</div>
<div class="paragraph">
<p><em><span id="Sequence_Variable_Representation">Sequence Variable Representation</span></em></p>
</div>
<div class="paragraph">
<p>A Sequence typed variable is represented as a count specifying the
number of objects (not bytes) of the sequence followed by count
instances of the corresponding Structure using the Structure
representation rules. This representation may be nested if one of the
variables itself is a Sequence variable. Dimensioned sequences are
represented in a form analogous to dimensioned variables of atomic type.
The Sequence array is represented by the concatenation of the instances
of the dimensioned Sequence, where the instances are listed in row-major
order.</p>
</div>
<div class="paragraph">
<p>Each Sequence variable, then, consists of a length, L say, in Int64 form
and giving the number of elements for a specific occurrence of the
variable-length dimension. The count, L, is then followed by L instances
of the serialized form of the sequence’s corresponding structure.</p>
</div>
<div class="paragraph">
<p><em><span id="Checksums">Checksums</span></em></p>
</div>
<div class="paragraph">
<p>As an option, checksums will be computed for the values of all the
&#8220;top-level&#8221; variables present in the DMR of a returned response from a
server. The term &#8220;top-level&#8221; means that the variable is not a field of
a Structure (or Sequence) typed variable.</p>
</div>
<div class="paragraph">
<p>The purpose of the checksum is to detect changes in data over time. That
is, if a client requests the same variable and the returned checksums
are the same, then the client may infer that the data has not changed.
The checksum is not intended for transmission error detection, although
the client MAY use it for that purpose if it chooses. Note that the
value of the checksum will change depending on the byte order used to
serialize the data.</p>
</div>
<div class="paragraph">
<p>The checksum is made visible to the client by adding an attribute to
each top-level variable in the DMR. This attribute is named
&#8220;_DAP4_Checksum_CRC32&#8221;.</p>
</div>
<div class="paragraph">
<p>In all cases, the checksum is computed over the serialized
representation of each top-level variable. The checksum is computed
before any chunking Section <a href="#DAP4_Chunked_Data_Representation">7</a>)
is applied.</p>
</div>
<div class="paragraph">
<p>If the request to the server is a dmr-only request, then the server will
compute the checksum for each variable mentioned in the DMR and will
insert the &#8220;_DAP4_Checksum_CRC32&#8221; attribute in the DMR. Note that this
can have significant performance consequences since the server may need
to read and serialize all of the data for all of the variables mentioned
in the DMR even though that data is not transmitted to the client.</p>
</div>
<div class="paragraph">
<p>If the request to the server is a data request, then the checksum value
will follow the value of the variable in the data part of the response.
The computed checksum is appended to the serialized representation for
transmission to the client. Note that in this case, the client is
expected to add the &#8220;_DAP4_Checksum_CRC32&#8221; attribute to the DMR.</p>
</div>
<div class="paragraph">
<p>The default checksum algorithm is CRC32. So the size of each checksum
inserted in the serialization will be a 32 bit integer. The checksum
integer will use the same endian representation as for the all other
data. Note that CRC32 is not a cryptographically strong checksum, so it
is not suitable for detecting man-in-the-middle attacks.</p>
</div>
<div class="paragraph">
<p><em><span id="Historical_Note">Historical Note</span></em></p>
</div>
<div class="paragraph">
<p>The encoding described in Section <a href="#Response_Format">6.1</a> is similar
to the serialization form of the DAP2 protocol [<a href="#ref3">3</a>], but has been
extended to support arrays with a varying dimension and stripped of
redundant information added by various XDR implementations.</p>
</div>
<div class="paragraph">
<p>The DAP4 Serialization rules are derived from, but not the same as, XDR
[<a href="#ref10">10</a>]. The differences are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Values are encoded using the byte order of the server. This is the
so-called &#8220;receiver makes it right&#8221; rule.</p>
</li>
<li>
<p>No padding is used.</p>
</li>
<li>
<p>Floating point values always use the IEEE [<a href="#ref7">7</a>] standard.</p>
</li>
<li>
<p>One and two-byte values are not converted to four byte values.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_example_responses">6.3. Example responses</h3>
<div class="paragraph">
<p>In these examples, spaces and newlines have been added to make them
easier to read. The real responses are more compact. Since this proposal
is just about the form of the response - and it really focuses on the
BLOB part - there is no mention of &#8216;chunking.&#8217; For information on how
this BLOB will/could be chunked. see Section
<a href="#DAP4_Chunked_Data_Representation">7</a>. NB: Some poetic license used
in the following and the checksums for single integer values seems
silly, but these are really simple examples.</p>
</div>
<div class="paragraph">
<p><em><span id="A_single_scalar">A single scalar</span></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
<span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em><span id="A_single_array">A single array</span></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
<span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
<span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"4"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/Int32&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em><span id="A_single_structure">A single structure</span></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"S"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"2"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13
y
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, there is a single variable at the top-level
of the root Group, and that is S; so it is S for which we compute the
checksum.</p>
</div>
<div class="paragraph">
<p><em><span id="An_array_of_structures">An array of structures</span></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"s"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"4"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Float64</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"3"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
x00 x01 x02 x03 x10 x11 x12 x13 y x00 x01 x02 x03 x10 x11 x12 x13 y x00 x01 x02 x03 x10 x11 x12 x13 y
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em><span id="Single_array_with_sequence">Single array with sequence</span></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;String</span> <span class="na">name=</span><span class="s">"s"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"a-star"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"a"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>
  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"x-star"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
16 This is a string
{checksum}
5 a0 a1 a2 a3 a4
{checksum}
3 x00 x01 x02 6 x00 x01 x02 x03 x04 x05
{checksum}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The checksum calculation includes only the values of the variable, not
the containing chunk’s length bytes.</p>
</li>
<li>
<p>The Sequence objects are treated &#8216;like strings&#8217; and prefixed with a
length count. In the last of the three variables, the dimensioned
sequence <em>x-star</em> has two sequence instances where the first sequence
has 3 elements and the second has 6.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em><span id="Nested_Sequences">Nested Sequences</span></em></p>
</div>
<div class="paragraph">
<p>The sequence &#8216;x-star&#8217; has a field that is itself a sequence. In the
example, at the time of serialization &#8216;x-star&#8217; has three elements the
inner sequence (of which there are three instances) have three, six and
one element, respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">...
Content-Type: application/vnd.opendap.org.dap4.data
CRLF
{chunk count+tag}
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"foo"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"x-star"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"y-star"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"z"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/Sequence&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>
CRLF
{chunk count+tag}
3 3 x00 x01 x02 6 x10 x11 x12 x3 x14 x15 1 x20
{checksum}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dap4_chunked_data_representation">7. DAP4 Chunked Data Representation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An important capability for DAP4 is supporting clients in determining
when a data transmission fails. This is especially difficult when
sending binary data (Section <a href="#Response_Format">6.1</a>). In order to
support such a capability, the DAP4 protocol uses a simplified variation
on the HTTP/1.1 chunked transmission format [<a href="#ref9">9</a>] to serialize the data
part of the response document so that errors are simple to detect.
Furthermore, this format is independent of the form or content of that
part of the response, so the same format can be used with different
response forms or dropped when/if DAP is used with protocols that
support out-of-band error signaling, simplifying our ongoing refinement
of the protocol.</p>
</div>
<div class="paragraph">
<p>The data part of a response document is &#8220;chunked&#8221; in a fashion similar
to that outlined in HTTP/1.1. However, in addition to a prefix
indicating the size of the chunk, DAP4 includes a chunk-type code. This
provides a way for the receiver to know if the next chunk is part of the
data response or if it contains an error response (Section
<a href="#DAP4_Error_Response_Format">12</a>). In the latter case, the client
should assume that the data response has ended, even though the correct
closing information was not provided.</p>
</div>
<div class="paragraph">
<p>Each chunk is prefixed by a chunk header consisting of a chunk type and
byte count, all contained in a single four-byte word. The encoding of
this word is always network byte order (i.e. Big-Endian) The chunk type
will be encoded in the high-order byte of the four-byte word and chunk
size will be given by the three remaining bytes of that word. The
maximum chunk size possible is 224 bytes. Immediately following the
four-byte chunk header will be chunk-count bytes followed by another
chunk header. More precisely the initial four bytes of the chunk are
decoded using the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Treat the 32 bit header a single, big-endian, unsigned integer.</p>
</li>
<li>
<p>Convert the integer to the local machine byte order by swapping bytes
as necessary (Section <a href="#Byte_Swapping_Rules">6.2.3.2</a>). Let the
resulting integer be called H.</p>
</li>
<li>
<p>Compute the chunk type by the following expression: type = (H &gt;&gt; 24) &amp;
0xff (Using C-language operators).</p>
</li>
<li>
<p>Compute the chunk length by the following expression: length = (H &amp;
0x00ffffff) (Using C-language operators).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The chunk type is determined as a set of one or more flags. Currently,
the possible flags are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 3. Chunk Type Encoding</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value of 0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value of 1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A data containing chunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The last data chunk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current chunk is not an error chunk.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current chunk is an &#8220;error chunk&#8221; and contains an error message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data in this response is encoded using Big-Endian (i.e. network byte order)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data in this response is encoded using Little-Endian</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Chunk Type Encoding</p>
</div>
<div class="paragraph">
<p>It is possible for a chunk type to have more than one of the flags. So,
for example, if the data fits into a single chunk, and we assume
little-endian encoding, then its chunk type would be End + LittleEndian.</p>
</div>
<div class="paragraph">
<p>Error implies End, but if the Error flag is set, then bit 0 should be
treated as set even if it is not. Note that in order for this to work,
the chunk flags values must be powers of two: e.g. 1, 2, 4.</p>
</div>
<div class="paragraph">
<p>The Endian flag must be set only in the first Data chunk. It applies to
the whole response. If set in any subsequent chunk type, it will be
ignored.</p>
</div>
<div class="sect2">
<h3 id="_chunked_format_grammar">7.1. Chunked Format Grammar</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">chunked_response: chunklist ;
chunklist: chunk | chunklist chunk ;
chunk: CHUNKTYPE SIZE CHUNKDATA ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is semantic limitation in the definition of &#8216;chunk&#8217;:
the number of bytes in the CHUNKDATA must be equal to SIZE.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lexical_structure">7.2. Lexical Structure</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">/* A single 8-bit byte,
   with the encoding 0 = data, 1 = end, 2 = error, 4 = Little-Endian */
CHUNKTYPE = '\x00'|'\x01'|'\x02'|'\x4'|'\x06'
/* A sequence of three 8-bit bytes,
  interpreted as an integer on network byte order */
SIZE = [\0x00-\0xFF][\0x00-\0xFF][\0x00-\0xFF]
CHUNKDATA = [\0x00-\0xFF]*</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_constraints">8. Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A request to a DAP4 server for either metadata (the DMR) or data may
include a constraint expression. This constraint expression specifies
which variables are to be returned and what subset of the data for each
variable is to be returned.</p>
</div>
<div class="paragraph">
<p>This section defines the a constraint language that MUST be supported by
any implementation claiming to support the DAP4 protocol. The method by
which a server is provided with a constraint is specified in Volume 2.
But as a typical example, if such a constraint were to be embedded in a
URL, then it is presumed that it is prefixed with a
&#8220;?dap4.ce=constraint-expression&#8221; that is appended to the end of the
URL.</p>
</div>
<div class="paragraph">
<p>The DAP4 Constraint Expression (CE) syntax is an extension of the syntax
used by DAP2 that adds some important new features for Arrays as well as
addressing some ambiguities and structural problems in the DAP2 syntax.
In this design we also introduce some new terminology to make the
explanation of the CE syntax clearer. Additionally, we use a &#8216;curly
brace&#8217; notation for datasets to streamline the description of datasets
because the XML documents that DAP4 servers produce is verbose and hard
for humans to read.</p>
</div>
<div class="paragraph">
<p>When a client makes a request to a DAP4 server, it MAY send a CE where a
missing (or empty) CE is interpreted to mean that the client wants the
entire dataset sent. A CE is made up of a list of clauses, e ach of
which names a variable in the dataset that the client would like the
server to send to it. Each clause can further be broken down into two
parts: The subset expression and the filter expression. There are
limitations on the CE clauses depending on variable type. For scalar
variables, getting the variable is the only option available, so filter
expression is supported, and if present, the only subset expression
allowed is <em>[0]</em> or <em>[]</em>. Structure variables can be subset by field but
do not support filter expressions (although fields within a Structure
may support filtering). Sequences can be subset by field and do support
filters. Arrays support index subsets.</p>
</div>
<div class="paragraph">
<p>Specifically, the new features added for DAP4 constraints include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a grouping operator for Structures and Sequences.</p>
</li>
<li>
<p>Sequence filtering expressions explicitly bound to a specific Sequence
variable.</p>
</li>
<li>
<p>Multiple, disjoint index subsets.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_terminology_used_by_this_section">8.1. Terminology used by this section</h3>
<div class="paragraph">
<p>selection expression<br>
The entire expression passed to the server that is used to choose
specific parts of a dataset.</p>
</div>
<div class="paragraph">
<p>subset<br>
The act of choosing parts of a dataset based on the <em>type</em> of one or
more of its variables. We define several types of subsetting operations
as follows:</p>
</div>
<div class="paragraph">
<p>index subsetting<br>
Choosing parts of an array based on the indexes of that array’s
dimensions. This operation always returns an array of the same rank as
the original, although the size of the return array will (likely) be
smaller. Index subsetting uses the bracket syntax described
subsequently.</p>
</div>
<div class="paragraph">
<p>field subsetting<br>
Choosing specific variables (fields) from the dataset. A dataset in DAP4
is made up of a number of variables and those may be Structures or
Sequences that contain fields. Field subsetting uses the brace syntax
described later. One or more fields can be specified using a semicolon
(<strong>;</strong>) as the separator.</p>
</div>
<div class="paragraph">
<p>filter<br>
A filter is a predicate that can be used to choose sequence rows based
on the values of fields of the sequence. the vertical bar (<strong>|</strong>) is used
as a prefix operator for the filter predicate. Filters can be applied to
fields of a Sequence. A filter predicate consists of one or more filter
subexpressions. One or more subexpressions can be specified, using a
comma (<strong>,</strong>) as the separator. Implicitly, multiple filter subexpressions
are logically and’ded together.</p>
</div>
<div class="paragraph">
<p>filter subexpression<br>
A simple expression that consists of a single variable/field; the
expression is composed from traditional set of binary and unary
operators: comparison operators (=, !=, &lt;, &#8656;, &gt;, &gt;=) for numbers and
strings, and a string specific regular expression comparison operator
(~=). The operands of the operators must be either numeric or string
constants or a field of the Sequence. Specifically, only atomic-valued,
scalar fields can be used in the filter expression.</p>
</div>
<div class="paragraph">
<p>id<br>
The name of a variable. These must be absolute, with some specific
exceptions. Absolute names are fully qualified names (See Section
<a href="#Fully_Qualified_Names">5.3</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_subsetting_constraints">8.2. Subsetting Constraints</h3>
<div class="paragraph">
<p>The simplest constraint is the null string and it means &#8216;return
everything&#8217; from the dataset. Choosing variables in a dataset is
referred to as the <em>subset</em>. To choose a subset of the variables in a
dataset, enumerate them in a semicolon-separated list. To choose parts
of a Structure, name those parts explicitly using the syntax
<em>structure_name\{field name}</em> or <em>structure_name.field name</em>. Each DAP4
dataset contains one or more Groups; the top-level Group is always
present and is named <em>/</em> (pronounced &#8216;root&#8217;).</p>
</div>
<div class="sect3">
<h4 id="_example_subsetting_by_variable_or_field">8.2.1. Example: subsetting by variable or field</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_1"</span>
  <span class="na">dapVersion=</span><span class="s">"4.0"</span>
  <span class="na">dmrVersion=</span><span class="s">"1.0"</span>
  <span class="na">xml:base=</span><span class="s">"file:dap4/test_ce_1.xml"</span>
  <span class="na">xmlns=</span><span class="s">"http://xml.opendap.org/ns/DAP/4.0#"</span>
  <span class="na">xmlns:dap=</span><span class="s">"http://xml.opendap.org/ns/DAP/4.0#"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"v"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Point"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: The syntax used for the examples is (hopefully) easier to read
than the DAP4 DMR which uses XML; Curly braces indicate hierarchy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">Dataset {
    Int32 u;
    Int32 v;
    Structure {
        Int32 x;
        Int32 y;
    } Point;
} vol_1_ce_1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access just <em>u</em><br>
<em>/u</em></p>
</div>
<div class="paragraph">
<p>Access just <em>u</em> and <em>v</em><br>
<em>/u;/v</em></p>
</div>
<div class="paragraph">
<p>Access just <em>x</em> within <em>Point</em><br>
<em>/Point{x}</em></p>
</div>
<div class="paragraph">
<p>Equivalent expression to access just <em>x</em> within <em>Point</em><br>
<em>/Point.x</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_2"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"v"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Group</span> <span class="na">name=</span><span class="s">"inst2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"v"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Point"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Structure&gt;</span>
  <span class="nt">&lt;/Group&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Int32 u;
    Int32 v;
    Group {
        Int32 u;
        Int32 v;
    Structure {
        Int32 x;
        Int32 y;
    } Point;
   } inst2;
} vol_1_ce_2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access &#8216;top-level&#8217; <em>u</em> and <em>v</em><br>
<em>/u;/v</em>.</p>
</div>
<div class="paragraph">
<p>Access &#8216;top-level&#8217; <em>u</em> and <em>v</em> and <em>inst2’</em>s <em>u</em> and <em>v</em><br>
<em>/u;/v;/inst2/u;/inst2/v</em>.</p>
</div>
<div class="paragraph">
<p>Access <em>inst2’</em>s <em>u</em> and <em>v</em><br>
<em>/inst2/u;/inst2/v</em></p>
</div>
<div class="paragraph">
<p>Access field <em>x</em> in <em>Point</em>, which is inside the <em>inst2</em> Group<br>
<em>/inst2/Point{x}</em> or <em>/inst2/Point.x</em>.</p>
</div>
<div class="paragraph">
<p><strong>Notes</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a semicolon is a change from DAP2 where clauses in the <em>project
part</em> of the constraint were separated using a comma (<em>,</em>). We used
semicolon because the comma is used elsewhere and using comma here made
for a convoluted grammar. We wanted the grammar to be LALR(1) so that
both table-driven and recursive-descent parsers would be easy to
write.because it’s easy to make both table and recursive descent parsers
for these.</p>
</li>
<li>
<p>Every name in a constraint should be a fully qualified name, except
that if a simple name is referenced inside curly braces (e.g. {x}) for
a variable whose type is a structure or sequence type, S say, and &#8220;x&#8221;
is a top-level field in S, then that is allowed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_array_subsetting_in_index_space">8.3. Array Subsetting in Index Space</h3>
<div class="paragraph">
<p>Subsetting fixed-size arrays in their <em>index space</em> is accomplished
using square brackets. The syntax closely follows that of DAP2, with
some extensions. For an array with <em>N</em> dimensions, <em>N</em> sets of brackets
are used, even if the array is only subset on some of the dimensions.
The names of array variables are fully qualified names (FQNs) so it’s
possible to name arrays in structures and/or Groups. Array index values
are <em>zero-based</em> as with a number of programming languages such as C and
Java. Every array has a known starting index value of zero. Within the
square brackets, several subexpressions are allowed:</p>
</div>
<div class="paragraph">
<p>[ ] <br>
return all of elements elements for a particular dimension <em>or</em> apply a
shared dimension slice (more on this later).</p>
</div>
<div class="paragraph">
<p>[ <em>n</em> ] <br>
return only the value at a single index, where 0 &#8656; n &lt; N for a
dimension of size <em>N</em>. This slicing operator does not reduce the
dimensionality of an array, but does return a dimension size of one for
the dimension to which this is applied.</p>
</div>
<div class="paragraph">
<p>[ <em>start</em> : <em>step</em> : <em>last</em> ] <br>
return every value whose index is in the range <em>start &#8656; index &#8656; last</em>
and where <em>(index - start) % step == 0</em>. This is the complete version of
the syntax.</p>
</div>
<div class="paragraph">
<p>[ <em>start</em> : <em>last</em> ] <br>
return the values whose index is in the range <em>start &#8656; index &#8656; last</em>.</p>
</div>
<div class="paragraph">
<p>[ <em>start</em> : ] <br>
return the values whose index is in the range <em>start &#8656; index &#8656; the
dimension size - 1</em>.</p>
</div>
<div class="paragraph">
<p>[ <em>start</em> : <em>step</em> : ] <br>
return every value whose index is in the range <em>start &#8656; index &#8656;
dimension size - 1</em> and where <em>(index - start) % step == 0</em>.</p>
</div>
<div class="paragraph">
<p>Subsetting can be applied to any array. It can also be applied to a
scalar, but in this case, the only legal forms are <em>[0]</em> or <em>[]</em>.</p>
</div>
<div class="sect3">
<h4 id="_example_subsetting_in_index_space">8.3.1. Example: Subsetting in Index Space</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_3"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Int32&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"v"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Int32&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Point"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Int32 u[256][256];
    Int32 v[256][256];
    Structure {
        Int32 x;
        Int32 y;
    } Point[256];
} vol_1_ce_3;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access all of <em>u</em><br>
<em>/u</em></p>
</div>
<div class="paragraph">
<p>Access all of <em>Point</em> ’s <em>x</em> field<br>
<em>/Point{x}</em> or <em>/Point.x</em>. This returns an array of Structures with a
single (Int32) element, not an array of Int32.</p>
</div>
<div class="paragraph">
<p>Access elements 10 through 19 of array <em>Point</em><br>
<em>/Point[10:19]</em>. DAP4, like DAP2, uses zero-based indexes. This CE will
return the 10th through the 19th elements (Structures in this case) of
the array.</p>
</div>
<div class="paragraph">
<p>Access every 4th element in the <em>Point</em> array<br>
<em>/Point[0:4:255]</em>, or <em>/Point[0:4:]</em>. This is a simple decimation
operation; this CE would return 64 Structures corresponding to elements
at indexes 0, 3, 7, …, 255 of the array.</p>
</div>
<div class="paragraph">
<p>The index-space and field subsetting may be combined in the logical
way<br>
<em>/Point[0:4:]{x}</em> will return an array of structures (with 64 elements)
named <em>Point</em> that contains a single <em>Int32</em> field named <em>x</em>.</p>
</div>
<div class="paragraph">
<p>Other possible CEs:</p>
</div>
<div class="paragraph">
<p><em>/u[0:4:][0:4:]</em><br>
every fourth element in both dimensions; this would return 1/16th of the
array’s data.</p>
</div>
<div class="paragraph">
<p><em>/u[][10:19]</em><br>
elements corresponding to every row and columns 10 through 19.</p>
</div>
<div class="paragraph">
<p><em>/u[7][10:19]</em><br>
elements corresponding to the 8th row and columns 10 through 19.</p>
</div>
<div class="paragraph">
<p><em>u[10:19][10:19]</em><br>
elements corresponding to rows 10 through 19 and columns 10 through 19.</p>
</div>
<div class="paragraph">
<p><em>/u[0:19][0:19]</em><br>
elements corresponding to rows 0 through 19 and columns 0 through 19.</p>
</div>
<div class="paragraph">
<p><em>/u[][]</em><br>
identical to <em>/u</em>, as are <em>/u[0:][0:]</em> and <em>/u[0:1:][0:1:]</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_complex_subsetting_examples">8.3.2. More complex subsetting examples</h4>
<div class="paragraph">
<p>The data model for DAP4 is very similar to that of a modern structured
programming language where <em>constructor types</em> like <em>Structure</em> may
contain any allowed type (including other Structures, etc.) as well as
being arrays themselves. The basic syntax for subsetting outlined so far
can be applied to the fields of a Structure using braces to enclose the
subsetting expression that apply to the fields of the Structure. This
can be applied recursively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_4"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Int32&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Point"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"z"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Int32 u[256][1024];
    Structure {
        Int32 x;
        Int32 y[1024];
        Int32 z[256];
    } Points[256];
} vol_1_ce_4;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>/Points\{y[7:256]}</em> or <em>/Points.y[7:256]</em><br>
Get all of the elements of the Array of Structure <em>Points</em> and for each
of those elements get the elements 7 through 256 from the field array
<em>y</em>. Do not return the field <em>x</em>.</p>
</div>
<div class="paragraph">
<p><em>/Points[0:9]\{y[0:9]}</em> or <em>/Points[0:9].y[0:9]</em><br>
Get the first ten elements of <em>Points</em> and, for each of those, only the
first ten elements of the array <em>y</em>.</p>
</div>
<div class="paragraph">
<p><em>/Points[0:9]\{x;y[0:9]}</em><br>
Get the first ten elements of <em>Points</em> and, for each of those, return
only all of <em>x’ and the first ten elements of the array</em> y<em>.</em></p>
</div>
<div class="paragraph">
<p><em>/Points[0:9]</em><br>
Get the first ten elements of <em>Points</em> (both fields are included)</p>
</div>
<div class="paragraph">
<p><em>/Points</em> or <em>/Points[]</em> or <em>/Points[0:]</em><br>
Get all of <em>Points</em> with the subtle difference that if <em>Points</em> uses a
shared dimension, the last of the three CEs will replace that with an
anonymous dimension (see the section on shared dimensions, below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_5"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"u"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Int32&gt;</span>
  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Points"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"sounding"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"height"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/Int32&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"pressure"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;/Structure&gt;</span>

    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>
<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Int32 u[256][1024];
    Structure {
        Int32 x;
        Int32 y;
        Structure {
            Int32 height[1024];
            Int32 pressure[1024];
        } sounding;
    } Points[256];
} vol_1_ce_5;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>/Points[0]\{x,y,sounding\{height[0:8:]}}</em><br>
Get only the first element of <em>Points</em> and, for that, get the fields
<em>x</em>, <em>y</em> and a slice of <em>sounding</em> where the <em>sounding</em> slice is every
8th element of the field <em>height</em> and elide the field <em>pressure</em>. An
equivalent way of writing this expression is
<em>/Points[0]\{x,y,sounding.height[0:8:]}</em>. The <em>\{}</em> syntax provides an
easy way to request <em>x</em>, <em>y</em> and <em>sounding.height[0:8:]</em> without having
to repeat <em>/Points[0]</em> three times. A CE like
<em>/Points[0].x;/Points[0].y;Points[0].soundings.height[0:8:]</em> is legal,
but <em>/Points[0]</em> will only appear once in the result and a CE where
<em>Points</em> is sliced differently is not legal. That is,
<em>Points[0].x;Points[0:10].y;Points[15].soundings.height[0:8:]</em> is not
legal because <em>Points</em> can appear only once in the result but has been
sliced three different ways in the CE. In any CE, each variable can be
constrained only one way.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_array_subsetting_with_disjoint_index_subsets">8.4. Array subsetting with Disjoint Index Subsets</h3>
<div class="paragraph">
<p>As a new feature in DAP4 constraints, index subset within square
brackets can contain multiple, disjoint slices, where each slice is of
any of the previously defined slice formats (most generally
<em>start:stride:last</em>). The disjoint slices are separated by commas.</p>
</div>
<div class="paragraph">
<p>Using the preceding example (dataset <em>vol_1_ce_4</em>), some disjoint index
examples might be as follows.</p>
</div>
<div class="paragraph">
<p><em>/u[10:12,19:23]</em><br>
Access elements 10 through 12 and 19 through 23 of array <em>u</em>. The result
will be an array of size 3+5 = 11 elements. The values returned will be,
in order,</p>
</div>
<div class="paragraph">
<p><em>u[10] u[11] u[12] u[19] u[20] u[21] u[22] u[23]</em>.</p>
</div>
<div class="paragraph">
<p><em>/u[19:23, 10:12]</em><br>
Access elements 19 through 23 and 10 through 12 of array <em>u</em>. The result
will be an array of size 11, but the values returned will be in a
different order, namely</p>
</div>
<div class="paragraph">
<p><em>u[19] u[20] u[21] u[22] u[23] u[10] u[11] u[12]</em>.</p>
</div>
<div class="paragraph">
<p>In the event that the slices are not disjoint, the result is undefined.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_sequences_fit_into_this_syntax">8.5. How Sequences fit into this syntax</h3>
<div class="paragraph">
<p>The <em>Sequence</em> type is more general data type in DAP4 than in DAP2 where
it was significantly limited. In DAP4 Arrays of Sequences will be
supported as will Sequence fields that are themselves Arrays or
Sequences. A Sequence variable is conceptually like a table of rows
where each field in the Sequence is a column in the table (or like an
array of Structures, where the size of the single array dimension is a
secret). Note that while there is a big difference between the value
held by a Structure and a Sequence, each has the same subsetting syntax
in the CE (although Sequences may have filters applied while Structures
may not).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_6"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"z"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"10"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"s4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"z"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Sequence {
        Int32 x;
        Int32 y;
    } s1;

   Sequence {
        Int32 x;
        Int32 y;
    } s2[100];

    Sequence {
        Int32 z;
        Int32 x[10];
    } s3;

     Sequence {
        Int32 z;
        Int32 x[1024];
    } s4[100];
} example;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>/s1</em><br>
All of Sequence <em>s1</em>.</p>
</div>
<div class="paragraph">
<p><em>/s1\{x;y}</em><br>
Also all of Sequence <em>s1</em>.</p>
</div>
<div class="paragraph">
<p><em>/s1{x}</em> or <em>/s1.x</em><br>
every &#8216;row&#8217; of Sequence <em>s1</em>, but just field <em>x</em>.</p>
</div>
<div class="paragraph">
<p><em>/s2\{x;y}</em><br>
All one hundred Sequences instances (not rows, but full sequences) of
the Array <em>s2</em>. Same as <em>/s2</em> and <em>/s2[0:99]\{x,y}</em> and <em>/s2[]\{x;y}</em>.</p>
</div>
<div class="paragraph">
<p><em>/s2[0:9]\{x;y}</em><br>
The first ten Sequence instances of <em>s2</em>. That would be 10 Sequences and
for each, both the fields <em>x</em> and <em>y</em>.</p>
</div>
<div class="paragraph">
<p><em>/s3\{} | z &lt; 10</em><br>
Every instance of the Sequence <em>s3</em> where z is less than 10. Note that
this is the first example of a <em>filter</em>, a topic that is discussed in
much more detail later on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subsetting_and_shared_dimensions">8.6. Subsetting and Shared Dimensions</h3>
<div class="paragraph">
<p><em>Shared Dimensions</em> provide additional information to indicate that a
group of arrays share certain relationships; that specific groups of the
arrays form <em>coverages</em> by indicating how dimensions of <em>Maps</em> and
<em>Arrays</em> are linked. The DAP4 CE syntax provides a way to slice a Shared
Dimension so that slice can be used by all of the arrays that use it
without repeating the slicing operation for each Array. The syntax can
be read &#8216;Assign the shared dimension <em>X</em> this slice,&#8217; where the slice
looks like, for example, <em>row=[10:19]</em>. All of the variations of the
slice operator possible for an array are accepted for shared dimension
slicing. In any CE, all of the shared dimension slicing clauses must
precede the variable subsetting clauses.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> DAP4 uses XML for it’s actual grammar, and because that’s wordy
this document includes a mock notation. I will extend that notation used
so far so it includes concepts needed to mimic DAP4’s notation for a
coverage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The keyword <em>Dimensions</em> introduces a list of symbols and their sizes.
(That is the definition of a Dimension in DAP4; a size bound to an
identifier.)</p>
</li>
<li>
<p>Arrays where every dimension uses a <em>Dimension</em> to supply its extent
are DAP4 <em>Maps</em>. Maps are the arrays that hold the <em>domain</em> values for a
<em>coverage</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>New 4/15/16</p>
</div>
<div class="paragraph">
<p>Using Shared Dimensions for array slicing adds some complexity to the
processing of constraints. Two cases are important to consider and are
shown in the examples.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a request is made for an Array with Maps but the request names
only the Array and not the Maps, the assumption is made that the
requester intended to receive <em>only</em> the Array and not the Maps. For
example, the client might have already requested/received the Maps. Note
that in this case the CDMR included with the data response will still
include the <em>Map</em> element(s) for the Array, and the receiving client
must know that the associated (Map) variable is not present in the
response.</p>
</li>
<li>
<p>A second case involves requests for two or more Arrays that share Maps
and that constrain (i.e. &#8216;slice&#8217;) those Maps differently. Because this
can introduce a logical inconsistency, when a local dimension slice is
applied to an Array’s dimension that has a Map, using that local
dimension slice will cause the Map to be removed from the data
response’s CDMR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The examples make these two cases clearer.</p>
</div>
<div class="paragraph">
<p>/New</p>
</div>
<div class="sect3">
<h4 id="_example_of_this_syntax">8.6.1. Example of this syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_7"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlat"</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlon"</span> <span class="na">size=</span><span class="s">"50"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>
  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"sal"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"O2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"CO2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"10"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Dimensions: nlat=100, nlon=50;
    Float32 lat[nlat];
    Float32 lon[nlon];

    // The maps ''lat'' and ''lon'' are used here and define a coverage
    Float32 temp[lon][lat];
    Float32 sal[lon][lat];
    Float32 O2[lat][lon];
    Float32 CO2[lon][lat][10];
} shared_dimensions;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_subsetting_using_shared_dimensions">8.6.2. Examples of subsetting using shared dimensions</h4>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];lat[nlat];lon[nlon];temp[nlat][nlon]</em><br>
This will return Dimensions nlat=10, nlon = 10, <em>lat</em>, <em>lon</em> and <em>temp</em>
such that lat an lon are 10 element vectors and <em>temp</em> is a 10 x 10
array.</p>
</div>
<div class="paragraph">
<p>Because the arrays are dimensioned using nlat and nlon in the original
DMR, this expression can also be written as
<em>nlat=[0:9];nlon=[10:19];lat[];lon[];temp[][]</em> or
<em>nlat=[0:9];nlon=[10:19];lat;lon;temp</em></p>
</div>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];lat; lon; temp; sal</em><br>
Same as above, but with both <em>temp</em> and <em>sal</em> included. This example
shows how two or more arrays variables can be accessed along with their
Maps without sending multiple copies of the Maps. Similarly, …</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];lat; lon</em><br>
This CE requests just the arrays that hold the domain values, while …</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];temp; sal</em><br>
This CE requests just the arrays that hold the range values. Taken
together, the two preceding examples support clients that read the
domain values first and then display a map (for example) providing a way
for someone to view the data’s geographical extent before accessing the
values them selves. Also note that there is no restriction that the same
shared dimension slices must be used for both requests; like DAP2, each
request in DAP4 is <em>stateless</em>.</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];temp[][]; sal[][]</em><br>
This CE requests exactly the same data as the previous one, but uses the
<em>[]</em> notation to indicate that the shared dimensions should be used for
the subset. An example below shows how this notation can be used to mix
local and shared dimension slicing.</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:4:];nlon=[0:4:];CO2</em><br>
This CE decimates <em>CO2</em> by returning every fourth value in the first two
dimensions</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:4:];nlon=[0:4:];CO2[][][0:4:]</em><br>
This CE introduces the second meaning for <em>[]</em>. When the empty braces
are used for a dimension that corresponds to a shared dimension, it
means <em>use the shared dimension slice</em>. This is useful because some
arrays contain a mixture of shared and anonymous dimensions and it’s
desirable to slice both, using a shared dimension slice previously
defined where applicable and an anonymous slice where that’s needed.
This expression will decimate <em>CO2</em> by four in each of its three
dimensions.</p>
</div>
<div class="paragraph">
<p><em>nlat=[0:4:];nlon=[0:4:];CO2[][1][0:4:]</em><br>
To override the slicing provided by a shared dimension slice, simply
replace the <em>[]</em> with a local dimension slice.</p>
</div>
<div class="paragraph">
<p>New 4/15/16</p>
</div>
<div class="paragraph">
<p><em>temp</em><br>
This will return only the Array <em>temp</em>. The constraint <em>lat;lon;temp</em>
will return three Arrays: The Map Arrays <em>lat</em> and <em>lon</em> and the &#8216;value
Array&#8217; <em>temp. In both cases the CDMR returned in the response will
include mention of the Maps</em> lat’ and <em>lon</em>. In the first case where
only <em>temp</em> is requested, the client must be savvy (or permissive)
enough to realize that the Map Arrays are not present. In summary, it is
the requester’s responsibility to understand that the Maps are separate
variables and must be explicitly requested. Here are example CDMR
responses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">The CDMR for the CE _temp_:

....
<span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_7"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlat"</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlon"</span> <span class="na">size=</span><span class="s">"50"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The CDMR for the CE <em>lat;lon;temp</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_7"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlat"</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlon"</span> <span class="na">size=</span><span class="s">"50"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>
  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>nlat=[0:9];nlon=[10:19];lat; lon; temp; sal[][8:9]</em><br>
This request is almost the same as the third example, but notice that
<em>sal</em> uses a local dimension slice for its second dimension. This means
that it will not use the <em>nlon=[10:19]</em> slice that <em>temp</em> uses. To avoid
a conflict with the <em>nlon</em> slice and the fact that that is being applied
to <em>temp</em> (and <em>lon</em> in this example), applying a local dimension slice
to an Array with Maps will cause the associated Maps to be elided from
the response’s CDMR. For Arrays with no Maps, this has no effect.</p>
</div>
<div class="paragraph">
<p>The CDMR for the CE <em>temp</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_7"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlat"</span> <span class="na">size=</span><span class="s">"10"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- The effect of ''nlat=[0:9]'' --&gt;</span>
  <span class="nt">&lt;Dimension</span> <span class="na">name=</span><span class="s">"nlon"</span> <span class="na">size=</span><span class="s">"10"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- ... nlon=[10:19] -&gt;

  &lt;Float32 name="lat"&gt;               &lt;!-- We asked for lat and lon --&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>
  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">&gt;</span>              <span class="c">&lt;!-- ... and temp --&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lon"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

  <span class="nt">&lt;Float32</span> <span class="na">name=</span><span class="s">"sal"</span><span class="nt">&gt;</span>              <span class="c">&lt;!-- ... and sal, but... --&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">name=</span><span class="s">"nlon"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">2/</span><span class="nt">&gt;</span>                   <span class="c">&lt;!-- for this dimension, we use a local dim slice --&gt;</span>
    <span class="nt">&lt;Map</span> <span class="na">name=</span><span class="s">"lat"</span><span class="nt">/&gt;</span>               <span class="c">&lt;!-- and thus only one of the two Maps is shown. --&gt;</span>
  <span class="nt">&lt;/Float32&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>/New</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constrained_dmr_objects">8.7. Constrained DMR Objects</h3>
<div class="paragraph">
<p>When a DAP4 server receives a request for a Data response, it must build
and return a Data Response Document that contains a text/xml part
containing a DMR, a separator and a binary part that contains the data
values. The organization of the Data Response Document is described in
detail elsewhere in this document. In this section the focus is on the
DMR returned in the first part of the response and how it relates to the
DMR for the original unconstrained dataset. We refer to the original
dataset’s DMR as the <em>DMR</em> and the DMR associated with the data response
as the <em>CDMR</em> (short-hand for Constrained DMR), although a data response
can be generated using a null CE, we consider that a constraint, too.</p>
</div>
<div class="paragraph">
<p>The DMR contains a number of declarations for the dataset: Enumerations,
Dimensions, Attributes, Groups and Variables. Each DMR and CDMR must
follow the rules for the DMR described in this specification and,
because DAP4 is a stateless protocol, each response from a server must
stand on its own. Since a Constraint Expression alters the data returned
(limiting variables, changing the size of dimensions and so on), it
stands to reason that the contents of the CDMR will vary for any given
dataset based on the CE. Furthermore, a goal of DAP4 is to specify that
the CDMR be &#8216;minimal&#8217; containing no unused definitions.</p>
</div>
<div class="paragraph">
<p>Because filters alter the values of variables, but not whether a
variable is returned, they have no affect on the CDMR. Only the
subsetting operators will be discussed here.</p>
</div>
<div class="sect3">
<h4 id="_enumerations">8.7.1. Enumerations</h4>
<div class="paragraph">
<p>An enumeration is included in the CDMR if and only if some variable or
attribute in the CE references it. A null CE returns the entire dataset,
so it effectively references every variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shared_dimensions">8.7.2. Shared Dimensions</h4>
<div class="paragraph">
<p>Shared Dimension declarations from the DMR are not included in the CDMR
unless the Shared Dimension is used by a variable that has been
projected and that variable does not override that shared dimension
using a local slicing operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_variables_2">8.7.3. Variables</h4>
<div class="paragraph">
<p>Each clause in the constraint must specify a variable and that variable
will be declared in the CDMR. The variable must be referenced by a FQN.</p>
</div>
</div>
<div class="sect3">
<h4 id="_array_variables">8.7.4. Array Variables</h4>
<div class="paragraph">
<p>Array variables follow all the rules for <em>Variables</em> with the additional
conditions that their dimensions may appear altered depending on the CE.
If the local slicing operations are used, then the sliced dimensions
will have the size given be the slice operator, not the size as shown in
the full dataset’s DMR. If a shared dimension is sliced and the Array
uses that slice, then its size will reflect that. Arrays may mix shared
dimension slices and local slices and the result must be correctly
reflected in the specific variable’s declaration.</p>
</div>
<div class="paragraph">
<p>Note that slicing never affects the <em>rank</em> of an array.</p>
</div>
</div>
<div class="sect3">
<h4 id="_structure_variables">8.7.5. Structure Variables</h4>
<div class="paragraph">
<p>If the variable is a Structure, then either the entire Structure is
included or a subset of its fields will be included in the variable
declaration where the fields are those specifically mentioned in a
constraint projection. As with all other variables, each variable in the
structure will have the same rank and type as the original declaration
in the DMR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sequence_variables">8.7.6. Sequence Variables</h4>
<div class="paragraph">
<p>If the variable is a Sequence, then for declaration purposes, it is
treated like a Structure (as above). Note that applying a filter to a
Sequence will not change its declaration form because the number of
records in the sequence is not specified in the DMR. Note also that
mentioning a Sequence field in the filter does not necessarily mean it
will be included in the DMR. It will only be included if it is mentioned
in the projection part of the constraint clause.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groups_2">8.7.7. Groups</h4>
<div class="paragraph">
<p>Each declaration in the CDMR that corresponds to a declaration in the
DMR will cause its containing group (and that group’s parents) to be
included in the CDMR. This ensures that the FQN for a declaration in the
CDMR is the same as in the DMR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attributes">8.7.8. Attributes</h4>
<div class="paragraph">
<p>Attributes are unaffected by the CE and are simply included in the CDMR,
with the stipulation that attributes for variables that are not included
in the CDMR won’t be part of the CDMR. Essentially DAP4 views those
attributes as part of the variables and explicitly excluding the
variable from the CDMR (by providing a CE that does not include it)
excludes its attributes too. Group level attributes will be included if
and only that group appears in the CDMR.</p>
</div>
<div class="paragraph">
<p>There is one situation that bears mention, however. Many datasets
contain variables which include attributes that describe domain-specific
values for for the variables value(s). For example, imagine a
atmospheric profile that includes information about the minimum and
maximum temperatures of that profile. If the values are stored in an
array and the array is sliced so that only a subset of values are
returned, the attributes will provide correct values for the original
data <em>but possibly not the data returned in the response</em> because the
slicing operation has removed some of the values of the array. Because
DAP4 is a <em>domain neutral</em> protocol, it has no knowledge about how the
values of a specific attribute relate to the values of the variable and
cannot adjust the values of the attribute to match the CE.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filters">8.8. Filters</h3>
<div class="paragraph">
<p>While <em>subsetting</em> provides ways to choose data based on the dataset
structure and the types of the variables, <em>filters</em> provide a way to
choose data based on their values. The values to be returned are denoted
using one or more simple predicates. The general syntax for a filter
expression is to follow a subset (projection) expression with a pipe
(<strong>|</strong>) and one or more filter predicates. Multiple predicates are
separated by commas and the value of complete predicate is the logical
AND of the comma-separated subexpressions.</p>
</div>
<div class="paragraph">
<p>Filter expressions can only be applied to Sequence variables (or arrays
of them). In each case the result of the filter operation returns <em>the
same type</em> variable. A Sequence variable is essentially a table of
values and thus can be thought of as containing a number of rows and the
filter expression is applied to <em>each row</em> in the order those rows are
provided to the expression evaluator. Every row that satisfies the
predicate will be included in the value returned; those that don’t will
not be included in the result. Note that no new values are computed by
these operations; no interpolations, means, etc., are performed.</p>
</div>
<div class="paragraph">
<p>The behavior of filtering expressions on Sequences will be covered in
the following sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_filters_and_more_complex_data_types">8.9. Filters and more complex data types</h3>
<div class="paragraph">
<p>The basic syntax for filters is that there is a subsetting expression, a
pipe (<strong>|</strong>) and then one or more filter predicates. This syntax can
appear any place a <em>selection expression</em> can appear, so it can be used
inside braces when an Array or Sequence is a field of a Structure or
Sequence. Note that the filter expression prefix operator binds to the
index subset immediately to its left at the same level (i.e. eliding
braces). Some examples follow.</p>
</div>
<div class="sect3">
<h4 id="_example_filters_on_complex_types">8.9.1. Example: Filters on complex types</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Dataset</span> <span class="na">name=</span><span class="s">"vol_1_ce_9"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"Points1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Int32&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"Points2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"sounding"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"depth"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Sequence&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"Points3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"sounding"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"depth"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"temp"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Sequence&gt;</span>
    <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"20"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Sequence&gt;</span>

  <span class="nt">&lt;Structure</span> <span class="na">name=</span><span class="s">"Points4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"x"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"y"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Sequence</span> <span class="na">name=</span><span class="s">"raw"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"depth"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Int32</span> <span class="na">name=</span><span class="s">"temps"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"4"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/Int32&gt;</span>
      <span class="nt">&lt;Dim</span> <span class="na">size=</span><span class="s">"300"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Sequence&gt;</span>
  <span class="nt">&lt;/Structure&gt;</span>

<span class="nt">&lt;/Dataset&gt;</span>

Dataset {
    Sequence {
        Int32 x[100];
        Int32 y;
    } Points1;

    Sequence {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temp;
        } sounding;
    } Points2;

    Sequence {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temp;
        } sounding;
    } Points3[20];

    Structure {
        Int32 x;
        Int32 y;
        Sequence {
            Int32 depth;
            Int32 temps[4];
        } raw;
    } Points4[100]

} complex_types_example;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>/Points1\{x[0:9]}|y&lt;3</em><br>
For the Sequence <em>Points1</em>, return the rows of data where <em>y</em> is less
than 3. In those rows, subset <em>x</em> so that only the first ten elements
are included. Note that y is mentioned in the filter, but not in the
selection so it will not appear in the resulting DMR.</p>
</div>
<div class="paragraph">
<p><em>/Points2\{x; y; sounding | depth &gt; 20} | x &gt; 17</em><br>
This show, without the added complexity of an array, how filter
expressions associate with Sequences. For the sequence <em>sounding</em> the
filter expression can use only <em>depth</em> and <em>temp</em> (and constants). When
filtering the values of a child sequence, the sequence name must be used
and thus the names of all of the fields of the parent sequence needed in
the result must be listed.</p>
</div>
<div class="paragraph">
<p><em>/Points3[10:19] \{ x; y; sounding | depth &gt; 10 } | 20 &lt; x &lt; 40, y
&lt;35</em><br>
This selection expression first finds the index subset of <em>Points3</em> and
arranges to return the fields <em>x</em>, <em>y</em> and <em>sounding</em> where <em>x</em>and <em>y</em>
satisfy the predicates <em>20 &lt; x &lt; 40</em> and <em>y &lt;35</em> and for the field
<em>sounding</em>, which is a Sequence itself, it will return both fields where
<em>depth &gt; 10</em>. This example points out an important aspect to the syntax
and to expression evaluation: the order of evaluation of the filter
predicates happens after the index and variable and/or field subsetting.
The order of evaluation of the complete filter predicates can happen in
any order (i.e., the <em>20 &lt; x &lt; 40, y &lt;35</em> and <em>depth &gt; 10</em> predicates
can happen in any order. The order of evaluation of the filter predicate
subexpressions (i.e., <em>20 &lt; x &lt; 40</em> and <em>y &lt;35</em>) is also unspecified.</p>
</div>
<div class="paragraph">
<p><em>/Points4[3:2:8] \{x; y; raw\{temps[2] | temps &gt; 7,ND=-1}}</em><br>
In this expression the <em>temps</em> field of the Sequence <em>raw</em> is still an
Array, it’s just an Array with a single element, which illustrates that
neither the subsetting nor filtering operations alter the types of the
variables.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">9. References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="ref1"></a> Caron, J. "<em>Unidata’s Common Data Model Version 4</em>, 2012".
(<a href="https://docs.unidata.ucar.edu/netcdf-java/4.6/userguide/CDM/index.html" class="bare">https://docs.unidata.ucar.edu/netcdf-java/4.6/userguide/CDM/index.html</a>)</p>
</li>
<li>
<p><a id="ref2"></a> Folk, M., Pourmal, E. 2007. HDF5 Data Model, File Format and Library&#8201;&#8212;&#8201;HDF5 1.6. ESDS-RFC-007v1 Recommended Standard. January 2007. <a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-007v1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-007v1.pdf</a>.</p>
</li>
<li>
<p><a id="ref3"></a> Gallagher J., N. Potter, T. Sgouros, S. Hankin, and G. Flierl, <em>The
Data Access Protocol—DAP 2.0</em>, NASA Earth Science Data Systems
Recommended Standard ESE-RFC-004.1.2 (<a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESE-RFC-004v1.1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESE-RFC-004v1.1.pdf</a>).</p>
</li>
<li>
<p><a id="ref4"></a> Hartnett, E., <em>netCDF-4/HDF5 File Format</em>, NASA Earth Science Data
Systems Recommended Standard ESDS-RFC-022, 2011
(<a href="https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-022v1.pdf" class="bare">https://www.earthdata.nasa.gov/s3fs-public/imported/ESDS-RFC-022v1.pdf</a>).</p>
</li>
<li>
<p><a id="ref5"></a> The Internet Society, <em>IETF RFC 2119: Key words for use in RFCs to
Indicate Requirement Levels</em> , 1997
(<a href="http://tools.ietf.org/html/rfc2119" class="bare">http://tools.ietf.org/html/rfc2119</a>).</p>
</li>
<li>
<p><a id="ref6"></a> Gosling, J., B. Joy, G. Steele, G. Bracha, A Buckley, <em>The Java™
Language Specification — 7th Edition</em> Oracle Corporation, 2012,
(<a href="http://docs.oracle.com/javase/specs/jls/se7/html/" class="bare">http://docs.oracle.com/javase/specs/jls/se7/html/</a>).</p>
</li>
<li>
<p><a id="ref7"></a> IEEE, <em>IEEE Standard for Binary Floating-Point Arithmetic, ANSI/IEEE
Std 754-1985</em>, Digital Object Identifier: 10.1109/IEEESTD.1985.82928,
1985.]</p>
</li>
<li>
<p><a id="ref8"></a> The Internet Society, <em>IETF RFC 2396: Uniform Resource Identifiers
(URI): Generic Syntax</em> , 1998 (<a href="http://tools.ietf.org/html/rfc2396" class="bare">http://tools.ietf.org/html/rfc2396</a>).</p>
</li>
<li>
<p><a id="ref9"></a> The Internet Society, <em>IETF RFC 2616: Hypertext Transfer Protocol —
HTTP/1.1</em> , 1999 (<a href="http://tools.ietf.org/html/rfc2616" class="bare">http://tools.ietf.org/html/rfc2616</a>).</p>
</li>
<li>
<p><a id="ref10"></a> The Internet Society, <em>IETF RFC 4506: XDR: External Data
Representation Standard</em>, 2006 (<a href="http://tools.ietf.org/html/rfc4506" class="bare">http://tools.ietf.org/html/rfc4506</a>).</p>
</li>
<li>
<p><a id="ref11"></a> ISO/IEC, <em>Information technology — Portable Operating System Interface
(POSIX) — Part 2: Shell and Utilities</em>, ISO/IEC 9945-2,1993
(<a href="http://www.iso.org/iso/catalogue_detail.htm?csnumber=17841" class="bare">http://www.iso.org/iso/catalogue_detail.htm?csnumber=17841</a>).</p>
</li>
<li>
<p><a id="ref12"></a> The Open Geospatial Consortium Inc., <em>Abstract Specifications</em>,
(<a href="https://www.ogc.org/publications/standard/abstract-specification/" class="bare">https://www.ogc.org/publications/standard/abstract-specification/</a>).</p>
</li>
<li>
<p><a id="ref13"></a> The Organization for the Advancement of Structured Information
Standards, <em>RELAX NG Specification</em>, Committee Specification: 2001, J.
Clark, M. Makoto (eds.) (<a href="http://relaxng.org/spec-20011203.html" class="bare">http://relaxng.org/spec-20011203.html</a>).</p>
</li>
<li>
<p><a id="ref14"></a> The Unicode Consortium. <em>The Unicode Standard, Version 6.2.0</em>, ISBN
978-1-936213-07-8, 2012.</p>
</li>
<li>
<p><a id="ref15"></a> Unidata, <em>CF Metadata</em>, (<a href="https://cfconventions.org/" class="bare">https://cfconventions.org/</a>).</p>
</li>
<li>
<p><a id="ref16"></a> W3C, <em>Extensible Markup Language (XML) 1.0</em>, T. Bray, J. Paoli, C. M.
Sperberg-McQueen, E. Maler, F. Yergeau (eds.), Fifth Edition. 2008
(<a href="http://www.w3.org/TR/2008/REC-xml-20081126/" class="bare">http://www.w3.org/TR/2008/REC-xml-20081126/</a>).</p>
</li>
<li>
<p><a id="ref17"></a> World Meteorological Organization, <em>FM 92 GRIB</em>, edition 2, version 2,
2003 (<a href="https://old.wmo.int/extranet/pages/prog/www/DPS/FM92-GRIB2-11-2003.pdf" class="bare">https://old.wmo.int/extranet/pages/prog/www/DPS/FM92-GRIB2-11-2003.pdf</a>)</p>
</li>
<li>
<p><a id="ref18"></a> The Internet Society, <em>IETF RFC 4180: Uniform Resource Identifiers
(URI): Generic Syntax</em> , 2005  (<a href="https://datatracker.ietf.org/doc/html/rfc4180" class="bare">https://datatracker.ietf.org/doc/html/rfc4180</a>)</p>
</li>
<li>
<p><a id="ref19"></a> W3C DOM-3 glossary for the definition of XML document order (<a href="https://www.w3.org/TR/DOM-Level-3-Core/glossary.html" class="bare">https://www.w3.org/TR/DOM-Level-3-Core/glossary.html</a>).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendices">10. Appendices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_appendix_1_dap4_dmr_syntax_as_a_relax_ng_schema">10.1. Appendix 1. DAP4 DMR Syntax as a RELAX NG Schema</h3>
<div class="paragraph">
<p>This RELAX NG grammar is the definitive formal grammar for the DMR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="c">&lt;!-- RELAX NG Grammar --&gt;</span>
<span class="c">&lt;!-- Date: June 15, 2012 --&gt;</span>
<span class="c">&lt;!-- Last Revised: November 23, 2012 --&gt;</span>

<span class="nt">&lt;grammar</span> <span class="na">xmlns=</span><span class="s">"http://relaxng.org/ns/structure/1.0"</span>
         <span class="na">xmlns:a=</span><span class="s">"http://relaxng.org/ns/compatibility/annotations/1.0"</span>
         <span class="na">datatypeLibrary=</span><span class="s">"http://xml.opendap.org/datatypes/dap4"</span>
         <span class="na">ns=</span><span class="s">"http://xml.opendap.org/ns/DAP/4.0#"</span>
         <span class="nt">&gt;</span>
<span class="nt">&lt;start&gt;</span>
  <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"dataset"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/start&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"dataset"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Dataset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a:documentation&gt;</span>
        Semantic restriction: dapVersion, dmrVersion are required.
    <span class="nt">&lt;/a:documentation&gt;</span>

    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"dapVersion"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_string"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"dmrVersion"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_string"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>

    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"groupbody"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"groupdef"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"groupbody"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"groupbody"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>

  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"dimdef"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"enumdef"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"variable"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"groupdef"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>

<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"enumdef"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Enumeration"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"basetype"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;choice&gt;</span> <span class="c">&lt;!-- Must be consistent with atomictype and variable --&gt;</span>
            <span class="nt">&lt;value&gt;</span>Byte<span class="nt">&lt;/value&gt;</span> <span class="c">&lt;!-- equivalent to UInt8 --&gt;</span>
            <span class="nt">&lt;value&gt;</span>Int8<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>UInt8<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>Int16<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>UInt16<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>Int32<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>UInt32<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>Int64<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>UInt64<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/choice&gt;</span>
    <span class="nt">&lt;/attribute&gt;</span>
    <span class="nt">&lt;oneOrMore&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"enumconst"</span><span class="nt">/&gt;&lt;/oneOrMore&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"enumconst"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"EnumConst"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"value"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_integer"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"namespace"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Namespace"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"href"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_uri"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"dimdef"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Dimension"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a:documentation&gt;</span>
      A Dimension is a binding of a name to a size; when two or more variables
      use the same 'name' it can be inferred that they 'share' that dimension.
      The 'size' attribute must be a positive integer.
    <span class="nt">&lt;/a:documentation&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"size"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_dim"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadatalist"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"dimref"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Dim"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;optional&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_fqn"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;optional&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"size"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_dim"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/attribute&gt;</span>
    <span class="nt">&lt;/optional&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="c">&lt;!-- Atomictype define is only a way
     to list the set of atomictypes;
     it is never used in the grammar
--&gt;</span>
<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"atomictype"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- This must be consistent with "variable" below --&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
    <span class="nt">&lt;value&gt;</span>Char<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Byte<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Int8<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>UInt8<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Int16<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>UInt16<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Int32<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>UInt32<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Int64<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>UInt64<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Float32<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Float64<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>String<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>URL<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Opaque<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value&gt;</span>Enum<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"variable"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"simplevariable"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"structurevariable"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"sequencevariable"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"simplevariable"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
    <span class="c">&lt;!-- Following  must be consistent with "atomictype" --&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Char"</span>   <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Byte"</span>   <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Int8"</span>   <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"UInt8"</span>  <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Int16"</span>  <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"UInt16"</span> <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Int32"</span>  <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"UInt32"</span> <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Int64"</span>  <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"UInt64"</span> <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Float32"</span><span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Float64"</span><span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="c">&lt;!-- Made 'string' capitalized. jhrg --&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"String"</span> <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="c">&lt;!-- Added URL type. jhrg --&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"URL"</span> <span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Opaque"</span><span class="nt">&gt;&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Enum"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"enum"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_fqn"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"variabledef"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;choice&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"dimref"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"mapref"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/choice&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"mapref"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Map"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_fqn"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"structurevariable"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Structure"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;zeroOrMore&gt;</span>
      <span class="nt">&lt;choice&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"dimref"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"variable"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/choice&gt;</span>
    <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"sequencevariable"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Sequence"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;zeroOrMore&gt;</span>
      <span class="nt">&lt;choice&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"dimref"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"variable"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/choice&gt;</span>
    <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"metadatalist"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/zeroOrMore&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"metadata"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;choice&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"otherxml"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"attribute"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/choice&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"attribute"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"atomicattribute"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"containerattribute"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"atomicattribute"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Attribute"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
      <span class="nt">&lt;a:documentation&gt;</span>
        Semantic constraint: type must be compatible
        with the set of attribute value types
      <span class="nt">&lt;/a:documentation&gt;</span>
      <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"type"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;choice&gt;</span>
          <span class="nt">&lt;value&gt;</span>Char<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Byte<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Int8<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>UInt8<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Int16<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>UInt16<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Int32<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>UInt32<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Int64<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>UInt64<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Float32<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Float64<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>String<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>URL<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Enum<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>Opaque<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/choice&gt;</span>
      <span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;optional&gt;</span>
          <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"namespace"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/optional&gt;</span>
      <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;choice&gt;</span>
          <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Value"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"value"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;choice&gt;</span> <span class="c">&lt;!-- technical ambiguity --&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_integer"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_float"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_opaque"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_char"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_string"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_fqn"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- for enum types --&gt;</span>
                <span class="nt">&lt;/choice&gt;</span>
              <span class="nt">&lt;/attribute&gt;</span>
         <span class="nt">&lt;/element&gt;</span>
     <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Value"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_text"</span><span class="nt">/&gt;&lt;/element&gt;</span>
    <span class="nt">&lt;/choice&gt;</span>
      <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"containerattribute"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Attribute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;&lt;data</span> <span class="na">type=</span><span class="s">"dap4_id"</span><span class="nt">/&gt;&lt;/attribute&gt;</span>
    <span class="nt">&lt;zeroOrMore&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"attribute"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/zeroOrMore&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"otherxml"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"OtherXML"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"arbitraryxml"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">"arbitraryxml"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;element&gt;</span>
      <span class="nt">&lt;anyName/&gt;</span>
      <span class="nt">&lt;zeroOrMore&gt;</span>
        <span class="nt">&lt;choice&gt;</span>
          <span class="nt">&lt;attribute&gt;</span>
            <span class="nt">&lt;anyName/&gt;</span>
          <span class="nt">&lt;/attribute&gt;</span>
          <span class="nt">&lt;text/&gt;</span>
          <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">"arbitraryxml"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/choice&gt;</span>
      <span class="nt">&lt;/zeroOrMore&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
<span class="nt">&lt;/define&gt;</span>
<span class="nt">&lt;/grammar&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_appendix_2_dap4_relax_ng_lexical_elements">10.2. Appendix 2. DAP4 RELAX NG Lexical Elements</h3>
<div class="paragraph">
<p>Within the RELAXNG DAP4 grammar there are markers for occurrences of
primitive type such as integers, floats, or strings (ignoring case). The
markers typically look like this when defining an attribute that can
occur in the DAP4 DMR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">"Principal_Investigator"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">"dap4_string"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The &#8220;&lt;data type=`"dap4_string”/&gt;” specifies the lexical class for the
values that this attribute can have. In this case, the
"`Principal_Investigator&#8221; attribute is defined to have a DAP4 string
value. Similar notation is used for values occurring as text within an
xml element.</p>
</div>
<div class="paragraph">
<p>The lexical specification later in this section defines the legal
lexical structure for such items. Specifically, it defines the format of
the following lexical items.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Constants, namely: string, float, integer, character, and opaque.</p>
</li>
<li>
<p>Identifiers</p>
</li>
<li>
<p>Fully qualified names (also referred to as FQNs) (Section
<a href="#Fully_Qualified_Names">5.3</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The specification is written using the extended POSIX regular expression
notation [<a href="#ref11">11</a>] with some additions.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Names are assigned to regular expressions using the notation &#8220;name =
regular-expression&#8221;</p>
</li>
<li>
<p>Named expressions can be used in subsequent regular expressions by
using the notation &#8220;{name}&#8221;. Such occurrences are equivalent to
textually substituting the expression associated with name for the
&#8220;{name}&#8221; occurrence.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The definition of {UTF8} is deferred to the next section.</p>
</li>
<li>
<p>Comments are indicated using the &#8220;//&#8221; notation. Standard xml escape
formats (&amp;x#DDD; or &amp;{name};) are assumed to be used as needed.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_basic_character_set_definitions">10.2.1. Basic character set definitions</h4>
<div class="listingblock">
<div class="content">
<pre>CONTROLS   = [\x00-\x1F] // ASCII control characters

WHITESPACE = [ \r\n\t\f]+

HEXCHAR    = [0-9a-zA-Z]

// ASCII printable characters

ASCII = [0-9a-zA-Z !"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\\]\\^_`|{}~]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ascii_characters_that_may_appear_unescaped_in_identifiers">10.2.2. Ascii characters that may appear unescaped in Identifiers</h4>
<div class="paragraph">
<p>This is assumed to be basically all ASCII printable characters except
these characters: &#8216;.&#8217;, &#8216;/&#8217;, &#8216;“&#8217;, ’’&#8216;, and&#8217;&amp;’. Occurrences of
these characters are assumed to be representable using the standard XML
&amp;{name}; notation (e.g. &amp;). In this expression, backslash is
interpreted as an escape character.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>IDASCII=[0-9a-zA-Z!#$%()*+:;&lt;=&gt;?@\[\]\\^_`|{}~]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_numeric_constant_classes_integer_and_float">10.2.3. The Numeric Constant Classes: integer and float</h4>
<div class="listingblock">
<div class="content">
<pre>INTEGER    = {INT}|{UINT}|{HEXINT}

INT        = [+-][0-9]+{INTTYPE}?

UINT       = [0-9]+{INTTYPE}?

HEXINT     = {HEXSTRING}{INTTYPE}?

INTTYPE    = ([BbSsLl]|"ll"|"LL")

HEXSTRING  = (0[xX]{HEXCHAR}+)

FLOAT      = ({MANTISSA}{EXPONENT}?)|{NANINF}

EXPONENT   = ([eE][+-]?[0-9]+)

MANTISSA   = [+-]?[0-9]*\.[0-9]*

NANINF     = (-?inf|nan|NaN)B.1.4 The String Constant Class

STRING     = ([^"&amp;&lt;&gt;]|{XMLESCAPE})*

CHAR       = ([^'&amp;&lt;&gt;]|{XMLESCAPE})

URL        = (http|https|[:][/][/][a-zA-Z0-9\-]+
             ([.][a-zA-Z\-]+)+([:][0-9]+)?
             ([/]([a-zA-Z0-9\-._,'\\+%)*
             ([?].+)?([#].+)?</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_stringurl_constant_class">10.2.4. The String/URL Constant Class</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">STRING = "\({SIMPLESTRING}{ESCAPEDQUOTE}?\)*"
SIMPLESTRING = [^"\\]
ESCAPEDQOTE=\\"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_opaque_constant_class">10.2.5. The Opaque Constant Class</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">OPAQUE = 0x([0-9A-Fa-f] [0-9A-Fa-f])+</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a semantic constraint that if there is an odd number of hex
digits in the opaque constant, a zero hex digit will be added to the end
to ensure that the constant represents a set of 8-bit bytes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_identifier_class">10.2.6. The Identifier Class</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">ID         = {IDCHAR}+

IDCHAR     = ({IDASCII}|{XMLESCAPE}|{UTF8})

XMLESCAPE  = [<span class="ni">&amp;][#][0-9]+;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_atomic_type_class">10.2.7. The Atomic Type Class</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">ATOMICTYPE =   Char | Byte
             | Int8 | UInt8 | Int16 | UInt16
             | Int32 | UInt32 | Int64 | UInt64
             | Float32 | Float64
             | String | URL
             | Enum
             | Opaque ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This list should be consistent with the atomic types in the grammar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_fully_qualified_name_class">10.2.8. The Fully Qualified Name Class</h4>
<div class="listingblock">
<div class="content">
<pre>FQN      = ([/]{EID})+([.]{EID})*
EID      = {EIDCHAR}+
EIDCHAR  =  ({EIDASCII}|{XMLESCAPE}|{UTF8})
EIDASCII = [0-9a-zA-Z!#$%()*+:;&lt;=&gt;?@\[\]\\^_`|{}~]</pre>
</div>
</div>
<div class="paragraph">
<p>This should be consistent with the definition in Section
<a href="#Fully_Qualified_Names">5.3</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_appendix_3_dap4_type_definitions">10.3. Appendix 3. DAP4 Type Definitions</h3>
<div class="paragraph">
<p>The RELAXNG [<a href="#ref13">13</a>] grammar references the following specific types. For
each type, the following table give the lexical format as defined by the
patterns previously given or by specific patterns as listed.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RELAXNG Data Type Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Lexical Pattern</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{INTEGER}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{FLOAT}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{CHAR}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{STRING}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_opaque</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{OPAQUE}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_fqn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{FQN}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{URL}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dap4_dim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1-9][0-9]*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the above lexical element classes are not disjoint. The type
element &#8220;&lt;datatype=…/&gt;&#8221; should be sufficient to interpret the type
within the DMR.</p>
</div>
</div>
<div class="sect2">
<h3 id="_appendix_4_utf_8">10.4. Appendix 4. UTF-8</h3>
<div class="paragraph">
<p>The UTF-8 specification [<a href="#ref14">14</a>] defines several ways to validate a UTF-8
string of characters.</p>
</div>
<div class="paragraph">
<p>The full (most correct) validating version of UTF8 character set is as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">UTF8 =   ([\xC2-\xDF][\x80-\xBF])
       | (\xE0[\xA0-\xBF][\x80-\xBF])
       | ([\xE1-\xEC][\x80-\xBF][\x80-\xBF])
       | (\xED[\x80-\x9F][\x80-\xBF])
       | ([\xEE-\xEF][\x80-\xBF][\x80-\xBF])
       | (\xF0[\x90-\xBF][\x80-\xBF][\x80-\xBF])
       | ([\xF1-\xF3][\x80-\xBF][\x80-\xBF][\x80-\xBF])
       | (\xF4[\x80-\x8F][\x80-\xBF][\x80-\xBF])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lines of the above expression cover the UTF-8 characters as follows:
1. non-overlong 2-byte 2. excluding overlongs 3. straight 3-byte 4.
excluding surrogates 5. straight 3-byte 6. planes 1-3 7. planes 4-15 8.
plane 16</p>
</div>
<div class="paragraph">
<p>Note that values from 0 through 127 (ASCII and control characters) are
not included in any of these definitions.</p>
</div>
<div class="paragraph">
<p>The above reference also defines some alternative regular expressions.
First, there is what is termed the partially relaxed version of UTF8
defined by this regular expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">UTF8 =    ([\xC0-\xD6][\x80-\xBF])
        | ([\xE0-\xEF][\x80-\xBF][\x80-\xBF])
        | ([\xF0-\xF7][\x80-\xBF][\x80-\xBF][\x80-\xBF])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second, there is what is termed the most-relaxed version of UTF8 defined
by this regular expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">UTF8 = ([\xC0-\xD6]...)|([\xE0-\xEF)...)|([\xF0 \xF7]...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any conforming DAP4 implementation MUST use at least the most-relaxed
expression for validating UTF-8 character strings, but MAY use either
the partially-relaxed or the full validation expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="_appendix_5_lalr1_grammar_for_dmr_using_bison_notation">10.5. Appendix 5. LALR(1) Grammar for DMR using Bison Notation</h3>
<div class="paragraph">
<p>It is conventient to have a Bison grammar that corresponds to the above
RELAX NG grammar. If there is a conflict, then the RELAX NG grammar is
considered correct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">%start dataset
%%
dataset:
    DATASET_
    xml_attribute_list
    groupbody
    _DATASET
    ;

group:
    GROUP_
    ATTR_NAME
    groupbody
    _GROUP
    ;

groupbody:
      %empty
    | groupbody dimdef
    | groupbody enumdef
    | groupbody variable
    | groupbody metadata
    | groupbody group
    ;

enumdef:
    ENUMERATION_
    xml_attribute_list
    enumconst_list
    _ENUMERATION
    ;

enumconst_list:
      enumconst
    | enumconst_list enumconst
    ;

enumconst:
      ENUMCONST_ ATTR_NAME ATTR_VALUE _ENUMCONST
    | ENUMCONST_ ATTR_VALUE ATTR_NAME _ENUMCONST
    ;

dimdef:
    DIMENSION_
    xml_attribute_list
    metadatalist
    _DIMENSION
    ;

dimref:
      DIM_ ATTR_NAME _DIM
    | DIM_ ATTR_SIZE _DIM
    ;

variable:
      atomicvariable
    | enumvariable
    | structurevariable
    | sequencevariable
    ;

atomicvariable:
    atomictype_
    ATTR_NAME
    varbody
    _atomictype
    ;

enumvariable:
    ENUM_
    xml_attribute_list
    varbody
    _ENUM
    ;

atomictype_:
      CHAR
    | BYTE
    | INT8
    | UINT8
    | INT16
    | UINT16
    | INT32
    | UINT32
    | INT64
    | UINT64
    | FLOAT32
    | FLOAT64
    | STRING
    | URL
    | OPAQUE
    ;

_atomictype:
      _CHA
    | _BYT
    | _INT
    | _UINT
    | _INT1
    | _UINT1
    | _INT3
    | _UINT3
    | _INT6
    | _UINT6
    | _FLOAT3
    | _FLOAT6
    | _STRIN
    | _UR
    | _OPAQU
    | _ENUM
    ;

varbody:
      %empty
    | varbody dimref
    | varbody mapref
    | varbody metadata
    ;

mapref:
    MAP_
    ATTR_NAME
    metadatalist
    _MAP
    ;

structurevariable:
    STRUCTURE_
    ATTR_NAME
    structbody
    _STRUCTURE
    ;

structbody:
      %empty
    | structbody variable
    | structbody dimref
    | structbody mapref
    | structbody metadata
    ;

sequencevariable:
    SEQUENCE_
    ATTR_NAME
    sequencebody
    _SEQUENCE
    ;

sequencebody:
      %empty
    | sequencebody dimref
    | sequencebody variable
    | sequencebody mapref
    | sequencebody metadata
    ;

metadatalist:
      %empty
    | metadatalist metadata
    ;

metadata:
      attribute
    ;

attribute:
      atomicattribute
    | containerattribute
    | otherxml
    ;


atomicattribute:
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      valuelist
      _ATTRIBUTE
    |
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      _ATTRIBUTE
    ;

namespace_list:
      %empty
    | namespace_list namespace
    ;

namespace:
    NAMESPACE_
    ATTR_HREF
    _NAMESPACE
    ;

containerattribute:
      ATTRIBUTE_
      xml_attribute_list
      namespace_list
      attributelist
      _ATTRIBUTE
    ;

attributelist:
      attribute
    | attributelist attribute
    ;

valuelist:
      value
    | valuelist value
    ;

value:
      VALUE_ TEXT _VALUE
    | VALUE_ ATTR_VALUE _VALUE
    ;

otherxml:
    OTHERXML_
    xml_attribute_list
    xml_body
    _OTHERXML
    ;

xml_body:
      element_or_text
    | xml_body element_or_text
    ;

element_or_text:
      xml_open
      xml_attribute_list
      xml_body
      xml_close
    | TEXT
    ;

xml_attribute_list:
      %empty
    | xml_attribute_list xml_attribute
    ;

xml_attribute:
      ATTR_BASE
    | ATTR_BASETYPE
    | ATTR_DAPVERSION
    | ATTR_DMRVERSION
    | ATTR_ENUM
    | ATTR_HREF
    | ATTR_NAME
    | ATTR_NAMESPACE
    | ATTR_NS
    | ATTR_SIZE
    | ATTR_TYPE
    | ATTR_VALUE
    ;

xml_open:
      DATASET_
    | GROUP_
    | ENUMERATION_
    | ENUMCONST_
    | NAMESPACE_
    | DIMENSION_
    | DIM_
    | ENUM_
    | MAP_
    | STRUCTURE_
    | SEQUENCE_
    | VALUE_
    | ATTRIBUTE_
    | OTHERXML_
    | CHAR_
    | BYTE_
    | INT8_
    | UINT8_
    | INT16_
    | UINT16_
    | INT32_
    | UINT32_
    | INT64_
    | UINT64_
    | FLOAT32_
    | FLOAT64_
    | STRING_
    | URL_
    | OPAQUE_
    ;

xml_close:
      _DATASET
    | _GROUP
    | _ENUMERATION
    | _ENUMCONST
    | _NAMESPACE
    | _DIMENSION
    | _DIM
    | _ENUM
    | _MAP
    | _STRUCTURE
    | _SEQUENCE
    | _VALUE
    | _ATTRIBUTE
    | _OTHERXML
    | _CHAR
    | _BYTE
    | _INT8
    | _UINT8
    | _INT16
    | _UINT16
    | _INT32
    | _UINT32
    | _INT64
    | _UINT64
    | _FLOAT32
    | _FLOAT64
    | _STRING
    | _URL
    | _OPAQUE
    ;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lexical_tokens_for_bison_grammar">10.5.1. Lexical Tokens for Bison Grammar</h4>
<div class="paragraph">
<p>The above Bison grammar assumes a corresponding lexer that will return a
set of token types (listed below). The token with a trailing underscore
represents an opening XML element and a token with a leading underscore
represents a closing XML element. So, for example, token <em>DATASET<em> is
_&lt;Dataset&gt;</em> and token </em>DATASET_ is <em>&lt;/Dataset&gt;</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">/* XML Element Names */
%token DATASET_ _DATASET
%token GROUP_ _GROUP
%token ENUMERATION_ _ENUMERATION
%token ENUMCONST_ _ENUMCONST
%token NAMESPACE_ _NAMESPACE
%token DIMENSION_ _DIMENSION
%token DIM_ _DIM
%token MAP_ _MAP
%token STRUCTURE_ _STRUCTURE
%token SEQUENCE_ _SEQUENCE
%token VALUE_ _VALUE
%token ATTRIBUTE_ _ATTRIBUTE
%token OTHERXML_ _OTHERXML
%token ERROR_ _ERROR
%token MESSAGE_ _MESSAGE
%token CONTEXT_ _CONTEXT
%token OTHERINFO_ _OTHERINFO

/* XML Element Names for Atomic Types*/
%token CHAR_ _CHAR
%token BYTE_ _BYTE
%token INT8_ _INT8
%token UINT8_ _UINT8
%token INT16_ _INT16
%token UINT16_ _UINT16
%token INT32_ _INT32
%token UINT32_ _UINT32
%token INT64_ _INT64
%token UINT64_ _UINT64
%token FLOAT32_ _FLOAT32
%token FLOAT64_ _FLOAT64
%token STRING_ _STRING
%token URL_ _URL
%token OPAQUE_ _OPAQUE
%token ENUM_ _ENUM

/* XML Attribute Names */
%token ATTR_BASE ATTR_BASETYPE ATTR_DAPVERSION ATTR_DMRVERSION
%token ATTR_ENUM ATTR_HREF ATTR_NAME ATTR_NAMESPACE
%token ATTR_NS ATTR_SIZE ATTR_TYPE ATTR_VALUE
%token ATTR_HTTPCODE

/* Arbitrary XML Text */
%token TEXT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_appendix_6_lalr1_grammar_for_constraints_using_bison_notation">10.6. Appendix 6. LALR(1) Grammar for Constraints using Bison Notation</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">%start constraint
%%
constraint:
    dimredeflist
    clauselist
    ;

dimredeflist:
          %empty
        | dimredeflist ';' dimredef
        ;

clauselist:
          clause
        | clauselist ';' clause
        ;

clause:
          projection
    | selection
        ;

projection:
    segmenttree
        ;

segmenttree:
          segment
        | segmenttree '.' segment
        | segmenttree '.' '{' segmentforest '}'
        | segmenttree '{' segmentforest '}'
        ;

segmentforest:
      segmenttree
    | segmentforest ',' segmenttree
    ;

segment:
          NAME
        | NAME slicelist
        ;

slicelist:
          slice
        | slicelist slice
        ;

slice:
          '[' ']'
        | '[' subsetlist ']'
    ;

subsetlist:
      subset
    | subsetlist ',' subset
    ;

subset:
           index
        |  index ':' index
        |  index ':' index ':' index
        |  index ':'
        |  index ':' index ':'
        ;

index:  INTEGER ;

selection:
        segmenttree '|' filter
        ;

filter:
          predicate
        | predicate ',' predicate  /* ',' == AND */
        | '!' predicate %prec NOT
        ;

predicate:
          primary relop primary
        | primary relop primary relop primary
        | primary eqop primary
        ;

relop:
      '<span class="ni">&amp;lt;</span>' '='
    | '<span class="ni">&amp;gt;</span>' '='
    | '<span class="ni">&amp;lt;</span>'
    | '^gt;'
    ;

eqop:
      '=' '='
    | '!' '='
    | '~' '='
    ;

primary:
          fieldname
        | constant
        | '(' predicate ')'
    ;

dimredef: NAME '=' slice ;

fieldname: NAME

constant: STRING | INTEGER | DOUBLE | BOOLEAN ;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lexical_tokens_for_bison_grammar_for_constraints">10.6.1. Lexical Tokens for Bison Grammar for Constraints</h4>
<div class="paragraph">
<p>The primary lexical tokens for constraints are: NAME, STRING, INTEGER,
DOUBLE, BOOLEAN.</p>
</div>
<div class="paragraph">
<p>These lexemes are intended to match the patterns defined for the RELAX
NG grammar.</p>
</div>
<div class="paragraph">
<p>Retrieved from
<a href="https://docs.opendap.org/index.php?title=DAP4:_Specification_Volume_1&amp;oldid=13089" class="bare">https://docs.opendap.org/index.php?title=DAP4:_Specification_Volume_1&amp;oldid=13089</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.opendap.org/index.php?title=Special:Categories">Categories</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.opendap.org/index.php?title=Category:Development">Development</a></p>
</li>
<li>
<p><a href="https://docs.opendap.org/index.php?title=Category:DAP4">DAP4</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-23 13:50:12 -0700
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>